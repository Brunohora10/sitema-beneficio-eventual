{"files":[{"id":"7f4c1b3d-7db6-4eb5-b152-bc1c59fd96b7","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/Sao_Paulo\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_ACCESSING\",\n    \"access\": \"ANYONE\"\n  }\n}"},{"id":"46698b23-d7b2-43b0-a831-c858cc5d02f4","name":"index","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cbase target\u003d\"_top\"\u003e\n    \u003cstyle\u003e\n      body {\n        font-family: Arial, sans-serif;\n        padding: 30px;\n        background-color: #f4f4f4;\n      }\n      .container {\n        max-width: 400px;\n        margin: auto;\n        background: white;\n        padding: 20px;\n        border-radius: 10px;\n        box-shadow: 0px 0px 10px rgba(0,0,0,0.1);\n      }\n      select, input[type\u003d\"text\"], input[type\u003d\"password\"] {\n        width: 100%;\n        padding: 10px;\n        margin: 8px 0;\n        border: 1px solid #ccc;\n        border-radius: 5px;\n      }\n      button {\n        width: 100%;\n        padding: 10px;\n        background-color: #4CAF50;\n        color: white;\n        border: none;\n        border-radius: 5px;\n        cursor: pointer;\n      }\n      button:hover {\n        background-color: #45a049;\n      }\n      #mensagemLogin {\n        text-align: center;\n        margin-top: 15px;\n        font-weight: bold;\n      }\n    \u003c/style\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003cdiv class\u003d\"container\"\u003e\n      \u003ch2 style\u003d\"text-align:center\"\u003eLogin do Sistema\u003c/h2\u003e\n      \u003clabel for\u003d\"setor\"\u003eSetor:\u003c/label\u003e\n      \u003cselect id\u003d\"setor\"\u003e\n        \u003coption value\u003d\"CRAS ANGELA MARIA (NOVO HORIZONTE)\"\u003eCRAS ANGELA MARIA (NOVO HORIZONTE)\u003c/option\u003e\n        \u003coption value\u003d\"CRAS DR. FRANKLIN (PARQUE DOS FAROIS)\"\u003eCRAS DR. FRANKLIN (PARQUE DOS FAROIS)\u003c/option\u003e\n        \u003coption value\u003d\"CRAS MARIA JOS√â (JARDIM)\"\u003eCRAS MARIA JOS√â (JARDIM)\u003c/option\u003e\n        \u003coption value\u003d\"CRAS PROF MARIA LUIZA (MARCOS FREIRE I)\"\u003eCRAS PROF MARIA LUIZA (MARCOS FREIRE I)\u003c/option\u003e\n        \u003coption value\u003d\"CRAS ZILDA ARNS (JO√ÉO ALVES)\"\u003eCRAS ZILDA ARNS (JO√ÉO ALVES)\u003c/option\u003e\n        \u003coption value\u003d\"CREAS MARCOS FREIRE\"\u003eCREAS MARCOS FREIRE\u003c/option\u003e\n        \u003coption value\u003d\"CREAS LEONEL BRIZOLA (PARQUE DOS FAROIS)\"\u003eCREAS LEONEL BRIZOLA (PARQUE DOS FAROIS)\u003c/option\u003e\n        \u003coption value\u003d\"Admin\"\u003eAdmin\u003c/option\u003e\n      \u003c/select\u003e\n\n      \u003clabel for\u003d\"usuario\"\u003eUsu√°rio:\u003c/label\u003e\n      \u003cinput type\u003d\"text\" id\u003d\"usuario\" placeholder\u003d\"Digite o usu√°rio\"\u003e\n\n      \u003clabel for\u003d\"senha\"\u003eSenha:\u003c/label\u003e\n      \u003cinput type\u003d\"password\" id\u003d\"senha\" placeholder\u003d\"Digite a senha\"\u003e\n\n      \u003cbutton onclick\u003d\"validarLoginFront()\"\u003eEntrar\u003c/button\u003e\n\n      \u003cdiv id\u003d\"mensagemLogin\"\u003e\u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cscript\u003e\n      function validarLoginFront() {\n        const setor \u003d document.getElementById(\u0027setor\u0027).value;\n        const usuario \u003d document.getElementById(\u0027usuario\u0027).value;\n        const senha \u003d document.getElementById(\u0027senha\u0027).value;\n\n        const mensagem \u003d document.getElementById(\u0027mensagemLogin\u0027);\n        mensagem.textContent \u003d \"Validando...\";\n        mensagem.style.color \u003d \u0027black\u0027;\n\n        google.script.run.withSuccessHandler(function (resposta) {\n          if (resposta.status) {\n            mensagem.style.color \u003d \u0027green\u0027;\n            mensagem.textContent \u003d \"‚úÖ Login bem-sucedido!\";\n          } else {\n            mensagem.style.color \u003d \u0027red\u0027;\n            mensagem.textContent \u003d \"‚ùå Erro: \" + resposta.mensagem;\n          }\n        }).validarLogin(setor, usuario, senha);\n      }\n    \u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n"},{"id":"143f4af3-f5d4-4794-a8a6-24d96454b6ad","name":"code","type":"server_js","source":"/************************\n * CONFIGURA√á√ïES\n ************************/\nconst PLANILHA_ID    \u003d \u00271_jNjcdd27uAqJ-TpfMFvPIAYVAmhZKK6Piyc_DOFjhY\u0027;\nconst ID_TEMPLATE    \u003d \u00271H9ptzXaKu0I9Ngg48e3lhMVTUzKQa863fkgTU4xdEjE\u0027;\nconst FOLDER_PDFS_ID \u003d \u00271VhKkhGVFACNA8DYDj54L_ByxhyU4Dz-n\u0027;\nconst TZ             \u003d \u0027America/Sao_Paulo\u0027;\n\nconst RESPOSTAS_SHEET_NAME \u003d \u0027Respostas\u0027;\nconst CPF_HEADER           \u003d \u0027CPF\u0027;\n\n// Cabe√ßalhos compartilhados\nconst BAIXAS_SHEET_NAME \u003d \u0027Baixas\u0027;\nconst ENTREGUE_HEADER   \u003d \u0027Entregue\u0027;\nconst ENTREGUE_EM_HDR   \u003d \u0027Entregue em\u0027;\nconst ENTREGUE_POR_HDR  \u003d \u0027Entregue por\u0027;\nconst ENTREGUE_UNID_HDR \u003d \u0027Unidade de Entrega\u0027;\nconst ENTREGUE_OBS_HDR  \u003d \u0027Obs Entrega\u0027;\nconst PROTOCOLO_HDR     \u003d \u0027Protocolo\u0027;\n\n// E-mail\nconst OUTBOX_SHEET_NAME \u003d \u0027FilaEmails\u0027;\nconst OUTBOX_MAX_TRIES  \u003d 5;\nconst COPIA_EMAIL       \u003d \u0027\u0027; // opcional\n\n/************************\n * ROUTER / VIEWS (AJUSTADO)\n ************************/\nfunction doGet(e) {\n  try { ensureOutboxSheet_(); ensureQueueTrigger_(); } catch (err) { Logger.log(\u0027[BOOT] \u0027 + (err.message || err)); }\n\n  const viewRaw \u003d (e \u0026\u0026 e.parameter \u0026\u0026 e.parameter.view) ? String(e.parameter.view) : \u0027login\u0027;\n  const view \u003d (viewRaw || \u0027\u0027).trim().toLowerCase();\n\n  const map \u003d {\n    login:\u0027login\u0027,\n    hub:\u0027hub\u0027,\n    formulario:\u0027formulario\u0027,\n    baixa:\u0027baixa\u0027,\n    central:\u0027central\u0027,\n    admin:\u0027admin\u0027,\n    analista:\u0027analista\u0027,\n    ti:\u0027ti\u0027\n  };\n\n  const file \u003d map[view] || \u0027login\u0027;\n\n  try {\n    // ‚úÖ serve como TEMPLATE (evaluate) ‚Äî resolve include(), vari√°veis, etc.\n    return renderHtmlFile_(file, { view })\n      .setTitle(\u0027Sistema SEMFAS\u0027)\n      .addMetaTag(\u0027viewport\u0027, \u0027width\u003ddevice-width, initial-scale\u003d1\u0027)\n      .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);\n\n  } catch (err) {\n    return HtmlService\n      .createHtmlOutput(errorHtml_(\u0027View n√£o encontrada: \u0027 + file + \u0027.html\u0027, err, true))\n      .setTitle(\u0027Sistema SEMFAS\u0027)\n      .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);\n  }\n}\n\n/**\n * Renderiza arquivo HTML como Template (com evaluate).\n * Use isso SEMPRE quando seu HTML tiver \u003c?!\u003d include() ?\u003e ou vari√°veis.\n */\nfunction renderHtmlFile_(file, data){\n  const t \u003d HtmlService.createTemplateFromFile(file);\n  t.view \u003d (data \u0026\u0026 data.view) ? data.view : \u0027\u0027;\n  t.ctx  \u003d (data \u0026\u0026 data.ctx)  ? data.ctx  : {};\n  return t.evaluate();\n}\n\n/**\n * Retorna HTML em STRING (para quando voc√™ usa google.script.run e troca a tela no front).\n * Tamb√©m usando TEMPLATE (evaluate) pra n√£o dar null/erro.\n */\nfunction renderView(view, ctx){\n  const map \u003d {\n    login:\u0027login\u0027,\n    hub:\u0027hub\u0027,\n    formulario:\u0027formulario\u0027,\n    baixa:\u0027baixa\u0027,\n    central:\u0027central\u0027,\n    admin:\u0027admin\u0027,\n    analista:\u0027analista\u0027,\n    ti:\u0027ti\u0027\n  };\n  const file \u003d map[(view||\u0027\u0027).toString().trim().toLowerCase()] || \u0027login\u0027;\n\n  try{\n    return renderHtmlFile_(file, { view:file, ctx: ctx || {} }).getContent();\n  } catch (err){\n    return errorHtml_(\u0027Erro ao renderizar: \u0027 + file + \u0027.html\u0027, err, false);\n  }\n}\n\nfunction include(file){\n  // usado dentro do HTML: \u003c?!\u003d include(\u0027arquivo\u0027) ?\u003e\n  return HtmlService.createHtmlOutputFromFile(file).getContent();\n}\n\n/** ‚úÖ Fun√ß√£o gen√©rica para o front pedir qualquer tela */\nfunction getTelaHtml(view, ctx){\n  return renderView(view, ctx);\n}\n\n/** Compat√≠veis com seu front atual */\nfunction getFormularioHtml(){ return renderView(\u0027formulario\u0027); }\nfunction getAdminHtml()     { return renderView(\u0027admin\u0027); }\nfunction getCentralHtml()   { return renderView(\u0027central\u0027); }\nfunction getAnalistaHtml()  { return renderView(\u0027analista\u0027); }\nfunction getHubHtml()       { return renderView(\u0027hub\u0027); }\nfunction getBaixaHtml()     { return renderView(\u0027baixa\u0027); }\nfunction getTiHtml()        { return renderView(\u0027ti\u0027); }\n\n/** P√°gina de erro (pra nunca ficar ‚Äútela branca‚Äù) */\nfunction errorHtml_(title, err, autoBackToLogin){\n  const msg \u003d (err \u0026\u0026 (err.stack || err.message)) ? (err.stack || err.message) : String(err);\n  return `\n\u003c!doctype html\u003e\n\u003chtml\u003e\n\u003chead\u003e\n  \u003cmeta charset\u003d\"utf-8\"\u003e\n  \u003cmeta name\u003d\"viewport\" content\u003d\"width\u003ddevice-width,initial-scale\u003d1\"\u003e\n  \u003ctitle\u003e${escapeHtml_(title)}\u003c/title\u003e\n  \u003cstyle\u003e\n    body{font-family:Arial,system-ui;padding:18px;background:#f8fafc;color:#0f172a}\n    .card{max-width:980px;margin:0 auto;background:#fff;border:1px solid #e2e8f0;border-radius:14px;padding:16px}\n    pre{white-space:pre-wrap;background:#0b1220;color:#e5e7eb;padding:12px;border-radius:12px;overflow:auto}\n    a{color:#2563eb;font-weight:700}\n  \u003c/style\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n  \u003cdiv class\u003d\"card\"\u003e\n    \u003ch2\u003e${escapeHtml_(title)}\u003c/h2\u003e\n    \u003cp\u003eCopie o erro abaixo e me mande aqui.\u003c/p\u003e\n    \u003cpre\u003e${escapeHtml_(msg)}\u003c/pre\u003e\n    ${autoBackToLogin ? `\u003cp\u003e\u003ca href\u003d\"?view\u003dlogin\"\u003eVoltar ao login\u003c/a\u003e\u003c/p\u003e` : ``}\n  \u003c/div\u003e\n  ${autoBackToLogin ? `\u003cscript\u003esetTimeout(()\u003d\u003elocation.search\u003d\u0027?view\u003dlogin\u0027, 1500)\u003c/script\u003e` : ``}\n\u003c/body\u003e\n\u003c/html\u003e`;\n}\n\nfunction escapeHtml_(s){\n  return (s ?? \u0027\u0027).toString()\n    .replace(/\u0026/g,\u0027\u0026amp;\u0027).replace(/\u003c/g,\u0027\u0026lt;\u0027)\n    .replace(/\u003e/g,\u0027\u0026gt;\u0027).replace(/\"/g,\u0027\u0026quot;\u0027)\n    .replace(/\u0027/g,\u0027\u0026#039;\u0027);\n}\n\n/************************\n * LOGIN\n ************************/\nfunction canonicalSectorKey_(s){\n  return (s || \u0027\u0027).toString()\n    .replace(/\\u00A0/g,\u0027 \u0027)\n    .replace(/[\\u200B-\\u200D\\uFEFF]/g,\u0027\u0027)\n    .normalize(\u0027NFD\u0027).replace(/[\\u0300-\\u036f]/g,\u0027\u0027)\n    .replace(/\\s+/g,\u0027 \u0027)\n    .trim()\n    .toLowerCase()\n    .replace(/[^a-z0-9]/g,\u0027\u0027);\n}\n\nfunction cleanSectorLabel_(s){\n  return (s || \u0027\u0027).toString()\n    .replace(/\\u00A0/g,\u0027 \u0027)\n    .replace(/[\\u200B-\\u200D\\uFEFF]/g,\u0027\u0027)\n    .replace(/\\s+/g,\u0027 \u0027)\n    .trim();\n}\n\nfunction listarSetores() {\n  const ss  \u003d SpreadsheetApp.openById(PLANILHA_ID);\n  const sh  \u003d ss.getSheetByName(\u0027Login\u0027);\n  if (!sh) throw new Error(\u0027Aba \"Login\" n√£o encontrada.\u0027);\n\n  const lastRow \u003d sh.getLastRow();\n  const lastCol \u003d sh.getLastColumn();\n  if (lastRow \u003c 2) throw new Error(\u0027Aba \"Login\" sem dados.\u0027);\n\n  const headers \u003d sh.getRange(1,1,1,lastCol).getValues()[0];\n  let colIdx \u003d findColIdx_(headers, \u0027Setor\u0027,\u0027Unidade\u0027,\u0027Setor/Unidade\u0027,\u0027Setor (Unidade)\u0027);\n  if (colIdx \u003c 0) {\n    const row2 \u003d sh.getRange(2,1,1,lastCol).getValues()[0];\n    colIdx \u003d row2.findIndex(v \u003d\u003e String(v||\u0027\u0027).trim() !\u003d\u003d \u0027\u0027);\n    if (colIdx \u003c 0) colIdx \u003d 0;\n  }\n\n  const valores \u003d sh.getRange(2, colIdx+1, lastRow-1, 1).getValues().map(r\u003d\u003er[0]);\n  const mapa \u003d new Map();\n  valores.forEach(v \u003d\u003e {\n    const label \u003d cleanSectorLabel_(v);\n    if (!label) return;\n    mapa.set(canonicalSectorKey_(label), label);\n  });\n\n  const setores \u003d Array.from(mapa.values()).sort((a,b)\u003d\u003ea.localeCompare(b,\u0027pt-BR\u0027,{sensitivity:\u0027base\u0027}));\n  if (!setores.length) throw new Error(\u0027Nenhum setor encontrado na aba \"Login\".\u0027);\n  return setores;\n}\n\nfunction isHubSector_(label){\n  const s \u003d cleanSectorLabel_(label).toUpperCase();\n  return s.includes(\u0027CRAS\u0027) || s.includes(\u0027CREAS\u0027) || s.includes(\u0027CRAM\u0027) ||\n         s.includes(\u0027SEDE\u0027) || s.includes(\u0027CENTROPOP\u0027) || s.includes(\u0027CENTRO POP\u0027) || s.includes(\u0027CENTRO-POP\u0027);\n}\n\nfunction getLoginIdx_(headers){\n  return {\n    setor: findColIdx_(headers, \u0027Setor\u0027,\u0027Unidade\u0027,\u0027Setor/Unidade\u0027),\n    user:  findColIdx_(headers, \u0027Usu√°rio\u0027,\u0027Usuario\u0027,\u0027User\u0027,\u0027Login\u0027),\n    pass:  findColIdx_(headers, \u0027Senha\u0027,\u0027Password\u0027),\n    email: findColIdx_(headers, \u0027E-mail\u0027,\u0027Email\u0027),\n    role:  findColIdx_(headers, \u0027Perfil\u0027,\u0027Role\u0027,\u0027Permiss√£o\u0027,\u0027Permissao\u0027)\n  };\n}\n\n/** ‚úÖ (FALTAVA) Mapeia perfil -\u003e view direta */\nfunction getDirectViewForRole_(role){\n  const r \u003d String(role || \u0027usuario\u0027).trim().toLowerCase();\n  if (!r) return \u0027formulario\u0027;\n\n  if (r.includes(\u0027admin\u0027))    return \u0027admin\u0027;\n  if (r.includes(\u0027central\u0027))  return \u0027central\u0027;\n  if (r.includes(\u0027analista\u0027)) return \u0027analista\u0027;\n  if (r \u003d\u003d\u003d \u0027ti\u0027 || r.includes(\u0027ti\u0027)) return \u0027ti\u0027;\n  if (r.includes(\u0027baixa\u0027))    return \u0027baixa\u0027;\n\n  // padr√£o: usu√°rio comum cai no formul√°rio/hub\n  return \u0027formulario\u0027;\n}\n\nfunction verificarLogin(setor, usuario, senha) {\n  const aba \u003d SpreadsheetApp.openById(PLANILHA_ID).getSheetByName(\u0027Login\u0027);\n  if (!aba) return { ok:false };\n\n  const lastRow \u003d aba.getLastRow();\n  const lastCol \u003d aba.getLastColumn();\n  if (lastRow \u003c 2) return { ok:false };\n\n  const headers \u003d aba.getRange(1,1,1,lastCol).getValues()[0] || [];\n  const idx \u003d getLoginIdx_(headers);\n\n  // fallback se n√£o achar cabe√ßalho\n  if (idx.setor \u003c 0) idx.setor \u003d 0;\n  if (idx.user  \u003c 0) idx.user  \u003d 1;\n  if (idx.pass  \u003c 0) idx.pass  \u003d 2;\n  if (idx.role  \u003c 0) idx.role  \u003d 4;\n\n  const dados \u003d aba.getRange(2,1,lastRow-1,lastCol).getValues();\n\n  const setorKey \u003d canonicalSectorKey_(setor);\n  const userKey  \u003d canonicalSectorKey_(usuario);\n  const pass     \u003d String(senha || \u0027\u0027).trim();\n\n  for (let i\u003d0; i\u003cdados.length; i++) {\n    const row  \u003d dados[i];\n    const set  \u003d cleanSectorLabel_(row[idx.setor] || \u0027\u0027);\n    const usr  \u003d String(row[idx.user] || \u0027\u0027);\n    const pwd  \u003d String(row[idx.pass] || \u0027\u0027);\n    const role \u003d String(row[idx.role] || \u0027usuario\u0027);\n\n    if (canonicalSectorKey_(set) \u003d\u003d\u003d setorKey \u0026\u0026\n        canonicalSectorKey_(usr) \u003d\u003d\u003d userKey \u0026\u0026\n        pwd.trim() \u003d\u003d\u003d pass) {\n      return { ok:true, role:(role.trim() || \u0027usuario\u0027), setorLabel:set };\n    }\n  }\n  return { ok:false };\n}\n\nfunction autenticarERetornarTela(setor, usuario, senha){\n  const res \u003d verificarLogin(setor, usuario, senha);\n  if (!res || !res.ok) return { ok:false };\n\n  try {\n    PropertiesService.getUserProperties()\n      .setProperties({ semfas_setor:setor, semfas_usuario:usuario }, true);\n  } catch (_){}\n\n  const direct \u003d getDirectViewForRole_(res.role);\n  const view \u003d (direct !\u003d\u003d \u0027formulario\u0027)\n    ? direct\n    : (isHubSector_(res.setorLabel || setor) ? \u0027hub\u0027 : \u0027formulario\u0027);\n\n  return {\n    ok: true,\n    view,\n    role: (res.role || \u0027usuario\u0027),\n    setorLabel: (res.setorLabel || setor),\n    forceRedirect: true,\n    redirectUrl: \u0027?view\u003d\u0027 + encodeURIComponent(view)\n  };\n}\n\n/************************\n * HELPERs\n ************************/\nfunction normText_(s){\n  return String(s||\u0027\u0027)\n    .normalize(\u0027NFD\u0027).replace(/[\\u00B7\\u0300-\\u036f]/g,\u0027\u0027)\n    .replace(/\\s+/g,\u0027 \u0027)\n    .trim()\n    .toLowerCase();\n}\n\nfunction withRetry(fn, tentativas\u003d5, baseMs\u003d250){\n  for (let i\u003d0;i\u003ctentativas;i++){\n    try { return fn(); }\n    catch(e){\n      if (i\u003d\u003d\u003dtentativas-1) throw e;\n      Utilities.sleep(baseMs * Math.pow(2,i));\n    }\n  }\n}\n\nfunction parseAnyDate(s){\n  if (!s) return null;\n  if (s instanceof Date) return s;\n\n  if (typeof s \u003d\u003d\u003d \u0027number\u0027){\n    if (s \u003e 10*365*24*3600*1000) return new Date(s); // epoch ms\n    return new Date(Math.round((s - 25569) * 86400 * 1000)); // serial Sheets\n  }\n\n  if (typeof s !\u003d\u003d \u0027string\u0027) return null;\n\n  let m \u003d s.match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n  if (m) return new Date(+m[1], +m[2]-1, +m[3]);\n\n  m \u003d s.match(/^(\\d{2})\\/(\\d{2})\\/(\\d{4})$/);\n  if (m) return new Date(+m[3], +m[2]-1, +m[1]);\n\n  const d \u003d new Date(s);\n  return isNaN(d) ? null : d;\n}\n\nfunction coerceSheetDate(v){\n  if (!v \u0026\u0026 v!\u003d\u003d0) return null;\n  if (v instanceof Date) return startOfDay(v);\n  if (typeof v \u003d\u003d\u003d \u0027number\u0027)\n    return startOfDay(new Date(Math.round((v - 25569) * 86400 * 1000)));\n  if (typeof v \u003d\u003d\u003d \u0027string\u0027){\n    const d \u003d parseAnyDate(v);\n    return d ? startOfDay(d) : null;\n  }\n  return null;\n}\n\nfunction startOfDay(d){\n  const x\u003dnew Date(d);\n  x.setHours(0,0,0,0);\n  return x;\n}\n\nfunction endOfDay(d){\n  const x\u003dnew Date(d);\n  x.setHours(23,59,59,999);\n  return x;\n}\n\nfunction firstDayNextMonth_(d){\n  const x\u003dnew Date(d.getFullYear(), d.getMonth()+1, 1);\n  x.setHours(0,0,0,0);\n  return x;\n}\n\nfunction toISODate_(d){\n  const y \u003d d.getFullYear();\n  const m \u003d (\u00270\u0027+(d.getMonth()+1)).slice(-2);\n  const da\u003d (\u00270\u0027+d.getDate()).slice(-2);\n  return `${y}-${m}-${da}`;\n}\n\n/** CPF sempre tratado como string */\nfunction normalizeCPF(cpf){\n  return String(cpf \u003d\u003d null ? \u0027\u0027 : cpf).replace(/\\D/g,\u0027\u0027);\n}\n\nfunction formatCPF(cpf){\n  const num \u003d normalizeCPF(cpf);\n  return num.length\u003d\u003d\u003d11\n    ? num.replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/,\u0027$1.$2.$3-$4\u0027)\n    : cpf;\n}\n\nfunction formatDateBR(d){\n  if (!(d instanceof Date)) return \u0027\u0027;\n  return Utilities.formatDate(d, TZ, \u0027dd/MM/yyyy\u0027);\n}\n\nfunction parseISODateSafe(str){\n  if (!str) return new Date();\n  if (str instanceof Date) return str;\n  if (typeof str \u003d\u003d\u003d \u0027number\u0027) return new Date(str);\n\n  let m \u003d String(str).match(/^(\\d{2})\\/(\\d{2})\\/(\\d{4})$/);\n  if (m) return new Date(+m[3], +m[2]-1, +m[1]);\n\n  m \u003d String(str).match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n  if (m) return new Date(+m[1], +m[2]-1, +m[3]);\n\n  const d \u003d new Date(str);\n  return isNaN(d) ? new Date() : d;\n}\n\n/** ‚úîÔ∏é Caixinhas de PARECER no PDF */\nconst BOX_CHECKED   \u003d \u0027‚òë\u0027;\nconst BOX_UNCHECKED \u003d \u0027‚òê\u0027;\n\nfunction normalizeParecerOpcao_(v){\n  const s \u003d (v||\u0027\u0027).toString()\n    .normalize(\u0027NFD\u0027).replace(/[\\u0300-\\u036f]/g,\u0027\u0027)\n    .toLowerCase().trim();\n  if (!s) return \u0027\u0027;\n  if (/(favoravel|aprovado|deferido|sim|favor)/.test(s)) return \u0027FAVORAVEL\u0027;\n  if (/(desfavoravel|reprovado|indeferido|nao|n√£o|contra)/.test(s)) return \u0027DESFAVORAVEL\u0027;\n  return \u0027\u0027;\n}\n\n/************************\n * DRIVE / PDFs\n ************************/\nfunction safeFolderName_(s){\n  const label \u003d (s || \u0027Sem Setor\u0027).toString().trim();\n  return label\n    .replace(/[\\\\\\/\u003c\u003e:\"|?*\\u0000-\\u001F]+/g,\u0027-\u0027)\n    .replace(/\\s+/g,\u0027 \u0027)\n    .trim();\n}\n\nfunction ensureSubfolder_(parent, name){\n  const it \u003d parent.getFoldersByName(name);\n  return it.hasNext() ? it.next() : parent.createFolder(name);\n}\n\nfunction getPdfDestinationFolder_(setorLabel, dateObj){\n  const tz   \u003d TZ;\n  const root \u003d DriveApp.getFolderById(FOLDER_PDFS_ID);\n  const setor\u003d ensureSubfolder_(root, safeFolderName_(setorLabel));\n  const year \u003d ensureSubfolder_(setor, Utilities.formatDate(dateObj,tz,\u0027yyyy\u0027));\n  const month\u003d ensureSubfolder_(year,  Utilities.formatDate(dateObj,tz,\u0027MM\u0027));\n  const day  \u003d ensureSubfolder_(month, Utilities.formatDate(dateObj,tz,\u0027dd\u0027));\n  return day;\n}\n\n/**\n * Pasta espec√≠fica do caso:\n *  FOLDER_PDFS_ID / Setor / Ano / M√™s / Dia / \"[PROTO] - NOME\"\n */\nfunction getCaseFolder_(setorLabel, dateObj, protocolo, nomeBeneficiario){\n  const baseDay \u003d getPdfDestinationFolder_(setorLabel, dateObj);\n  const proto \u003d (protocolo || \u0027\u0027).toString().trim();\n  const nome  \u003d safeFolderName_(nomeBeneficiario || \u0027Benefici√°rio\u0027);\n  let folderName \u003d proto ? `${proto} - ${nome}` : nome;\n  if (folderName.length \u003e 120) folderName \u003d folderName.substring(0,120);\n  return ensureSubfolder_(baseDay, folderName);\n}\n\nfunction setPublicSharing_(file){\n  try {\n    file.setSharing(DriveApp.Access.ANYONE_WITH_LINK, DriveApp.Permission.VIEW);\n  } catch(e){\n    try {\n      file.setSharing(DriveApp.Access.DOMAIN_WITH_LINK, DriveApp.Permission.VIEW);\n    } catch(_){}\n  }\n  return file;\n}\n\nfunction buildDriveLinks_(id){\n  return {\n    preview:`https://drive.google.com/file/d/${id}/preview`,\n    download:`https://drive.google.com/uc?export\u003ddownload\u0026id\u003d${id}`\n  };\n}\n\n/** ***********************\n *  ASSINATURA DIGITAL\n **************************/\nfunction dataUrlToBlob_(dataUrl, defaultMime) {\n  if (!dataUrl) return null;\n  const str \u003d String(dataUrl);\n  let mime \u003d defaultMime || MimeType.PNG;\n  let b64  \u003d str;\n\n  const m \u003d str.match(/^data:([\\w\\/\\-\\+\\.]+);base64,(.+)$/);\n  if (m) {\n    mime \u003d m[1];\n    b64  \u003d m[2];\n  }\n\n  const bytes \u003d Utilities.base64Decode(b64);\n  return Utilities.newBlob(bytes, mime, \u0027assinatura.png\u0027);\n}\n\nfunction insertSignatureImageAtPlaceholder_(body, placeholderKey, blob) {\n  if (!body || !blob || !placeholderKey) return;\n\n  const pattern \u003d \u0027\\\\{\\\\{?\\\\s*\u0027 + placeholderKey + \u0027\\\\s*\\\\}?\\\\}\u0027;\n  const result \u003d body.findText(pattern);\n  if (!result) return;\n\n  const el   \u003d result.getElement();\n  const text \u003d el.asText();\n  const start \u003d result.getStartOffset();\n  const end   \u003d result.getEndOffsetInclusive();\n\n  text.deleteText(start, end);\n\n  let parent \u003d text.getParent();\n  while (parent \u0026\u0026 parent.getType() !\u003d\u003d DocumentApp.ElementType.PARAGRAPH \u0026\u0026 parent.getParent) {\n    parent \u003d parent.getParent();\n  }\n  if (!parent || parent.getType() !\u003d\u003d DocumentApp.ElementType.PARAGRAPH) return;\n\n  const para \u003d parent.asParagraph();\n  const img \u003d para.insertInlineImage(para.getNumChildren(), blob);\n  try { if (img.getWidth() \u003e 140) img.setWidth(140); } catch (_){}\n}\n\n/************************\n * DESCOBERTA AUTOM√ÅTICA\n ************************/\nfunction getSheet_(name){\n  return SpreadsheetApp.openById(PLANILHA_ID).getSheetByName(name);\n}\n\nfunction autoDetectDataSheet_(){\n  const ss \u003d SpreadsheetApp.openById(PLANILHA_ID);\n\n  const pref \u003d ss.getSheetByName(RESPOSTAS_SHEET_NAME);\n  if (pref \u0026\u0026 pref.getLastRow() \u003e\u003d 2) return pref;\n\n  const sheets \u003d ss.getSheets();\n  let best \u003d null, bestScore \u003d -1;\n\n  sheets.forEach(sh \u003d\u003e {\n    const lr \u003d sh.getLastRow();\n    const lc \u003d sh.getLastColumn();\n    if (lr \u003c 2 || lc \u003c 3) return;\n\n    const headers \u003d sh.getRange(1,1,1,lc).getValues()[0];\n\n    const iCPF   \u003d findColIdx_(headers,\n      CPF_HEADER,\u0027cpf\u0027,\u0027cpf do benefici√°rio\u0027,\u0027cpf do beneficiario\u0027,\n      \u0027documento (cpf)\u0027,\u0027cpf benefici√°rio\u0027\n    );\n    const iNome  \u003d findColIdx_(headers,\n      \u0027nome\u0027,\u0027nome do benefici√°rio\u0027,\u0027nome do beneficiario\u0027,\n      \u0027benefici√°rio\u0027,\u0027beneficiario\u0027\n    );\n    const iUnid  \u003d findColIdx_(headers,\n      \u0027via de entrada\u0027,\u0027unidade\u0027,\u0027unidade / setor\u0027,\u0027setor\u0027,\n      \u0027cras\u0027,\u0027creas\u0027,\u0027cram\u0027\n    );\n    const iBenef \u003d findColIdx_(headers,\n      \u0027benef√≠cio\u0027,\u0027beneficio\u0027,\u0027demanda apresentada\u0027,\n      \u0027tipo de benef√≠cio\u0027,\u0027tipo de beneficio\u0027\n    );\n    const iData  \u003d findColIdx_(headers,\n      \u0027data da solicita√ß√£o\u0027,\u0027data\u0027,\u0027timestamp\u0027,\n      \u0027solicitado em\u0027,\u0027data de cadastro\u0027\n    );\n\n    const sampleRows \u003d Math.min(400, lr-1);\n    const rng \u003d sh.getRange(2,1,sampleRows,lc).getValues();\n\n    let cpfOk \u003d 0;\n    if (iCPF \u003e\u003d 0){\n      for (let r\u003d0;r\u003crng.length;r++){\n        const n \u003d String(rng[r][iCPF]||\u0027\u0027).replace(/\\D/g,\u0027\u0027);\n        if (n.length \u003d\u003d\u003d 11) cpfOk++;\n      }\n    }\n\n    let dataOk \u003d 0;\n    if (iData \u003e\u003d 0){\n      for (let r\u003d0;r\u003crng.length;r++){\n        const v \u003d rng[r][iData];\n        if (v instanceof Date || typeof v \u003d\u003d\u003d \u0027number\u0027){ dataOk++; continue; }\n        const s \u003d String(v||\u0027\u0027).trim();\n        if (/^\\d{2}\\/\\d{2}\\/\\d{4}$/.test(s) || /^\\d{4}-\\d{2}-\\d{2}$/.test(s)) dataOk++;\n      }\n    }\n\n    let unSet \u003d new Set();\n    if (iUnid \u003e\u003d 0){\n      for (let r\u003d0;r\u003crng.length;r++){\n        const s \u003d String(rng[r][iUnid]||\u0027\u0027).trim();\n        if (s) unSet.add(s);\n      }\n    }\n\n    let headerScore \u003d 0;\n    [iCPF,iNome,iUnid,iBenef,iData].forEach(i \u003d\u003e { if (i\u003e\u003d0) headerScore+\u003d15; });\n\n    const bulk  \u003d Math.min(lr-1, 5000);\n    const score \u003d headerScore + cpfOk*2 + dataOk*1.5 + Math.min(unSet.size,50) + bulk/5;\n\n    if (score \u003e bestScore){ best \u003d sh; bestScore \u003d score; }\n  });\n\n  if (!best) throw new Error(\u0027Nenhuma aba de dados compat√≠vel encontrada.\u0027);\n  return best;\n}\n\nfunction findColIdx_(headers, ...cands){\n  const H \u003d (headers||[]).map(h\u003d\u003eString(h||\u0027\u0027).trim().toLowerCase());\n  const flat \u003d cands.flat();\n\n  for (const cand of flat){\n    const i \u003d H.indexOf(String(cand||\u0027\u0027).trim().toLowerCase());\n    if (i \u003e\u003d 0) return i;\n  }\n\n  const patterns \u003d flat.map(c \u003d\u003e\n    new RegExp(String(c).replace(/[.*+?^${}()|[\\]\\\\]/g,\u0027\\\\$\u0026\u0027), \u0027i\u0027)\n  );\n  for (let i\u003d0;i\u003c(headers||[]).length;i++){\n    const h \u003d String(headers[i]||\u0027\u0027);\n    if (patterns.some(rx \u003d\u003e rx.test(h))) return i;\n  }\n  return -1;\n}\n\nfunction ensureColumn_(sheet, header){\n  const range   \u003d sheet.getRange(1,1,1,Math.max(1,sheet.getLastColumn()));\n  const headers \u003d range.getValues()[0] || [];\n  const idx     \u003d findColIdx_(headers, header);\n  if (idx \u003d\u003d\u003d -1){\n    sheet.insertColumnAfter(headers.length || 1);\n    sheet.getRange(1, headers.length+1).setValue(header);\n    return headers.length;\n  }\n  return idx;\n}\n\nfunction guessCpfColumn_(sh, startRow, lastRow, lastCol){\n  const rows \u003d Math.min(300, lastRow - startRow + 1);\n  if (rows \u003c\u003d 0) return -1;\n\n  let bestIdx \u003d -1, bestScore \u003d 0;\n  for (let c\u003d1;c\u003c\u003dlastCol;c++){\n    const vals \u003d sh.getRange(startRow, c, rows, 1).getValues();\n    let score\u003d0;\n    for (let i\u003d0;i\u003cvals.length;i++){\n      const n \u003d String(vals[i][0]||\u0027\u0027).replace(/\\D/g,\u0027\u0027);\n      if (n.length \u003d\u003d\u003d 11) score++;\n    }\n    if (score \u003e bestScore){ bestScore \u003d score; bestIdx \u003d c-1; }\n  }\n  return bestScore \u003e\u003d 3 ? bestIdx : -1;\n}\n\nfunction guessDateColumn_(sh, startRow, lastRow, lastCol){\n  const rows \u003d Math.min(300, lastRow - startRow + 1);\n  if (rows \u003c\u003d 0) return -1;\n\n  let bestIdx \u003d -1, bestScore \u003d 0;\n  for (let c\u003d1;c\u003c\u003dlastCol;c++){\n    const vals \u003d sh.getRange(startRow, c, rows, 1).getValues();\n    let score\u003d0;\n    for (let i\u003d0;i\u003cvals.length;i++){\n      const v \u003d vals[i][0];\n      if (v instanceof Date || typeof v \u003d\u003d\u003d \u0027number\u0027){ score++; continue; }\n      const s \u003d String(v||\u0027\u0027).trim();\n      if (/^\\d{2}\\/\\d{2}\\/\\d{4}$/.test(s) || /^\\d{4}-\\d{2}-\\d{2}$/.test(s)) score++;\n    }\n    if (score \u003e bestScore){ bestScore \u003d score; bestIdx \u003d c-1; }\n  }\n  return bestScore \u003e\u003d 3 ? bestIdx : -1;\n}\n\nfunction ensureDocumentosColumn_(sheet) {\n  return ensureColumn_(sheet, \u0027Documentos\u0027);\n}\n\n/** ‚úÖ (AJUSTADO) Recarrega cabe√ßalhos ap√≥s inserir colunas */\nfunction getRespostasIndexMap_(){\n  const sh \u003d autoDetectDataSheet_();\n\n  let lastCol \u003d sh.getLastColumn();\n  let headers \u003d sh.getRange(1,1,1,lastCol).getValues()[0] || [];\n\n  const idx \u003d {\n    unidade:   findColIdx_(headers,\n      \u0027via de entrada\u0027,\u0027unidade\u0027,\u0027unidade / setor\u0027,\u0027setor\u0027,\u0027cras\u0027,\u0027creas\u0027,\u0027cram\u0027,\n      \u0027unidade/setor\u0027,\u0027setor/unidade\u0027,\u0027unidade/setor (cras/creas)\u0027\n    ),\n    beneficio: findColIdx_(headers,\n      \u0027benef√≠cio\u0027,\u0027beneficio\u0027,\u0027benef√≠cio social\u0027,\n      \u0027demanda apresentada\u0027,\u0027tipo de benef√≠cio\u0027,\u0027tipo de beneficio\u0027,\u0027beneficio social\u0027\n    ),\n    data:      findColIdx_(headers,\n      \u0027data da solicita√ß√£o\u0027,\u0027data\u0027,\u0027timestamp\u0027,\n      \u0027data de cadastro\u0027,\u0027solicitado em\u0027,\u0027solicita√ß√£o\u0027\n    ),\n    nome:      findColIdx_(headers,\n      \u0027nome do benefici√°rio\u0027,\u0027benefici√°rio\u0027,\u0027beneficiario\u0027,\n      \u0027nome\u0027,\u0027nome do beneficiario\u0027,\u0027nome benefici√°rio\u0027\n    ),\n    cpf:       findColIdx_(headers,\n      CPF_HEADER,\u0027cpf\u0027,\u0027cpf do benefici√°rio\u0027,\u0027cpf do beneficiario\u0027,\n      \u0027documento (cpf)\u0027,\u0027cpf benefici√°rio\u0027\n    ),\n    status:    findColIdx_(headers,\u0027status\u0027,\u0027situa√ß√£o\u0027,\u0027situacao\u0027),\n    pdf:       findColIdx_(headers,\u0027pdf\u0027,\u0027link do pdf\u0027,\u0027link\u0027,\u0027arquivo\u0027,\u0027drive\u0027,\u0027url pdf\u0027,\u0027arquivo pdf\u0027),\n    docs:      findColIdx_(headers,\u0027documentos\u0027,\u0027docs\u0027,\u0027anexos\u0027,\u0027arquivos anexos\u0027,\u0027documentos/anexos\u0027),\n    entregueFlag: -1\n  };\n\n  if (idx.cpf  \u003c 0) idx.cpf  \u003d guessCpfColumn_(sh, 2, Math.max(2, sh.getLastRow()), lastCol);\n  if (idx.data \u003c 0) idx.data \u003d guessDateColumn_(sh, 2, Math.max(2, sh.getLastRow()), lastCol);\n\n  let changed \u003d false;\n  if (idx.status \u003c 0){ idx.status \u003d ensureColumn_(sh, \u0027Status\u0027); changed \u003d true; }\n  idx.entregueFlag \u003d ensureColumn_(sh, ENTREGUE_HEADER); if (idx.entregueFlag \u003e\u003d headers.length) changed \u003d true;\n  if (idx.docs \u003c 0){ idx.docs \u003d ensureDocumentosColumn_(sh); changed \u003d true; }\n\n  if (changed){\n    lastCol \u003d sh.getLastColumn();\n    headers \u003d sh.getRange(1,1,1,lastCol).getValues()[0] || [];\n  }\n\n  if (idx.unidade  \u003c 0) idx.unidade   \u003d 1;\n  if (idx.beneficio\u003c 0) idx.beneficio \u003d 2;\n  if (idx.data     \u003c 0) idx.data      \u003d 3;\n  if (idx.nome     \u003c 0) idx.nome      \u003d 4;\n  if (idx.cpf      \u003c 0) idx.cpf       \u003d 12;\n\n  return { sh, headers, idx };\n}\n\n/************************\n * AUX ‚Äî ENTREGUE robusto\n ************************/\nfunction isRowEntregue_(row, idx){\n  const flag \u003d String(row[idx.entregueFlag]||\u0027\u0027).trim().toUpperCase();\n  const st   \u003d idx.status\u003e\u003d0 ? String(row[idx.status]||\u0027\u0027).trim().toUpperCase() : \u0027\u0027;\n  return (\n    flag \u003d\u003d\u003d \u0027ENTREGUE\u0027 || flag \u003d\u003d\u003d \u0027SIM\u0027 || flag \u003d\u003d\u003d \u0027TRUE\u0027 || flag \u003d\u003d\u003d \u0027VERDADEIRO\u0027 ||\n    st \u003d\u003d\u003d \u0027ENTREGUE\u0027 || st.includes(\u0027ENTREG\u0027)\n  );\n}\n\n/************************\n * CPF: exist√™ncia\n ************************/\nfunction checkCpfExistence(cpf) {\n  cpf \u003d normalizeCPF(cpf);\n  if (!cpf) return { exists:false };\n\n  const { sh, idx } \u003d getRespostasIndexMap_();\n  const lastRow \u003d sh.getLastRow();\n  if (lastRow \u003c 2) return { exists:false };\n\n  const values \u003d sh.getRange(2, idx.cpf+1, lastRow-1, 1).getValues();\n  const exists \u003d values.some(r \u003d\u003e normalizeCPF(r[0]) \u003d\u003d\u003d cpf);\n  return { exists };\n}\n\n/************************\n * BENEF√çCIOS ILIMITADOS\n ************************/\nfunction normalizeBenefit_(s){\n  return (s || \u0027\u0027).toString()\n    .normalize(\u0027NFD\u0027).replace(/[\\u0300-\\u036f]/g,\u0027\u0027)\n    .replace(/[()\\-]/g,\u0027 \u0027)\n    .replace(/[^a-zA-Z0-9 ]/g,\u0027\u0027)\n    .trim()\n    .toLowerCase()\n    .replace(/\\s+/g,\u0027\u0027);\n}\n\nconst BENEFICIOS_ILIMITADOS \u003d new Set([\n  normalizeBenefit_(\u0027AUX√çLIO POR MORTE\u0027),\n  normalizeBenefit_(\u0027MAIS ACONCHEGO (NATALIDADE)\u0027),\n  normalizeBenefit_(\u0027PASSAGEM INTERESTADUAL (VIAGEM)\u0027),\n  normalizeBenefit_(\u0027Outro\u0027)\n]);\n\n/************************\n * üîπ ANEXOS ‚Äì helpers\n ************************/\nfunction salvarAnexosNoDrive_(anexos, pastaDestino, protocolo) {\n  if (!anexos || !anexos.length || !pastaDestino) return \u0027\u0027;\n\n  const linhas \u003d [];\n  anexos.forEach(function (item, idx) {\n    try {\n      if (!item) return;\n\n      const nomeOriginal \u003d (item.nome || item.filename || (\u0027arquivo_\u0027 + (idx+1))).toString();\n      const rotulo       \u003d (item.nomeDocumento || \u0027\u0027).toString().trim(); // ex.: RG, CPF, Comprovante\n      const mime         \u003d (item.mimeType || item.mimetype || MimeType.PDF);\n\n      let base64 \u003d item.base64 || item.conteudoBase64 || item.data || item.dataUrl || \u0027\u0027;\n      if (!base64) return;\n\n      const m \u003d String(base64).match(/^data:([\\w\\/\\-\\+\\.]+);base64,(.+)$/);\n      let mimeUse \u003d mime;\n      if (m) {\n        mimeUse \u003d m[1] || mimeUse;\n        base64  \u003d m[2] || \u0027\u0027;\n      }\n\n      const bytes \u003d Utilities.base64Decode(base64);\n      const blob  \u003d Utilities.newBlob(bytes, mimeUse, nomeOriginal);\n\n      const nomeFinal \u003d (protocolo ? protocolo + \u0027 - \u0027 : \u0027\u0027) + (rotulo ? (rotulo + \u0027 - \u0027) : \u0027\u0027) + nomeOriginal;\n\n      const file \u003d withRetry(function(){\n        return pastaDestino.createFile(blob).setName(nomeFinal);\n      }, 3, 300);\n\n      setPublicSharing_(file);\n      const links \u003d buildDriveLinks_(file.getId());\n\n      const etiqueta \u003d rotulo || nomeOriginal;\n      linhas.push(etiqueta + \u0027: \u0027 + links.preview);\n\n    } catch (e) {\n      Logger.log(\u0027[ANEXO] Erro ao salvar anexo: \u0027 + e.message);\n    }\n  });\n\n  return linhas.join(\u0027\\n\u0027);\n}\n\n/************************\n * SALVAR + PDF + E-MAIL\n ************************/\nfunction salvarFormulario(dados) {\n  dados \u003d dados || {};\n\n  // Datas \u0026 formatos\n  const dataSolicitacao   \u003d parseISODateSafe(dados.data_solicitacao);\n  const dataSolicitacaoBR \u003d formatDateBR(dataSolicitacao);\n  dados.data_solicitacao  \u003d dataSolicitacaoBR;\n\n  if (dados.nasc) {\n    const nascDate \u003d parseISODateSafe(dados.nasc);\n    dados.nasc \u003d formatDateBR(nascDate);\n  }\n  dados.cpf \u003d formatCPF(dados.cpf);\n\n  // Se n√£o vier \"cadastrador\" do front, tenta o usu√°rio logado\n  if (!dados.cadastrador) {\n    try {\n      const up \u003d PropertiesService.getUserProperties().getProperties();\n      dados.cadastrador \u003d up.semfas_usuario || Session.getActiveUser().getEmail() || \u0027\u0027;\n    } catch (_){\n      dados.cadastrador \u003d \u0027\u0027;\n    }\n  }\n\n  // üîπ ASSINATURA DIGITAL (base64 vindo do formul√°rio)\n  const assinaturaB64 \u003d\n    dados.assinatura_base64 ||\n    dados.assinaturaDigitalBase64 ||\n    dados.assinatura_digital_base64 ||\n    dados.assinaturaDigital ||\n    dados.assinatura_img ||\n    dados.assinaturaImagem ||\n    dados.assinatura_digital ||\n    \u0027\u0027;\n\n  let assinaturaBlob \u003d null;\n  if (assinaturaB64) {\n    try {\n      assinaturaBlob \u003d dataUrlToBlob_(assinaturaB64, MimeType.PNG);\n    } catch (e) {\n      Logger.log(\u0027[ASSINATURA] Erro ao converter base64: \u0027 + e.message);\n    }\n  }\n\n  // üîπ anexos (array vindo do front; se n√£o vier, fica vazio)\n  const anexos \u003d Array.isArray(dados.anexos) ? dados.anexos : [];\n\n  const shPref \u003d getSheet_(RESPOSTAS_SHEET_NAME);\n  const sh \u003d (shPref \u0026\u0026 shPref.getLastRow() \u003e\u003d 1) ? shPref : autoDetectDataSheet_();\n\n  let newRow, protocoloGerado \u003d \u0027\u0027;\n  const lock1 \u003d LockService.getScriptLock(); lock1.waitLock(10000);\n\n  try {\n    // ‚úÖ (AJUSTADO) duplicidade usando √≠ndices detectados (n√£o fixos)\n    const lastRow \u003d sh.getLastRow();\n    const lastCol \u003d sh.getLastColumn();\n    const headers \u003d sh.getRange(1,1,1,lastCol).getValues()[0] || [];\n\n    let iCpf  \u003d findColIdx_(headers, CPF_HEADER,\u0027cpf\u0027,\u0027cpf do benefici√°rio\u0027,\u0027cpf do beneficiario\u0027,\u0027cpf benefici√°rio\u0027);\n    let iBen  \u003d findColIdx_(headers, \u0027demanda apresentada\u0027,\u0027benef√≠cio\u0027,\u0027beneficio\u0027,\u0027tipo de benef√≠cio\u0027,\u0027tipo de beneficio\u0027,\u0027benef√≠cio social\u0027,\u0027beneficio social\u0027);\n    let iData \u003d findColIdx_(headers, \u0027data da solicita√ß√£o\u0027,\u0027data\u0027,\u0027timestamp\u0027,\u0027solicitado em\u0027,\u0027data de cadastro\u0027);\n\n    if (iCpf  \u003c 0) iCpf  \u003d guessCpfColumn_(sh, 2, Math.max(2,lastRow), lastCol);\n    if (iData \u003c 0) iData \u003d guessDateColumn_(sh, 2, Math.max(2,lastRow), lastCol);\n\n    const registros \u003d (lastRow \u003e\u003d 2)\n      ? sh.getRange(2,1,lastRow-1,lastCol).getValues()\n      : [];\n\n    const cpfNovo       \u003d normalizeCPF(dados.cpf);\n    const beneficioNovo \u003d (dados.demanda || \u0027\u0027).toString().trim();\n    const benKeyNovo    \u003d normalizeBenefit_(beneficioNovo);\n    const mesNovo       \u003d dataSolicitacao.getMonth();\n    const anoNovo       \u003d dataSolicitacao.getFullYear();\n    const isIlimitado   \u003d BENEFICIOS_ILIMITADOS.has(benKeyNovo);\n\n    let lastMatchDate \u003d null;\n    for (let i\u003d0; i\u003cregistros.length; i++) {\n      const row \u003d registros[i];\n\n      const cpfExistente \u003d (iCpf\u003e\u003d0 \u0026\u0026 iCpf\u003crow.length) ? normalizeCPF(row[iCpf]) : \u0027\u0027;\n      const beneficioExistente \u003d (iBen\u003e\u003d0 \u0026\u0026 iBen\u003crow.length) ? String(row[iBen]||\u0027\u0027).trim() : \u0027\u0027;\n      const benKeyExistente \u003d normalizeBenefit_(beneficioExistente);\n\n      const dataExistente \u003d (iData\u003e\u003d0 \u0026\u0026 iData\u003crow.length) ? parseAnyDate(row[iData]) : null;\n\n      if (cpfExistente \u003d\u003d\u003d cpfNovo \u0026\u0026\n          benKeyExistente \u003d\u003d\u003d benKeyNovo \u0026\u0026\n          dataExistente \u0026\u0026\n          dataExistente.getMonth() \u003d\u003d\u003d mesNovo \u0026\u0026\n          dataExistente.getFullYear() \u003d\u003d\u003d anoNovo) {\n        if (!lastMatchDate || dataExistente \u003e lastMatchDate) lastMatchDate \u003d dataExistente;\n      }\n    }\n\n    if (!isIlimitado \u0026\u0026 lastMatchDate) {\n      const liberadoEm \u003d firstDayNextMonth_(lastMatchDate);\n      return {\n        sucesso:false,\n        mensagem:\u0027J√° existe um cadastro para este CPF com este benef√≠cio neste m√™s.\u0027,\n        ultima_data:  formatDateBR(lastMatchDate),\n        proxima_data: formatDateBR(liberadoEm)\n      };\n    }\n\n    // Escreve a linha (estrutura padr√£o; se a planilha tiver menos colunas, ela expande)\n    const linha \u003d [\n      new Date(), dados.via_entrada, dados.demanda, dataSolicitacaoBR,\n      dados.nomeb, dados.nasc, dados.endereco, dados.bairro, dados.referencia,\n      dados.telefone, dados.rg, dados.ssp, dados.cpf, (dados.nis || \u0027\u0027),\n      dados.cras_ref, dados.tem_beneficio, dados.qual_beneficio, dados.membros,\n      dados.renda, dados.nomes, dados.telefones, dados.enderecos, dados.rgs,\n      dados.cpfs, dados.vinculo, dados.situacao,\n      \u0027PENDENTE\u0027, \u0027\u0027, dados.cadastrador\n    ];\n\n    withRetry(()\u003d\u003esh.appendRow(linha), 5, 250);\n    newRow \u003d sh.getLastRow();\n\n    // Protocolo\n    protocoloGerado \u003d ensureProtocoloForRow_(sh, newRow);\n\n    // PARECER T√âCNICO -\u003e grava em colunas dedicadas\n    const iPar   \u003d ensureColumn_(sh, \u0027PARECER T√âCNICO\u0027);\n    const iNomT  \u003d ensureColumn_(sh, \u0027NOME T√âCNICO\u0027);\n    const iMun   \u003d ensureColumn_(sh, \u0027MUNIC√çPIO PARECER\u0027);\n    const iDataP \u003d ensureColumn_(sh, \u0027DATA PARECER\u0027);\n    const iAssB  \u003d ensureColumn_(sh, \u0027ASSINATURA BENEFICI√ÅRIO\u0027);\n    const iAssT  \u003d ensureColumn_(sh, \u0027ASSINATURA/CARIMBO\u0027);\n\n    const dataParecerBR \u003d dados.data_parecer\n      ? formatDateBR(parseISODateSafe(dados.data_parecer))\n      : \u0027\u0027;\n\n    const assinaturaSheetValue \u003d assinaturaB64 || dados.assinatura_carimbo || \u0027\u0027;\n\n    sh.getRange(newRow, iPar+1 ).setValue(dados.parecer_tecnico || dados.parecer || \u0027\u0027);\n    sh.getRange(newRow, iNomT+1).setValue(dados.nome_tecnico || \u0027\u0027);\n    sh.getRange(newRow, iMun+1 ).setValue(dados.municipio_parecer || \u0027Nossa Senhora do Socorro\u0027);\n    sh.getRange(newRow, iDataP+1).setValue(dataParecerBR);\n    sh.getRange(newRow, iAssB+1).setValue(dados.assinatura_beneficiario || \u0027\u0027);\n    sh.getRange(newRow, iAssT+1).setValue(assinaturaSheetValue);\n\n  } finally {\n    lock1.releaseLock();\n  }\n\n  // Pasta espec√≠fica do caso\n  const setorLabel \u003d dados.via_entrada || \u0027Sem Setor\u0027;\n  const dataRef    \u003d parseISODateSafe(dados.data_solicitacao || new Date());\n  const pastaCaso  \u003d getCaseFolder_(setorLabel, dataRef, protocoloGerado, dados.nomeb);\n\n  // Gera PDF\n  const pdf \u003d gerarFichaPDF(Object.assign({}, dados, {\n    protocolo: protocoloGerado,\n    __assinaturaBlob__: assinaturaBlob\n  }), pastaCaso);\n\n  // Atualiza c√©lula do PDF + Documentos\n  const lock2 \u003d LockService.getScriptLock(); lock2.waitLock(10000);\n  try {\n    const iPdf  \u003d ensureColumn_(sh, \u0027PDF\u0027);\n    const iDocs \u003d ensureDocumentosColumn_(sh);\n\n    withRetry(()\u003d\u003esh.getRange(newRow, iPdf+1).setValue(pdf.downloadUrl), 5, 250);\n\n    // üîπ ANEXOS ‚Üí mesma pasta do caso\n    if (anexos \u0026\u0026 anexos.length) {\n      const textoDocs \u003d salvarAnexosNoDrive_(anexos, pastaCaso, protocoloGerado);\n      if (textoDocs) {\n        const anterior \u003d sh.getRange(newRow, iDocs+1).getValue() || \u0027\u0027;\n        const novo     \u003d anterior ? (anterior + \u0027\\n\u0027 + textoDocs) : textoDocs;\n        withRetry(() \u003d\u003e sh.getRange(newRow, iDocs+1).setValue(novo), 5, 250);\n      }\n    }\n  } finally {\n    lock2.releaseLock();\n  }\n\n  // E-mail ao setor (se configurado)\n  enviarEmailSetor(dados.via_entrada, pdf, dados.nomeb);\n\n  return {\n    sucesso:true,\n    mensagem:\u0027Cadastro realizado, PDF e anexos salvos em pasta organizada, e e-mail enviado ao setor!\u0027,\n    link: pdf.downloadUrl,\n    protocolo: protocoloGerado,\n    concluirTexto:\u0027Conclu√≠do\u0027\n  };\n}\n\n/************************\n * GERA√á√ÉO DO PDF (template + assinatura)\n ************************/\nfunction gerarFichaPDF(dados, destFolderOpt) {\n  const dSolic \u003d coerceSheetDate(dados.data_solicitacao || dados.data || dados.dataSolicitacao);\n  const dNasc  \u003d coerceSheetDate(dados.nasc || dados.data_nascimento || dados.dataNascimento);\n\n  const assinaturaBlob \u003d dados.__assinaturaBlob__ || null;\n  const parecerOp \u003d normalizeParecerOpcao_(dados.parecer_opcao || dados.parecer_tecnico || dados.parecer);\n\n  const payload \u003d Object.assign({}, dados, {\n    data_solicitacao: dSolic ? formatDateBR(dSolic) : (dados.data_solicitacao || \u0027\u0027),\n    nasc:             dNasc  ? formatDateBR(dNasc)  : (dados.nasc || \u0027\u0027),\n    cpf:              formatCPF(dados.cpf || \u0027\u0027),\n    cadastrador:      dados.cadastrador || \u0027\u0027,\n\n    parecer:                 dados.parecer_tecnico || dados.parecer || \u0027\u0027,\n    nome_tecnico:            dados.nome_tecnico || \u0027\u0027,\n    municipio_parecer:       dados.municipio_parecer || \u0027Nossa Senhora do Socorro\u0027,\n    data_parecer:            dados.data_parecer ? formatDateBR(parseISODateSafe(dados.data_parecer)) : \u0027\u0027,\n    assinatura_beneficiario: dados.assinatura_beneficiario || \u0027\u0027,\n    assinatura_carimbo:      dados.assinatura_carimbo || \u0027\u0027,\n    protocolo:               dados.protocolo || \u0027\u0027,\n\n    box_favoravel:    (parecerOp \u003d\u003d\u003d \u0027FAVORAVEL\u0027)    ? BOX_CHECKED   : BOX_UNCHECKED,\n    box_desfavoravel: (parecerOp \u003d\u003d\u003d \u0027DESFAVORAVEL\u0027) ? BOX_CHECKED   : BOX_UNCHECKED,\n    box_indef:        (!parecerOp)                   ? BOX_CHECKED   : BOX_UNCHECKED\n  });\n\n  delete payload.__assinaturaBlob__;\n\n  const modelo \u003d DriveApp.getFileById(ID_TEMPLATE);\n  const copia  \u003d withRetry(\n    () \u003d\u003e modelo.makeCopy(\u0027Ficha - \u0027 + (payload.nomeb || \u0027Benefici√°rio\u0027)),\n    5, 250\n  );\n  const doc   \u003d DocumentApp.openById(copia.getId());\n  const corpo \u003d doc.getBody();\n\n  try {\n    corpo\n      .setMarginTop(36)\n      .setMarginBottom(36)\n      .setMarginLeft(36)\n      .setMarginRight(36);\n  } catch (_){}\n\n  function replacePlaceholder_(key, value) {\n    const val \u003d (value \u003d\u003d null ? \u0027\u0027 : String(value)).replace(/\\r\\n/g,\u0027\\n\u0027);\n    const pattern \u003d \u0027\\\\{\\\\{\\\\s*\u0027 + key + \u0027\\\\s*\\\\}\\\\}|\\\\{\\\\s*\u0027 + key + \u0027\\\\s*\\\\}\u0027;\n    try { corpo.replaceText(pattern, val); }\n    catch (e) { Logger.log(\u0027[PDF] replaceText \u0027 + key + \u0027: \u0027 + e.message); }\n  }\n\n  Object.keys(payload).forEach(k \u003d\u003e {\n    const isAssinaturaKey \u003d\n      k \u003d\u003d\u003d \u0027assinatura_carimbo\u0027 ||\n      k \u003d\u003d\u003d \u0027assinatura_img\u0027 ||\n      k \u003d\u003d\u003d \u0027assinatura_digital\u0027 ||\n      k \u003d\u003d\u003d \u0027assinaturaImagem\u0027;\n\n    if (assinaturaBlob \u0026\u0026 isAssinaturaKey) return;\n    replacePlaceholder_(k, payload[k]);\n  });\n\n  if (assinaturaBlob) {\n    try { insertSignatureImageAtPlaceholder_(corpo, \u0027assinatura_carimbo\u0027, assinaturaBlob); }\n    catch (e) { Logger.log(\u0027[ASSINATURA] Erro ao inserir imagem: \u0027 + e.message); }\n  }\n\n  try { corpo.replaceText(\u0027\\\\{\\\\s*([^{}]+)\\\\s*\\\\}\u0027, \u0027$1\u0027); } catch (e) { Logger.log(\u0027[PDF] limpar chaves simples: \u0027 + e.message); }\n  try { corpo.replaceText(\u0027\\\\{\\\\{\\\\s*[^}]+\\\\s*\\\\}\\\\}\u0027, \u0027\u0027); } catch (e) { Logger.log(\u0027[PDF] limpar placeholders {{}}: \u0027 + e.message); }\n\n  doc.saveAndClose();\n  Utilities.sleep(300);\n\n  const nomeArquivo \u003d `Ficha - ${(payload.nomeb || \u0027Benefici√°rio\u0027)} - ${(payload.cpf || \u0027\u0027).toString()}.pdf`;\n\n  const pdfBlob \u003d withRetry(\n    () \u003d\u003e DriveApp.getFileById(copia.getId()).getAs(MimeType.PDF).copyBlob().setName(nomeArquivo),\n    5, 250\n  );\n\n  const setor   \u003d safeFolderName_(payload.via_entrada || \u0027Sem Setor\u0027);\n  const dataRef \u003d dSolic || new Date();\n\n  const pastaDestino \u003d (destFolderOpt \u0026\u0026 destFolderOpt.createFile)\n    ? destFolderOpt\n    : getPdfDestinationFolder_(setor, dataRef);\n\n  const pdfFile \u003d withRetry(() \u003d\u003e pastaDestino.createFile(pdfBlob), 5, 250);\n  setPublicSharing_(pdfFile);\n\n  const fileId \u003d pdfFile.getId();\n  const links  \u003d buildDriveLinks_(fileId);\n\n  try { DriveApp.getFileById(copia.getId()).setTrashed(true); } catch (_){}\n\n  return {\n    blob: pdfBlob,\n    file: pdfFile,\n    fileId,\n    previewUrl:  links.preview,\n    downloadUrl: links.download\n  };\n}\n\n/************************\n * GERAR PDF A PARTIR DE UMA LINHA EXISTENTE\n ************************/\nfunction gerarPdfDeRegistro(linha) {\n  const shPref \u003d getSheet_(RESPOSTAS_SHEET_NAME);\n  const sh \u003d (shPref \u0026\u0026 shPref.getLastRow() \u003e\u003d 1) ? shPref : autoDetectDataSheet_();\n\n  const headers \u003d sh.getRange(1,1,1,sh.getLastColumn()).getValues()[0] || [];\n  const dados   \u003d sh.getRange(linha,1,1,sh.getLastColumn()).getValues()[0];\n\n  const dSolic \u003d coerceSheetDate(dados[3]);\n  const dNasc  \u003d coerceSheetDate(dados[5]);\n\n  const iProt \u003d findColIdx_(headers,\n    PROTOCOLO_HDR,\u0027protocolo\u0027,\u0027n¬∫ protocolo\u0027,\u0027n¬∞ protocolo\u0027,\n    \u0027numero do protocolo\u0027,\u0027id\u0027,\u0027id protocolo\u0027\n  );\n  const protocoloLido \u003d iProt \u003e\u003d 0 ? (dados[iProt] || \u0027\u0027) : \u0027\u0027;\n\n  const iPar   \u003d findColIdx_(headers, \u0027PARECER T√âCNICO\u0027);\n  const iNomT  \u003d findColIdx_(headers, \u0027NOME T√âCNICO\u0027);\n  const iMun   \u003d findColIdx_(headers, \u0027MUNIC√çPIO PARECER\u0027);\n  const iData  \u003d findColIdx_(headers, \u0027DATA PARECER\u0027);\n  const iAssB  \u003d findColIdx_(headers, \u0027ASSINATURA BENEFICI√ÅRIO\u0027,\u0027ASSINATURA BENEFICIARIO\u0027);\n  const iAssT  \u003d findColIdx_(headers,\n    \u0027ASSINATURA/CARIMBO\u0027,\n    \u0027ASSINATURA T√âCNICO\u0027,\u0027ASSINATURA TECNICO\u0027,\n    \u0027ASSINATURA TEC\u0027,\u0027ASSINATURA TEC.\u0027,\u0027ASSINATURA\u0027\n  );\n\n  let assinaturaBlob \u003d null;\n  if (iAssT \u003e\u003d 0) {\n    const sigCell \u003d dados[iAssT];\n    if (sigCell) {\n      const s \u003d String(sigCell).trim();\n      try {\n        if (/^data:image\\//i.test(s) || (/^[A-Za-z0-9+/\u003d]+$/.test(s) \u0026\u0026 s.length \u003e 100)) {\n          assinaturaBlob \u003d dataUrlToBlob_(s, MimeType.PNG);\n        }\n      } catch (e) {\n        Logger.log(\u0027[ASSINATURA] erro ao recriar blob da planilha: \u0027 + e.message);\n      }\n    }\n  }\n\n  const registro \u003d {\n    via_entrada: dados[1],\n    demanda: dados[2],\n    data_solicitacao: dSolic ? formatDateBR(dSolic) : \u0027\u0027,\n    nomeb: dados[4],\n    nasc: dNasc ? formatDateBR(dNasc) : \u0027\u0027,\n    endereco: dados[6],\n    bairro: dados[7],\n    referencia: dados[8],\n    telefone: dados[9],\n    rg: dados[10],\n    ssp: dados[11],\n    cpf: formatCPF(dados[12] || \u0027\u0027),\n    nis: dados[13],\n    cras_ref: dados[14],\n    tem_beneficio: dados[15],\n    qual_beneficio: dados[16],\n    membros: dados[17],\n    renda: dados[18],\n    nomes: dados[19],\n    telefones: dados[20],\n    enderecos: dados[21],\n    rgs: dados[22],\n    cpfs: dados[23],\n    vinculo: dados[24],\n    situacao: dados[25],\n    cadastrador: dados[29] || \u0027\u0027,\n    protocolo: protocoloLido || \u0027\u0027,\n    parecer: iPar\u003e\u003d0 ? (dados[iPar]||\u0027\u0027) : \u0027\u0027,\n    nome_tecnico: iNomT\u003e\u003d0 ? (dados[iNomT]||\u0027\u0027) : \u0027\u0027,\n    municipio_parecer: iMun\u003e\u003d0 ? (dados[iMun]||\u0027\u0027) : \u0027\u0027,\n    data_parecer: iData\u003e\u003d0 ? (dados[iData]||\u0027\u0027) : \u0027\u0027,\n    assinatura_beneficiario: iAssB\u003e\u003d0 ? (dados[iAssB]||\u0027\u0027) : \u0027\u0027,\n    assinatura_carimbo:      iAssT\u003e\u003d0 ? (dados[iAssT]||\u0027\u0027) : \u0027\u0027\n  };\n\n  const setorLabel \u003d registro.via_entrada || \u0027Sem Setor\u0027;\n  const dataRefReg \u003d dSolic || new Date();\n  const pastaCaso  \u003d getCaseFolder_(setorLabel, dataRefReg, protocoloLido, registro.nomeb);\n\n  const pdf \u003d gerarFichaPDF(Object.assign({}, registro, {\n    __assinaturaBlob__: assinaturaBlob\n  }), pastaCaso);\n\n  const lock \u003d LockService.getScriptLock(); lock.waitLock(10000);\n  try {\n    const iPdf \u003d ensureColumn_(sh, \u0027PDF\u0027);\n    sh.getRange(linha, iPdf+1).setValue(pdf.downloadUrl);\n  } finally {\n    lock.releaseLock();\n  }\n  return { link: pdf.downloadUrl };\n}\n\n/************************\n * CENTRAL (consulta)\n ************************/\nfunction buscarBeneficios(filtroCPF \u003d \"\", dataInicio \u003d \"\", dataFim \u003d \"\", beneficio \u003d \"\", unidade \u003d \"\") {\n  const { sh, headers, idx } \u003d getRespostasIndexMap_();\n  const dados \u003d sh.getDataRange().getValues();\n\n  const listaUnidades   \u003d new Set();\n  const listaBeneficios \u003d new Set();\n  for (let i\u003d1; i\u003cdados.length; i++){\n    const r \u003d dados[i];\n    if (r[idx.unidade])   listaUnidades.add(String(r[idx.unidade]).trim());\n    if (r[idx.beneficio]) listaBeneficios.add(String(r[idx.beneficio]).trim());\n  }\n  unidade   \u003d resolveFiltroOuVazio_(Array.from(listaUnidades),   unidade);\n  beneficio \u003d resolveFiltroOuVazio_(Array.from(listaBeneficios), beneficio);\n\n  const registros \u003d [];\n  const cpfFiltroNum \u003d normalizeCPF(filtroCPF);\n  const dIni \u003d parseAnyDate(dataInicio);\n  const dFim \u003d parseAnyDate(dataFim);\n  const benFiltro \u003d (beneficio || \u0027\u0027).toString().trim();\n  const uniFiltro \u003d (unidade   || \u0027\u0027).toString().trim();\n\n  const iProt \u003d findColIdx_(headers, PROTOCOLO_HDR,\u0027protocolo\u0027,\u0027n¬∫ protocolo\u0027,\u0027n¬∞ protocolo\u0027,\u0027numero do protocolo\u0027,\u0027id\u0027,\u0027id protocolo\u0027);\n\n  for (let i\u003d1; i\u003cdados.length; i++) {\n    const row \u003d dados[i];\n\n    const cpfStr   \u003d (row[idx.cpf] || \u0027\u0027).toString().trim();\n    const cpfNum   \u003d normalizeCPF(cpfStr);\n    const status   \u003d isRowEntregue_(row, idx) ? \u0027ENTREGUE\u0027 : (String(row[idx.status] || \u0027PENDENTE\u0027).toUpperCase());\n    const data     \u003d coerceSheetDate(row[idx.data]);\n    const demanda  \u003d (row[idx.beneficio] || \u0027\u0027).toString().trim();\n    const unidadeV \u003d (row[idx.unidade] || \u0027\u0027).toString().trim();\n    const nome     \u003d (row[idx.nome] || \u0027\u0027).toString().trim();\n    const protocolo\u003d iProt\u003e\u003d0 ? String(row[iProt]||\u0027\u0027).trim() : \u0027\u0027;\n\n    let okData \u003d true;\n    if (dIni \u0026\u0026 data \u0026\u0026 data \u003c startOfDay(dIni)) okData \u003d false;\n    if (dFim \u0026\u0026 data \u0026\u0026 data \u003e endOfDay(dFim)) okData \u003d false;\n\n    if (benFiltro \u0026\u0026 !matchesFilter_(demanda, benFiltro)) continue;\n    if (uniFiltro \u0026\u0026 !matchesFilter_(unidadeV, uniFiltro)) continue;\n\n    if ((!cpfFiltroNum || cpfNum \u003d\u003d\u003d cpfFiltroNum) \u0026\u0026 okData) {\n      registros.push({\n        linha: i+1,\n        data: data ? formatDateBR(data) : \u0027\u0027,\n        unidade: unidadeV,\n        demanda,\n        nome,\n        cpf: formatCPF(cpfStr),\n        protocolo,\n        status,\n        linkPdf: (idx.pdf\u003e\u003d0 ? (row[idx.pdf] || \u0027\u0027) : \u0027\u0027),\n        documentos: (idx.docs\u003e\u003d0 ? (row[idx.docs] || \u0027\u0027) : \u0027\u0027)\n      });\n    }\n  }\n  return { registros };\n}\n\nfunction matchesFilter_(value, filterTxt){\n  const f \u003d normText_(filterTxt);\n  if (!f) return true;\n  return normText_(value).includes(f);\n}\n\nfunction resolveFiltroOuVazio_(lista, valor){\n  const v \u003d normText_(valor||\u0027\u0027);\n  if (!v) return \u0027\u0027;\n  for (const item of lista){\n    const n \u003d normText_(item);\n    if (n.includes(v) || v.includes(n)) return valor;\n  }\n  return \u0027\u0027;\n}\n\n/************************\n * BAIXA ‚Äî Op√ß√µes / Lista / Busca / Entrega\n ************************/\nfunction ensureBaixasSheet_(){\n  const ss \u003d SpreadsheetApp.openById(PLANILHA_ID);\n  let sh \u003d ss.getSheetByName(BAIXAS_SHEET_NAME);\n  if (!sh){\n    sh \u003d ss.insertSheet(BAIXAS_SHEET_NAME);\n    sh.appendRow([\n      \u0027Carimbo\u0027,\u0027Protocolo\u0027,\u0027CPF\u0027,\u0027Nome\u0027,\u0027Benef√≠cio\u0027,\u0027Status Antes\u0027,\u0027Status Depois\u0027,\n      \u0027Entregue em\u0027,\u0027Unidade\u0027,\u0027Entregue por\u0027,\u0027Observa√ß√£o\u0027,\u0027RowRef\u0027\n    ]);\n  }\n  return sh;\n}\n\nfunction sortList_(arr, order){\n  const o \u003d String(order||\u0027data_desc\u0027).toLowerCase();\n  const coll \u003d (a,b)\u003d\u003eString(a||\u0027\u0027).localeCompare(String(b||\u0027\u0027),\u0027pt-BR\u0027,{sensitivity:\u0027base\u0027});\n  const getT \u003d v \u003d\u003e { const d \u003d coerceSheetDate(v); return d ? d.getTime() : 0; };\n  const key \u003d (r, k)\u003d\u003e{\n    switch(k){\n      case \u0027data\u0027:   return getT(r.solicitadoEm || r.data || r.dataBR || r.dataISO);\n      case \u0027nome\u0027:   return normText_(r.nome);\n      case \u0027benef\u0027:  return normText_(r.beneficio);\n      case \u0027uni\u0027:    return normText_(r.unidade);\n      case \u0027status\u0027: return normText_(r.status);\n      case \u0027prot\u0027:   return normText_(r.protocolo);\n      case \u0027cpf\u0027:    return (String(r.cpf||\u0027\u0027).replace(/\\D/g,\u0027\u0027)) || \u0027\u0027;\n      default:       return \u0027\u0027;\n    }\n  };\n  if (o \u003d\u003d\u003d \u0027data_asc\u0027)  return arr.sort((a,b)\u003d\u003e key(a,\u0027data\u0027) - key(b,\u0027data\u0027));\n  if (o \u003d\u003d\u003d \u0027data_desc\u0027) return arr.sort((a,b)\u003d\u003e key(b,\u0027data\u0027) - key(a,\u0027data\u0027));\n  if (o \u003d\u003d\u003d \u0027nome_asc\u0027)  return arr.sort((a,b)\u003d\u003e coll(key(a,\u0027nome\u0027),  key(b,\u0027nome\u0027)));\n  if (o \u003d\u003d\u003d \u0027nome_desc\u0027) return arr.sort((a,b)\u003d\u003e coll(key(b,\u0027nome\u0027),  key(a,\u0027nome\u0027)));\n  if (o \u003d\u003d\u003d \u0027benef_asc\u0027) return arr.sort((a,b)\u003d\u003e coll(key(a,\u0027benef\u0027), key(b,\u0027benef\u0027)));\n  if (o \u003d\u003d\u003d \u0027benef_desc\u0027)return arr.sort((a,b)\u003d\u003e coll(key(b,\u0027benef\u0027), key(a,\u0027benef\u0027)));\n  if (o \u003d\u003d\u003d \u0027uni_asc\u0027)   return arr.sort((a,b)\u003d\u003e coll(key(a,\u0027uni\u0027),   key(b,\u0027uni\u0027)));\n  if (o \u003d\u003d\u003d \u0027uni_desc\u0027)  return arr.sort((a,b)\u003d\u003e coll(key(b,\u0027uni\u0027),   key(a,\u0027uni\u0027)));\n  if (o \u003d\u003d\u003d \u0027prot_asc\u0027)  return arr.sort((a,b)\u003d\u003e coll(key(a,\u0027prot\u0027),  key(b,\u0027prot\u0027)));\n  if (o \u003d\u003d\u003d \u0027prot_desc\u0027) return arr.sort((a,b)\u003d\u003e coll(key(b,\u0027prot\u0027),  key(a,\u0027prot\u0027)));\n  if (o \u003d\u003d\u003d \u0027cpf_asc\u0027)   return arr.sort((a,b)\u003d\u003e coll(key(a,\u0027cpf\u0027),   key(b,\u0027cpf\u0027)));\n  if (o \u003d\u003d\u003d \u0027cpf_desc\u0027)  return arr.sort((a,b)\u003d\u003e coll(key(b,\u0027cpf\u0027),   key(a,\u0027cpf\u0027)));\n  return arr;\n}\n\nfunction listarUnidadesDashboard(){\n  const { sh, idx } \u003d getRespostasIndexMap_();\n  const dados \u003d sh.getDataRange().getValues().slice(1);\n  const set \u003d new Set();\n  dados.forEach(l \u003d\u003e {\n    const u \u003d (l[idx.unidade] || \u0027\u0027).toString().trim();\n    if (u) set.add(u);\n  });\n  return Array.from(set).sort();\n}\n\nfunction listarBeneficiosDashboard(){\n  const { sh, idx } \u003d getRespostasIndexMap_();\n  const dados \u003d sh.getDataRange().getValues().slice(1);\n  const set \u003d new Set();\n  dados.forEach(l \u003d\u003e {\n    const b \u003d (l[idx.beneficio] || \u0027\u0027).toString().trim();\n    if (b) set.add(b);\n  });\n  return Array.from(set).sort((a,b)\u003d\u003ea.localeCompare(b,\u0027pt-BR\u0027,{sensitivity:\u0027base\u0027}));\n}\n\nfunction getOpcoesFiltros(){\n  return {\n    unidades: listarUnidadesDashboard(),\n    beneficios: listarBeneficiosDashboard()\n  };\n}\n\nfunction baixa_listarOpcoes(){\n  return {\n    unidades: listarUnidadesDashboard(),\n    beneficios: listarBeneficiosDashboard()\n  };\n}\n\nfunction baixa_list(statusFilter\u003d\u0027todos\u0027, unidadeFiltro\u003d\u0027\u0027, beneficioFiltro\u003d\u0027\u0027, order\u003d\u0027data_desc\u0027, pdfOnly\u003dfalse, hasProto\u003dfalse, dataInicio\u003d\u0027\u0027, dataFim\u003d\u0027\u0027){\n  const { sh, headers, idx } \u003d getRespostasIndexMap_();\n  const values \u003d sh.getRange(2,1, Math.max(0, sh.getLastRow()-1), sh.getLastColumn()).getValues();\n\n  const setUnidades \u003d new Set(), setBenef \u003d new Set();\n  for (let r\u003d0;r\u003cvalues.length;r++){\n    const row \u003d values[r];\n    if (row[idx.unidade])   setUnidades.add(String(row[idx.unidade]).trim());\n    if (row[idx.beneficio]) setBenef.add(String(row[idx.beneficio]).trim());\n  }\n  unidadeFiltro   \u003d resolveFiltroOuVazio_(Array.from(setUnidades), unidadeFiltro);\n  beneficioFiltro \u003d resolveFiltroOuVazio_(Array.from(setBenef),    beneficioFiltro);\n\n  const wantPend \u003d String(statusFilter).toLowerCase() \u003d\u003d\u003d \u0027pendentes\u0027;\n  const wantEnt  \u003d String(statusFilter).toLowerCase() \u003d\u003d\u003d \u0027entregues\u0027;\n  const iProt \u003d findColIdx_(headers, PROTOCOLO_HDR,\u0027protocolo\u0027,\u0027n¬∫ protocolo\u0027,\u0027n¬∞ protocolo\u0027,\u0027numero do protocolo\u0027,\u0027id\u0027,\u0027id protocolo\u0027);\n\n  const dIni \u003d parseAnyDate(dataInicio);\n  const dFim \u003d parseAnyDate(dataFim);\n\n  const out \u003d [];\n  for (let r\u003d0; r\u003cvalues.length; r++){\n    const row \u003d values[r];\n\n    const unidade \u003d (row[idx.unidade] || \u0027\u0027).toString().trim();\n    const benef   \u003d (row[idx.beneficio] || \u0027\u0027).toString().trim();\n    if (unidadeFiltro \u0026\u0026 !matchesFilter_(unidade, unidadeFiltro)) continue;\n    if (beneficioFiltro \u0026\u0026 !matchesFilter_(benef, beneficioFiltro)) continue;\n\n    const isEnt   \u003d isRowEntregue_(row, idx);\n    if (wantPend \u0026\u0026 isEnt) continue;\n    if (wantEnt  \u0026\u0026 !isEnt) continue;\n\n    const stCell  \u003d idx.status\u003e\u003d0 ? String(row[idx.status]||\u0027\u0027).toUpperCase() : \u0027\u0027;\n    const status  \u003d isEnt ? \u0027ENTREGUE\u0027 : (stCell || \u0027PENDENTE\u0027);\n    const dataObj \u003d coerceSheetDate(row[idx.data]);\n\n    if (dIni \u0026\u0026 dataObj \u0026\u0026 dataObj \u003c startOfDay(dIni)) continue;\n    if (dFim \u0026\u0026 dataObj \u0026\u0026 dataObj \u003e endOfDay(dFim))   continue;\n\n    const linkPdf \u003d idx.pdf\u003e\u003d0 ? (row[idx.pdf] || \u0027\u0027) : \u0027\u0027;\n    if (pdfOnly \u0026\u0026 !linkPdf) continue;\n\n    const protStr \u003d iProt\u003e\u003d0 ? String(row[iProt]||\u0027\u0027) : \u0027\u0027;\n    if (hasProto \u0026\u0026 !protStr) continue;\n\n    out.push({\n      rowRef:      r+2,\n      protocolo:   protStr || \u0027\u0027,\n      nome:        idx.nome\u003e\u003d0 ? String(row[idx.nome]||\u0027\u0027).trim() : \u0027\u0027,\n      cpf:         idx.cpf\u003e\u003d0 ? formatCPF(String(row[idx.cpf]||\u0027\u0027)) : \u0027\u0027,\n      beneficio:   benef,\n      unidade,\n      solicitadoEm: dataObj ? formatDateBR(dataObj) : \u0027\u0027,\n      status,\n      pdf:         linkPdf,\n      entregue:    isEnt,\n      documentos:  idx.docs\u003e\u003d0 ? (row[idx.docs] || \u0027\u0027) : \u0027\u0027\n    });\n  }\n\n  sortList_(out, order);\n  return { registros: out.slice(0,2000) };\n}\n\nfunction baixa_search(q, statusFilter\u003d\u0027todos\u0027, unidadeFiltro\u003d\u0027\u0027, beneficioFiltro\u003d\u0027\u0027, order\u003d\u0027data_desc\u0027, pdfOnly\u003dfalse, hasProto\u003dfalse, dataInicio\u003d\u0027\u0027, dataFim\u003d\u0027\u0027){\n  q \u003d String(q || \u0027\u0027).trim();\n  if (!q) return { registros: [] };\n\n  const { sh, headers, idx } \u003d getRespostasIndexMap_();\n  const values \u003d sh.getRange(2,1, Math.max(0, sh.getLastRow()-1), sh.getLastColumn()).getValues();\n\n  const setUnidades \u003d new Set(), setBenef \u003d new Set();\n  for (let r\u003d0;r\u003cvalues.length;r++){\n    const row \u003d values[r];\n    if (row[idx.unidade])   setUnidades.add(String(row[idx.unidade]).trim());\n    if (row[idx.beneficio]) setBenef.add(String(row[idx.beneficio]).trim());\n  }\n  unidadeFiltro   \u003d resolveFiltroOuVazio_(Array.from(setUnidades), unidadeFiltro);\n  beneficioFiltro \u003d resolveFiltroOuVazio_(Array.from(setBenef),    beneficioFiltro);\n\n  const wantPend \u003d String(statusFilter).toLowerCase() \u003d\u003d\u003d \u0027pendentes\u0027;\n  const wantEnt  \u003d String(statusFilter).toLowerCase() \u003d\u003d\u003d \u0027entregues\u0027;\n  const iProt \u003d findColIdx_(headers, PROTOCOLO_HDR,\u0027protocolo\u0027,\u0027n¬∫ protocolo\u0027,\u0027n¬∞ protocolo\u0027,\u0027numero do protocolo\u0027,\u0027id\u0027,\u0027id protocolo\u0027);\n\n  const qLower \u003d q.toLowerCase();\n  const qNum   \u003d q.replace(/\\D/g,\u0027\u0027);\n  const qNorm  \u003d normText_(q);\n  const dIni   \u003d parseAnyDate(dataInicio);\n  const dFim   \u003d parseAnyDate(dataFim);\n\n  const out \u003d [];\n  for (let r\u003d0; r\u003cvalues.length; r++){\n    const row \u003d values[r];\n\n    const unidade \u003d (row[idx.unidade] || \u0027\u0027).toString().trim();\n    const benef   \u003d (row[idx.beneficio] || \u0027\u0027).toString().trim();\n    if (unidadeFiltro \u0026\u0026 !matchesFilter_(unidade, unidadeFiltro)) continue;\n    if (beneficioFiltro \u0026\u0026 !matchesFilter_(benef, beneficioFiltro)) continue;\n\n    const cpfStr   \u003d idx.cpf\u003e\u003d0 ? String(row[idx.cpf]||\u0027\u0027) : \u0027\u0027;\n    const cpfNum   \u003d cpfStr.replace(/\\D/g,\u0027\u0027);\n    const nomeStr  \u003d idx.nome\u003e\u003d0 ? String(row[idx.nome]||\u0027\u0027) : \u0027\u0027;\n    const nomeNorm \u003d normText_(nomeStr);\n    const protStr  \u003d iProt\u003e\u003d0 ? String(row[iProt]||\u0027\u0027) : \u0027\u0027;\n\n    const match \u003d\n      (qNum \u0026\u0026 (cpfNum.includes(qNum) || protStr.replace(/\\D/g,\u0027\u0027).includes(qNum))) ||\n      (qNorm \u0026\u0026 nomeNorm.includes(qNorm)) ||\n      (iProt\u003e\u003d0 \u0026\u0026 protStr.toLowerCase().includes(qLower));\n    if (!match) continue;\n\n    const isEnt   \u003d isRowEntregue_(row, idx);\n    if (wantPend \u0026\u0026 isEnt) continue;\n    if (wantEnt  \u0026\u0026 !isEnt) continue;\n\n    const stCell  \u003d idx.status\u003e\u003d0 ? String(row[idx.status]||\u0027\u0027).toUpperCase() : \u0027\u0027;\n    const status  \u003d isEnt ? \u0027ENTREGUE\u0027 : (stCell || \u0027PENDENTE\u0027);\n    const dataObj \u003d coerceSheetDate(row[idx.data]);\n\n    if (dIni \u0026\u0026 dataObj \u0026\u0026 dataObj \u003c startOfDay(dIni)) continue;\n    if (dFim \u0026\u0026 dataObj \u0026\u0026 dataObj \u003e endOfDay(dFim))   continue;\n\n    const linkPdf \u003d idx.pdf\u003e\u003d0 ? (row[idx.pdf] || \u0027\u0027) : \u0027\u0027;\n    if (pdfOnly \u0026\u0026 !linkPdf) continue;\n    if (hasProto \u0026\u0026 !protStr) continue;\n\n    out.push({\n      rowRef:      r+2,\n      protocolo:   protStr,\n      nome:        nomeStr,\n      cpf:         formatCPF(cpfStr),\n      beneficio:   benef,\n      unidade,\n      solicitadoEm: dataObj ? formatDateBR(dataObj) : \u0027\u0027,\n      status,\n      pdf:         linkPdf,\n      entregue:    isEnt,\n      documentos:  idx.docs\u003e\u003d0 ? (row[idx.docs] || \u0027\u0027) : \u0027\u0027\n    });\n  }\n\n  sortList_(out, order);\n  return { registros: out };\n}\n\nfunction baixa_marcarEntrega(payload){\n  const { rowRef, dataEntrega, setor, usuario, obs } \u003d payload || {};\n  if (!rowRef) throw new Error(\u0027RowRef n√£o informado\u0027);\n\n  const { sh, headers, idx } \u003d getRespostasIndexMap_();\n\n  const iEnt    \u003d idx.entregueFlag;\n  const iEntEm  \u003d ensureColumn_(sh, ENTREGUE_EM_HDR);\n  const iEntPor \u003d ensureColumn_(sh, ENTREGUE_POR_HDR);\n  const iEntUni \u003d ensureColumn_(sh, ENTREGUE_UNID_HDR);\n  const iEntObs \u003d ensureColumn_(sh, ENTREGUE_OBS_HDR);\n\n  let iStatus \u003d idx.status;\n  if (iStatus \u003c 0) iStatus \u003d ensureColumn_(sh, \u0027Status\u0027);\n\n  const rowVals \u003d sh.getRange(rowRef, 1, 1, sh.getLastColumn()).getValues()[0];\n  const antes \u003d isRowEntregue_(rowVals, idx)\n    ? \u0027ENTREGUE\u0027\n    : String(rowVals[iStatus] || \u0027PENDENTE\u0027).toUpperCase();\n\n  const agora \u003d new Date();\n  let dt \u003d agora;\n\n  if (dataEntrega) {\n    const d \u003d parseISODateSafe(dataEntrega);\n    if (d instanceof Date \u0026\u0026 !isNaN(d.getTime())) {\n      d.setHours(agora.getHours(), agora.getMinutes(), agora.getSeconds(), 0);\n      dt \u003d d;\n    }\n  }\n\n  const lock \u003d LockService.getScriptLock(); lock.waitLock(20000);\n  try {\n    sh.getRange(rowRef, iEnt+1).setValue(\u0027ENTREGUE\u0027);\n    sh.getRange(rowRef, iEntEm+1).setValue(dt);\n    sh.getRange(rowRef, iEntPor+1).setValue(usuario || \u0027\u0027);\n    sh.getRange(rowRef, iEntUni+1).setValue(setor   || \u0027\u0027);\n    sh.getRange(rowRef, iEntObs+1).setValue(obs     || \u0027\u0027);\n    sh.getRange(rowRef, iStatus+1).setValue(\u0027ENTREGUE\u0027);\n  } finally {\n    lock.releaseLock();\n  }\n\n  const log     \u003d ensureBaixasSheet_();\n  const idxCPF  \u003d idx.cpf;\n  const idxNome \u003d idx.nome;\n  const idxBen  \u003d idx.beneficio;\n  const iProt   \u003d findColIdx_(headers,\n    PROTOCOLO_HDR,\u0027protocolo\u0027,\u0027n¬∫ protocolo\u0027,\u0027n¬∞ protocolo\u0027,\n    \u0027numero do protocolo\u0027,\u0027id\u0027,\u0027id protocolo\u0027\n  );\n\n  log.appendRow([\n    new Date(),\n    iProt   \u003e\u003d0 ? rowVals[iProt]   : \u0027\u0027,\n    idxCPF  \u003e\u003d0 ? rowVals[idxCPF]  : \u0027\u0027,\n    idxNome \u003e\u003d0 ? rowVals[idxNome] : \u0027\u0027,\n    idxBen  \u003e\u003d0 ? rowVals[idxBen]  : \u0027\u0027,\n    antes, \u0027ENTREGUE\u0027, dt, setor||\u0027\u0027, usuario||\u0027\u0027, obs||\u0027\u0027, rowRef\n  ]);\n\n  return true;\n}\n\n/************************\n * DASHBOARD\n ************************/\nfunction getDashboardCompleto(inicio, fim, unidade \u003d \"\") {\n  const { sh, idx } \u003d getRespostasIndexMap_();\n  const rows \u003d sh.getDataRange().getValues();\n  if (rows.length \u003c\u003d 1) return payloadDashboardVazio_();\n\n  const dados \u003d rows.slice(1);\n  const dIni \u003d parseAnyDate(inicio);\n  const dFim \u003d parseAnyDate(fim);\n\n  const statusTotais \u003d { SOLICITADO:0, APROVADO:0, PENDENTE:0, RECUSADO:0, ENTREGUE:0 };\n  const tipos \u003d {};\n  const setores \u003d {};\n  const meses \u003d {};\n  const byMonthStatus \u003d {};\n  const dow \u003d [0,0,0,0,0,0,0];\n  const registros \u003d [];\n\n  dados.forEach(linha \u003d\u003e {\n    const data \u003d coerceSheetDate(linha[idx.data]);\n    if (!data) return;\n    if (dIni \u0026\u0026 data \u003c startOfDay(dIni)) return;\n    if (dFim \u0026\u0026 data \u003e endOfDay(dFim)) return;\n\n    const setor  \u003d (linha[idx.unidade] || \u0027Indefinido\u0027).toString().trim();\n    if (unidade \u0026\u0026 !matchesFilter_(setor, unidade)) return;\n\n    const isEnt  \u003d isRowEntregue_(linha, idx);\n    const status \u003d isEnt ? \u0027ENTREGUE\u0027 : (String(linha[idx.status] || \u0027PENDENTE\u0027).toUpperCase());\n    const tipo   \u003d (linha[idx.beneficio] || \u0027Indefinido\u0027).toString().trim();\n    const cpfStr \u003d (linha[idx.cpf] || \u0027\u0027).toString().trim();\n    const nome   \u003d (linha[idx.nome] || \u0027\u0027).toString().trim();\n\n    statusTotais.SOLICITADO++;\n    if (statusTotais.hasOwnProperty(status)) statusTotais[status]++;\n\n    tipos[tipo] \u003d (tipos[tipo] || 0) + 1;\n\n    if (!setores[setor]) setores[setor] \u003d { SOLICITADO:0, APROVADO:0, PENDENTE:0, RECUSADO:0, ENTREGUE:0 };\n    setores[setor].SOLICITADO++;\n    if (setores[setor].hasOwnProperty(status)) setores[setor][status]++;\n\n    const chave \u003d ((\u00270\u0027+(data.getMonth()+1)).slice(-2)) + \u0027/\u0027 + data.getFullYear();\n    meses[chave] \u003d (meses[chave] || 0) + 1;\n\n    if (!byMonthStatus[chave]) byMonthStatus[chave] \u003d { SOLICITADO:0, APROVADO:0, PENDENTE:0, RECUSADO:0, ENTREGUE:0 };\n    byMonthStatus[chave][status] \u003d (byMonthStatus[chave][status] || 0) + 1;\n\n    dow[data.getDay()]++;\n\n    registros.push({\n      nome,\n      cpf: formatCPF(cpfStr),\n      unidade:setor,\n      beneficio:tipo,\n      demanda:tipo,\n      status,\n      dataISO: toISODate_(data),\n      dataBR: formatDateBR(data)\n    });\n  });\n\n  const mesesLabels \u003d Object.keys(meses).sort((a,b)\u003d\u003e{\n    const [ma,aa] \u003d a.split(\u0027/\u0027).map(Number);\n    const [mb,ab] \u003d b.split(\u0027/\u0027).map(Number);\n    return new Date(aa,ma-1,1) - new Date(ab,mb-1,1);\n  });\n  const mesesData \u003d mesesLabels.map(k\u003d\u003emeses[k]||0);\n\n  const series \u003d { SOLICITADO:[], APROVADO:[], PENDENTE:[], RECUSADO:[], ENTREGUE:[] };\n  mesesLabels.forEach(lbl\u003d\u003e{\n    const pack \u003d byMonthStatus[lbl] || {};\n    series.SOLICITADO.push((pack.SOLICITADO||0));\n    series.APROVADO  .push((pack.APROVADO  ||0));\n    series.PENDENTE  .push((pack.PENDENTE  ||0));\n    series.RECUSADO  .push((pack.RECUSADO  ||0));\n    series.ENTREGUE  .push((pack.ENTREGUE  ||0));\n  });\n\n  return {\n    status: statusTotais,\n    tipos,\n    setores,\n    meses, mesesLabels, mesesData,\n    byMonthStatusLabels: mesesLabels,\n    byMonthStatusSeries: series,\n    dowLabels: [\u0027Dom\u0027,\u0027Seg\u0027,\u0027Ter\u0027,\u0027Qua\u0027,\u0027Qui\u0027,\u0027Sex\u0027,\u0027S√°b\u0027],\n    dowData: dow,\n    registros\n  };\n}\n\nfunction payloadDashboardVazio_(){\n  return {\n    status:{ SOLICITADO:0, APROVADO:0, PENDENTE:0, RECUSADO:0, ENTREGUE:0 },\n    tipos:{}, setores:{}, meses:{},\n    mesesLabels:[], mesesData:[],\n    byMonthStatusLabels:[],\n    byMonthStatusSeries:{ SOLICITADO:[], APROVADO:[], PENDENTE:[], RECUSADO:[], ENTREGUE:[] },\n    dowLabels:[\u0027Dom\u0027,\u0027Seg\u0027,\u0027Ter\u0027,\u0027Qua\u0027,\u0027Qui\u0027,\u0027Sex\u0027,\u0027S√°b\u0027],\n    dowData:[0,0,0,0,0,0,0],\n    registros:[]\n  };\n}\n\n/************************\n * E-MAIL (fila/retry)\n ************************/\nfunction enviarEmailSetor(setor, pdf, nomeBeneficiario) {\n  try { ensureOutboxSheet_(); ensureQueueTrigger_(); } catch (_){}\n\n  const toSetor \u003d obterEmailDoSetor_(setor);\n  if (!toSetor) {\n    Logger.log(\u0027[EMAIL] Setor sem e-mail: \u0027 + setor);\n    return;\n  }\n\n  const assunto \u003d \u0027Nova Ficha de Benef√≠cio - \u0027 + (nomeBeneficiario || \u0027\u0027);\n  const corpo   \u003d \u0027Segue em anexo a ficha preenchida do benefici√°rio: \u0027 + (nomeBeneficiario || \u0027\u0027);\n\n  let fileId \u003d null;\n  try {\n    if (pdf?.file?.getId) fileId \u003d pdf.file.getId();\n    else if (pdf?.fileId) fileId \u003d pdf.fileId;\n  } catch(_){}\n\n  if (!fileId \u0026\u0026 pdf \u0026\u0026 pdf.blob){\n    try {\n      const f \u003d DriveApp.createFile(pdf.blob);\n      fileId \u003d f.getId();\n      setPublicSharing_(f);\n    } catch(e){\n      Logger.log(\u0027[EMAIL] blob-\u003efile: \u0027+e.message);\n    }\n  }\n  if (!fileId) {\n    Logger.log(\u0027[EMAIL] sem fileId\u0027);\n    return;\n  }\n\n  const okSetor \u003d tentarEnviarAgora_(toSetor, assunto, corpo, fileId, pdf \u0026\u0026 pdf.blob);\n  if (!okSetor) enqueueEmail_(toSetor, assunto, corpo, fileId, setor, nomeBeneficiario);\n\n  if (COPIA_EMAIL \u0026\u0026 validarEmail_(COPIA_EMAIL)) {\n    const okCopia \u003d tentarEnviarAgora_(COPIA_EMAIL, assunto + \u0027 (c√≥pia)\u0027, corpo, fileId, null);\n    if (!okCopia) enqueueEmail_(COPIA_EMAIL, assunto + \u0027 (c√≥pia)\u0027, corpo, fileId, setor, nomeBeneficiario);\n  }\n}\n\nfunction validarEmail_(e){\n  return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(String(e||\u0027\u0027).trim());\n}\n\n/** ‚úÖ (AJUSTADO) pega e-mail usando cabe√ßalho, n√£o posi√ß√£o fixa */\nfunction obterEmailDoSetor_(setor){\n  try{\n    const planilha \u003d SpreadsheetApp.openById(PLANILHA_ID);\n    const aba \u003d planilha.getSheetByName(\u0027Login\u0027);\n    if (!aba) return \u0027\u0027;\n\n    const lastRow \u003d aba.getLastRow();\n    const lastCol \u003d aba.getLastColumn();\n    if (lastRow \u003c 2) return \u0027\u0027;\n\n    const headers \u003d aba.getRange(1,1,1,lastCol).getValues()[0] || [];\n    const idx \u003d getLoginIdx_(headers);\n\n    const iSet \u003d idx.setor \u003e\u003d 0 ? idx.setor : 0;\n    const iEm  \u003d idx.email \u003e\u003d 0 ? idx.email : 3;\n\n    const dados \u003d aba.getRange(2,1,lastRow-1,lastCol).getValues();\n    const wantedKey \u003d canonicalSectorKey_(setor);\n\n    for (let i\u003d0;i\u003cdados.length;i++){\n      const setLabel \u003d cleanSectorLabel_(dados[i][iSet] || \u0027\u0027);\n      if (canonicalSectorKey_(setLabel) !\u003d\u003d wantedKey) continue;\n\n      const em \u003d (dados[i][iEm] || \u0027\u0027).toString().trim();\n      if (validarEmail_(em)) return em;\n    }\n  }catch(e){\n    Logger.log(\u0027[EMAIL] obter email setor: \u0027 + e.message);\n  }\n  return \u0027\u0027;\n}\n\nfunction tentarEnviarAgora_(to, subject, body, fileId, blobOpt){\n  if (!validarEmail_(to)) {\n    Logger.log(\u0027[EMAIL] inv√°lido: \u0027 + to);\n    return false;\n  }\n  const quota \u003d MailApp.getRemainingDailyQuota();\n  if (quota \u003c\u003d 0) {\n    Logger.log(\u0027[EMAIL] Sem quota di√°ria\u0027);\n    return false;\n  }\n\n  const lock \u003d LockService.getScriptLock();\n  try { lock.waitLock(20000); } catch (e){\n    Logger.log(\u0027[EMAIL] lock falhou: \u0027 + e.message);\n  }\n\n  try {\n    for (let tent\u003d1; tent\u003c\u003d2; tent++){\n      try{\n        const attachments \u003d [];\n        if (blobOpt) attachments.push(blobOpt);\n        else attachments.push(DriveApp.getFileById(fileId).getAs(MimeType.PDF));\n\n        if (tent\u003e1) Utilities.sleep(600 * tent);\n\n        try{\n          MailApp.sendEmail({ to, subject, body, attachments, name:\u0027SEMFAS Sistema\u0027 });\n          Logger.log(\u0027[EMAIL] MailApp OK -\u003e \u0027 + to);\n          return true;\n        }catch(e1){\n          Logger.log(\u0027[EMAIL] MailApp falhou: \u0027 + e1.message);\n          GmailApp.sendEmail(to, subject, body, { attachments, name:\u0027SEMFAS Sistema\u0027 });\n          Logger.log(\u0027[EMAIL] GmailApp OK -\u003e \u0027 + to);\n          return true;\n        }\n      }catch(e){\n        Logger.log(\u0027[EMAIL] tentativa \u0027 + tent + \u0027: \u0027 + e.message);\n        if (tent\u003d\u003d\u003d2) return false;\n      }\n    }\n  } finally {\n    try { lock.releaseLock(); } catch(_){}\n  }\n  return false;\n}\n\nfunction ensureOutboxSheet_(){\n  const ss \u003d SpreadsheetApp.openById(PLANILHA_ID);\n  let sh \u003d ss.getSheetByName(OUTBOX_SHEET_NAME);\n  if (!sh){\n    sh \u003d ss.insertSheet(OUTBOX_SHEET_NAME);\n    sh.getRange(1,1,1,10).setValues([[\n      \u0027Timestamp\u0027,\u0027To\u0027,\u0027Assunto\u0027,\u0027Corpo\u0027,\u0027FileId\u0027,\u0027Tentativas\u0027,\u0027Status\u0027,\u0027UltimoErro\u0027,\u0027Setor\u0027,\u0027Beneficiario\u0027\n    ]]);\n  }\n  return sh;\n}\n\nfunction enqueueEmail_(to, subject, body, fileId, setor, beneficiario){\n  const sh \u003d ensureOutboxSheet_();\n  sh.appendRow([\n    new Date(), to, subject, body, fileId, 0, \u0027PENDING\u0027, \u0027\u0027, setor||\u0027\u0027, beneficiario||\u0027\u0027\n  ]);\n  ensureQueueTrigger_();\n  Logger.log(\u0027[EMAIL] enfileirado -\u003e \u0027 + to);\n}\n\nfunction processEmailQueue(){\n  const sh \u003d ensureOutboxSheet_();\n  const lastRow \u003d sh.getLastRow();\n  if (lastRow \u003c 2) return;\n\n  const rng \u003d sh.getRange(2,1,lastRow-1,10).getValues();\n  const out \u003d [];\n  const quota \u003d MailApp.getRemainingDailyQuota();\n  if (quota \u003c\u003d 0) {\n    Logger.log(\u0027[EMAIL] Sem quota di√°ria\u0027);\n    return;\n  }\n\n  for (let i\u003d0;i\u003crng.length;i++){\n    let [ts, to, subject, body, fileId, tries, status, lastErr, setor, benef] \u003d rng[i];\n    if (status \u003d\u003d\u003d \u0027SENT\u0027) {\n      out.push(rng[i]);\n      continue;\n    }\n    if (tries \u003e\u003d OUTBOX_MAX_TRIES) {\n      out.push([ts,to,subject,body,fileId,tries,\u0027ERROR\u0027,lastErr,setor,benef]);\n      continue;\n    }\n\n    let ok\u003dfalse, errMsg\u003d\u0027\u0027;\n    try{\n      const file \u003d DriveApp.getFileById(fileId);\n      const attachments \u003d [ file.getAs(MimeType.PDF) ];\n      try {\n        MailApp.sendEmail({ to, subject, body, attachments, name:\u0027SEMFAS Sistema\u0027 });\n        ok\u003dtrue;\n      } catch(e1){\n        GmailApp.sendEmail(to, subject, body, { attachments, name:\u0027SEMFAS Sistema\u0027 });\n        ok\u003dtrue;\n      }\n    }catch(e){\n      ok\u003dfalse;\n      errMsg \u003d e.message || String(e);\n    }\n\n    if (ok) out.push([ts,to,subject,body,fileId,tries+1,\u0027SENT\u0027,\u0027\u0027,setor,benef]);\n    else    out.push([ts,to,subject,body,fileId,tries+1,\u0027PENDING\u0027,errMsg,setor,benef]);\n  }\n  sh.getRange(2,1,out.length,10).setValues(out);\n}\n\nfunction ensureQueueTrigger_(){\n  const fn \u003d \u0027processEmailQueue\u0027;\n  const triggers \u003d ScriptApp.getProjectTriggers().filter(t\u003d\u003et.getHandlerFunction()\u003d\u003d\u003dfn);\n  if (triggers.length\u003d\u003d\u003d0)\n    ScriptApp.newTrigger(fn).timeBased().everyMinutes(5).create();\n}\n\nfunction extractDriveIdFromUrl_(url){\n  if (!url) return \u0027\u0027;\n  const m1 \u003d String(url).match(/\\/d\\/([a-zA-Z0-9_-]{10,})/);\n  if (m1 \u0026\u0026 m1[1]) return m1[1];\n  const m2 \u003d String(url).match(/[?\u0026]id\u003d([a-zA-Z0-9_-]{10,})/);\n  if (m2 \u0026\u0026 m2[1]) return m2[1];\n  return \u0027\u0027;\n}\n\n/************************\n * DIAGN√ìSTICO R√ÅPIDO\n ************************/\nfunction baixa_ping(){\n  const { sh, idx } \u003d getRespostasIndexMap_();\n  return {\n    sheet: sh.getName(),\n    rows: sh.getLastRow() - 1,\n    cols: sh.getLastColumn(),\n    idx: idx\n  };\n}\n\n/** \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n *  PROTOCOLO AUTOM√ÅTICO\n *  \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d*/\nfunction nextProtocolo_(){\n  const year \u003d new Date().getFullYear();\n  const key \u003d \u0027PROTO_SEQ_\u0027 + year;\n  const sp \u003d PropertiesService.getScriptProperties();\n  let n \u003d parseInt(sp.getProperty(key) || \u00270\u0027, 10);\n  n++;\n  sp.setProperty(key, String(n));\n  return `BEV-${year}-${String(n).padStart(6,\u00270\u0027)}`;\n}\n\nfunction ensureProtocoloForRow_(sh, rowIndex){\n  const iProt \u003d ensureColumn_(sh, PROTOCOLO_HDR);\n  const val \u003d sh.getRange(rowIndex, iProt+1).getValue();\n  if (!String(val||\u0027\u0027).trim()){\n    const proto \u003d nextProtocolo_();\n    sh.getRange(rowIndex, iProt+1).setValue(proto);\n    return proto;\n  }\n  return val;\n}\n\nfunction backfillProtocolos(){\n  const { sh } \u003d getRespostasIndexMap_();\n  const iProt \u003d ensureColumn_(sh, PROTOCOLO_HDR);\n  const last \u003d sh.getLastRow();\n  if (last \u003c 2) return { preenchidos: 0 };\n  const rng \u003d sh.getRange(2, iProt+1, last-1, 1);\n  const vals \u003d rng.getValues();\n  let count \u003d 0;\n  for (let i\u003d0;i\u003cvals.length;i++){\n    if (!String(vals[i][0]||\u0027\u0027).trim()){\n      vals[i][0] \u003d nextProtocolo_();\n      count++;\n    }\n  }\n  rng.setValues(vals);\n  return { preenchidos: count };\n}\n\n/************************\n * DETALHES (Drawer Central)\n ************************/\nfunction getRegistroCompleto(linha){\n  if (!linha) throw new Error(\u0027Linha n√£o informada.\u0027);\n  const { sh, headers, idx } \u003d getRespostasIndexMap_();\n  const lastCol \u003d sh.getLastColumn();\n  const row \u003d sh.getRange(linha, 1, 1, lastCol).getValues()[0];\n\n  const toStr \u003d v \u003d\u003e {\n    if (v instanceof Date) return formatDateBR(v);\n    if (typeof v \u003d\u003d\u003d \u0027number\u0027) return String(v);\n    return v \u003d\u003d null ? \u0027\u0027 : String(v);\n  };\n\n  const cols \u003d [];\n  for (let i\u003d0;i\u003clastCol;i++){\n    const label \u003d headers[i] ? String(headers[i]) : (\u0027Coluna \u0027 + (i+1));\n    cols.push({ label, value: toStr(row[i]) });\n  }\n\n  const iProt \u003d findColIdx_(headers,\n    PROTOCOLO_HDR,\u0027protocolo\u0027,\u0027n¬∫ protocolo\u0027,\u0027n¬∞ protocolo\u0027,\n    \u0027numero do protocolo\u0027,\u0027id\u0027,\u0027id protocolo\u0027\n  );\n  const protocolo \u003d iProt \u003e\u003d 0 ? toStr(row[iProt]) : \u0027\u0027;\n\n  const status \u003d isRowEntregue_(row, idx)\n    ? \u0027ENTREGUE\u0027\n    : (String(idx.status\u003e\u003d0 ? row[idx.status] : \u0027PENDENTE\u0027).toUpperCase() || \u0027PENDENTE\u0027);\n\n  const resumo \u003d {\n    linha,\n    data: (function(){\n      const d \u003d coerceSheetDate(row[idx.data]); return d ? formatDateBR(d) : \u0027\u0027;\n    })(),\n    unidade:  idx.unidade  \u003e\u003d 0 ? toStr(row[idx.unidade])  : \u0027\u0027,\n    demanda:  idx.beneficio\u003e\u003d 0 ? toStr(row[idx.beneficio]): \u0027\u0027,\n    nome:     idx.nome     \u003e\u003d 0 ? toStr(row[idx.nome])     : \u0027\u0027,\n    cpf:      idx.cpf      \u003e\u003d 0 ? formatCPF(toStr(row[idx.cpf])) : \u0027\u0027,\n    status,\n    protocolo\n  };\n\n  return { linha, resumo, cols };\n}\n\n/************************\n * ATUALIZAR STATUS (Central)\n ************************/\nfunction atualizarStatus(linha, status){\n  status \u003d String(status||\u0027\u0027).trim().toUpperCase();\n  if (!linha || !status) throw new Error(\u0027Par√¢metros inv√°lidos.\u0027);\n\n  const { sh, idx } \u003d getRespostasIndexMap_();\n\n  let iStatus \u003d idx.status;\n  if (iStatus \u003c 0) iStatus \u003d ensureColumn_(sh, \u0027Status\u0027);\n\n  const iEnt    \u003d idx.entregueFlag;\n  const iEntEm  \u003d ensureColumn_(sh, ENTREGUE_EM_HDR);\n  const iEntPor \u003d ensureColumn_(sh, ENTREGUE_POR_HDR);\n  const iEntUni \u003d ensureColumn_(sh, ENTREGUE_UNID_HDR);\n  const iEntObs \u003d ensureColumn_(sh, ENTREGUE_OBS_HDR);\n\n  const rowVals \u003d sh.getRange(linha, 1, 1, sh.getLastColumn()).getValues()[0];\n\n  const lock \u003d LockService.getScriptLock(); lock.waitLock(15000);\n  try{\n    sh.getRange(linha, iStatus+1).setValue(status);\n    if (status \u003d\u003d\u003d \u0027ENTREGUE\u0027){\n      sh.getRange(linha, iEnt+1).setValue(\u0027ENTREGUE\u0027);\n      if (!rowVals[iEntEm]) sh.getRange(linha, iEntEm+1).setValue(new Date());\n    } else {\n      sh.getRange(linha, iEnt+1).setValue(\u0027\u0027);\n    }\n  } finally { lock.releaseLock(); }\n  return true;\n}\n\n/************************\n * PARECER T√âCNICO ‚Äî atualizar/ler\n ************************/\nfunction atualizarParecer(linha, payload){\n  if (!linha) throw new Error(\u0027Linha n√£o informada.\u0027);\n  payload \u003d payload || {};\n  const { sh } \u003d getRespostasIndexMap_();\n\n  const iPar  \u003d ensureColumn_(sh, \u0027PARECER T√âCNICO\u0027);\n  const iNomT \u003d ensureColumn_(sh, \u0027NOME T√âCNICO\u0027);\n  const iMun  \u003d ensureColumn_(sh, \u0027MUNIC√çPIO PARECER\u0027);\n  const iData \u003d ensureColumn_(sh, \u0027DATA PARECER\u0027);\n  const iAssB \u003d ensureColumn_(sh, \u0027ASSINATURA BENEFICI√ÅRIO\u0027);\n  const iAssT \u003d ensureColumn_(sh, \u0027ASSINATURA/CARIMBO\u0027);\n\n  const lock \u003d LockService.getScriptLock(); lock.waitLock(15000);\n  try {\n    if (payload.parecer !\u003d null)\n      sh.getRange(linha, iPar+1).setValue(String(payload.parecer||\u0027\u0027));\n    if (payload.nome_tecnico !\u003d null)\n      sh.getRange(linha, iNomT+1).setValue(String(payload.nome_tecnico||\u0027\u0027));\n    if (payload.municipio_parecer !\u003d null)\n      sh.getRange(linha, iMun+1).setValue(String(payload.municipio_parecer||\u0027\u0027));\n    if (payload.data_parecer !\u003d null){\n      const d \u003d parseISODateSafe(payload.data_parecer);\n      sh.getRange(linha, iData+1).setValue(d ? formatDateBR(d) : \u0027\u0027);\n    }\n    if (payload.assinatura_beneficiario !\u003d null)\n      sh.getRange(linha, iAssB+1).setValue(String(payload.assinatura_beneficiario||\u0027\u0027));\n    if (payload.assinatura_carimbo !\u003d null)\n      sh.getRange(linha, iAssT+1).setValue(String(payload.assinatura_carimbo||\u0027\u0027));\n  } finally {\n    lock.releaseLock();\n  }\n  return true;\n}\n\nfunction lerParecer(linha){\n  if (!linha) throw new Error(\u0027Linha n√£o informada.\u0027);\n  const { sh } \u003d getRespostasIndexMap_();\n\n  const iPar  \u003d ensureColumn_(sh, \u0027PARECER T√âCNICO\u0027);\n  const iNomT \u003d ensureColumn_(sh, \u0027NOME T√âCNICO\u0027);\n  const iMun  \u003d ensureColumn_(sh, \u0027MUNIC√çPIO PARECER\u0027);\n  const iData \u003d ensureColumn_(sh, \u0027DATA PARECER\u0027);\n  const iAssB \u003d ensureColumn_(sh, \u0027ASSINATURA BENEFICI√ÅRIO\u0027);\n  const iAssT \u003d ensureColumn_(sh, \u0027ASSINATURA/CARIMBO\u0027);\n\n  const vals \u003d sh.getRange(linha, 1, 1, sh.getLastColumn()).getValues()[0];\n\n  return {\n    parecer:                 vals[iPar]  || \u0027\u0027,\n    nome_tecnico:            vals[iNomT] || \u0027\u0027,\n    municipio_parecer:       vals[iMun]  || \u0027\u0027,\n    data_parecer:            vals[iData] || \u0027\u0027,\n    assinatura_beneficiario: vals[iAssB] || \u0027\u0027,\n    assinatura_carimbo:      vals[iAssT] || \u0027\u0027\n  };\n}\n\n/************************\n * PROTOCOLO / PDF ‚Äî utilidades\n ************************/\nfunction obterLinkPdf(linha){\n  const { sh } \u003d getRespostasIndexMap_();\n  if (!linha) throw new Error(\u0027Linha n√£o informada.\u0027);\n  const iPdf \u003d ensureColumn_(sh, \u0027PDF\u0027);\n  const link \u003d sh.getRange(linha, iPdf+1).getValue();\n  return { link: link || \u0027\u0027 };\n}\n\nfunction regerarPdf(linha){\n  if (!linha) throw new Error(\u0027Linha n√£o informada.\u0027);\n  return gerarPdfDeRegistro(linha);\n}\n\nfunction garantirProtocolosPreenchidos(){\n  return backfillProtocolos();\n}\n\n/************************\n * ENTREGA ‚Äî desfazer/ajustar\n ************************/\nfunction desfazerEntrega(linha){\n  if (!linha) throw new Error(\u0027Linha n√£o informada.\u0027);\n  const { sh, idx } \u003d getRespostasIndexMap_();\n\n  const iEnt   \u003d idx.entregueFlag;\n  const iEntEm \u003d ensureColumn_(sh, ENTREGUE_EM_HDR);\n  const iEntPor\u003d ensureColumn_(sh, ENTREGUE_POR_HDR);\n  const iEntUni\u003d ensureColumn_(sh, ENTREGUE_UNID_HDR);\n  const iEntObs\u003d ensureColumn_(sh, ENTREGUE_OBS_HDR);\n\n  let iStatus  \u003d idx.status;\n  if (iStatus \u003c 0) iStatus \u003d ensureColumn_(sh, \u0027Status\u0027);\n\n  const lock \u003d LockService.getScriptLock(); lock.waitLock(15000);\n  try{\n    sh.getRange(linha, iEnt+1).setValue(\u0027\u0027);\n    sh.getRange(linha, iEntEm+1).setValue(\u0027\u0027);\n    sh.getRange(linha, iEntPor+1).setValue(\u0027\u0027);\n    sh.getRange(linha, iEntUni+1).setValue(\u0027\u0027);\n    sh.getRange(linha, iEntObs+1).setValue(\u0027\u0027);\n    sh.getRange(linha, iStatus+1).setValue(\u0027PENDENTE\u0027);\n  } finally {\n    lock.releaseLock();\n  }\n  return true;\n}\n\n/************************\n * HIST√ìRICO por CPF\n ************************/\nfunction historicoPorCPF(cpf){\n  const docpf \u003d normalizeCPF(cpf);\n  if (!docpf) return { registros: [] };\n\n  const { sh, headers, idx } \u003d getRespostasIndexMap_();\n  const vals \u003d sh.getDataRange().getValues();\n\n  const iProt   \u003d findColIdx_(headers,\n    PROTOCOLO_HDR,\u0027protocolo\u0027,\u0027n¬∫ protocolo\u0027,\u0027n¬∞ protocolo\u0027,\n    \u0027numero do protocolo\u0027,\u0027id\u0027,\u0027id protocolo\u0027\n  );\n  const iEntEm  \u003d ensureColumn_(sh, ENTREGUE_EM_HDR);\n  const iEntPor \u003d ensureColumn_(sh, ENTREGUE_POR_HDR);\n  const iEntUni \u003d ensureColumn_(sh, ENTREGUE_UNID_HDR);\n  const iEntObs \u003d ensureColumn_(sh, ENTREGUE_OBS_HDR);\n  const iPdf    \u003d idx.pdf \u003e\u003d 0 ? idx.pdf : ensureColumn_(sh, \u0027PDF\u0027);\n  const iDocs   \u003d idx.docs;\n\n  const out \u003d [];\n  for (let i \u003d 1; i \u003c vals.length; i++){\n    const row \u003d vals[i];\n\n    const cpfCell \u003d (idx.cpf \u003e\u003d 0 \u0026\u0026 idx.cpf \u003c row.length) ? row[idx.cpf] : \u0027\u0027;\n    const cpfRow  \u003d normalizeCPF(cpfCell);\n    if (!cpfRow || cpfRow !\u003d\u003d docpf) continue;\n\n    const dSolic  \u003d\n      (idx.data \u003e\u003d 0 \u0026\u0026 idx.data \u003c row.length)\n        ? coerceSheetDate(row[idx.data])\n        : null;\n\n    const dEntRaw \u003d\n      (iEntEm \u003e\u003d 0 \u0026\u0026 iEntEm \u003c row.length)\n        ? row[iEntEm]\n        : null;\n    const dEnt \u003d dEntRaw ? parseAnyDate(dEntRaw) : null;\n\n    const statusCell \u003d\n      (idx.status \u003e\u003d 0 \u0026\u0026 idx.status \u003c row.length)\n        ? row[idx.status]\n        : \u0027PENDENTE\u0027;\n\n    const status \u003d isRowEntregue_(row, idx)\n      ? \u0027ENTREGUE\u0027\n      : String(statusCell || \u0027PENDENTE\u0027).toUpperCase();\n\n    out.push({\n      linha: i+1,\n      protocolo:       (iProt \u003e\u003d0   \u0026\u0026 iProt   \u003c row.length) ? (row[iProt]      || \u0027\u0027) : \u0027\u0027,\n      nome:            (idx.nome\u003e\u003d0 \u0026\u0026 idx.nome\u003c row.length) ? (row[idx.nome]   || \u0027\u0027) : \u0027\u0027,\n      unidade:         (idx.unidade\u003e\u003d0 \u0026\u0026 idx.unidade\u003crow.length) ? (row[idx.unidade] || \u0027\u0027) : \u0027\u0027,\n      beneficio:       (idx.beneficio\u003e\u003d0 \u0026\u0026 idx.beneficio\u003crow.length) ? (row[idx.beneficio] || \u0027\u0027) : \u0027\u0027,\n      data:            dSolic ? formatDateBR(dSolic) : \u0027\u0027,\n      status,\n      entregue_em:     dEnt ? Utilities.formatDate(dEnt, TZ, \u0027dd/MM/yyyy HH:mm\u0027) : \u0027\u0027,\n      unidade_entrega: (iEntUni\u003e\u003d0 \u0026\u0026 iEntUni\u003crow.length) ? (row[iEntUni] || \u0027\u0027) : \u0027\u0027,\n      entregue_por:    (iEntPor\u003e\u003d0 \u0026\u0026 iEntPor\u003crow.length) ? (row[iEntPor] || \u0027\u0027) : \u0027\u0027,\n      obs_entrega:     (iEntObs\u003e\u003d0 \u0026\u0026 iEntObs\u003crow.length) ? (row[iEntObs] || \u0027\u0027) : \u0027\u0027,\n      pdf:             (iPdf   \u003e\u003d0 \u0026\u0026 iPdf   \u003crow.length) ? (row[iPdf]    || \u0027\u0027) : \u0027\u0027,\n      docs:            (iDocs  \u003e\u003d0 \u0026\u0026 iDocs  \u003crow.length) ? (row[iDocs]   || \u0027\u0027) : \u0027\u0027\n    });\n  }\n\n  sortList_(out, \u0027data_desc\u0027);\n  return { registros: out };\n}\n\n/************************\n * EXPORTA√á√ÉO CSV (link Drive)\n ************************/\nfunction exportarCsvDashboard(params){\n  params \u003d params || {};\n  const statusFilter   \u003d params.status || \u0027todos\u0027;\n  const unidadeFiltro  \u003d params.unidade || \u0027\u0027;\n  const beneficioFiltro\u003d params.beneficio || \u0027\u0027;\n  const order          \u003d params.order || \u0027data_desc\u0027;\n  const pdfOnly        \u003d !!params.pdfOnly;\n  const hasProto       \u003d !!params.hasProto;\n  const dataInicio     \u003d params.dataInicio || \u0027\u0027;\n  const dataFim        \u003d params.dataFim || \u0027\u0027;\n\n  const pack \u003d baixa_list(statusFilter, unidadeFiltro, beneficioFiltro, order, pdfOnly, hasProto, dataInicio, dataFim);\n  const registros \u003d pack.registros || [];\n  const sep \u003d \u0027;\u0027;\n\n  const header \u003d [\n    \u0027Linha\u0027,\u0027Protocolo\u0027,\u0027Nome\u0027,\u0027CPF\u0027,\u0027Benef√≠cio\u0027,\u0027Unidade\u0027,\u0027Solicitado em\u0027,\u0027Status\u0027,\u0027PDF\u0027\n  ];\n  const linhas \u003d [header.join(sep)];\n  registros.forEach(r\u003d\u003e{\n    linhas.push([\n      r.rowRef, r.protocolo, r.nome, r.cpf, r.beneficio, r.unidade, r.solicitadoEm, r.status, r.pdf\n    ].map(x \u003d\u003e (String(x||\u0027\u0027).includes(sep)\n      ? `\"${String(x).replace(/\"/g,\u0027\"\"\u0027)}\"`\n      : String(x||\u0027\u0027))).join(sep));\n  });\n\n  const blob \u003d Utilities.newBlob(linhas.join(\u0027\\n\u0027), \u0027text/csv\u0027, \u0027export-semfas.csv\u0027);\n  const file \u003d DriveApp.createFile(blob);\n  setPublicSharing_(file);\n  return { fileId: file.getId(), link: buildDriveLinks_(file.getId()).download };\n}\n\n/************************\n * SA√öDE / DIAGN√ìSTICO\n ************************/\nfunction healthCheck(){\n  const info \u003d baixa_ping();\n  return {\n    ok: true,\n    sheet: info.sheet,\n    rows: info.rows,\n    cols: info.cols,\n    idx: info.idx,\n    tz: TZ,\n    now: Utilities.formatDate(new Date(), TZ, \"yyyy-MM-dd\u0027T\u0027HH:mm:ss\")\n  };\n}\n\nfunction versaoScript(){\n  return { version: \u0027v2026.01.06-FIXES-ROLEVIEW-DUPLICIDADE-EMAILHDR\u0027, planilha: PLANILHA_ID };\n}\n\n/************************\n * MENU (opcional no Editor)\n ************************/\nfunction onOpen(){\n  try{\n    SpreadsheetApp.getUi()\n      .createMenu(\u0027SEMFAS\u0027)\n      .addItem(\u0027Backfill Protocolos\u0027,\u0027garantirProtocolosPreenchidos\u0027)\n      .addItem(\u0027Health Check\u0027,\u0027healthCheck\u0027)\n      .addItem(\u0027Processar Fila de E-mails\u0027,\u0027processEmailQueue\u0027)\n      .addToUi();\n  }catch(_){}\n}\n\n/************************\n * CORRE√á√ÉO DE STATUS DA FILA (se necess√°rio)\n ************************/\nfunction corrigirStatusOutbox(){\n  const sh \u003d ensureOutboxSheet_();\n  const lr \u003d sh.getLastRow();\n  if (lr \u003c 2) return { corrigidos: 0 };\n  const rng \u003d sh.getRange(2,1,lr-1,10);\n  const vals \u003d rng.getValues();\n  let c\u003d0;\n  for (let i\u003d0;i\u003cvals.length;i++){\n    if (vals[i][6] \u003d\u003d\u003d \u0027SENTE\u0027){\n      vals[i][6] \u003d \u0027SENT\u0027;\n      c++;\n    }\n  }\n  rng.setValues(vals);\n  return { corrigidos: c };\n}\n\n/************************\n * LOGIN ‚Äî CRUD DE USU√ÅRIOS (Tela ANALISTA)\n ************************/\nfunction ensureLoginSheet_(){\n  const ss \u003d SpreadsheetApp.openById(PLANILHA_ID);\n  let sh \u003d ss.getSheetByName(\u0027Login\u0027);\n  if (!sh){\n    sh \u003d ss.insertSheet(\u0027Login\u0027);\n    sh.appendRow([\u0027Setor\u0027,\u0027Usu√°rio\u0027,\u0027Senha\u0027,\u0027E-mail\u0027,\u0027Perfil\u0027]);\n  }\n  return sh;\n}\n\nfunction listarUsuariosLogin(){\n  const sh \u003d ensureLoginSheet_();\n  const vals \u003d sh.getDataRange().getValues();\n  if (vals.length \u003c\u003d 1) return { usuarios: [], setores: [] };\n\n  const usuarios \u003d [];\n  const setSet \u003d new Set();\n\n  for (let i\u003d1;i\u003cvals.length;i++){\n    const row \u003d vals[i];\n    const setorRaw \u003d row[0] || \u0027\u0027;\n    const usuarioRaw \u003d row[1] || \u0027\u0027;\n    const emailRaw \u003d row[3] || \u0027\u0027;\n    const roleRaw  \u003d row[4] || \u0027usuario\u0027;\n\n    const setor \u003d cleanSectorLabel_(setorRaw);\n    const usuario \u003d String(usuarioRaw||\u0027\u0027).trim();\n    const email   \u003d String(emailRaw||\u0027\u0027).trim();\n    let role      \u003d String(roleRaw||\u0027usuario\u0027).trim().toLowerCase() || \u0027usuario\u0027;\n\n    if (setor) setSet.add(setor);\n\n    usuarios.push({\n      linha: i+1,\n      setor,\n      usuario,\n      email,\n      role\n    });\n  }\n\n  const setores \u003d Array.from(setSet).sort((a,b)\u003d\u003ea.localeCompare(b,\u0027pt-BR\u0027,{sensitivity:\u0027base\u0027}));\n  return { usuarios, setores };\n}\n\nfunction criarUsuarioLogin(payload){\n  payload \u003d payload || {};\n  let setor   \u003d cleanSectorLabel_(payload.setor || \u0027\u0027);\n  let usuario \u003d String(payload.usuario || \u0027\u0027).trim();\n  let senha   \u003d String(payload.senha   || \u0027\u0027).toString();\n  let email   \u003d String(payload.email   || \u0027\u0027).trim();\n  let role    \u003d String(payload.role    || \u0027usuario\u0027).trim().toLowerCase() || \u0027usuario\u0027;\n\n  if (!setor || !usuario || !senha){\n    return { ok:false, msg:\u0027Setor, usu√°rio e senha s√£o obrigat√≥rios.\u0027 };\n  }\n\n  const sh \u003d ensureLoginSheet_();\n  const vals \u003d sh.getDataRange().getValues();\n  const setorKey \u003d canonicalSectorKey_(setor);\n  const userKey  \u003d canonicalSectorKey_(usuario);\n\n  for (let i\u003d1;i\u003cvals.length;i++){\n    const sRow \u003d cleanSectorLabel_(vals[i][0] || \u0027\u0027);\n    const uRow \u003d String(vals[i][1] || \u0027\u0027);\n    if (canonicalSectorKey_(sRow) \u003d\u003d\u003d setorKey \u0026\u0026\n        canonicalSectorKey_(uRow) \u003d\u003d\u003d userKey){\n      return { ok:false, msg:\u0027J√° existe um usu√°rio com esse login para este setor.\u0027 };\n    }\n  }\n\n  const lock \u003d LockService.getScriptLock(); lock.waitLock(15000);\n  try{\n    sh.appendRow([setor, usuario, senha, email, role]);\n  } finally {\n    lock.releaseLock();\n  }\n  return { ok:true };\n}\n\nfunction atualizarUsuarioLogin(payload){\n  payload \u003d payload || {};\n  const linha \u003d parseInt(payload.linha, 10);\n  if (!linha || linha \u003c 2){\n    return { ok:false, msg:\u0027Linha inv√°lida.\u0027 };\n  }\n\n  let setor   \u003d cleanSectorLabel_(payload.setor || \u0027\u0027);\n  let usuario \u003d String(payload.usuario || \u0027\u0027).trim();\n  let email   \u003d String(payload.email   || \u0027\u0027).trim();\n  let role    \u003d String(payload.role    || \u0027usuario\u0027).trim().toLowerCase() || \u0027usuario\u0027;\n\n  if (!setor || !usuario){\n    return { ok:false, msg:\u0027Setor e usu√°rio s√£o obrigat√≥rios.\u0027 };\n  }\n\n  const sh \u003d ensureLoginSheet_();\n  const lastRow \u003d sh.getLastRow();\n  if (linha \u003e lastRow){\n    return { ok:false, msg:\u0027Linha fora do intervalo da planilha.\u0027 };\n  }\n\n  const vals \u003d sh.getDataRange().getValues();\n  const setorKey \u003d canonicalSectorKey_(setor);\n  const userKey  \u003d canonicalSectorKey_(usuario);\n\n  for (let i\u003d1;i\u003cvals.length;i++){\n    const rowIndex \u003d i+1;\n    if (rowIndex \u003d\u003d\u003d linha) continue;\n    const sRow \u003d cleanSectorLabel_(vals[i][0] || \u0027\u0027);\n    const uRow \u003d String(vals[i][1] || \u0027\u0027);\n    if (canonicalSectorKey_(sRow) \u003d\u003d\u003d setorKey \u0026\u0026\n        canonicalSectorKey_(uRow) \u003d\u003d\u003d userKey){\n      return { ok:false, msg:\u0027J√° existe um usu√°rio com esse login para este setor.\u0027 };\n    }\n  }\n\n  const lock \u003d LockService.getScriptLock(); lock.waitLock(15000);\n  try {\n    sh.getRange(linha,1).setValue(setor);\n    sh.getRange(linha,2).setValue(usuario);\n    sh.getRange(linha,4).setValue(email);\n    sh.getRange(linha,5).setValue(role);\n  } finally {\n    lock.releaseLock();\n  }\n  return { ok:true };\n}\n\nfunction alterarSenhaLogin(linha, novaSenha){\n  const row \u003d parseInt(linha, 10);\n  if (!row || row \u003c 2){\n    return { ok:false, msg:\u0027Linha inv√°lida.\u0027 };\n  }\n  novaSenha \u003d String(novaSenha || \u0027\u0027).toString();\n  if (!novaSenha){\n    return { ok:false, msg:\u0027Senha n√£o pode ser vazia.\u0027 };\n  }\n\n  const sh \u003d ensureLoginSheet_();\n  const lastRow \u003d sh.getLastRow();\n  if (row \u003e lastRow){\n    return { ok:false, msg:\u0027Linha fora do intervalo da planilha.\u0027 };\n  }\n\n  const lock \u003d LockService.getScriptLock(); lock.waitLock(15000);\n  try {\n    sh.getRange(row,3).setValue(novaSenha);\n  } finally {\n    lock.releaseLock();\n  }\n  return { ok:true };\n}\n\nfunction resetarSenhaLogin(linha){\n  const row \u003d parseInt(linha, 10);\n  if (!row || row \u003c 2){\n    return { ok:false, msg:\u0027Linha inv√°lida.\u0027 };\n  }\n  const sh \u003d ensureLoginSheet_();\n  const lastRow \u003d sh.getLastRow();\n  if (row \u003e lastRow){\n    return { ok:false, msg:\u0027Linha fora do intervalo da planilha.\u0027 };\n  }\n\n  const nova \u003d \u0027S\u0027 + Math.floor(100000 + Math.random()*900000);\n\n  const lock \u003d LockService.getScriptLock(); lock.waitLock(15000);\n  try {\n    sh.getRange(row,3).setValue(nova);\n  } finally {\n    lock.releaseLock();\n  }\n  return { ok:true, senha:nova };\n}\n\nfunction excluirUsuarioLogin(linha){\n  const row \u003d parseInt(linha, 10);\n  if (!row || row \u003c 2){\n    return { ok:false, msg:\u0027Linha inv√°lida.\u0027 };\n  }\n  const sh \u003d ensureLoginSheet_();\n  const lastRow \u003d sh.getLastRow();\n  if (row \u003e lastRow){\n    return { ok:false, msg:\u0027Linha fora do intervalo da planilha.\u0027 };\n  }\n\n  const lock \u003d LockService.getScriptLock(); lock.waitLock(15000);\n  try {\n    sh.deleteRow(row);\n  } finally {\n    lock.releaseLock();\n  }\n  return { ok:true };\n}\n\n/************************\n * CHAMADOS TI\n ************************/\nconst CHAMADOS_SHEET_NAME \u003d \u0027Chamados\u0027;\nconst CHAMADOS_SUBFOLDER_NAME \u003d \u0027CHAMADOS_TI\u0027;\nconst CHAMADOS_MAX_BYTES \u003d 5 * 1024 * 1024; // 5MB\n\nfunction ensureChamadosSheet_(){\n  const ss \u003d SpreadsheetApp.openById(PLANILHA_ID);\n  let sh \u003d ss.getSheetByName(CHAMADOS_SHEET_NAME);\n  if (!sh){\n    sh \u003d ss.insertSheet(CHAMADOS_SHEET_NAME);\n    sh.appendRow([\n      \u0027Carimbo\u0027,\u0027Protocolo\u0027,\n      \u0027Nome\u0027,\u0027Email\u0027,\u0027Telefone\u0027,\n      \u0027Setor/Local\u0027,\u0027Categoria\u0027,\u0027Prioridade\u0027,\n      \u0027Descri√ß√£o\u0027,\n      \u0027Status\u0027,\u0027Respons√°vel\u0027,\u0027Atualizado em\u0027,\u0027Obs\u0027,\n      \u0027Anexo (Link)\u0027,\u0027Anexo (Nome)\u0027,\u0027Anexo (Mime)\u0027,\n      \u0027Origem\u0027,\u0027UserAgent\u0027\n    ]);\n  } else {\n    const must \u003d [\n      \u0027Carimbo\u0027,\u0027Protocolo\u0027,\u0027Nome\u0027,\u0027Email\u0027,\u0027Telefone\u0027,\u0027Setor/Local\u0027,\u0027Categoria\u0027,\u0027Prioridade\u0027,\n      \u0027Descri√ß√£o\u0027,\u0027Status\u0027,\u0027Respons√°vel\u0027,\u0027Atualizado em\u0027,\u0027Obs\u0027,\n      \u0027Anexo (Link)\u0027,\u0027Anexo (Nome)\u0027,\u0027Anexo (Mime)\u0027,\u0027Origem\u0027,\u0027UserAgent\u0027\n    ];\n    must.forEach(h \u003d\u003e ensureColumn_(sh, h));\n  }\n  return sh;\n}\n\nfunction getChamadosFolder_(){\n  const root \u003d DriveApp.getFolderById(FOLDER_PDFS_ID);\n  return ensureSubfolder_(root, CHAMADOS_SUBFOLDER_NAME);\n}\n\nfunction nextChamadoProtocolo_(){\n  const year \u003d new Date().getFullYear();\n  const key \u003d \u0027TI_SEQ_\u0027 + year;\n  const sp \u003d PropertiesService.getScriptProperties();\n  let n \u003d parseInt(sp.getProperty(key) || \u00270\u0027, 10);\n  n++;\n  sp.setProperty(key, String(n));\n  return `TI-${year}-${String(n).padStart(6,\u00270\u0027)}`;\n}\n\nfunction approxBytesFromBase64_(b64){\n  if (!b64) return 0;\n  const s \u003d String(b64).trim();\n  const clean \u003d s.replace(/^data:([\\w\\/\\-\\+\\.]+);base64,/, \u0027\u0027);\n  return Math.floor(clean.length * 0.75);\n}\n\nfunction salvarAnexoChamado_(attachment, protocolo){\n  if (!attachment) return { link:\u0027\u0027, name:\u0027\u0027, mime:\u0027\u0027 };\n\n  let fileName \u003d attachment.fileName || attachment.name || \u0027anexo\u0027;\n  let mimeType \u003d attachment.mimeType || attachment.type || MimeType.BINARY;\n  let base64   \u003d attachment.base64 || attachment.data || attachment.dataUrl || \u0027\u0027;\n\n  if (!base64) return { link:\u0027\u0027, name:\u0027\u0027, mime:\u0027\u0027 };\n\n  const m \u003d String(base64).match(/^data:([\\w\\/\\-\\+\\.]+);base64,(.+)$/);\n  if (m){\n    mimeType \u003d m[1] || mimeType;\n    base64   \u003d m[2] || \u0027\u0027;\n  }\n\n  const bytesApprox \u003d approxBytesFromBase64_(base64);\n  if (bytesApprox \u003e CHAMADOS_MAX_BYTES){\n    throw new Error(\u0027Anexo acima de 5MB.\u0027);\n  }\n\n  const bytes \u003d Utilities.base64Decode(base64);\n  const blob  \u003d Utilities.newBlob(bytes, mimeType, fileName);\n\n  const folder \u003d getChamadosFolder_();\n  const safeProto \u003d (protocolo || \u0027TI\u0027).toString().trim();\n  const finalName \u003d `${safeProto} - ${fileName}`.slice(0, 180);\n\n  const file \u003d withRetry(() \u003d\u003e folder.createFile(blob).setName(finalName), 3, 300);\n  setPublicSharing_(file);\n\n  const link \u003d buildDriveLinks_(file.getId()).preview;\n  return { link, name:file.getName(), mime:mimeType };\n}\n\nfunction ti_abrirChamado(payload){\n  payload \u003d payload || {};\n\n  const nome  \u003d String(payload.requester_name  || payload.nome  || \u0027\u0027).trim();\n  const email \u003d String(payload.requester_email || payload.email || \u0027\u0027).trim();\n  const tel   \u003d String(payload.requester_phone || payload.tel   || \u0027\u0027).trim();\n  const dep   \u003d String(payload.department      || payload.setor || \u0027\u0027).trim();\n  const cat   \u003d String(payload.category        || \u0027\u0027).trim();\n  const pri   \u003d String(payload.priority        || \u0027\u0027).trim();\n  const desc  \u003d String(payload.description     || payload.mensagem || \u0027\u0027).trim();\n\n  if (!nome || !email || !tel || !dep || !cat || !pri || !desc){\n    return { ok:false, msg:\u0027Campos obrigat√≥rios do chamado n√£o preenchidos.\u0027 };\n  }\n\n  const sh \u003d ensureChamadosSheet_();\n  const protocolo \u003d nextChamadoProtocolo_();\n\n  let anexo \u003d { link:\u0027\u0027, name:\u0027\u0027, mime:\u0027\u0027 };\n  if (payload.attachment){\n    anexo \u003d salvarAnexoChamado_(payload.attachment, protocolo);\n  }\n\n  let user \u003d \u0027\u0027;\n  try {\n    const up \u003d PropertiesService.getUserProperties().getProperties();\n    user \u003d up.semfas_usuario || \u0027\u0027;\n  } catch(_){}\n\n  const row \u003d [\n    new Date(), protocolo,\n    nome, email, tel,\n    dep, cat, pri,\n    desc,\n    \u0027ABERTO\u0027, user, new Date(), \u0027\u0027,\n    anexo.link, anexo.name, anexo.mime,\n    String(payload.pagina || \u0027login\u0027), String(payload.userAgent || \u0027\u0027)\n  ];\n\n  const lock \u003d LockService.getScriptLock(); lock.waitLock(15000);\n  try {\n    sh.appendRow(row);\n  } finally {\n    lock.releaseLock();\n  }\n\n  return {\n    ok:true,\n    protocolo,\n    msg:\u0027Chamado aberto com sucesso!\u0027,\n    anexo: anexo.link || \u0027\u0027\n  };\n}\n\nfunction ti_listarChamados(params){\n  params \u003d params || {};\n  const status \u003d String(params.status || \u0027ABERTO\u0027).trim().toUpperCase();\n  const q \u003d String(params.q || \u0027\u0027).trim().toLowerCase();\n\n  const sh \u003d ensureChamadosSheet_();\n  const vals \u003d sh.getDataRange().getValues();\n  if (vals.length \u003c\u003d 1) return { chamados: [] };\n\n  const out \u003d [];\n  for (let i\u003d1;i\u003cvals.length;i++){\n    const r \u003d vals[i];\n    const protocolo \u003d String(r[1]||\u0027\u0027).trim();\n    const nome \u003d String(r[2]||\u0027\u0027).trim();\n    const dep  \u003d String(r[5]||\u0027\u0027).trim();\n    const cat  \u003d String(r[6]||\u0027\u0027).trim();\n    const pri  \u003d String(r[7]||\u0027\u0027).trim();\n    const desc \u003d String(r[8]||\u0027\u0027).trim();\n    const st   \u003d String(r[9]||\u0027ABERTO\u0027).trim().toUpperCase();\n    const anexo\u003d String(r[13]||\u0027\u0027).trim();\n\n    if (status \u0026\u0026 status !\u003d\u003d \u0027TODOS\u0027 \u0026\u0026 st !\u003d\u003d status) continue;\n\n    if (q){\n      const hay \u003d (protocolo+\u0027 \u0027+nome+\u0027 \u0027+dep+\u0027 \u0027+cat+\u0027 \u0027+pri+\u0027 \u0027+desc).toLowerCase();\n      if (!hay.includes(q)) continue;\n    }\n\n    out.push({\n      linha: i+1,\n      carimbo: r[0] ? Utilities.formatDate(new Date(r[0]), TZ, \u0027dd/MM/yyyy HH:mm\u0027) : \u0027\u0027,\n      protocolo,\n      nome,\n      email: String(r[3]||\u0027\u0027),\n      telefone: String(r[4]||\u0027\u0027),\n      setor: dep,\n      categoria: cat,\n      prioridade: pri,\n      descricao: desc,\n      status: st,\n      responsavel: String(r[10]||\u0027\u0027),\n      atualizado_em: r[11] ? Utilities.formatDate(new Date(r[11]), TZ, \u0027dd/MM/yyyy HH:mm\u0027) : \u0027\u0027,\n      obs: String(r[12]||\u0027\u0027),\n      anexo\n    });\n  }\n\n  out.sort((a,b)\u003d\u003e (b.linha - a.linha));\n  return { chamados: out.slice(0, 1500) };\n}\n\nfunction ti_atualizarChamado(linha, patch){\n  const row \u003d parseInt(linha,10);\n  if (!row || row \u003c 2) throw new Error(\u0027Linha inv√°lida.\u0027);\n\n  patch \u003d patch || {};\n  const sh \u003d ensureChamadosSheet_();\n  if (row \u003e sh.getLastRow()) throw new Error(\u0027Linha fora do intervalo.\u0027);\n\n  const lock \u003d LockService.getScriptLock(); lock.waitLock(15000);\n  try{\n    if (patch.status !\u003d null) sh.getRange(row, 10).setValue(String(patch.status||\u0027\u0027).toUpperCase()); // col J\n    if (patch.responsavel !\u003d null) sh.getRange(row, 11).setValue(String(patch.responsavel||\u0027\u0027));     // col K\n    sh.getRange(row, 12).setValue(new Date());                                                       // col L\n    if (patch.obs !\u003d null) sh.getRange(row, 13).setValue(String(patch.obs||\u0027\u0027));                      // col M\n  } finally {\n    lock.releaseLock();\n  }\n  return { ok:true };\n}\n\n/************************\n * (FIM)\n ************************/\n"},{"id":"0fe72eb0-2a5c-413a-917f-0ca77a910ac7","name":"formulario","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml lang\u003d\"pt-BR\"\u003e\n\u003chead\u003e\n  \u003cbase target\u003d\"_top\"\u003e\n  \u003cmeta charset\u003d\"UTF-8\"\u003e\n  \u003cmeta name\u003d\"viewport\" content\u003d\"width\u003ddevice-width, initial-scale\u003d1.0\"\u003e\n\n  \u003c!-- jQuery + jQuery Mask --\u003e\n  \u003cscript src\u003d\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js\"\u003e\u003c/script\u003e\n  \u003cscript src\u003d\"https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js\"\u003e\u003c/script\u003e\n\n  \u003cstyle\u003e\n    body{font-family:Arial, sans-serif;background:#f2f4f7;padding:30px;margin:0}\n    .container{max-width:1100px;margin:auto;background:#fff;padding:30px;border-radius:12px;box-shadow:0 4px 8px rgba(0,0,0,.1)}\n    h2,h3{text-align:center;color:#333;margin-top:0}\n    .section{margin-bottom:30px}\n    .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}\n    label{font-weight:bold;display:block;margin-bottom:5px}\n    input,select,textarea{width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;box-sizing:border-box}\n    .full-width{grid-column:span 2}\n    .btn{background:#0B6E4F;color:#fff;padding:12px 24px;border:none;border-radius:6px;font-weight:bold;cursor:pointer;margin-top:20px}\n    .btn:hover{background:#095b41}\n    .btn-outline{background:#fff;color:#4338ca;border:1px solid #4338ca;padding:10px 18px;border-radius:6px;font-weight:700;cursor:pointer}\n    .btn-outline:hover{background:#eef2ff}\n    #loadingForm{display:none;margin-top:15px;text-align:center;font-weight:bold;color:#0B6E4F}\n    .alert-error{background:#fee2e2;color:#991b1b;border:1px solid #fecaca;padding:12px 14px;border-radius:8px;font-weight:600;line-height:1.45}\n    .helper{display:block;margin-top:4px;font-size:12px}\n    .ok{color:#16a34a}.warn{color:#6b7280}.err{color:#b91c1c}.invalid{border-color:#ef4444!important}\n    .result-actions{margin-top:12px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap}\n    .radio-row{display:flex;gap:16px;align-items:center;flex-wrap:wrap}\n    .radio-row label{font-weight:600;margin:0}\n    .radio-row input{width:auto}\n    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}\n    .sig-preview{display:flex;align-items:center;gap:12px;margin-top:8px}\n    .sig-preview img{max-height:70px;border:1px dashed #cbd5e1;border-radius:6px;padding:4px;background:#fafafa}\n    @media (max-width:768px){.form-grid{grid-template-columns:1fr}.full-width{grid-column:span 1}}\n  \u003c/style\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n  \u003cdiv class\u003d\"container\"\u003e\n    \u003ch2\u003eRELAT√ìRIO SOCIAL / REQUERIMENTO DE BENEF√çCIO EVENTUAL\u003c/h2\u003e\n\n    \u003cform id\u003d\"beneficioForm\" action\u003d\"javascript:void(0)\" autocomplete\u003d\"off\" novalidate\u003e\n      \u003c!-- VIA DE ENTRADA --\u003e\n      \u003cdiv class\u003d\"section\"\u003e\n        \u003ch3\u003eVia de Entrada\u003c/h3\u003e\n        \u003cdiv class\u003d\"form-grid\"\u003e\n          \u003cdiv class\u003d\"full-width\"\u003e\n            \u003clabel\u003eVIA DE ENTRADA *\u003c/label\u003e\n            \u003cselect name\u003d\"via_entrada\" required\u003e\n              \u003coption value\u003d\"\"\u003eSelecione\u003c/option\u003e\n              \u003coption\u003eCRAS ANGELA MARIA (NOVO HORIZONTE)\u003c/option\u003e\n              \u003coption\u003eCRAS DR. FRANKLIN (PARQUE DOS FAROIS)\u003c/option\u003e\n              \u003coption\u003eCRAS MARIA JOS√â (JARDIM)\u003c/option\u003e\n              \u003coption\u003eCRAS PROF MARIA LUIZA (MARCOS FREIRE I)\u003c/option\u003e\n              \u003coption\u003eCRAS ZILDA ARNS (JO√ÉO ALVES)\u003c/option\u003e\n              \u003coption\u003eCREAS MARCOS FREIRE\u003c/option\u003e\n              \u003coption\u003eCREAS LEONEL BRIZOLA (PARQUE DOS FAROIS)\u003c/option\u003e\n              \u003coption\u003eCRAM\u003c/option\u003e\n              \u003coption\u003eSEDE\u003c/option\u003e\n              \u003coption\u003eOutro\u003c/option\u003e\n            \u003c/select\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003c!-- DEMANDA --\u003e\n      \u003cdiv class\u003d\"section\"\u003e\n        \u003ch3\u003eDemanda\u003c/h3\u003e\n        \u003cdiv class\u003d\"form-grid\"\u003e\n          \u003cdiv\u003e\n            \u003clabel\u003eDEMANDA APRESENTADA *\u003c/label\u003e\n            \u003cselect name\u003d\"demanda\" required\u003e\n              \u003coption value\u003d\"\"\u003eSelecione\u003c/option\u003e\n              \u003coption\u003eCUIDAR MAIS (CESTA B√ÅSICA)\u003c/option\u003e\n              \u003coption\u003eAUX√çLIO POR MORTE\u003c/option\u003e\n              \u003coption\u003eMAIS ACONCHEGO (NATALIDADE)\u003c/option\u003e\n              \u003coption\u003eCOLCH√ÉO DE CASAL\u003c/option\u003e\n              \u003coption\u003eCOLCH√ÉO DE SOLTEIRO\u003c/option\u003e\n              \u003coption\u003ePASSAGEM INTERESTADUAL (VIAGEM)\u003c/option\u003e\n              \u003coption\u003eDOCUMENTA√á√ÉO\u003c/option\u003e\n              \u003coption\u003eAUX√çLIO MORADIA\u003c/option\u003e\n              \u003coption\u003eOutro\u003c/option\u003e\n            \u003c/select\u003e\n          \u003c/div\u003e\n          \u003cdiv\u003e\n            \u003clabel\u003eDATA DA SOLICITA√á√ÉO *\u003c/label\u003e\n            \u003cinput type\u003d\"date\" name\u003d\"data_solicitacao\" required\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003c!-- DADOS DO BENEFICI√ÅRIO --\u003e\n      \u003cdiv class\u003d\"section\"\u003e\n        \u003ch3\u003eDados do Benefici√°rio\u003c/h3\u003e\n        \u003cdiv class\u003d\"form-grid\"\u003e\n          \u003cdiv class\u003d\"full-width\"\u003e\n            \u003clabel\u003eNOME COMPLETO *\u003c/label\u003e\n            \u003cinput type\u003d\"text\" name\u003d\"nomeb\" required\u003e\n          \u003c/div\u003e\n          \u003cdiv\u003e\n            \u003clabel\u003eDATA DE NASCIMENTO *\u003c/label\u003e\n            \u003cinput type\u003d\"text\" name\u003d\"nasc\" required placeholder\u003d\"dd/mm/aaaa\"\u003e\n          \u003c/div\u003e\n          \u003cdiv\u003e\n            \u003clabel\u003eENDERE√áO *\u003c/label\u003e\n            \u003cinput type\u003d\"text\" name\u003d\"endereco\" required\u003e\n          \u003c/div\u003e\n          \u003cdiv\u003e\n            \u003clabel\u003eBAIRRO *\u003c/label\u003e\n            \u003cinput type\u003d\"text\" name\u003d\"bairro\" required\u003e\n          \u003c/div\u003e\n          \u003cdiv\u003e\n            \u003clabel\u003ePONTO DE REFER√äNCIA\u003c/label\u003e\n            \u003cinput type\u003d\"text\" name\u003d\"referencia\"\u003e\n          \u003c/div\u003e\n          \u003cdiv\u003e\n            \u003clabel\u003eTELEFONE *\u003c/label\u003e\n            \u003cinput type\u003d\"text\" name\u003d\"telefone\" required placeholder\u003d\"(xx) xxxxx-xxxx)\"\u003e\n          \u003c/div\u003e\n          \u003cdiv\u003e\n            \u003clabel\u003eRG / ORG√ÉO EMISSOR *\u003c/label\u003e\n            \u003cinput type\u003d\"text\" name\u003d\"rg\" required\u003e\n          \u003c/div\u003e\n          \u003cdiv\u003e\n            \u003clabel\u003eSSP *\u003c/label\u003e\n            \u003cinput type\u003d\"text\" name\u003d\"ssp\" required\u003e\n          \u003c/div\u003e\n          \u003cdiv\u003e\n            \u003clabel\u003eCPF *\u003c/label\u003e\n            \u003cinput type\u003d\"text\" name\u003d\"cpf\" required placeholder\u003d\"000.000.000-00\"\u003e\n            \u003csmall id\u003d\"cpfMsgB\" class\u003d\"helper\" aria-live\u003d\"polite\"\u003e\u003c/small\u003e\n          \u003c/div\u003e\n          \u003cdiv\u003e\n            \u003clabel\u003eNIS\u003c/label\u003e\n            \u003cinput type\u003d\"text\" name\u003d\"nis\" placeholder\u003d\"(opcional)\"\u003e\n          \u003c/div\u003e\n          \u003cdiv class\u003d\"full-width\"\u003e\n            \u003clabel\u003eCRAS DE REFER√äNCIA *\u003c/label\u003e\n            \u003cinput type\u003d\"text\" name\u003d\"cras_ref\" required\u003e\n          \u003c/div\u003e\n          \u003cdiv\u003e\n            \u003clabel\u003eBENEF√çCIO SOCIAL *\u003c/label\u003e\n            \u003cselect name\u003d\"tem_beneficio\" required\u003e\n              \u003coption value\u003d\"N√ÉO\"\u003eN√ÉO\u003c/option\u003e\n              \u003coption value\u003d\"SIM\"\u003eSIM\u003c/option\u003e\n            \u003c/select\u003e\n          \u003c/div\u003e\n          \u003cdiv\u003e\n            \u003clabel\u003eSE SIM, QUAL?\u003c/label\u003e\n            \u003cinput type\u003d\"text\" name\u003d\"qual_beneficio\"\u003e\n          \u003c/div\u003e\n          \u003cdiv\u003e\n            \u003clabel\u003eN¬∫ DE MEMBROS NA FAM√çLIA *\u003c/label\u003e\n            \u003cinput type\u003d\"number\" name\u003d\"membros\" required\u003e\n          \u003c/div\u003e\n          \u003cdiv\u003e\n            \u003clabel\u003eRENDA FAMILIAR MENSAL (R$) *\u003c/label\u003e\n            \u003cinput type\u003d\"text\" name\u003d\"renda\" required\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003c!-- DADOS DO SOLICITANTE --\u003e\n      \u003cdiv class\u003d\"section\"\u003e\n        \u003ch3\u003eDados do Solicitante\u003c/h3\u003e\n        \u003cdiv class\u003d\"form-grid\"\u003e\n          \u003cdiv class\u003d\"full-width\"\u003e\n            \u003clabel\u003eNOME COMPLETO *\u003c/label\u003e\n            \u003cinput type\u003d\"text\" name\u003d\"nomes\" required\u003e\n          \u003c/div\u003e\n          \u003cdiv\u003e\n            \u003clabel\u003eTELEFONE *\u003c/label\u003e\n            \u003cinput type\u003d\"text\" name\u003d\"telefones\" required placeholder\u003d\"(xx) xxxxx-xxxx)\"\u003e\n          \u003c/div\u003e\n          \u003cdiv\u003e\n            \u003clabel\u003eENDERE√áO *\u003c/label\u003e\n            \u003cinput type\u003d\"text\" name\u003d\"enderecos\" required\u003e\n          \u003c/div\u003e\n          \u003cdiv\u003e\n            \u003clabel\u003eRG / ORG√ÉO EMISSOR *\u003c/label\u003e\n            \u003cinput type\u003d\"text\" name\u003d\"rgs\" required\u003e\n          \u003c/div\u003e\n          \u003cdiv\u003e\n            \u003clabel\u003eCPF *\u003c/label\u003e\n            \u003cinput type\u003d\"text\" name\u003d\"cpfs\" required placeholder\u003d\"000.000.000-00\"\u003e\n            \u003csmall id\u003d\"cpfMsgS\" class\u003d\"helper\" aria-live\u003d\"polite\"\u003e\u003c/small\u003e\n          \u003c/div\u003e\n          \u003cdiv\u003e\n            \u003clabel\u003eV√çNCULO COM O BENEFICI√ÅRIO *\u003c/label\u003e\n            \u003cinput type\u003d\"text\" name\u003d\"vinculo\" required\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003c!-- SITUA√á√ÉO / OBSERVA√á√ïES --\u003e\n      \u003cdiv class\u003d\"section\"\u003e\n        \u003ch3\u003eSitua√ß√£o Familiar / Observa√ß√µes\u003c/h3\u003e\n        \u003cdiv class\u003d\"form-grid\"\u003e\n          \u003cdiv class\u003d\"full-width\"\u003e\n            \u003clabel\u003eDESCREVA A SITUA√á√ÉO FAMILIAR *\u003c/label\u003e\n            \u003ctextarea name\u003d\"situacao\" rows\u003d\"4\" required\u003e\u003c/textarea\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003c!-- ANEXAR DOCUMENTOS (com Anexar para criar FILA sem limite pr√°tico) --\u003e\n      \u003cdiv class\u003d\"section\"\u003e\n        \u003ch3\u003eAnexar Documentos\u003c/h3\u003e\n        \u003cdiv class\u003d\"form-grid\"\u003e\n          \u003cdiv class\u003d\"full-width\"\u003e\n            \u003clabel for\u003d\"anexos\"\u003eDOCUMENTOS\u003c/label\u003e\n            \u003cinput id\u003d\"anexos\" type\u003d\"file\" accept\u003d\".pdf,application/pdf,image/jpeg,image/png\"\u003e\n            \u003csmall class\u003d\"helper\"\u003e\n              Selecione um ou mais arquivos e informe um nome para identifica√ß√£o (ex.: RG, CPF, Comprovante de Resid√™ncia). Clique em \u003cb\u003eAnexar\u003c/b\u003e para adicionar √† lista. Repita esse processo quantas vezes quiser.\n            \u003c/small\u003e\n            \u003cdiv style\u003d\"display:flex;gap:10px;align-items:center;margin-top:6px\"\u003e\n              \u003cinput id\u003d\"anexoNomeInput\" type\u003d\"text\" placeholder\u003d\"Nome do documento (ex.: RG)\" style\u003d\"flex:1\"\u003e\n              \u003cbutton type\u003d\"button\" class\u003d\"btn-outline\" id\u003d\"btnAnexarDoc\"\u003eAnexar\u003c/button\u003e\n            \u003c/div\u003e\n\n            \u003cdiv id\u003d\"anexosInfo\" class\u003d\"helper\" style\u003d\"color:#6b7280;margin-top:6px\"\u003eNenhum documento na lista.\u003c/div\u003e\n            \u003cdiv id\u003d\"anexosLista\" class\u003d\"helper\" style\u003d\"margin-top:6px\"\u003e\u003c/div\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003c!-- PARECER T√âCNICO --\u003e\n      \u003cdiv class\u003d\"section\"\u003e\n        \u003ch3\u003eParecer T√©cnico\u003c/h3\u003e\n        \u003cdiv class\u003d\"form-grid\"\u003e\n          \u003cdiv class\u003d\"full-width\"\u003e\n            \u003clabel\u003eDECIS√ÉO *\u003c/label\u003e\n            \u003cdiv class\u003d\"radio-row\" role\u003d\"group\" aria-label\u003d\"Parecer t√©cnico\"\u003e\n              \u003clabel\u003e\u003cinput type\u003d\"radio\" name\u003d\"parecer_tecnico\" value\u003d\"FAVOR√ÅVEL\" required\u003e Favor√°vel\u003c/label\u003e\n              \u003clabel\u003e\u003cinput type\u003d\"radio\" name\u003d\"parecer_tecnico\" value\u003d\"DESFAVOR√ÅVEL\" required\u003e Desfavor√°vel\u003c/label\u003e\n            \u003c/div\u003e\n          \u003c/div\u003e\n\n          \u003cdiv class\u003d\"full-width\"\u003e\n            \u003clabel\u003eNOME DO T√âCNICO(A) RESPONS√ÅVEL *\u003c/label\u003e\n            \u003cinput type\u003d\"text\" name\u003d\"nome_tecnico\" required placeholder\u003d\"Informe seu nome completo\"\u003e\n          \u003c/div\u003e\n\n          \u003cdiv\u003e\n            \u003clabel\u003eMUNIC√çPIO\u003c/label\u003e\n            \u003cinput type\u003d\"text\" name\u003d\"municipio_parecer\" value\u003d\"Nossa Senhora do Socorro\"\u003e\n          \u003c/div\u003e\n\n          \u003cdiv\u003e\n            \u003clabel\u003eDATA DO PARECER *\u003c/label\u003e\n            \u003cinput type\u003d\"date\" name\u003d\"data_parecer\" required\u003e\n          \u003c/div\u003e\n\n          \u003cdiv class\u003d\"full-width\"\u003e\n            \u003clabel\u003eASSINATURA DIGITAL (PNG/JPG) ‚Äî opcional\u003c/label\u003e\n            \u003cinput id\u003d\"assinaturaFile\" type\u003d\"file\" accept\u003d\"image/png,image/jpeg\"\u003e\n            \u003cdiv class\u003d\"sig-preview\" id\u003d\"assinaturaPreviewBox\" style\u003d\"display:none\"\u003e\n              \u003cimg id\u003d\"assinaturaPreview\" alt\u003d\"Pr√©via da assinatura\"\u003e\n              \u003csmall style\u003d\"color:#475569\"\u003eSer√° inserida na √°rea da assinatura do PDF.\u003c/small\u003e\n            \u003c/div\u003e\n\n            \u003cinput type\u003d\"hidden\" name\u003d\"assinatura_base64\" id\u003d\"assinaturaBase64\"\u003e\n            \u003cinput type\u003d\"hidden\" name\u003d\"assinatura_filename\" id\u003d\"assinaturaFileName\"\u003e\n\n            \u003cinput type\u003d\"text\" name\u003d\"assinatura_carimbo\" placeholder\u003d\"(Opcional ‚Äî se n√£o anexar imagem, o PDF ficar√° em branco para assinatura manual)\"\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003cdiv class\u003d\"sr-only\" aria-live\u003d\"polite\" id\u003d\"live\"\u003e\u003c/div\u003e\n      \u003cdiv style\u003d\"text-align:right\"\u003e\n        \u003cbutton id\u003d\"btnEnviar\" type\u003d\"submit\" class\u003d\"btn\"\u003eEnviar Requerimento\u003c/button\u003e\n      \u003c/div\u003e\n    \u003c/form\u003e\n\n    \u003cdiv id\u003d\"loadingForm\"\u003e‚è≥ Enviando requerimento, aguarde...\u003c/div\u003e\n    \u003cdiv id\u003d\"resultado\" style\u003d\"margin-top:20px;text-align:center\"\u003e\u003c/div\u003e\n  \u003c/div\u003e\n\n  \u003cscript\u003e\n    /* \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d Helpers de CPF \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d */\n    function onlyDigits(s){ return String(s||\u0027\u0027).replace(/\\D/g,\u0027\u0027); }\n    function cpfIsValid(cpf){\n      const s \u003d onlyDigits(cpf);\n      if (s.length !\u003d\u003d 11) return false;\n      if (/^(\\d)\\1+$/.test(s)) return false;\n      let sum \u003d 0;\n      for (let i\u003d0;i\u003c9;i++) sum +\u003d parseInt(s[i])*(10-i);\n      let d1 \u003d (sum*10)%11; if (d1\u003d\u003d\u003d10) d1 \u003d 0;\n      if (d1 !\u003d\u003d parseInt(s[9])) return false;\n      sum \u003d 0;\n      for (let i\u003d0;i\u003c10;i++) sum +\u003d parseInt(s[i])*(11-i);\n      let d2 \u003d (sum*10)%11; if (d2\u003d\u003d\u003d10) d2 \u003d 0;\n      return d2 \u003d\u003d\u003d parseInt(s[10]);\n    }\n    function setCpfMsg(input, ok, msg, css){\n      const id \u003d input.getAttribute(\u0027data-help-id\u0027);\n      const el \u003d document.getElementById(id);\n      if (!el) return;\n      input.classList.toggle(\u0027invalid\u0027, !ok);\n      el.className \u003d \u0027helper \u0027 + (css || (ok?\u0027ok\u0027:\u0027err\u0027));\n      el.textContent \u003d msg || (ok ? \u0027\u0027 : \u0027CPF inv√°lido.\u0027);\n    }\n    function attachCpfLiveValidation(selector, msgId){\n      const el \u003d document.querySelector(selector);\n      if (!el) return;\n      if (el.dataset.cpfLiveAttached \u003d\u003d\u003d \u00271\u0027) return;\n      el.dataset.cpfLiveAttached \u003d \u00271\u0027;\n      el.setAttribute(\u0027data-help-id\u0027, msgId);\n      el.addEventListener(\u0027input\u0027, function(e){\n        const raw \u003d onlyDigits(e.target.value);\n        if (raw.length \u003c 11){ setCpfMsg(e.target, true, \u0027\u0027, \u0027\u0027); return; }\n        if (!cpfIsValid(raw)){ setCpfMsg(e.target, false, \u0027CPF inv√°lido.\u0027, \u0027err\u0027); return; }\n        setCpfMsg(e.target, true, \u0027CPF v√°lido ‚úî\u0027, \u0027ok\u0027);\n\n        if (typeof google !\u003d\u003d \u0027undefined\u0027 \u0026\u0026 google.script \u0026\u0026 google.script.run){\n          google.script.run.withSuccessHandler(function(res){\n            if (res \u0026\u0026 res.exists \u003d\u003d\u003d true){\n              setCpfMsg(e.target, true, \u0027CPF v√°lido e encontrado na base ‚úî\u0027, \u0027ok\u0027);\n            } else if (res \u0026\u0026 res.exists \u003d\u003d\u003d false){\n              setCpfMsg(e.target, true, \u0027CPF v√°lido (n√£o encontrado na base)\u0027, \u0027warn\u0027);\n            }\n          }).checkCpfExistence(raw);\n        }\n      });\n    }\n\n    /* \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d Upload da assinatura \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d */\n    const MAX_SIG_MB \u003d 2;\n    function handleSignatureFile(file){\n      const previewBox \u003d document.getElementById(\u0027assinaturaPreviewBox\u0027);\n      const previewImg \u003d document.getElementById(\u0027assinaturaPreview\u0027);\n      const outB64 \u003d document.getElementById(\u0027assinaturaBase64\u0027);\n      const outName\u003d document.getElementById(\u0027assinaturaFileName\u0027);\n\n      if (!file){\n        previewBox.style.display\u003d\u0027none\u0027;\n        outB64.value\u003d\u0027\u0027;\n        outName.value\u003d\u0027\u0027;\n        return;\n      }\n      if (!/image\\/(png|jpeg)/i.test(file.type)){\n        alert(\u0027Apenas PNG ou JPG.\u0027);\n        return;\n      }\n      if (file.size \u003e MAX_SIG_MB*1024*1024){\n        alert(\u0027Arquivo muito grande (m√°x. \u0027+MAX_SIG_MB+\u0027 MB).\u0027);\n        return;\n      }\n\n      const rd \u003d new FileReader();\n      rd.onload \u003d () \u003d\u003e {\n        const dataUrl \u003d String(rd.result || \u0027\u0027);\n        previewImg.src \u003d dataUrl;\n        previewBox.style.display \u003d \u0027flex\u0027;\n        outB64.value \u003d dataUrl;\n        outName.value \u003d file.name || \u0027assinatura.png\u0027;\n      };\n      rd.readAsDataURL(file);\n    }\n\n    /* \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d FILA DE ANEXOS (ilimitado) \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d */\n    const anexosQueue \u003d []; // {nome,nomeDocumento,mimeType,dataUrl}\n    const inputFile \u003d document.getElementById(\u0027anexos\u0027);\n    const nomeInput \u003d document.getElementById(\u0027anexoNomeInput\u0027);\n    const btnAnexar \u003d document.getElementById(\u0027btnAnexarDoc\u0027);\n    const infoEl    \u003d document.getElementById(\u0027anexosInfo\u0027);\n    const listaEl   \u003d document.getElementById(\u0027anexosLista\u0027);\n\n    function bytesToMB(n){ return Math.round((n/(1024*1024))*10)/10; }\n\n    function renderQueue(){\n      if (!anexosQueue.length){\n        infoEl.textContent \u003d \u0027Nenhum documento na lista.\u0027;\n        listaEl.innerHTML \u003d \u0027\u0027;\n        return;\n      }\n      let totalBytes \u003d 0;\n      anexosQueue.forEach(a \u003d\u003e totalBytes +\u003d (a.size || 0));\n\n      infoEl.textContent \u003d anexosQueue.length+\u0027 documento(s) na lista, ~\u0027+bytesToMB(totalBytes)+\u0027 MB.\u0027;\n      listaEl.innerHTML \u003d anexosQueue.map((a,i)\u003d\u003e`\n        \u003cdiv style\u003d\"display:flex;align-items:center;gap:8px;margin:4px 0;\"\u003e\n          \u003cspan style\u003d\"font-weight:600\"\u003e${a.nomeDocumento}\u003c/span\u003e\n          \u003cspan style\u003d\"color:#6b7280\"\u003e(${a.nome})\u003c/span\u003e\n          \u003cbutton type\u003d\"button\" class\u003d\"btn-outline\" style\u003d\"padding:4px 8px\" onclick\u003d\"removerAnexo(${i})\"\u003eRemover\u003c/button\u003e\n        \u003c/div\u003e\n      `).join(\u0027\u0027);\n    }\n\n    async function addSelectedFilesToQueue(){\n      const files \u003d Array.from(inputFile.files || []);\n      const label \u003d (nomeInput.value || \u0027\u0027).trim();\n      if (!files.length){\n        alert(\u0027Selecione pelo menos um arquivo.\u0027);\n        return;\n      }\n      if (!label){\n        alert(\u0027Informe um nome para o(s) documento(s).\u0027);\n        nomeInput.focus();\n        return;\n      }\n      for (const file of files){\n        // valida√ß√£o leve\n        const tipo \u003d (file.type || \u0027\u0027).toLowerCase();\n        const nome \u003d file.name || \u0027arquivo\u0027;\n        if (!tipo \u0026\u0026 !/\\.(pdf|jpe?g|png)$/i.test(nome)){\n          alert(\u0027Tipo n√£o reconhecido em \"\u0027+nome+\u0027\". Permitidos: PDF, JPG, PNG.\u0027);\n          return;\n        }\n        if (tipo \u0026\u0026 !/^application\\/pdf$|^image\\/(jpeg|png)$/.test(tipo)){\n          alert(\u0027Arquivo \"\u0027+nome+\u0027\" n√£o √© PDF, JPG ou PNG.\u0027);\n          return;\n        }\n      }\n      // leitura e push\n      for (const file of files){\n        const dataUrl \u003d await new Promise((resolve,reject)\u003d\u003e{\n          const rd \u003d new FileReader();\n          rd.onload \u003d ()\u003d\u003e resolve(String(rd.result||\u0027\u0027));\n          rd.onerror \u003d ()\u003d\u003e reject(rd.error||new Error(\u0027Erro ao ler arquivo \u0027+file.name));\n          rd.readAsDataURL(file);\n        });\n        anexosQueue.push({\n          nome: file.name || \u0027arquivo\u0027,\n          nomeDocumento: label,\n          mimeType: file.type || \u0027\u0027,\n          dataUrl,\n          size: file.size || 0\n        });\n      }\n      // limpa sele√ß√£o\n      inputFile.value \u003d \u0027\u0027;\n      nomeInput.value \u003d \u0027\u0027;\n      renderQueue();\n    }\n\n    function removerAnexo(idx){\n      anexosQueue.splice(idx,1);\n      renderQueue();\n    }\n\n    // Expor removerAnexo no escopo global\n    window.removerAnexo \u003d removerAnexo;\n\n    btnAnexar.addEventListener(\u0027click\u0027, addSelectedFilesToQueue);\n\n    /* \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d Modal de confirma√ß√£o \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d */\n    function openConfirmModal(summaryPairs){\n      const bg \u003d document.createElement(\u0027div\u0027);\n      bg.id \u003d \u0027confirmBackdrop\u0027;\n      bg.style.position\u003d\u0027fixed\u0027; bg.style.inset\u003d\u00270\u0027; bg.style.background\u003d\u0027rgba(15,23,42,.55)\u0027;\n      bg.style.display\u003d\u0027flex\u0027; bg.style.alignItems\u003d\u0027center\u0027; bg.style.justifyContent\u003d\u0027center\u0027; bg.style.zIndex\u003d\u00279999\u0027;\n      bg.innerHTML \u003d `\n        \u003cdiv style\u003d\"width:min(720px,92vw);background:#fff;border-radius:12px;box-shadow:0 20px 60px rgba(0,0,0,.25);padding:20px\"\u003e\n          \u003ch4 style\u003d\"margin:0 0 8px;font-size:18px;color:#111827\"\u003eConfirmar envio\u003c/h4\u003e\n          \u003cp style\u003d\"margin:0 0 14px;color:#374151;font-size:14px\"\u003eConfira os principais dados abaixo e clique em \u003cb\u003eConfirmar\u003c/b\u003e.\u003c/p\u003e\n          \u003cdiv style\u003d\"display:grid;grid-template-columns:1fr 1fr;gap:10px 16px;max-height:45vh;overflow:auto;margin:10px 0 18px\"\u003e\n            ${summaryPairs.map(([l,v])\u003d\u003e`\u003cdiv\u003e\u003cb style\u003d\"display:block;font-size:12px;color:#6b7280;margin-bottom:4px\"\u003e${l}\u003c/b\u003e\u003cdiv\u003e${v||\u0027‚Äî\u0027}\u003c/div\u003e\u003c/div\u003e`).join(\u0027\u0027)}\n          \u003c/div\u003e\n          \u003cdiv style\u003d\"display:flex;gap:10px;justify-content:flex-end\"\u003e\n            \u003cbutton type\u003d\"button\" class\u003d\"btn-outline\" id\u003d\"btnVoltarEditar\"\u003eVoltar e editar\u003c/button\u003e\n            \u003cbutton type\u003d\"button\" class\u003d\"btn\" id\u003d\"btnConfirmarEnvio\"\u003eConfirmar envio\u003c/button\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e`;\n      document.body.appendChild(bg);\n      document.getElementById(\u0027btnVoltarEditar\u0027).onclick \u003d closeConfirmModal;\n      document.getElementById(\u0027btnConfirmarEnvio\u0027).onclick \u003d doSubmit;\n    }\n    function closeConfirmModal(){\n      const bd\u003ddocument.getElementById(\u0027confirmBackdrop\u0027);\n      if(bd) bd.remove();\n    }\n\n    function buildSummary(){\n      const f \u003d document.getElementById(\u0027beneficioForm\u0027);\n      const v \u003d (name)\u003d\u003e (f.elements[name]?.value || \u0027\u0027).toString().trim();\n      const parecer \u003d [...(f.elements[\u0027parecer_tecnico\u0027]||[])].find(r\u003d\u003er.checked)?.value || \u0027\u0027;\n      const temSig  \u003d !!document.getElementById(\u0027assinaturaBase64\u0027).value;\n      const anexosQtd \u003d anexosQueue.length;\n\n      return [\n        [\u0027Via de entrada\u0027, v(\u0027via_entrada\u0027)],\n        [\u0027Demanda\u0027, v(\u0027demanda\u0027)],\n        [\u0027Data da solicita√ß√£o\u0027, v(\u0027data_solicitacao\u0027)],\n        [\u0027Nome (benefici√°rio)\u0027, v(\u0027nomeb\u0027)],\n        [\u0027CPF (benefici√°rio)\u0027, v(\u0027cpf\u0027)],\n        [\u0027Telefone (benefici√°rio)\u0027, v(\u0027telefone\u0027)],\n        [\u0027CRAS de refer√™ncia\u0027, v(\u0027cras_ref\u0027)],\n        [\u0027Nome (solicitante)\u0027, v(\u0027nomes\u0027)],\n        [\u0027CPF (solicitante)\u0027, v(\u0027cpfs\u0027)],\n        [\u0027V√≠nculo\u0027, v(\u0027vinculo\u0027)],\n        [\u0027Endere√ßo\u0027, v(\u0027endereco\u0027)],\n        [\u0027Bairro\u0027, v(\u0027bairro\u0027)],\n        [\u0027Situa√ß√£o familiar / observa√ß√µes\u0027, v(\u0027situacao\u0027)],\n        [\u0027Documentos anexados (fila)\u0027, anexosQtd ? (anexosQtd + \u0027 arquivo(s)\u0027) : \u0027Nenhum\u0027],\n        [\u0027Parecer t√©cnico\u0027, parecer],\n        [\u0027T√©cnico respons√°vel\u0027, v(\u0027nome_tecnico\u0027)],\n        [\u0027Data do parecer\u0027, v(\u0027data_parecer\u0027)],\n        [\u0027Assinatura digital\u0027, temSig ? \u0027Sim (anexada)\u0027 : \u0027N√£o (ficar√° em branco no PDF)\u0027]\n      ];\n    }\n\n    /* \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d Envio \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d */\n    let _cachedFormData \u003d null;\n\n    async function handleSubmit(e){\n      e.preventDefault();\n      const cpfB \u003d document.querySelector(\u0027input[name\u003d\"cpf\"]\u0027);\n      const cpfS \u003d document.querySelector(\u0027input[name\u003d\"cpfs\"]\u0027);\n      if (!cpfIsValid(cpfB.value)){\n        setCpfMsg(cpfB, false, \u0027CPF inv√°lido.\u0027, \u0027err\u0027);\n        cpfB.focus();\n        return;\n      }\n      if (!cpfIsValid(cpfS.value)){\n        setCpfMsg(cpfS, false, \u0027CPF inv√°lido.\u0027, \u0027err\u0027);\n        cpfS.focus();\n        return;\n      }\n\n      const formEl \u003d e.target;\n      const data \u003d {};\n      new FormData(formEl).forEach((value, key) \u003d\u003e { data[key] \u003d value; });\n\n      // anexos \u003d fila acumulada\n      data.anexos \u003d anexosQueue.slice();\n\n      _cachedFormData \u003d data;\n      openConfirmModal(buildSummary());\n    }\n\n    function doSubmit(){\n      if (!_cachedFormData) return;\n      closeConfirmModal();\n\n      const btn \u003d document.getElementById(\u0027btnEnviar\u0027);\n      const loader \u003d document.getElementById(\u0027loadingForm\u0027);\n      btn.disabled \u003d true;\n      loader.style.display \u003d \u0027block\u0027;\n\n      google.script.run\n        .withSuccessHandler(function(resposta){\n          btn.disabled \u003d false;\n          loader.style.display \u003d \u0027none\u0027;\n          const resultadoDiv \u003d document.getElementById(\u0027resultado\u0027);\n\n          if (resposta.sucesso) {\n            resultadoDiv.innerHTML \u003d `\n              \u003cp style\u003d\"color:#16a34a;font-weight:bold\"\u003e${resposta.mensagem}\u003c/p\u003e\n              \u003cdiv class\u003d\"result-actions\"\u003e\n                \u003ca href\u003d\"${resposta.link}\" target\u003d\"_blank\" class\u003d\"btn\"\u003eüì• Baixar PDF\u003c/a\u003e\n                \u003cbutton type\u003d\"button\" class\u003d\"btn-outline\" onclick\u003d\"novoCadastro()\"\u003e‚ûï Conclu√≠do (Novo Cadastro)\u003c/button\u003e\n              \u003c/div\u003e`;\n          } else {\n            let extra \u003d \u0027\u0027;\n            if (resposta.ultima_data || resposta.proxima_data) {\n              extra \u003d `\n                \u003cdiv style\u003d\"margin-top:8px;font-weight:600\"\u003e\n                  - √öltimo registro: \u003cb\u003e${resposta.ultima_data || \u0027-\u0027}\u003c/b\u003e\u003cbr\u003e\n                  - Novo pedido permitido: \u003cb\u003e${resposta.proxima_data || \u0027-\u0027}\u003c/b\u003e\n                \u003c/div\u003e`;\n            }\n            resultadoDiv.innerHTML \u003d `\n              \u003cdiv class\u003d\"alert-error\"\u003e${resposta.mensagem}${extra}\u003c/div\u003e\n              \u003cdiv class\u003d\"result-actions\"\u003e\n                \u003cbutton type\u003d\"button\" class\u003d\"btn-outline\" onclick\u003d\"novoCadastro()\"\u003e‚ûï Conclu√≠do (Novo Cadastro)\u003c/button\u003e\n              \u003c/div\u003e`;\n          }\n          document.getElementById(\u0027live\u0027).textContent \u003d \u0027Envio conclu√≠do.\u0027;\n        })\n        .withFailureHandler(function(err){\n          btn.disabled \u003d false;\n          loader.style.display \u003d \u0027none\u0027;\n          alert(\u0027Erro ao enviar: \u0027 + (err \u0026\u0026 err.message ? err.message : err));\n        })\n        .salvarFormulario(_cachedFormData);\n    }\n\n    /* \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d Novo cadastro \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d */\n    function aplicarMascaras(){\n      $(\u0027input[name\u003d\"cpf\"], input[name\u003d\"cpfs\"]\u0027).unmask().mask(\u0027000.000.000-00\u0027);\n      $(\u0027input[name\u003d\"telefone\"], input[name\u003d\"telefones\"]\u0027).unmask().mask(\u0027(00) 00000-0000\u0027);\n      $(\u0027input[name\u003d\"nasc\"]\u0027).unmask().mask(\u002700/00/0000\u0027);\n    }\n    function limparMensagensCPF(){\n      [\u0027cpfMsgB\u0027,\u0027cpfMsgS\u0027].forEach(id \u003d\u003e {\n        const el \u003d document.getElementById(id);\n        if (el) el.textContent \u003d \u0027\u0027;\n      });\n      document.querySelectorAll(\u0027.invalid\u0027).forEach(el\u003d\u003eel.classList.remove(\u0027invalid\u0027));\n    }\n    function novoCadastro(){\n      const f \u003d document.getElementById(\u0027beneficioForm\u0027);\n      f.reset();\n      document.getElementById(\u0027resultado\u0027).innerHTML \u003d \u0027\u0027;\n      limparMensagensCPF();\n      document.getElementById(\u0027assinaturaPreviewBox\u0027).style.display\u003d\u0027none\u0027;\n      document.getElementById(\u0027assinaturaBase64\u0027).value\u003d\u0027\u0027;\n      document.getElementById(\u0027assinaturaFileName\u0027).value\u003d\u0027\u0027;\n\n      // limpa fila de anexos\n      anexosQueue.length \u003d 0;\n      renderQueue();\n      inputFile.value \u003d \u0027\u0027;\n      nomeInput.value  \u003d \u0027\u0027;\n\n      _cachedFormData \u003d null;\n\n      const btn \u003d document.getElementById(\u0027btnEnviar\u0027);\n      btn.disabled \u003d false;\n      aplicarMascaras();\n      attachCpfLiveValidation(\u0027input[name\u003d\"cpf\"]\u0027,\u0027cpfMsgB\u0027);\n      attachCpfLiveValidation(\u0027input[name\u003d\"cpfs\"]\u0027,\u0027cpfMsgS\u0027);\n      setDefaultParecerDate();\n      window.scrollTo({top: 0, behavior: \u0027smooth\u0027});\n      document.getElementById(\u0027live\u0027).textContent \u003d \u0027Formul√°rio pronto para novo cadastro.\u0027;\n    }\n\n    /* \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d Boot \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d */\n    function setDefaultParecerDate(){\n      const el \u003d document.querySelector(\u0027input[name\u003d\"data_parecer\"]\u0027);\n      if (!el) return;\n      if (!el.value){\n        const d \u003d new Date();\n        const pad \u003d n\u003d\u003eString(n).padStart(2,\u00270\u0027);\n        el.value \u003d `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;\n      }\n    }\n\n    function boot(){\n      aplicarMascaras();\n      attachCpfLiveValidation(\u0027input[name\u003d\"cpf\"]\u0027,\u0027cpfMsgB\u0027);\n      attachCpfLiveValidation(\u0027input[name\u003d\"cpfs\"]\u0027,\u0027cpfMsgS\u0027);\n      setDefaultParecerDate();\n\n      const form \u003d document.getElementById(\u0027beneficioForm\u0027);\n      form.addEventListener(\u0027submit\u0027, handleSubmit);\n\n      const sigInput \u003d document.getElementById(\u0027assinaturaFile\u0027);\n      if (sigInput) sigInput.addEventListener(\u0027change\u0027, e \u003d\u003e handleSignatureFile(e.target.files?.[0]));\n    }\n    document.addEventListener(\u0027DOMContentLoaded\u0027, boot);\n  \u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e"},{"id":"ea241662-f6e3-4cad-a975-7665b258a48e","name":"login","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml lang\u003d\"pt-BR\"\u003e\n\u003chead\u003e\n  \u003cmeta charset\u003d\"UTF-8\"\u003e\n  \u003cbase target\u003d\"_top\"\u003e\n  \u003cmeta name\u003d\"viewport\" content\u003d\"width\u003ddevice-width, initial-scale\u003d1\"\u003e\n  \u003ctitle\u003eSistema SEMFAS ‚Äì Login\u003c/title\u003e\n  \u003cstyle\u003e\n    :root{\n      --bg-url: url(\u0027https://lh3.googleusercontent.com/d/1198pJcJXG4o7_YZOwLC0QvdrBg53Z0Th\u003dw2400\u0027);\n      --brand-900:#0b2742; --brand-800:#0e3557; --brand-700:#114266; --brand-600:#16527c;\n      --card-bg: rgba(255,255,255,.92); --card-border: rgba(255,255,255,.6);\n      --text:#1f2a37; --muted:#6b7280; --primary:#1677ff; --primary-700:#0e5ed6;\n      --line:#e2e8f0; --danger:#dc2626;\n    }\n    html, body { height:100%; margin:0; }\n    body{\n      font-family: \u0027Segoe UI\u0027, Tahoma, Geneva, Verdana, sans-serif;\n      color:var(--text); display:flex; align-items:center; justify-content:center;\n      background:\n        radial-gradient(1200px 600px at 10% -10%, rgba(255,255,255,.1), transparent 60%),\n        radial-gradient(1000px 500px at 110% 0%, rgba(255,255,255,.1), transparent 60%),\n        linear-gradient(135deg, var(--brand-900) 0%, var(--brand-800) 45%, var(--brand-700) 100%);\n      position:relative; overflow:hidden;\n    }\n    body::after{\n      content:\"\"; position:fixed; inset:0;\n      background-image:\n        linear-gradient(transparent calc(100% - 1px), rgba(255,255,255,.06) 1px),\n        linear-gradient(90deg, transparent calc(100% - 1px), rgba(255,255,255,.06) 1px);\n      background-size:30px 30px, 30px 30px; opacity:.4; pointer-events:none; mix-blend-mode:soft-light;\n    }\n    .bg-mark{\n      position:fixed; left:50%; top:50%; transform:translate(-50%, -50%) rotate(-1deg);\n      width:clamp(240px, 36vw, 560px); aspect-ratio: 1/1;\n      background: var(--bg-url) center / contain no-repeat; opacity:.15;\n      filter: drop-shadow(0 20px 60px rgba(0,0,0,.4)) saturate(.95); pointer-events:none; z-index:0;\n    }\n\n    .login-container{\n      position:relative; z-index:1; width:min(92vw, 460px);\n      background: var(--card-bg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);\n      border:1px solid var(--card-border); border-radius:20px; padding:34px 38px;\n      box-shadow: 0 20px 40px rgba(0,0,0,.25), 0 1px 0 rgba(255,255,255,.3) inset, 0 0 0 1px rgba(255,255,255,.1) inset;\n    }\n    .login-container::before{\n      content:\"\"; position:absolute; left:0; top:20px; bottom:20px; width:4px;\n      background: linear-gradient(180deg, var(--primary), var(--brand-600));\n      border-top-right-radius:4px; border-bottom-right-radius:4px; opacity:.9; box-shadow: 0 0 10px rgba(22,119,255,.3);\n    }\n    .top-row{\n      display:flex; align-items:center; justify-content:space-between; gap:12px;\n      margin-bottom:10px;\n    }\n    .chip{\n      display:inline-flex; align-items:center; gap:8px;\n      font-size:.78rem; font-weight:800; letter-spacing:.3px;\n      padding:8px 10px; border-radius:999px;\n      background: rgba(22,119,255,.10);\n      border:1px solid rgba(22,119,255,.25);\n      color:#0f172a;\n      user-select:none;\n    }\n    .gear-btn{\n      display:inline-flex; align-items:center; gap:8px;\n      padding:10px 12px;\n      border-radius:12px;\n      border:1px solid var(--line);\n      background:#fff;\n      color:#0f172a;\n      font-weight:800;\n      cursor:pointer;\n      transition:transform .12s ease, box-shadow .2s ease, border-color .2s ease;\n    }\n    .gear-btn:hover{ transform: translateY(-1px); border-color:#cbd5e0; box-shadow:0 6px 18px rgba(15,23,42,.08); }\n    .gear-btn:active{ transform: translateY(0px); }\n\n    h2{ margin:8px 0 10px; font-weight:800; font-size:1.65rem; letter-spacing:.3px; color:#0f172a; text-align:center; }\n    .subtitle{ margin:0 0 18px; text-align:center; color:var(--muted); }\n    .req{ color:var(--danger); font-weight:900; margin-left:4px; }\n\n    label{ display:block; font-size:.9rem; font-weight:700; color:#111827; margin:12px 0 8px; }\n    select, input, textarea{\n      width:100%; padding:14px 16px; border-radius:12px; border:2px solid var(--line); background:#fff; outline:none;\n      transition:all .2s ease; box-sizing:border-box; font-size:1rem;\n    }\n    select:focus, input:focus, textarea:focus{\n      border-color: var(--primary); box-shadow:0 0 0 3px rgba(22,119,255,.12); transform: translateY(-1px);\n    }\n    select:hover, input:hover, textarea:hover{ border-color:#cbd5e0; }\n\n    button.primary{\n      width:100%; margin-top:18px; padding:16px 20px; border:none; border-radius:12px; font-weight:800; font-size:1rem;\n      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-700) 100%); color:#fff; cursor:pointer; transition:all .3s ease;\n      box-shadow: 0 4px 15px rgba(22,119,255,.3);\n      display:flex; align-items:center; justify-content:center; gap:10px;\n    }\n    button.primary:hover{ transform: translateY(-2px); box-shadow: 0 8px 25px rgba(22,119,255,.4); }\n    button.primary:disabled{ opacity:.7; cursor:not-allowed; transform:none; }\n\n    .alert{ margin-top:12px; padding:12px 14px; background:#fee2e2; color:#991b1b; border:1px solid #fecaca; border-radius:10px; font-weight:700; display:none; text-align:center; }\n    .ok{ margin-top:12px; padding:12px 14px; background:#dcfce7; color:#166534; border:1px solid #bbf7d0; border-radius:10px; font-weight:800; display:none; text-align:center; }\n    .footer-info{ text-align:center; margin-top:18px; font-size:.8rem; color:var(--muted); opacity:.9; }\n\n    .overlay{ position:fixed; inset:0; background:rgba(2,6,23,.55); display:none; align-items:center; justify-content:center; z-index:50; padding:18px; }\n    .modal{\n      width:min(92vw, 940px);\n      background:#fff;\n      border-radius:18px;\n      border:1px solid rgba(226,232,240,.8);\n      box-shadow:0 30px 70px rgba(0,0,0,.35);\n      overflow:hidden;\n    }\n    .modal-h{\n      padding:16px 18px;\n      background:linear-gradient(135deg,#f8fafc,#eef2ff);\n      border-bottom:1px solid #e2e8f0;\n      display:flex; align-items:center; justify-content:space-between; gap:10px;\n    }\n    .modal-title{ font-weight:900; color:#0f172a; display:flex; align-items:center; gap:10px; }\n    .close{\n      border:1px solid #e2e8f0; background:#fff; border-radius:12px;\n      padding:10px 12px; cursor:pointer; font-weight:900;\n    }\n    .modal-b{ padding:16px 18px 18px 18px; }\n\n    .grid3{ display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; }\n    .full{ grid-column: 1 / -1; }\n    @media (max-width: 900px){ .grid3{ grid-template-columns: repeat(2, 1fr); } }\n    @media (max-width: 560px){ .grid3{ grid-template-columns: 1fr; } }\n\n    .hint{ font-size:.82rem; color:#64748b; margin-top:6px; }\n    .mini{ font-size:.85rem; color:#64748b; margin-top:10px; }\n    .row-actions{ display:flex; gap:10px; margin-top:14px; }\n    .btn-sec{\n      flex:1; border-radius:12px; padding:14px 14px; font-weight:900;\n      border:2px solid #e2e8f0; background:#fff; cursor:pointer;\n    }\n    .btn-sec:hover{ border-color:#cbd5e0; }\n    .btn-send{\n      flex:1; border-radius:12px; padding:14px 14px; font-weight:900;\n      border:none; cursor:pointer; color:#fff;\n      background:linear-gradient(135deg,#0ea5e9,#2563eb);\n      box-shadow:0 10px 22px rgba(37,99,235,.25);\n      display:flex; align-items:center; justify-content:center; gap:10px;\n    }\n    .btn-send:disabled{ opacity:.7; cursor:not-allowed; box-shadow:none; }\n    .spin{\n      width:16px;height:16px;border-radius:999px;border:2px solid rgba(255,255,255,.55);\n      border-top-color:#fff; animation:rot .8s linear infinite;\n    }\n    @keyframes rot{ to{ transform:rotate(360deg);} }\n\n    input[type\u003d\"file\"]{ padding:12px 12px; }\n    .file-pill{\n      margin-top:8px;\n      display:none;\n      font-size:.85rem;\n      color:#0f172a;\n      background:rgba(22,119,255,.08);\n      border:1px solid rgba(22,119,255,.18);\n      border-radius:12px;\n      padding:10px 12px;\n      word-break: break-word;\n    }\n\n    #c_dep_outro_wrap{ display:none; }\n  \u003c/style\u003e\n\u003c/head\u003e\n\n\u003cbody\u003e\n  \u003cdiv class\u003d\"bg-mark\" aria-hidden\u003d\"true\"\u003e\u003c/div\u003e\n\n  \u003cdiv class\u003d\"login-container\"\u003e\n    \u003cdiv class\u003d\"top-row\"\u003e\n      \u003cdiv class\u003d\"chip\"\u003eSEMFAS ‚Ä¢ Acesso Interno\u003c/div\u003e\n      \u003cbutton class\u003d\"gear-btn\" type\u003d\"button\" id\u003d\"btnChamados\" title\u003d\"Abrir Chamado\"\u003e\n        ‚öôÔ∏è Chamados\n      \u003c/button\u003e\n    \u003c/div\u003e\n\n    \u003ch2\u003eSistema SEMFAS ‚Äì Login\u003c/h2\u003e\n    \u003cp class\u003d\"subtitle\"\u003eAcesse com seu setor e credenciais\u003c/p\u003e\n\n    \u003cform id\u003d\"loginForm\" novalidate\u003e\n      \u003clabel for\u003d\"setor\"\u003eSetor \u003cspan class\u003d\"req\"\u003e*\u003c/span\u003e\u003c/label\u003e\n      \u003cselect id\u003d\"setor\" name\u003d\"setor\" required\u003e\n        \u003coption value\u003d\"\"\u003eCarregando setores...\u003c/option\u003e\n      \u003c/select\u003e\n\n      \u003clabel for\u003d\"usuario\"\u003eUsu√°rio \u003cspan class\u003d\"req\"\u003e*\u003c/span\u003e\u003c/label\u003e\n      \u003cinput type\u003d\"text\" id\u003d\"usuario\" name\u003d\"usuario\" placeholder\u003d\"Digite seu usu√°rio\" required autocomplete\u003d\"username\"\u003e\n\n      \u003clabel for\u003d\"senha\"\u003eSenha \u003cspan class\u003d\"req\"\u003e*\u003c/span\u003e\u003c/label\u003e\n      \u003cinput type\u003d\"password\" id\u003d\"senha\" name\u003d\"senha\" placeholder\u003d\"Digite sua senha\" required autocomplete\u003d\"current-password\"\u003e\n\n      \u003cbutton type\u003d\"submit\" class\u003d\"primary\" id\u003d\"btnLogin\"\u003e\n        \u003cspan id\u003d\"btnTxt\"\u003eEntrar\u003c/span\u003e\n        \u003cspan id\u003d\"btnSpin\" class\u003d\"spin\" style\u003d\"display:none\"\u003e\u003c/span\u003e\n      \u003c/button\u003e\n\n      \u003cdiv id\u003d\"erro\" class\u003d\"alert\"\u003e\u003c/div\u003e\n    \u003c/form\u003e\n\n    \u003cdiv class\u003d\"footer-info\"\u003e\u0026copy; 2026 SEMFAS ‚Ä¢ Sistema Corporativo\u003c/div\u003e\n  \u003c/div\u003e\n\n  \u003c!-- MODAL DE CHAMADOS --\u003e\n  \u003cdiv class\u003d\"overlay\" id\u003d\"ovl\"\u003e\n    \u003cdiv class\u003d\"modal\" role\u003d\"dialog\" aria-modal\u003d\"true\" aria-labelledby\u003d\"ttl\"\u003e\n      \u003cdiv class\u003d\"modal-h\"\u003e\n        \u003cdiv class\u003d\"modal-title\" id\u003d\"ttl\"\u003e‚öôÔ∏è Abrir Chamado\u003c/div\u003e\n        \u003cbutton class\u003d\"close\" type\u003d\"button\" id\u003d\"btnClose\"\u003eFechar\u003c/button\u003e\n      \u003c/div\u003e\n\n      \u003cdiv class\u003d\"modal-b\"\u003e\n        \u003cdiv class\u003d\"grid3\"\u003e\n          \u003cdiv\u003e\n            \u003clabel for\u003d\"c_nome\"\u003eSeu Nome \u003cspan class\u003d\"req\"\u003e*\u003c/span\u003e\u003c/label\u003e\n            \u003cinput id\u003d\"c_nome\" placeholder\u003d\"Digite seu nome completo\" autocomplete\u003d\"name\" /\u003e\n          \u003c/div\u003e\n\n          \u003cdiv\u003e\n            \u003clabel for\u003d\"c_email\"\u003eSeu Email \u003cspan class\u003d\"req\"\u003e*\u003c/span\u003e\u003c/label\u003e\n            \u003cinput id\u003d\"c_email\" type\u003d\"email\" placeholder\u003d\"seu.email@empresa.com\" autocomplete\u003d\"email\" /\u003e\n          \u003c/div\u003e\n\n          \u003cdiv\u003e\n            \u003clabel for\u003d\"c_tel\"\u003eSeu Telefone/WhatsApp \u003cspan class\u003d\"req\"\u003e*\u003c/span\u003e\u003c/label\u003e\n            \u003cinput id\u003d\"c_tel\" type\u003d\"tel\" placeholder\u003d\"(DDD) 90000-0000\" maxlength\u003d\"15\" autocomplete\u003d\"tel\" /\u003e\n          \u003c/div\u003e\n\n          \u003cdiv\u003e\n            \u003clabel for\u003d\"c_dep\"\u003eSetor / Local \u003cspan class\u003d\"req\"\u003e*\u003c/span\u003e\u003c/label\u003e\n            \u003cselect id\u003d\"c_dep\"\u003e\n              \u003coption value\u003d\"\"\u003eSelecione...\u003c/option\u003e\n            \u003c/select\u003e\n\n            \u003cdiv id\u003d\"c_dep_outro_wrap\"\u003e\n              \u003cdiv class\u003d\"hint\"\u003eSe escolheu \u003cb\u003eOUTROS\u003c/b\u003e, descreva aqui:\u003c/div\u003e\n              \u003cinput id\u003d\"c_dep_outro\" placeholder\u003d\"Digite o setor/local\" /\u003e\n            \u003c/div\u003e\n          \u003c/div\u003e\n\n          \u003cdiv\u003e\n            \u003clabel for\u003d\"c_categoria\"\u003eCategoria \u003cspan class\u003d\"req\"\u003e*\u003c/span\u003e\u003c/label\u003e\n            \u003cselect id\u003d\"c_categoria\"\u003e\n              \u003coption value\u003d\"\"\u003eSelecione...\u003c/option\u003e\n              \u003coption value\u003d\"Hardware\"\u003eHardware (Computador, Impressora, etc)\u003c/option\u003e\n              \u003coption value\u003d\"Software\"\u003eSoftware (Programas, Sistemas)\u003c/option\u003e\n              \u003coption value\u003d\"Rede\"\u003eRede / Internet\u003c/option\u003e\n              \u003coption value\u003d\"Email\"\u003eEmail\u003c/option\u003e\n              \u003coption value\u003d\"Telefonia\"\u003eTelefonia\u003c/option\u003e\n              \u003coption value\u003d\"Acesso\"\u003eAcesso / Senha\u003c/option\u003e\n              \u003coption value\u003d\"Instalacao\"\u003eInstala√ß√£o / Configura√ß√£o\u003c/option\u003e\n              \u003coption value\u003d\"Outro\"\u003eOutro\u003c/option\u003e\n            \u003c/select\u003e\n          \u003c/div\u003e\n\n          \u003cdiv\u003e\n            \u003clabel for\u003d\"c_prioridade\"\u003ePrioridade \u003cspan class\u003d\"req\"\u003e*\u003c/span\u003e\u003c/label\u003e\n            \u003cselect id\u003d\"c_prioridade\"\u003e\n              \u003coption value\u003d\"\"\u003eSelecione...\u003c/option\u003e\n              \u003coption value\u003d\"baixa\"\u003eüü¢ Baixa - Pode esperar\u003c/option\u003e\n              \u003coption value\u003d\"media\"\u003eüü° M√©dia - Importante\u003c/option\u003e\n              \u003coption value\u003d\"alta\"\u003eüü† Alta - Urgente\u003c/option\u003e\n              \u003coption value\u003d\"urgente\"\u003eüî¥ Urgente - Sistema parado\u003c/option\u003e\n            \u003c/select\u003e\n          \u003c/div\u003e\n\n          \u003cdiv class\u003d\"full\"\u003e\n            \u003clabel for\u003d\"c_desc\"\u003eDescreva o Problema \u003cspan class\u003d\"req\"\u003e*\u003c/span\u003e\u003c/label\u003e\n            \u003ctextarea id\u003d\"c_desc\" rows\u003d\"6\" placeholder\u003d\"Descreva o problema com o m√°ximo de detalhes poss√≠vel.\"\u003e\u003c/textarea\u003e\n          \u003c/div\u003e\n\n          \u003cdiv class\u003d\"full\"\u003e\n            \u003clabel for\u003d\"c_file\"\u003eAnexar Arquivo (Opcional)\u003c/label\u003e\n            \u003cinput type\u003d\"file\" id\u003d\"c_file\"\n              accept\u003d\".jpg,.jpeg,.png,.gif,.mp4,.mov,.avi,.mkv,.pdf,.doc,.docx,.txt\" /\u003e\n            \u003cdiv class\u003d\"hint\"\u003eFormatos aceitos ‚Äî m√°x. 5MB\u003c/div\u003e\n            \u003cdiv id\u003d\"c_fileInfo\" class\u003d\"file-pill\"\u003e\u003c/div\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n\n        \u003cdiv id\u003d\"c_ok\" class\u003d\"ok\"\u003e\u003c/div\u003e\n        \u003cdiv id\u003d\"c_err\" class\u003d\"alert\"\u003e\u003c/div\u003e\n\n        \u003cdiv class\u003d\"row-actions\"\u003e\n          \u003cbutton type\u003d\"button\" class\u003d\"btn-sec\" id\u003d\"btnLimpar\"\u003eLimpar\u003c/button\u003e\n          \u003cbutton type\u003d\"button\" class\u003d\"btn-send\" id\u003d\"btnEnviar\"\u003e\n            \u003cspan id\u003d\"btnEnviarTxt\"\u003eEnviar Chamado\u003c/span\u003e\n            \u003cspan id\u003d\"btnEnviarSpin\" class\u003d\"spin\" style\u003d\"display:none\"\u003e\u003c/span\u003e\n          \u003c/button\u003e\n        \u003c/div\u003e\n\n        \u003cdiv class\u003d\"mini\"\u003eO chamado √© registrado na planilha (aba \u003cb\u003eChamados\u003c/b\u003e) com status \u003cb\u003eABERTO\u003c/b\u003e.\u003c/div\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\n  \u003cscript\u003e\n    /**********************\n     * LOGIN (corrigido)\n     **********************/\n    const selectSetor \u003d document.getElementById(\u0027setor\u0027);\n    const erro \u003d document.getElementById(\u0027erro\u0027);\n\n    const form \u003d document.getElementById(\u0027loginForm\u0027);\n    const btnLogin  \u003d document.getElementById(\u0027btnLogin\u0027);\n    const btnTxt \u003d document.getElementById(\u0027btnTxt\u0027);\n    const btnSpin \u003d document.getElementById(\u0027btnSpin\u0027);\n\n    const elUsuario \u003d document.getElementById(\u0027usuario\u0027);\n    const elSenha   \u003d document.getElementById(\u0027senha\u0027);\n\n    function showLoginError(msg){\n      erro.textContent \u003d msg || \u0027Erro.\u0027;\n      erro.style.display \u003d \u0027block\u0027;\n    }\n    function clearLoginError(){\n      erro.textContent \u003d \u0027\u0027;\n      erro.style.display \u003d \u0027none\u0027;\n    }\n    function setBusyLogin(isBusy){\n      btnLogin.disabled \u003d !!isBusy;\n      btnSpin.style.display \u003d isBusy ? \u0027inline-block\u0027 : \u0027none\u0027;\n      btnTxt.textContent \u003d isBusy ? \u0027Entrando...\u0027 : \u0027Entrar\u0027;\n    }\n\n    // Carrega setores do Code.gs (fun√ß√£o: listarSetores)\n    function carregarSetores(){\n      selectSetor.innerHTML \u003d \u0027\u003coption value\u003d\"\"\u003eCarregando setores...\u003c/option\u003e\u0027;\n\n      google.script.run\n        .withSuccessHandler(function(setores){\n          selectSetor.innerHTML \u003d \u0027\u003coption value\u003d\"\"\u003eSelecione o Setor\u003c/option\u003e\u0027;\n          (setores || []).forEach(function(s){\n            if(!s) return;\n            const o \u003d document.createElement(\u0027option\u0027);\n            o.value \u003d s; o.textContent \u003d s;\n            selectSetor.appendChild(o);\n          });\n        })\n        .withFailureHandler(function(err){\n          console.error(\u0027[listarSetores]\u0027, err);\n          selectSetor.innerHTML \u003d \u0027\u003coption value\u003d\"\"\u003eSelecione o Setor\u003c/option\u003e\u0027;\n          const msg \u003d (err \u0026\u0026 err.message) ? err.message : \u0027Falha ao listar setores.\u0027;\n          showLoginError(\u0027Erro ao carregar setores: \u0027 + msg);\n        })\n        .listarSetores();\n    }\n    carregarSetores();\n\n    // Login de verdade (chama autenticarERetornarTela no Code.gs)\n    function entrar(){\n      clearLoginError();\n\n      const setor   \u003d (selectSetor.value || \u0027\u0027).trim();\n      const usuario \u003d (elUsuario.value || \u0027\u0027).trim();\n      const senha   \u003d (elSenha.value || \u0027\u0027).trim();\n\n      if(!setor || !usuario || !senha){\n        showLoginError(\u0027Preencha Setor, Usu√°rio e Senha.\u0027);\n        return;\n      }\n\n      setBusyLogin(true);\n\n      google.script.run\n        .withSuccessHandler(function(res){\n          if (!res || !res.ok){\n            setBusyLogin(false);\n            showLoginError(\u0027Usu√°rio ou senha inv√°lidos.\u0027);\n            return;\n          }\n\n          // ‚úÖ ESSENCIAL: navegar no TOP (evita tela branca do iframe)\n          const url \u003d res.redirectUrl || (\u0027?view\u003d\u0027 + encodeURIComponent(res.view || \u0027formulario\u0027));\n          window.open(url, \u0027_top\u0027);\n        })\n        .withFailureHandler(function(err){\n          console.error(\u0027[autenticarERetornarTela]\u0027, err);\n          setBusyLogin(false);\n          const msg \u003d (err \u0026\u0026 err.message) ? err.message : \u0027Falha no login.\u0027;\n          showLoginError(\u0027Erro no login: \u0027 + msg);\n        })\n        .autenticarERetornarTela(setor, usuario, senha);\n    }\n\n    form.addEventListener(\u0027submit\u0027, function(e){\n      e.preventDefault();\n      entrar();\n    });\n\n    /**********************\n     * CHAMADOS (modal)\n     **********************/\n    // \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d CHAMADO: setores fixos \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n    const CHAMADO_SETORES_FIXOS \u003d [\n      \u0027SECRETARIA\u0027,\u0027CAD1\u0027,\u0027CAD2\u0027,\u0027CRAM\u0027,\u0027ESTAT√çSTICA\u0027,\n      \u0027CRAS ANGELA MARIA (NOVO HORIZONTE)\u0027,\n      \u0027CRAS DR. FRANKLIN (PARQUE DOS FAROIS)\u0027,\n      \u0027CRAS MARIA JOS√â (JARDIM)\u0027,\n      \u0027CRAS PROF MARIA LUIZA (MARCOS FREIRE I)\u0027,\n      \u0027CRAS ZILDA ARNS (JO√ÉO ALVES)\u0027,\n      \u0027CREAS LEONEL BRIZOLA (PARQUE DOS FAROIS)\u0027,\n      \u0027CREAS MARCOS FREIRE\u0027,\n      \u0027OUTROS\u0027,\n    ];\n\n    const cDep \u003d document.getElementById(\u0027c_dep\u0027);\n    const cDepOutroWrap \u003d document.getElementById(\u0027c_dep_outro_wrap\u0027);\n    const cDepOutro \u003d document.getElementById(\u0027c_dep_outro\u0027);\n\n    (function fillChamadoSetores(){\n      const seen \u003d new Set();\n      CHAMADO_SETORES_FIXOS.forEach((s)\u003d\u003e{\n        const v \u003d String(s||\u0027\u0027).trim();\n        if(!v) return;\n        const k \u003d v.toUpperCase();\n        if(seen.has(k)) return;\n        seen.add(k);\n        const opt \u003d document.createElement(\u0027option\u0027);\n        opt.value \u003d v;\n        opt.textContent \u003d v;\n        cDep.appendChild(opt);\n      });\n    })();\n\n    cDep.addEventListener(\u0027change\u0027, ()\u003d\u003e{\n      const v \u003d String(cDep.value||\u0027\u0027).trim().toUpperCase();\n      if(v \u003d\u003d\u003d \u0027OUTROS\u0027){\n        cDepOutroWrap.style.display \u003d \u0027block\u0027;\n        setTimeout(()\u003d\u003ecDepOutro.focus(), 10);\n      }else{\n        cDepOutroWrap.style.display \u003d \u0027none\u0027;\n        cDepOutro.value \u003d \u0027\u0027;\n      }\n    });\n\n    // \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d CHAMADOS (modal) \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n    const ovl \u003d document.getElementById(\u0027ovl\u0027);\n    const btnChamados \u003d document.getElementById(\u0027btnChamados\u0027);\n    const btnClose \u003d document.getElementById(\u0027btnClose\u0027);\n    const btnLimpar \u003d document.getElementById(\u0027btnLimpar\u0027);\n    const btnEnviar \u003d document.getElementById(\u0027btnEnviar\u0027);\n    const btnEnviarTxt \u003d document.getElementById(\u0027btnEnviarTxt\u0027);\n    const btnEnviarSpin \u003d document.getElementById(\u0027btnEnviarSpin\u0027);\n\n    const cNome  \u003d document.getElementById(\u0027c_nome\u0027);\n    const cEmail \u003d document.getElementById(\u0027c_email\u0027);\n    const cTel   \u003d document.getElementById(\u0027c_tel\u0027);\n    const cCat   \u003d document.getElementById(\u0027c_categoria\u0027);\n    const cPri   \u003d document.getElementById(\u0027c_prioridade\u0027);\n    const cDesc  \u003d document.getElementById(\u0027c_desc\u0027);\n    const cFile  \u003d document.getElementById(\u0027c_file\u0027);\n    const cFileInfo \u003d document.getElementById(\u0027c_fileInfo\u0027);\n    const cOk \u003d document.getElementById(\u0027c_ok\u0027);\n    const cErr \u003d document.getElementById(\u0027c_err\u0027);\n\n    function clearAlerts(){\n      cOk.style.display \u003d \u0027none\u0027;\n      cErr.style.display \u003d \u0027none\u0027;\n      cErr.textContent \u003d \u0027\u0027;\n      cOk.textContent \u003d \u0027\u0027;\n    }\n    function showErr(msg){\n      cOk.style.display \u003d \u0027none\u0027;\n      cErr.textContent \u003d msg;\n      cErr.style.display \u003d \u0027block\u0027;\n    }\n    function showOk(msg){\n      cErr.style.display \u003d \u0027none\u0027;\n      cOk.textContent \u003d msg;\n      cOk.style.display \u003d \u0027block\u0027;\n    }\n\n    function openChamado(){\n      clearAlerts();\n      try{\n        const n \u003d localStorage.getItem(\u0027semfas_ch_nome\u0027) || \u0027\u0027;\n        const e \u003d localStorage.getItem(\u0027semfas_ch_email\u0027) || \u0027\u0027;\n        const t \u003d localStorage.getItem(\u0027semfas_ch_tel\u0027) || \u0027\u0027;\n        if (n \u0026\u0026 !cNome.value) cNome.value \u003d n;\n        if (e \u0026\u0026 !cEmail.value) cEmail.value \u003d e;\n        if (t \u0026\u0026 !cTel.value) cTel.value \u003d t;\n      }catch(_){}\n\n      ovl.style.display \u003d \u0027flex\u0027;\n      setTimeout(()\u003d\u003e (cNome.value ? cDesc.focus() : cNome.focus()), 30);\n    }\n    function closeChamado(){ ovl.style.display \u003d \u0027none\u0027; }\n\n    btnChamados.addEventListener(\u0027click\u0027, openChamado);\n    btnClose.addEventListener(\u0027click\u0027, closeChamado);\n    ovl.addEventListener(\u0027click\u0027, (e)\u003d\u003e{ if(e.target\u003d\u003d\u003dovl) closeChamado(); });\n    document.addEventListener(\u0027keydown\u0027, (e)\u003d\u003e{\n      if (e.key \u003d\u003d\u003d \u0027Escape\u0027 \u0026\u0026 ovl.style.display \u003d\u003d\u003d \u0027flex\u0027) closeChamado();\n    });\n\n    function maskPhoneBR(v){\n      v \u003d (v || \u0027\u0027).replace(/\\D/g,\u0027\u0027).slice(0,11);\n      if (!v) return \u0027\u0027;\n      if (v.length \u003c\u003d 2) return \u0027(\u0027 + v;\n      if (v.length \u003c\u003d 6) return \u0027(\u0027 + v.slice(0,2) + \u0027) \u0027 + v.slice(2);\n      if (v.length \u003c\u003d 10) return \u0027(\u0027 + v.slice(0,2) + \u0027) \u0027 + v.slice(2,6) + \u0027-\u0027 + v.slice(6);\n      return \u0027(\u0027 + v.slice(0,2) + \u0027) \u0027 + v.slice(2,7) + \u0027-\u0027 + v.slice(7);\n    }\n    cTel.addEventListener(\u0027input\u0027, ()\u003d\u003e{ cTel.value \u003d maskPhoneBR(cTel.value); });\n\n    const MAX_FILE \u003d 5 * 1024 * 1024; // 5MB\n    cFile.addEventListener(\u0027change\u0027, ()\u003d\u003e{\n      clearAlerts();\n      cFileInfo.style.display \u003d \u0027none\u0027;\n      cFileInfo.textContent \u003d \u0027\u0027;\n\n      const f \u003d cFile.files \u0026\u0026 cFile.files[0];\n      if (!f) return;\n\n      if (f.size \u003e MAX_FILE){\n        showErr(\u0027Arquivo acima de 5MB. Selecione um arquivo menor.\u0027);\n        cFile.value \u003d \u0027\u0027;\n        return;\n      }\n      cFileInfo.textContent \u003d `üìé ${f.name} (${Math.ceil(f.size/1024)} KB)`;\n      cFileInfo.style.display \u003d \u0027block\u0027;\n    });\n\n    btnLimpar.addEventListener(\u0027click\u0027, ()\u003d\u003e{\n      cNome.value \u003d \u0027\u0027;\n      cEmail.value \u003d \u0027\u0027;\n      cTel.value \u003d \u0027\u0027;\n      cDep.value \u003d \u0027\u0027;\n      cDepOutro.value \u003d \u0027\u0027;\n      cDepOutroWrap.style.display \u003d \u0027none\u0027;\n      cCat.value \u003d \u0027\u0027;\n      cPri.value \u003d \u0027\u0027;\n      cDesc.value \u003d \u0027\u0027;\n      cFile.value \u003d \u0027\u0027;\n      cFileInfo.style.display \u003d \u0027none\u0027;\n      cFileInfo.textContent \u003d \u0027\u0027;\n      clearAlerts();\n      cNome.focus();\n    });\n\n    function readFileAsBase64(file){\n      return new Promise((resolve, reject)\u003d\u003e{\n        const reader \u003d new FileReader();\n        reader.onload \u003d () \u003d\u003e {\n          try{\n            const dataUrl \u003d reader.result || \u0027\u0027;\n            const base64 \u003d String(dataUrl).split(\u0027,\u0027)[1] || \u0027\u0027;\n            resolve(base64);\n          }catch(e){ reject(e); }\n        };\n        reader.onerror \u003d reject;\n        reader.readAsDataURL(file);\n      });\n    }\n\n    function setSending(isSending){\n      btnEnviar.disabled \u003d isSending;\n      btnEnviarTxt.textContent \u003d isSending ? \u0027Enviando...\u0027 : \u0027Enviar Chamado\u0027;\n      btnEnviarSpin.style.display \u003d isSending ? \u0027inline-block\u0027 : \u0027none\u0027;\n    }\n\n    function validEmail(v){\n      return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(String(v||\u0027\u0027).trim());\n    }\n\n    btnEnviar.addEventListener(\u0027click\u0027, async ()\u003d\u003e{\n      clearAlerts();\n\n      const nome  \u003d (cNome.value || \u0027\u0027).trim();\n      const email \u003d (cEmail.value || \u0027\u0027).trim();\n      const tel   \u003d (cTel.value || \u0027\u0027).trim();\n      const depSel \u003d (cDep.value || \u0027\u0027).trim();\n      const depOutro \u003d (cDepOutro.value || \u0027\u0027).trim();\n      const dep   \u003d (depSel.toUpperCase() \u003d\u003d\u003d \u0027OUTROS\u0027) ? depOutro : depSel;\n      const cat   \u003d (cCat.value || \u0027\u0027).trim();\n      const pri   \u003d (cPri.value || \u0027\u0027).trim();\n      const desc  \u003d (cDesc.value || \u0027\u0027).trim();\n\n      if(!nome || !email || !tel || !dep || !cat || !pri || !desc){\n        showErr(\u0027Preencha todos os campos obrigat√≥rios (*) para abrir o chamado.\u0027);\n        return;\n      }\n      if(!validEmail(email)){\n        showErr(\u0027E-mail inv√°lido. Verifique e tente novamente.\u0027);\n        return;\n      }\n\n      try{\n        localStorage.setItem(\u0027semfas_ch_nome\u0027, nome);\n        localStorage.setItem(\u0027semfas_ch_email\u0027, email);\n        localStorage.setItem(\u0027semfas_ch_tel\u0027, tel);\n      }catch(_){}\n\n      const payload \u003d {\n        requester_name: nome,\n        requester_email: email,\n        requester_phone: tel,\n        department: dep,\n        category: cat,\n        priority: pri,\n        description: desc,\n        pagina: \u0027login\u0027,\n        userAgent: navigator.userAgent,\n        attachment: null\n      };\n\n      const f \u003d cFile.files \u0026\u0026 cFile.files[0];\n      if (f){\n        if (f.size \u003e MAX_FILE){\n          showErr(\u0027Arquivo acima de 5MB. Selecione um arquivo menor.\u0027);\n          return;\n        }\n        const b64 \u003d await readFileAsBase64(f);\n        payload.attachment \u003d {\n          fileName: f.name,\n          mimeType: f.type || \u0027application/octet-stream\u0027,\n          base64: b64\n        };\n      }\n\n      setSending(true);\n\n      google.script.run\n        .withSuccessHandler(function(res){\n          setSending(false);\n\n          if(!res || !res.ok){\n            showErr((res \u0026\u0026 res.msg) ? res.msg : \u0027N√£o foi poss√≠vel abrir o chamado.\u0027);\n            return;\n          }\n\n          const proto \u003d res.protocolo ? ` Protocolo: ${res.protocolo}.` : \u0027\u0027;\n          showOk(\u0027‚úÖ Chamado aberto com sucesso!\u0027 + proto);\n\n          cDesc.value \u003d \u0027\u0027;\n          cFile.value \u003d \u0027\u0027;\n          cFileInfo.style.display \u003d \u0027none\u0027;\n          cFileInfo.textContent \u003d \u0027\u0027;\n        })\n        .withFailureHandler(function(err){\n          setSending(false);\n          console.error(\u0027[ti_abrirChamado]\u0027, err);\n          showErr(\u0027Erro ao enviar chamado. Tente novamente.\u0027);\n        })\n        .ti_abrirChamado(payload);\n    });\n  \u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},{"id":"df880ab8-3b78-4b0a-8b02-f2c85052c964","name":"admin","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml lang\u003d\"pt-BR\"\u003e\n\u003chead\u003e\n  \u003cbase target\u003d\"_top\"\u003e\n  \u003cmeta charset\u003d\"UTF-8\" /\u003e\n  \u003cmeta name\u003d\"viewport\" content\u003d\"width\u003ddevice-width, initial-scale\u003d1.0\"/\u003e\n  \u003ctitle\u003eDashboard Estat√≠stico Avan√ßado\u003c/title\u003e\n  \u003cscript src\u003d\"https://cdn.tailwindcss.com\"\u003e\u003c/script\u003e\n  \u003cscript src\u003d\"https://cdn.jsdelivr.net/npm/chart.js\"\u003e\u003c/script\u003e\n  \u003cscript src\u003d\"https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js\"\u003e\u003c/script\u003e\n  \u003cstyle\u003e\n    body { box-sizing: border-box; transition: all .3s ease; }\n    .trend-up{ color:#10b981 } .trend-down{ color:#ef4444 }\n    .alert-pulse{ animation:pulse 2s infinite }\n    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.7}}\n    .gauge-container{ position:relative; width:200px; height:100px; margin:0 auto }\n\n    /* Modal simples */\n    .modal{ position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; align-items:center; justify-content:center; z-index:1000; }\n    .modal.show{ display:flex; }\n    .modal-card{ width:min(1000px,95vw); max-height:85vh; overflow:auto; background:#fff; border-radius:14px; box-shadow:0 25px 60px rgba(0,0,0,.25)}\n    .modal-header{ padding:14px 18px; border-bottom:1px solid #e5e7eb; display:flex; align-items:center; justify-content:space-between }\n    .modal-body{ padding:14px 18px }\n    .btn{ display:inline-flex; align-items:center; gap:.4rem; padding:.5rem .8rem; border-radius:.6rem; border:1px solid #e5e7eb; background:#fff }\n    .btn:hover{ background:#f8fafc }\n    .btn-primary{ background:#0ea5e9; color:#fff; border-color:#0ea5e9 }\n    .btn-primary:hover{ filter:brightness(.95) }\n  \u003c/style\u003e\n\u003c/head\u003e\n\u003cbody class\u003d\"bg-gradient-to-br from-purple-50 to-blue-100 min-h-screen\"\u003e\n\n  \u003c!-- \u003d\u003d\u003d\u003d\u003d\u003d\u003d TOPBAR SEMFAS \u003d\u003d\u003d\u003d\u003d\u003d\u003d --\u003e\n  \u003cheader class\u003d\"sticky top-0 z-50 bg-white/90 backdrop-blur-sm shadow-sm\"\u003e\n    \u003cdiv class\u003d\"max-w-6xl mx-auto px-4 py-2 flex justify-end\"\u003e\n      \u003cbutton id\u003d\"btnSair\"\n        class\u003d\"px-3 py-2 rounded-md border border-gray-200 hover:bg-gray-50 text-gray-700\"\u003e\n        Sair\n      \u003c/button\u003e\n    \u003c/div\u003e\n  \u003c/header\u003e\n  \u003c!-- \u003d\u003d\u003d\u003d\u003d\u003d\u003d /TOPBAR \u003d\u003d\u003d\u003d\u003d\u003d\u003d --\u003e\n\n  \u003cdiv class\u003d\"container mx-auto px-4 py-4\" id\u003d\"root\"\u003e\n    \u003c!-- Header --\u003e\n    \u003cdiv class\u003d\"bg-white rounded-lg shadow-lg p-4 mb-4\"\u003e\n      \u003cdiv class\u003d\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\"\u003e\n        \u003cdiv\u003e\n          \u003ch1 class\u003d\"text-2xl font-bold text-gray-800 mb-1\" id\u003d\"titulo\"\u003eDashboard Estat√≠stico Avan√ßado\u003c/h1\u003e\n          \u003cp class\u003d\"text-gray-600 text-sm\"\u003eAn√°lise completa com alertas, tend√™ncias e exporta√ß√£o\u003c/p\u003e\n        \u003c/div\u003e\n        \u003cdiv class\u003d\"flex gap-2\"\u003e\n          \u003cbutton onclick\u003d\"exportarPDF()\" class\u003d\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 text-sm rounded-lg font-medium transition-colors shadow-md\"\u003eüìÑ Exportar PDF\u003c/button\u003e\n          \u003cbutton onclick\u003d\"aplicarFiltros()\" class\u003d\"bg-green-600 hover:bg-green-700 text-white px-4 py-2 text-sm rounded-lg font-medium transition-colors shadow-md\"\u003eüîÑ Atualizar\u003c/button\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003c!-- Alertas --\u003e\n    \u003cdiv id\u003d\"alertasContainer\" class\u003d\"mb-4\"\u003e\u003c/div\u003e\n\n    \u003c!-- Filtros --\u003e\n    \u003cdiv class\u003d\"bg-white rounded-xl shadow-lg p-6 mb-6\"\u003e\n      \u003ch2 class\u003d\"text-xl font-bold text-gray-800 mb-4 flex items-center\"\u003e\n        \u003csvg class\u003d\"w-5 h-5 mr-2 text-purple-600\" fill\u003d\"none\" stroke\u003d\"currentColor\" viewBox\u003d\"0 0 24 24\"\u003e\n          \u003cpath stroke-linecap\u003d\"round\" stroke-linejoin\u003d\"round\" stroke-width\u003d\"2\" d\u003d\"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.707A1 1 0 013 7V4z\"\u003e\u003c/path\u003e\n        \u003c/svg\u003e\n        Filtros Avan√ßados\n      \u003c/h2\u003e\n\n      \u003cdiv class\u003d\"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4\"\u003e\n        \u003cdiv\u003e\n          \u003clabel class\u003d\"block text-sm font-medium text-gray-700 mb-2\"\u003ePer√≠odo R√°pido\u003c/label\u003e\n          \u003cselect id\u003d\"periodoRapido\" onchange\u003d\"aplicarPeriodoRapido()\" class\u003d\"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500\"\u003e\n            \u003coption value\u003d\"\"\u003ePersonalizado\u003c/option\u003e\n            \u003coption value\u003d\"7\"\u003e√öltimos 7 dias\u003c/option\u003e\n            \u003coption value\u003d\"30\"\u003e√öltimos 30 dias\u003c/option\u003e\n            \u003coption value\u003d\"90\"\u003e√öltimos 90 dias\u003c/option\u003e\n            \u003coption value\u003d\"365\"\u003e√öltimo ano\u003c/option\u003e\n          \u003c/select\u003e\n        \u003c/div\u003e\n        \u003cdiv\u003e\n          \u003clabel class\u003d\"block text-sm font-medium text-gray-700 mb-2\"\u003eData Inicial\u003c/label\u003e\n          \u003cinput type\u003d\"date\" id\u003d\"dataInicial\" class\u003d\"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500\"\u003e\n        \u003c/div\u003e\n        \u003cdiv\u003e\n          \u003clabel class\u003d\"block text-sm font-medium text-gray-700 mb-2\"\u003eData Final\u003c/label\u003e\n          \u003cinput type\u003d\"date\" id\u003d\"dataFinal\" class\u003d\"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500\"\u003e\n        \u003c/div\u003e\n        \u003cdiv\u003e\n          \u003clabel class\u003d\"block text-sm font-medium text-gray-700 mb-2\"\u003eUnidade\u003c/label\u003e\n          \u003cselect id\u003d\"unidadeFiltro\" class\u003d\"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500\"\u003e\n            \u003coption value\u003d\"\"\u003eTodas as Unidades\u003c/option\u003e\n          \u003c/select\u003e\n        \u003c/div\u003e\n        \u003cdiv\u003e\n          \u003clabel class\u003d\"block text-sm font-medium text-gray-700 mb-2\"\u003eStatus\u003c/label\u003e\n          \u003cselect id\u003d\"statusFiltro\" class\u003d\"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500\"\u003e\n            \u003coption value\u003d\"\"\u003eTodos\u003c/option\u003e\n            \u003coption value\u003d\"PENDENTE\"\u003ePendente\u003c/option\u003e\n            \u003coption value\u003d\"APROVADO\"\u003eAprovado\u003c/option\u003e\n            \u003coption value\u003d\"RECUSADO\"\u003eRecusado\u003c/option\u003e\n            \u003coption value\u003d\"ENTREGUE\"\u003eEntregue\u003c/option\u003e\n          \u003c/select\u003e\n        \u003c/div\u003e\n        \u003cdiv\u003e\n          \u003clabel class\u003d\"block text-sm font-medium text-gray-700 mb-2\"\u003eBenef√≠cio\u003c/label\u003e\n          \u003cselect id\u003d\"beneficioFiltro\" class\u003d\"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500\"\u003e\n            \u003coption value\u003d\"\"\u003eTodos\u003c/option\u003e\n          \u003c/select\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003cdiv class\u003d\"flex flex-col sm:flex-row gap-3 mt-2\"\u003e\n        \u003cdiv class\u003d\"flex gap-2\"\u003e\n          \u003cbutton onclick\u003d\"aplicarFiltros()\" class\u003d\"bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 text-sm rounded-lg font-medium transition-colors shadow-md\"\u003e‚ú® Filtrar\u003c/button\u003e\n          \u003cbutton onclick\u003d\"limparFiltros()\" class\u003d\"bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 text-sm rounded-lg font-medium transition-colors shadow-md\"\u003eüóëÔ∏è Limpar\u003c/button\u003e\n        \u003c/div\u003e\n        \u003cdiv class\u003d\"flex flex-1 gap-2\"\u003e\n          \u003cinput type\u003d\"text\" id\u003d\"buscaRapida\" placeholder\u003d\"üîç Buscar por CPF...\" class\u003d\"flex-1 px-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500\"\u003e\n          \u003cbutton onclick\u003d\"aplicarFiltros()\" class\u003d\"bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 text-sm rounded-lg font-medium transition-colors shadow-md\"\u003eBuscar\u003c/button\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003cdiv id\u003d\"loading\" class\u003d\"hidden mt-3 text-purple-700 font-semibold text-sm\"\u003eüîÑ Carregando dados...\u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003c!-- M√©tricas --\u003e\n    \u003cdiv class\u003d\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-6\"\u003e\n      \u003cdiv class\u003d\"bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl shadow-lg p-6 border border-blue-200\"\u003e\n        \u003cdiv class\u003d\"flex items-center justify-between\"\u003e\n          \u003cdiv class\u003d\"flex items-center\"\u003e\n            \u003cdiv class\u003d\"bg-blue-500 p-3 rounded-xl shadow-md\"\u003e\n              \u003csvg class\u003d\"w-6 h-6 text-white\" fill\u003d\"none\" stroke\u003d\"currentColor\" viewBox\u003d\"0 0 24 24\"\u003e\u003cpath stroke-linecap\u003d\"round\" stroke-linejoin\u003d\"round\" stroke-width\u003d\"2\" d\u003d\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586l6.414 6.414V19a2 2 0 01-2 2z\"/\u003e\u003c/svg\u003e\n            \u003c/div\u003e\n            \u003cdiv class\u003d\"ml-4\"\u003e\n              \u003cp class\u003d\"text-sm font-semibold text-blue-700\"\u003eTotal\u003c/p\u003e\n              \u003cp class\u003d\"text-2xl font-bold text-blue-900\" id\u003d\"totalMetrica\"\u003e0\u003c/p\u003e\n            \u003c/div\u003e\n          \u003c/div\u003e\n          \u003cdiv class\u003d\"text-right\"\u003e\u003cspan id\u003d\"totalTendencia\" class\u003d\"text-xs font-medium\"\u003e--\u003c/span\u003e\u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003cdiv class\u003d\"bg-gradient-to-br from-green-50 to-green-100 rounded-xl shadow-lg p-6 border border-green-200\"\u003e\n        \u003cdiv class\u003d\"flex items-center justify-between\"\u003e\n          \u003cdiv class\u003d\"flex items-center\"\u003e\n            \u003cdiv class\u003d\"bg-green-500 p-3 rounded-xl shadow-md\"\u003e\n              \u003csvg class\u003d\"w-6 h-6 text-white\" fill\u003d\"none\" stroke\u003d\"currentColor\" viewBox\u003d\"0 0 24 24\"\u003e\u003cpath stroke-linecap\u003d\"round\" stroke-linejoin\u003d\"round\" stroke-width\u003d\"2\" d\u003d\"M5 13l4 4L19 7\"/\u003e\u003c/svg\u003e\n            \u003c/div\u003e\n            \u003cdiv class\u003d\"ml-4\"\u003e\n              \u003cp class\u003d\"text-sm font-semibold text-green-700\"\u003eAprovados\u003c/p\u003e\n              \u003cp class\u003d\"text-2xl font-bold text-green-900\" id\u003d\"aprovadasMetrica\"\u003e0\u003c/p\u003e\n              \u003cp class\u003d\"text-xs text-green-600 font-medium\" id\u003d\"aprovadasPorcentagem\"\u003e0%\u003c/p\u003e\n            \u003c/div\u003e\n          \u003c/div\u003e\n          \u003cdiv class\u003d\"text-right\"\u003e\u003cspan id\u003d\"aprovadasTendencia\" class\u003d\"text-xs font-medium\"\u003e--\u003c/span\u003e\u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003cdiv class\u003d\"bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-xl shadow-lg p-6 border border-yellow-200\"\u003e\n        \u003cdiv class\u003d\"flex items-center justify-between\"\u003e\n          \u003cdiv class\u003d\"flex items-center\"\u003e\n            \u003cdiv class\u003d\"bg-yellow-500 p-3 rounded-xl shadow-md\"\u003e\n              \u003csvg class\u003d\"w-6 h-6 text-white\" fill\u003d\"none\" stroke\u003d\"currentColor\" viewBox\u003d\"0 0 24 24\"\u003e\u003cpath stroke-linecap\u003d\"round\" stroke-linejoin\u003d\"round\" stroke-width\u003d\"2\" d\u003d\"M12 8v4l3 3\"/\u003e\u003c/svg\u003e\n            \u003c/div\u003e\n            \u003cdiv class\u003d\"ml-4\"\u003e\n              \u003cp class\u003d\"text-sm font-semibold text-yellow-700\"\u003ePendentes\u003c/p\u003e\n              \u003cp class\u003d\"text-2xl font-bold text-yellow-900\" id\u003d\"pendentesMetrica\"\u003e0\u003c/p\u003e\n              \u003cp class\u003d\"text-xs text-yellow-600 font-medium\" id\u003d\"pendentesPorcentagem\"\u003e0%\u003c/p\u003e\n            \u003c/div\u003e\n          \u003c/div\u003e\n          \u003cdiv class\u003d\"text-right\"\u003e\u003cspan id\u003d\"pendentesTendencia\" class\u003d\"text-xs font-medium\"\u003e--\u003c/span\u003e\u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003cdiv class\u003d\"bg-gradient-to-br from-red-50 to-red-100 rounded-xl shadow-lg p-6 border border-red-200\"\u003e\n        \u003cdiv class\u003d\"flex items-center justify-between\"\u003e\n          \u003cdiv class\u003d\"flex items-center\"\u003e\n            \u003cdiv class\u003d\"bg-red-500 p-3 rounded-xl shadow-md\"\u003e\n              \u003csvg class\u003d\"w-6 h-6 text-white\" fill\u003d\"none\" stroke\u003d\"currentColor\" viewBox\u003d\"0 0 24 24\"\u003e\u003cpath stroke-linecap\u003d\"round\" stroke-linejoin\u003d\"round\" stroke-width\u003d\"2\" d\u003d\"M6 18L18 6M6 6l12 12\"/\u003e\u003c/svg\u003e\n            \u003c/div\u003e\n            \u003cdiv class\u003d\"ml-4\"\u003e\n              \u003cp class\u003d\"text-sm font-semibold text-red-700\"\u003eRecusados\u003c/p\u003e\n              \u003cp class\u003d\"text-2xl font-bold text-red-900\" id\u003d\"recusadasMetrica\"\u003e0\u003c/p\u003e\n              \u003cp class\u003d\"text-xs text-red-600 font-medium\" id\u003d\"recusadasPorcentagem\"\u003e0%\u003c/p\u003e\n            \u003c/div\u003e\n          \u003c/div\u003e\n          \u003cdiv class\u003d\"text-right\"\u003e\u003cspan id\u003d\"recusadasTendencia\" class\u003d\"text-xs font-medium\"\u003e--\u003c/span\u003e\u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003cdiv class\u003d\"bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl shadow-lg p-6 border border-purple-200\"\u003e\n        \u003cdiv class\u003d\"flex items-center justify-between\"\u003e\n          \u003cdiv class\u003d\"flex items-center\"\u003e\n            \u003cdiv class\u003d\"bg-purple-500 p-3 rounded-xl shadow-md\"\u003e\n              \u003csvg class\u003d\"w-6 h-6 text-white\" fill\u003d\"none\" stroke\u003d\"currentColor\" viewBox\u003d\"0 0 24 24\"\u003e\u003cpath stroke-linecap\u003d\"round\" stroke-linejoin\u003d\"round\" stroke-width\u003d\"2\" d\u003d\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\"/\u003e\u003c/svg\u003e\n            \u003c/div\u003e\n            \u003cdiv class\u003d\"ml-4\"\u003e\n              \u003cp class\u003d\"text-sm font-semibold text-purple-700\"\u003eEntregues\u003c/p\u003e\n              \u003cp class\u003d\"text-2xl font-bold text-purple-900\" id\u003d\"entreguesMetrica\"\u003e0\u003c/p\u003e\n              \u003cp class\u003d\"text-xs text-purple-600 font-medium\" id\u003d\"entreguesPorcentagem\"\u003e0%\u003c/p\u003e\n            \u003c/div\u003e\n          \u003c/div\u003e\n          \u003cdiv class\u003d\"text-right\"\u003e\u003cspan id\u003d\"entreguesTendencia\" class\u003d\"text-xs font-medium\"\u003e--\u003c/span\u003e\u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003c!-- Performance --\u003e\n    \u003cdiv class\u003d\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6\"\u003e\n      \u003cdiv class\u003d\"bg-gradient-to-br from-indigo-50 to-indigo-100 rounded-xl shadow-lg p-6 border border-indigo-200\"\u003e\n        \u003cdiv class\u003d\"flex items-center mb-3\"\u003e\n          \u003cdiv class\u003d\"bg-indigo-500 p-2 rounded-lg\"\u003e\n            \u003csvg class\u003d\"w-5 h-5 text-white\" fill\u003d\"none\" stroke\u003d\"currentColor\" viewBox\u003d\"0 0 24 24\"\u003e\u003cpath stroke-linecap\u003d\"round\" stroke-linejoin\u003d\"round\" stroke-width\u003d\"2\" d\u003d\"M12 8v4l3 3\"/\u003e\u003c/svg\u003e\n          \u003c/div\u003e\n          \u003ch3 class\u003d\"text-sm font-bold text-indigo-800 ml-3\"\u003eTempo M√©dio\u003c/h3\u003e\n        \u003c/div\u003e\n        \u003cp class\u003d\"text-3xl font-bold text-indigo-900 mb-1\" id\u003d\"tempoMedio\"\u003e‚Äî\u003c/p\u003e\n        \u003cp class\u003d\"text-xs text-indigo-600 font-medium\"\u003eDa solicita√ß√£o √† entrega\u003c/p\u003e\n      \u003c/div\u003e\n\n      \u003cdiv class\u003d\"bg-gradient-to-br from-teal-50 to-teal-100 rounded-xl shadow-lg p-6 border border-teal-200\"\u003e\n        \u003cdiv class\u003d\"flex items-center mb-3\"\u003e\n          \u003cdiv class\u003d\"bg-teal-500 p-2 rounded-lg\"\u003e\n            \u003csvg class\u003d\"w-5 h-5 text-white\" fill\u003d\"none\" stroke\u003d\"currentColor\" viewBox\u003d\"0 0 24 24\"\u003e\u003cpath stroke-linecap\u003d\"round\" stroke-linejoin\u003d\"round\" stroke-width\u003d\"2\" d\u003d\"M9 19v-6m0 0V9m6 10V9\"/\u003e\u003c/svg\u003e\n          \u003c/div\u003e\n          \u003ch3 class\u003d\"text-sm font-bold text-teal-800 ml-3\"\u003eTaxa de Convers√£o\u003c/h3\u003e\n        \u003c/div\u003e\n        \u003cdiv class\u003d\"gauge-container\"\u003e\u003ccanvas id\u003d\"gaugeCanvas\" width\u003d\"200\" height\u003d\"100\"\u003e\u003c/canvas\u003e\u003c/div\u003e\n        \u003cp class\u003d\"text-xs text-teal-600 font-medium text-center\"\u003ePendente ‚Üí Entregue\u003c/p\u003e\n      \u003c/div\u003e\n\n      \u003cdiv class\u003d\"bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl shadow-lg p-6 border border-orange-200\"\u003e\n        \u003cdiv class\u003d\"flex items-center mb-3\"\u003e\n          \u003cdiv class\u003d\"bg-orange-500 p-2 rounded-lg\"\u003e\n            \u003csvg class\u003d\"w-5 h-5 text-white\" fill\u003d\"none\" stroke\u003d\"currentColor\" viewBox\u003d\"0 0 24 24\"\u003e\u003cpath stroke-linecap\u003d\"round\" stroke-linejoin\u003d\"round\" stroke-width\u003d\"2\" d\u003d\"M12 9v2m0 4h.01\"/\u003e\u003c/svg\u003e\n          \u003c/div\u003e\n        \u003ch3 class\u003d\"text-sm font-bold text-orange-800 ml-3\"\u003eEm Atraso\u003c/h3\u003e\u003c/div\u003e\n        \u003cp class\u003d\"text-3xl font-bold text-orange-900 mb-1\" id\u003d\"emAtraso\"\u003e0\u003c/p\u003e\n        \u003cp class\u003d\"text-xs text-orange-600 font-medium\"\u003ePendentes h√° mais de 7 dias\u003c/p\u003e\n      \u003c/div\u003e\n\n      \u003cdiv class\u003d\"bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-xl shadow-lg p-6 border border-emerald-200\"\u003e\n        \u003cdiv class\u003d\"flex items-center mb-3\"\u003e\n          \u003cdiv class\u003d\"bg-emerald-500 p-2 rounded-lg\"\u003e\n            \u003csvg class\u003d\"w-5 h-5 text-white\" fill\u003d\"none\" stroke\u003d\"currentColor\" viewBox\u003d\"0 0 24 24\"\u003e\u003cpath stroke-linecap\u003d\"round\" stroke-linejoin\u003d\"round\" stroke-width\u003d\"2\" d\u003d\"M13 10V3L4 14h7v7l9-11h-7z\"/\u003e\u003c/svg\u003e\n          \u003c/div\u003e\n          \u003ch3 class\u003d\"text-sm font-bold text-emerald-800 ml-3\"\u003eEfici√™ncia Geral\u003c/h3\u003e\n        \u003c/div\u003e\n        \u003cp class\u003d\"text-3xl font-bold text-emerald-900 mb-1\" id\u003d\"eficienciaGeral\"\u003e0%\u003c/p\u003e\n        \u003cp class\u003d\"text-xs text-emerald-600 font-medium\"\u003eAprovados + Entregues / Total\u003c/p\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003c!-- Gr√°ficos --\u003e\n    \u003cdiv class\u003d\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\"\u003e\n      \u003cdiv class\u003d\"bg-white rounded-xl shadow-lg p-6 border border-gray-100\"\u003e\n        \u003cdiv class\u003d\"flex items-center mb-4\"\u003e\n          \u003cdiv class\u003d\"bg-purple-500 p-2 rounded-lg\"\u003e\n            \u003csvg class\u003d\"w-5 h-5 text-white\" fill\u003d\"none\" stroke\u003d\"currentColor\" viewBox\u003d\"0 0 24 24\"\u003e\u003cpath stroke-linecap\u003d\"round\" stroke-linejoin\u003d\"round\" stroke-width\u003d\"2\" d\u003d\"M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z\"/\u003e\u003c/svg\u003e\n          \u003c/div\u003e\n          \u003ch3 class\u003d\"text-xl font-bold text-gray-800 ml-3\"\u003eDistribui√ß√£o por Status\u003c/h3\u003e\n        \u003c/div\u003e\n        \u003cdiv class\u003d\"relative h-72\"\u003e\u003ccanvas id\u003d\"graficoStatus\"\u003e\u003c/canvas\u003e\u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003cdiv class\u003d\"bg-white rounded-xl shadow-lg p-6 border border-gray-100\"\u003e\n        \u003cdiv class\u003d\"flex items-center mb-4\"\u003e\n          \u003cdiv class\u003d\"bg-indigo-500 p-2 rounded-lg\"\u003e\n            \u003csvg class\u003d\"w-5 h-5 text-white\" fill\u003d\"none\" stroke\u003d\"currentColor\" viewBox\u003d\"0 0 24 24\"\u003e\u003cpath stroke-linecap\u003d\"round\" stroke-linejoin\u003d\"round\" stroke-width\u003d\"2\" d\u003d\"M9 19v-6m0 0V9m6 10V9\"/\u003e\u003c/svg\u003e\n          \u003c/div\u003e\n          \u003ch3 class\u003d\"text-xl font-bold text-gray-800 ml-3\"\u003eSolicita√ß√µes por Unidade\u003c/h3\u003e\n        \u003c/div\u003e\n        \u003cdiv class\u003d\"relative h-72\"\u003e\u003ccanvas id\u003d\"graficoUnidades\"\u003e\u003c/canvas\u003e\u003c/div\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cdiv class\u003d\"bg-white rounded-lg shadow-lg p-4 mb-4\"\u003e\n      \u003ch3 class\u003d\"text-lg font-semibold text-gray-800 mb-3\"\u003eEvolu√ß√£o das Solicita√ß√µes ao Longo do Tempo\u003c/h3\u003e\n      \u003cdiv class\u003d\"relative h-64\"\u003e\u003ccanvas id\u003d\"graficoTempo\"\u003e\u003c/canvas\u003e\u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cdiv class\u003d\"bg-white rounded-lg shadow-lg p-4 mb-4\"\u003e\n      \u003ch3 class\u003d\"text-lg font-semibold text-gray-800 mb-3\"\u003eFunil de Convers√£o\u003c/h3\u003e\n      \u003cdiv class\u003d\"relative h-64\"\u003e\u003ccanvas id\u003d\"graficoFunil\"\u003e\u003c/canvas\u003e\u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cdiv class\u003d\"bg-white rounded-lg shadow-lg p-4 mb-4\"\u003e\n      \u003ch3 class\u003d\"text-lg font-semibold text-gray-800 mb-3\"\u003eTop Tipos de Benef√≠cio (Per√≠odo Aplicado)\u003c/h3\u003e\n      \u003cdiv class\u003d\"relative h-64\"\u003e\u003ccanvas id\u003d\"graficoBeneficios\"\u003e\u003c/canvas\u003e\u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003c!-- Tabelas --\u003e\n    \u003cdiv class\u003d\"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4\"\u003e\n      \u003cdiv class\u003d\"bg-white rounded-lg shadow-lg overflow-hidden\"\u003e\n        \u003cdiv class\u003d\"px-4 py-3 border-b border-gray-200\"\u003e\u003ch3 class\u003d\"text-lg font-semibold text-gray-800\"\u003ePerformance por Unidade\u003c/h3\u003e\u003c/div\u003e\n        \u003cdiv class\u003d\"overflow-x-auto\"\u003e\n          \u003ctable class\u003d\"min-w-full divide-y divide-gray-200\"\u003e\n            \u003cthead class\u003d\"bg-gray-50\"\u003e\n              \u003ctr\u003e\n                \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eUnidade\u003c/th\u003e\n                \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eTotal\u003c/th\u003e\n                \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eTaxa\u003c/th\u003e\n                \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eTempo M√©dio\u003c/th\u003e\n              \u003c/tr\u003e\n            \u003c/thead\u003e\n            \u003ctbody id\u003d\"tabelaResumo\" class\u003d\"bg-white divide-y divide-gray-200\"\u003e\u003c/tbody\u003e\n          \u003c/table\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003cdiv class\u003d\"bg-white rounded-lg shadow-lg overflow-hidden\"\u003e\n        \u003cdiv class\u003d\"px-4 py-3 border-b border-gray-200\"\u003e\u003ch3 class\u003d\"text-lg font-semibold text-gray-800\"\u003eTop Benef√≠cios Solicitados\u003c/h3\u003e\u003c/div\u003e\n        \u003cdiv class\u003d\"overflow-x-auto\"\u003e\n          \u003ctable class\u003d\"min-w-full divide-y divide-gray-200\"\u003e\n            \u003cthead class\u003d\"bg-gray-50\"\u003e\n              \u003ctr\u003e\n                \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eBenef√≠cio\u003c/th\u003e\n                \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eQuantidade\u003c/th\u003e\n                \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003e%\u003c/th\u003e\n                \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eTend√™ncia\u003c/th\u003e\n              \u003c/tr\u003e\n            \u003c/thead\u003e\n            \u003ctbody id\u003d\"tabelaBeneficios\" class\u003d\"bg-white divide-y divide-gray-200\"\u003e\u003c/tbody\u003e\n          \u003c/table\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cdiv class\u003d\"bg-white rounded-lg shadow-lg overflow-hidden\"\u003e\n      \u003cdiv class\u003d\"px-4 py-3 border-b border-gray-200\"\u003e\u003ch3 class\u003d\"text-lg font-semibold text-gray-800\"\u003eSolicita√ß√µes Recentes\u003c/h3\u003e\u003c/div\u003e\n      \u003cdiv class\u003d\"overflow-x-auto\"\u003e\n        \u003ctable class\u003d\"min-w-full divide-y divide-gray-200\"\u003e\n          \u003cthead class\u003d\"bg-gray-50\"\u003e\n            \u003ctr\u003e\n              \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eNome\u003c/th\u003e\n              \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eCPF\u003c/th\u003e\n              \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eBenef√≠cio\u003c/th\u003e\n              \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eUnidade\u003c/th\u003e\n              \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eData\u003c/th\u003e\n              \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eStatus\u003c/th\u003e\n              \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eDias\u003c/th\u003e\n            \u003c/tr\u003e\n          \u003c/thead\u003e\n          \u003ctbody id\u003d\"tabelaRecentes\" class\u003d\"bg-white divide-y divide-gray-200\"\u003e\u003c/tbody\u003e\n        \u003c/table\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\n  \u003c!-- MODAL: Lista de Pend√™ncias em Atraso --\u003e\n  \u003cdiv id\u003d\"modalAtrasos\" class\u003d\"modal\" aria-hidden\u003d\"true\"\u003e\n    \u003cdiv class\u003d\"modal-card\"\u003e\n      \u003cdiv class\u003d\"modal-header\"\u003e\n        \u003ch3 class\u003d\"text-lg font-semibold text-gray-800\"\u003ePendentes h√° mais de 7 dias\u003c/h3\u003e\n        \u003cdiv class\u003d\"flex gap-2\"\u003e\n          \u003cbutton class\u003d\"btn\" onclick\u003d\"copiarAtrasos()\"\u003eCopiar\u003c/button\u003e\n          \u003cbutton class\u003d\"btn btn-primary\" onclick\u003d\"baixarAtrasosCSV()\"\u003eBaixar CSV\u003c/button\u003e\n          \u003cbutton class\u003d\"btn\" onclick\u003d\"closeModal(\u0027modalAtrasos\u0027)\"\u003eFechar\u003c/button\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n      \u003cdiv class\u003d\"modal-body\"\u003e\n        \u003cdiv class\u003d\"overflow-auto\"\u003e\n          \u003ctable class\u003d\"min-w-full divide-y divide-gray-200\"\u003e\n            \u003cthead class\u003d\"bg-gray-50\"\u003e\n              \u003ctr\u003e\n                \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eNome\u003c/th\u003e\n                \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eCPF\u003c/th\u003e\n                \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eUnidade\u003c/th\u003e\n                \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eBenef√≠cio\u003c/th\u003e\n                \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eData\u003c/th\u003e\n                \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eDias\u003c/th\u003e\n              \u003c/tr\u003e\n            \u003c/thead\u003e\n            \u003ctbody id\u003d\"listaAtrasosBody\" class\u003d\"bg-white divide-y divide-gray-200\"\u003e\u003c/tbody\u003e\n          \u003c/table\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\n  \u003c!-- MODAL: Taxa de Aprova√ß√£o Baixa (Recusados por Unidade) --\u003e\n  \u003cdiv id\u003d\"modalTaxaBaixa\" class\u003d\"modal\" aria-hidden\u003d\"true\"\u003e\n    \u003cdiv class\u003d\"modal-card\"\u003e\n      \u003cdiv class\u003d\"modal-header\"\u003e\n        \u003ch3 class\u003d\"text-lg font-semibold text-gray-800\"\u003eRecusados por Unidade\u003c/h3\u003e\n        \u003cdiv class\u003d\"flex gap-2\"\u003e\n          \u003cbutton class\u003d\"btn\" onclick\u003d\"copiarTaxaBaixa()\"\u003eCopiar\u003c/button\u003e\n          \u003cbutton class\u003d\"btn btn-primary\" onclick\u003d\"baixarTaxaBaixaCSV()\"\u003eBaixar CSV\u003c/button\u003e\n          \u003cbutton class\u003d\"btn\" onclick\u003d\"closeModal(\u0027modalTaxaBaixa\u0027)\"\u003eFechar\u003c/button\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n      \u003cdiv class\u003d\"modal-body\"\u003e\n        \u003cdiv class\u003d\"overflow-auto\"\u003e\n          \u003ctable class\u003d\"min-w-full divide-y divide-gray-200\"\u003e\n            \u003cthead class\u003d\"bg-gray-50\"\u003e\n              \u003ctr\u003e\n                \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eUnidade\u003c/th\u003e\n                \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eTotal\u003c/th\u003e\n                \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eAprovados\u003c/th\u003e\n                \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eRecusados\u003c/th\u003e\n                \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003ePendentes\u003c/th\u003e\n                \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003eEntregues\u003c/th\u003e\n                \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003e% Aprova√ß√£o\u003c/th\u003e\n                \u003cth class\u003d\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\"\u003e% Recusa\u003c/th\u003e\n              \u003c/tr\u003e\n            \u003c/thead\u003e\n            \u003ctbody id\u003d\"listaTaxaBaixaBody\" class\u003d\"bg-white divide-y divide-gray-200\"\u003e\u003c/tbody\u003e\n          \u003c/table\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\n  \u003c!-- MODAL: Hist√≥rico do Benefici√°rio --\u003e\n  \u003cdiv id\u003d\"modalHistorico\" class\u003d\"modal\" aria-hidden\u003d\"true\"\u003e\n    \u003cdiv class\u003d\"modal-card\"\u003e\n      \u003cdiv class\u003d\"modal-header\"\u003e\n        \u003ch3 id\u003d\"tituloHistorico\" class\u003d\"text-lg font-semibold text-gray-800\"\u003eHist√≥rico do Benefici√°rio\u003c/h3\u003e\n        \u003cbutton class\u003d\"btn\" onclick\u003d\"closeModal(\u0027modalHistorico\u0027)\"\u003eFechar\u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv class\u003d\"modal-body\"\u003e\n        \u003cdiv id\u003d\"conteudoHistorico\" class\u003d\"text-sm text-gray-700\"\u003e\n          Carregando...\n        \u003c/div\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\n  \u003cscript\u003e\n    // \u003d\u003d\u003d\u003d\u003d Estado \u003d\u003d\u003d\u003d\u003d\n    let payload \u003d null;\n    let registros \u003d [];\n    let filtrados \u003d [];\n    let graficos \u003d {};\n    const el \u003d id \u003d\u003e document.getElementById(id);\n    function showLoading(v){ el(\"loading\").classList.toggle(\"hidden\", !v); }\n\n    // \u003d\u003d\u003d\u003d\u003d Helpers \u003d\u003d\u003d\u003d\u003d\n    function toBR(iso){\n      const m \u003d String(iso||\u0027\u0027).match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n      return m ? `${m[3]}/${m[2]}/${m[1]}` : iso || \u0027\u0027;\n    }\n    function diasEntre(iso) {\n      if (!iso) return 0;\n      const d \u003d new Date(iso + \u0027T00:00:00\u0027);\n      const hoje \u003d new Date(); hoje.setHours(0,0,0,0);\n      return Math.max(0, Math.floor((hoje - d)/(1000*60*60*24)));\n    }\n    function maskCPF(cpf){\n      const num \u003d String(cpf||\u0027\u0027).replace(/\\D/g,\u0027\u0027);\n      return num.length\u003d\u003d\u003d11? num.replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/,\"$1.$2.$3-$4\") : cpf||\u0027\u0027;\n    }\n\n    // \u003d\u003d\u003d\u003d\u003d Backend \u003d\u003d\u003d\u003d\u003d\n    function popularUnidades(){\n      if (!(google \u0026\u0026 google.script \u0026\u0026 google.script.run)) return;\n      google.script.run.withSuccessHandler(function(arr){\n        const sel \u003d el(\u0027unidadeFiltro\u0027);\n        let lista \u003d (arr || []).slice();\n        if (!lista.includes(\u0027SEDE\u0027)) lista.push(\u0027SEDE\u0027);\n        sel.innerHTML \u003d `\u003coption value\u003d\"\"\u003eTodas as Unidades\u003c/option\u003e` +\n          lista.map(u\u003d\u003e`\u003coption value\u003d\"${u}\"\u003e${u}\u003c/option\u003e`).join(\u0027\u0027);\n      }).listarUnidadesDashboard();\n    }\n\n    function aplicarFiltros(){\n      showLoading(true);\n      const inicio  \u003d el(\u0027dataInicial\u0027).value || \u0027\u0027;\n      const fim     \u003d el(\u0027dataFinal\u0027).value   || \u0027\u0027;\n      const unidade \u003d el(\u0027unidadeFiltro\u0027).value || \u0027\u0027;\n      const status  \u003d (el(\u0027statusFiltro\u0027).value || \u0027\u0027).toUpperCase();\n      const ben     \u003d el(\u0027beneficioFiltro\u0027).value || \u0027\u0027;\n      const termo   \u003d (el(\u0027buscaRapida\u0027).value || \u0027\u0027).trim().toLowerCase();\n\n      if (!(google \u0026\u0026 google.script \u0026\u0026 google.script.run)) { showLoading(false); return; }\n\n      google.script.run\n        .withSuccessHandler(function(dados){\n          showLoading(false);\n          payload   \u003d dados || {};\n          registros \u003d (payload.registros || []).map(r \u003d\u003e ({\n            nome: r.nome || \u0027\u0027,\n            cpf: r.cpf || \u0027\u0027,\n            unidade: r.unidade || \u0027\u0027,\n            beneficio: r.beneficio || r.demanda || \u0027\u0027,\n            status: (r.status||\u0027\u0027).toUpperCase(),\n            dataISO: r.dataISO || \u0027\u0027,\n            dataBR: r.dataBR || toBR(r.dataISO||\u0027\u0027)\n          }));\n\n          const tipos \u003d Object.keys(payload.tipos||{});\n          const benSel \u003d el(\u0027beneficioFiltro\u0027);\n          const benSelVal \u003d benSel.value;\n          benSel.innerHTML \u003d `\u003coption value\u003d\"\"\u003eTodos\u003c/option\u003e` + tipos.map(t\u003d\u003e`\u003coption value\u003d\"${t}\"\u003e${t}\u003c/option\u003e`).join(\u0027\u0027);\n          if ([...benSel.options].some(o\u003d\u003eo.value\u003d\u003d\u003dbenSelVal)) benSel.value \u003d benSelVal;\n\n          filtrados \u003d registros.filter(it\u003d\u003e{\n            if (unidade \u0026\u0026 it.unidade !\u003d\u003d unidade) return false;\n            if (status \u0026\u0026 it.status !\u003d\u003d status) return false;\n            if (ben \u0026\u0026 it.beneficio !\u003d\u003d ben) return false;\n            if (termo \u0026\u0026 !(it.nome.toLowerCase().includes(termo) || it.cpf.replace(/\\D/g,\u0027\u0027).includes(termo.replace(/\\D/g,\u0027\u0027)))) return false;\n            if (inicio \u0026\u0026 it.dataISO \u0026\u0026 it.dataISO \u003c inicio) return false;\n            if (fim \u0026\u0026 it.dataISO \u0026\u0026 it.dataISO \u003e fim) return false;\n            return true;\n          });\n\n          atualizarDashboard();\n          el(\u0027titulo\u0027).textContent \u003d `Dashboard Estat√≠stico Avan√ßado (Atualizado: ${new Date().toLocaleTimeString(\u0027pt-BR\u0027)})`;\n        })\n        .withFailureHandler(function(err){\n          showLoading(false);\n          alert(\u0027Erro ao carregar: \u0027 + (err \u0026\u0026 err.message? err.message : err));\n        })\n        .getDashboardCompleto(inicio, fim, unidade);\n    }\n\n    function aplicarPeriodoRapido(){\n      const p \u003d parseInt(el(\u0027periodoRapido\u0027).value||\u0027\u0027);\n      if (!p) return;\n      const hoje \u003d new Date();\n      const fim  \u003d hoje.toISOString().slice(0,10);\n      const iniD \u003d new Date(hoje.getTime() - p*24*60*60*1000);\n      const ini  \u003d iniD.toISOString().slice(0,10);\n      el(\u0027dataInicial\u0027).value \u003d ini;\n      el(\u0027dataFinal\u0027).value   \u003d fim;\n      aplicarFiltros();\n    }\n\n    function limparFiltros(){\n      el(\u0027periodoRapido\u0027).value \u003d \u0027\u0027;\n      el(\u0027dataInicial\u0027).value \u003d \u0027\u0027;\n      el(\u0027dataFinal\u0027).value \u003d \u0027\u0027;\n      el(\u0027unidadeFiltro\u0027).value \u003d \u0027\u0027;\n      el(\u0027statusFiltro\u0027).value \u003d \u0027\u0027;\n      el(\u0027beneficioFiltro\u0027).value \u003d \u0027\u0027;\n      el(\u0027buscaRapida\u0027).value \u003d \u0027\u0027;\n      aplicarFiltros();\n    }\n\n    // \u003d\u003d\u003d\u003d\u003d M√©tricas / Alertas / Gr√°ficos / Tabelas \u003d\u003d\u003d\u003d\u003d\n    function atualizarMetricas(){\n      const total \u003d filtrados.length;\n      const aprov \u003d filtrados.filter(i\u003d\u003ei.status\u003d\u003d\u003d\u0027APROVADO\u0027).length;\n      const pend  \u003d filtrados.filter(i\u003d\u003ei.status\u003d\u003d\u003d\u0027PENDENTE\u0027).length;\n      const rec   \u003d filtrados.filter(i\u003d\u003ei.status\u003d\u003d\u003d\u0027RECUSADO\u0027).length;\n      const entr  \u003d filtrados.filter(i\u003d\u003ei.status\u003d\u003d\u003d\u0027ENTREGUE\u0027).length;\n\n      el(\u0027totalMetrica\u0027).textContent      \u003d total;\n      el(\u0027aprovadasMetrica\u0027).textContent  \u003d aprov;\n      el(\u0027pendentesMetrica\u0027).textContent  \u003d pend;\n      el(\u0027recusadasMetrica\u0027).textContent  \u003d rec;\n      el(\u0027entreguesMetrica\u0027).textContent  \u003d entr;\n\n      el(\u0027aprovadasPorcentagem\u0027).textContent \u003d total? ((aprov/total)*100).toFixed(1)+\u0027%\u0027:\u00270%\u0027;\n      el(\u0027pendentesPorcentagem\u0027).textContent \u003d total? ((pend/total)*100).toFixed(1)+\u0027%\u0027:\u00270%\u0027;\n      el(\u0027recusadasPorcentagem\u0027).textContent \u003d total? ((rec/total)*100).toFixed(1)+\u0027%\u0027:\u00270%\u0027;\n      el(\u0027entreguesPorcentagem\u0027).textContent \u003d total? ((entr/total)*100).toFixed(1)+\u0027%\u0027:\u00270%\u0027;\n\n      const eficiencia \u003d total ? (((aprov + entr) / total) * 100).toFixed(1) : 0;\n      el(\u0027eficienciaGeral\u0027).textContent \u003d `${eficiencia}%`;\n      atualizarGauge(Number(eficiencia));\n\n      el(\u0027tempoMedio\u0027).textContent \u003d \u0027‚Äî\u0027;\n\n      const atrasados \u003d filtrados.filter(i\u003d\u003e i.status\u003d\u003d\u003d\u0027PENDENTE\u0027 \u0026\u0026 diasEntre(i.dataISO) \u003e 7).length;\n      el(\u0027emAtraso\u0027).textContent \u003d atrasados;\n    }\n\n    function calcularTendencias(){\n      const hoje \u003d new Date();\n      const umMes \u003d new Date(hoje.getTime() - 30*24*60*60*1000);\n      const doisMes \u003d new Date(hoje.getTime() - 60*24*60*60*1000);\n\n      const atual \u003d filtrados.filter(i\u003d\u003e new Date(i.dataISO+\u0027T00:00:00\u0027) \u003e\u003d umMes);\n      const anterior \u003d registros.filter(i\u003d\u003e{\n        const d\u003dnew Date(i.dataISO+\u0027T00:00:00\u0027); return d\u003e\u003ddoisMes \u0026\u0026 d\u003cumMes;\n      });\n\n      const totA \u003d atual.length, totB \u003d anterior.length;\n      const tTot \u003d totB\u003e0 ? ((totA-totB)/totB*100).toFixed(1) : 0;\n\n      const apA \u003d atual.filter(i\u003d\u003ei.status\u003d\u003d\u003d\u0027APROVADO\u0027).length;\n      const apB \u003d anterior.filter(i\u003d\u003ei.status\u003d\u003d\u003d\u0027APROVADO\u0027).length;\n      const tAp \u003d apB\u003e0 ? ((apA-apB)/apB*100).toFixed(1) : 0;\n\n      el(\u0027totalTendencia\u0027).innerHTML \u003d `${tTot\u003e0?\u0027‚ÜóÔ∏è\u0027:\u0027‚ÜòÔ∏è\u0027} ${Math.abs(tTot)}%`;\n      el(\u0027totalTendencia\u0027).className \u003d `text-xs font-medium ${tTot\u003e0?\u0027trend-up\u0027:\u0027trend-down\u0027}`;\n      el(\u0027aprovadasTendencia\u0027).innerHTML \u003d `${tAp\u003e0?\u0027‚ÜóÔ∏è\u0027:\u0027‚ÜòÔ∏è\u0027} ${Math.abs(tAp)}%`;\n      el(\u0027aprovadasTendencia\u0027).className \u003d `text-xs font-medium ${tAp\u003e0?\u0027trend-up\u0027:\u0027trend-down\u0027}`;\n    }\n\n    function openModal(id){ document.getElementById(id).classList.add(\u0027show\u0027); }\n    function closeModal(id){ document.getElementById(id).classList.remove(\u0027show\u0027); }\n\n    function gerarAlertas(){\n      const wrap \u003d el(\u0027alertasContainer\u0027);\n      const total \u003d filtrados.length;\n      const pend \u003d filtrados.filter(i\u003d\u003ei.status\u003d\u003d\u003d\u0027PENDENTE\u0027);\n      const atras \u003d pend.filter(i\u003d\u003ediasEntre(i.dataISO)\u003e7).length;\n\n      const aprov \u003d filtrados.filter(i\u003d\u003ei.status\u003d\u003d\u003d\u0027APROVADO\u0027).length;\n      const taxaAprov \u003d total? (aprov/total*100) : 0;\n\n      const ult3 \u003d filtrados.filter(i\u003d\u003e{\n        const d \u003d new Date(i.dataISO+\u0027T00:00:00\u0027);\n        return (new Date()-d) \u003c\u003d 3*24*60*60*1000;\n      }).length;\n\n      const list \u003d [];\n      if (atras\u003e0) list.push({tipo:\u0027warning\u0027, icone:\u0027‚ö†Ô∏è\u0027, titulo:\u0027Solicita√ß√µes em Atraso\u0027, msg:`${atras} pendentes h√° mais de 7 dias`, click:\u0027abrirAtrasos()\u0027});\n      if (taxaAprov\u003c50 \u0026\u0026 total\u003e10) list.push({tipo:\u0027error\u0027, icone:\u0027üö®\u0027, titulo:\u0027Taxa de Aprova√ß√£o Baixa\u0027, msg:`Taxa atual: ${taxaAprov.toFixed(1)}% (abaixo de 50%)`, click:\u0027abrirTaxaBaixa()\u0027});\n      if (ult3 \u003e total*0.3 \u0026\u0026 total\u003e20) list.push({tipo:\u0027info\u0027, icone:\u0027üìà\u0027, titulo:\u0027Pico de Solicita√ß√µes\u0027, msg:`${ult3} nos √∫ltimos 3 dias`});\n\n      const mapC \u003d {error:\u0027red\u0027, warning:\u0027yellow\u0027, info:\u0027blue\u0027};\n      wrap.innerHTML \u003d list.map(a\u003d\u003e`\n        \u003cdiv class\u003d\"bg-${mapC[a.tipo]}-100 border border-${mapC[a.tipo]}-400 text-${mapC[a.tipo]}-700 px-4 py-3 rounded-lg mb-2 alert-pulse ${a.click?\u0027cursor-pointer\u0027:\u0027\u0027}\" ${a.click?`onclick\u003d\"${a.click}\"`:\u0027\u0027}\u003e\n          \u003cdiv class\u003d\"flex items-center justify-between\"\u003e\n            \u003cdiv class\u003d\"flex items-center\"\u003e\n              \u003cspan class\u003d\"text-lg mr-2\"\u003e${a.icone}\u003c/span\u003e\n              \u003cdiv\u003e\u003cstrong class\u003d\"font-bold\"\u003e${a.titulo}:\u003c/strong\u003e \u003cspan\u003e${a.msg}\u003c/span\u003e\u003c/div\u003e\n            \u003c/div\u003e\n            ${a.click?\u0027\u003cbutton class\u003d\"ml-4 btn btn-primary text-xs\"\u003eVer lista\u003c/button\u003e\u0027:\u0027\u0027}\n          \u003c/div\u003e\n        \u003c/div\u003e\n      `).join(\u0027\u0027);\n    }\n\n    // \u003d\u003d\u003d\u003d\u003d Atrasos (modal + export) \u003d\u003d\u003d\u003d\u003d\n    function getAtrasos(){\n      return filtrados\n        .filter(i \u003d\u003e i.status\u003d\u003d\u003d\u0027PENDENTE\u0027 \u0026\u0026 diasEntre(i.dataISO) \u003e 7)\n        .map(i \u003d\u003e ({\n          nome: i.nome,\n          cpf: maskCPF(i.cpf),\n          unidade: i.unidade,\n          beneficio: i.beneficio,\n          data: i.dataBR,\n          dias: diasEntre(i.dataISO)\n        }))\n        .sort((a,b)\u003d\u003e b.dias - a.dias || a.nome.localeCompare(b.nome,\u0027pt-BR\u0027));\n    }\n    function abrirAtrasos(){\n      const body \u003d document.getElementById(\u0027listaAtrasosBody\u0027);\n      const rows \u003d getAtrasos();\n      body.innerHTML \u003d rows.map(r\u003d\u003e`\n        \u003ctr class\u003d\"hover:bg-gray-50\"\u003e\n          \u003ctd class\u003d\"px-3 py-2 text-sm text-gray-900\"\u003e${r.nome}\u003c/td\u003e\n          \u003ctd class\u003d\"px-3 py-2 text-sm text-gray-900\"\u003e${r.cpf}\u003c/td\u003e\n          \u003ctd class\u003d\"px-3 py-2 text-sm text-gray-900\"\u003e${r.unidade.replace(\u0027Unidade \u0027,\u0027\u0027)}\u003c/td\u003e\n          \u003ctd class\u003d\"px-3 py-2 text-sm text-gray-900\" title\u003d\"${r.beneficio}\"\u003e${r.beneficio.length\u003e36? r.beneficio.slice(0,36)+\u0027‚Ä¶\u0027 : r.beneficio}\u003c/td\u003e\n          \u003ctd class\u003d\"px-3 py-2 text-sm text-gray-900\"\u003e${r.data}\u003c/td\u003e\n          \u003ctd class\u003d\"px-3 py-2 text-sm font-semibold ${r.dias\u003e7?\u0027text-red-600\u0027:\u0027\u0027}\"\u003e${r.dias}\u003c/td\u003e\n        \u003c/tr\u003e\n      `).join(\u0027\u0027) || `\u003ctr\u003e\u003ctd class\u003d\"px-3 py-3 text-center text-sm text-gray-500\" colspan\u003d\"6\"\u003eSem pend√™ncias em atraso.\u003c/td\u003e\u003c/tr\u003e`;\n      openModal(\u0027modalAtrasos\u0027);\n    }\n    async function copiarAtrasos(){\n      const rows \u003d getAtrasos();\n      const texto \u003d rows.map(r \u003d\u003e `${r.nome} - ${r.cpf}`).join(\u0027\\n\u0027);\n      try{ await navigator.clipboard.writeText(texto); alert(\u0027Lista copiada!\u0027); }catch(_){ alert(\u0027Falha ao copiar.\u0027); }\n    }\n    function baixarAtrasosCSV(){\n      const rows \u003d getAtrasos();\n      const header \u003d [\u0027Nome\u0027,\u0027CPF\u0027,\u0027Unidade\u0027,\u0027Benef√≠cio\u0027,\u0027Data\u0027,\u0027Dias em aberto\u0027];\n      const csv \u003d [header].concat(rows.map(r\u003d\u003e[r.nome,r.cpf,r.unidade,r.beneficio,r.data,r.dias]))\n        .map(l\u003d\u003el.map(x\u003d\u003e`\"${String(x||\u0027\u0027).replace(/\"/g,\u0027\"\"\u0027)}\"`).join(\u0027,\u0027)).join(\u0027\\n\u0027);\n      const blob \u003d new Blob([csv], {type:\u0027text/csv;charset\u003dutf-8;\u0027});\n      const url \u003d URL.createObjectURL(blob);\n      const a \u003d document.createElement(\u0027a\u0027); a.href \u003d url; a.download \u003d \u0027pendentes-atraso.csv\u0027; a.click();\n      URL.revokeObjectURL(url);\n    }\n\n    // \u003d\u003d\u003d\u003d\u003d Taxa de Aprova√ß√£o Baixa (Recusados por unidade) \u003d\u003d\u003d\u003d\u003d\n    function getResumoUnidades(){\n      const map \u003d {};\n      filtrados.forEach(i\u003d\u003e{\n        const u \u003d i.unidade || \u0027‚Äî\u0027;\n        if (!map[u]) map[u] \u003d {unidade:u,total:0,aprov:0,pend:0,rec:0,ent:0};\n        const m \u003d map[u];\n        m.total++;\n        if (i.status\u003d\u003d\u003d\u0027APROVADO\u0027) m.aprov++;\n        else if (i.status\u003d\u003d\u003d\u0027PENDENTE\u0027) m.pend++;\n        else if (i.status\u003d\u003d\u003d\u0027RECUSADO\u0027) m.rec++;\n        else if (i.status\u003d\u003d\u003d\u0027ENTREGUE\u0027) m.ent++;\n      });\n      const arr \u003d Object.values(map).map(m\u003d\u003e({\n        ...m,\n        taxaAprov: m.total? (m.aprov/m.total*100) : 0,\n        taxaRec:   m.total? (m.rec/m.total*100)   : 0\n      }));\n      // Ordena por % de recusa (desc), depois por recusados absolutos\n      return arr.sort((a,b)\u003d\u003e b.taxaRec - a.taxaRec || b.rec - a.rec || a.unidade.localeCompare(b.unidade,\u0027pt-BR\u0027));\n    }\n\n    function abrirTaxaBaixa(){\n      const rows \u003d getResumoUnidades();\n      const tbody \u003d document.getElementById(\u0027listaTaxaBaixaBody\u0027);\n      tbody.innerHTML \u003d rows.map(r\u003d\u003e`\n        \u003ctr class\u003d\"hover:bg-gray-50\"\u003e\n          \u003ctd class\u003d\"px-3 py-2 text-sm text-gray-900\"\u003e${r.unidade.replace(\u0027Unidade \u0027,\u0027\u0027)}\u003c/td\u003e\n          \u003ctd class\u003d\"px-3 py-2 text-sm text-gray-900\"\u003e${r.total}\u003c/td\u003e\n          \u003ctd class\u003d\"px-3 py-2 text-sm text-green-700 font-medium\"\u003e${r.aprov}\u003c/td\u003e\n          \u003ctd class\u003d\"px-3 py-2 text-sm text-red-700 font-medium\"\u003e${r.rec}\u003c/td\u003e\n          \u003ctd class\u003d\"px-3 py-2 text-sm text-yellow-700\"\u003e${r.pend}\u003c/td\u003e\n          \u003ctd class\u003d\"px-3 py-2 text-sm text-purple-700\"\u003e${r.ent}\u003c/td\u003e\n          \u003ctd class\u003d\"px-3 py-2 text-sm font-semibold ${r.taxaAprov\u003e\u003d50?\u0027text-green-600\u0027:\u0027text-red-600\u0027}\"\u003e${r.taxaAprov.toFixed(1)}%\u003c/td\u003e\n          \u003ctd class\u003d\"px-3 py-2 text-sm font-semibold ${r.taxaRec\u003e\u003d25?\u0027text-red-600\u0027:\u0027text-gray-700\u0027}\"\u003e${r.taxaRec.toFixed(1)}%\u003c/td\u003e\n        \u003c/tr\u003e\n      `).join(\u0027\u0027) || `\u003ctr\u003e\u003ctd class\u003d\"px-3 py-3 text-center text-sm text-gray-500\" colspan\u003d\"8\"\u003eSem dados suficientes para calcular.\u003c/td\u003e\u003c/tr\u003e`;\n      openModal(\u0027modalTaxaBaixa\u0027);\n    }\n\n    async function copiarTaxaBaixa(){\n      const rows \u003d getResumoUnidades();\n      const texto \u003d rows.map(r\u003d\u003e `${r.unidade}: Recusados ${r.rec} (${r.taxaRec.toFixed(1)}%), Aprovados ${r.aprov} (${r.taxaAprov.toFixed(1)}%), Total ${r.total}`).join(\u0027\\n\u0027);\n      try{ await navigator.clipboard.writeText(texto); alert(\u0027Resumo copiado!\u0027); }catch(_){ alert(\u0027Falha ao copiar.\u0027); }\n    }\n\n    function baixarTaxaBaixaCSV(){\n      const rows \u003d getResumoUnidades();\n      const header \u003d [\u0027Unidade\u0027,\u0027Total\u0027,\u0027Aprovados\u0027,\u0027Recusados\u0027,\u0027Pendentes\u0027,\u0027Entregues\u0027,\u0027% Aprov.\u0027,\u0027% Recusa\u0027];\n      const csv \u003d [header].concat(rows.map(r\u003d\u003e[\n        r.unidade, r.total, r.aprov, r.rec, r.pend, r.ent,\n        r.taxaAprov.toFixed(1)+\u0027%\u0027, r.taxaRec.toFixed(1)+\u0027%\u0027\n      ])).map(l\u003d\u003el.map(x\u003d\u003e`\"${String(x||\u0027\u0027).replace(/\"/g,\u0027\"\"\u0027)}\"`).join(\u0027,\u0027)).join(\u0027\\n\u0027);\n      const blob \u003d new Blob([csv], {type:\u0027text/csv;charset\u003dutf-8;\u0027});\n      const url \u003d URL.createObjectURL(blob);\n      const a \u003d document.createElement(\u0027a\u0027); a.href \u003d url; a.download \u003d \u0027recusados-por-unidade.csv\u0027; a.click();\n      URL.revokeObjectURL(url);\n    }\n\n    function destroyChart(key){ if (graficos[key]) { graficos[key].destroy(); delete graficos[key]; } }\n\n    function graficoStatus(){\n      destroyChart(\u0027status\u0027);\n      const ctx \u003d document.getElementById(\u0027graficoStatus\u0027).getContext(\u00272d\u0027);\n      const labels \u003d [\u0027APROVADO\u0027,\u0027PENDENTE\u0027,\u0027RECUSADO\u0027,\u0027ENTREGUE\u0027];\n      const data \u003d labels.map(s\u003d\u003e filtrados.filter(i\u003d\u003ei.status\u003d\u003d\u003ds).length);\n      graficos.status \u003d new Chart(ctx, {\n        type:\u0027doughnut\u0027,\n        data:{ labels:[\u0027Aprovado\u0027,\u0027Pendente\u0027,\u0027Recusado\u0027,\u0027Entregue\u0027], datasets:[{ data, backgroundColor:[\u0027#10B981\u0027,\u0027#F59E0B\u0027,\u0027#EF4444\u0027,\u0027#8B5CF6\u0027], borderWidth:2, borderColor:\u0027#fff\u0027 }]},\n        options:{ responsive:true, maintainAspectRatio:false, plugins:{legend:{position:\u0027bottom\u0027}} }\n      });\n    }\n\n    function graficoUnidades(){\n      destroyChart(\u0027unidades\u0027);\n      const ctx \u003d document.getElementById(\u0027graficoUnidades\u0027).getContext(\u00272d\u0027);\n      const unidades \u003d [...new Set(filtrados.map(i\u003d\u003ei.unidade))];\n      const series \u003d unidades.map(u \u003d\u003e filtrados.filter(i\u003d\u003ei.unidade\u003d\u003d\u003du).length);\n      graficos.unidades \u003d new Chart(ctx, {\n        type:\u0027bar\u0027,\n        data:{ labels:unidades.map(u\u003d\u003eu.replace(\u0027Unidade \u0027,\u0027\u0027)), datasets:[{label:\u0027Solicita√ß√µes\u0027, data:series, backgroundColor:\u0027#8B5CF6\u0027, borderColor:\u0027#7C3AED\u0027, borderWidth:1}] },\n        options:{ responsive:true, maintainAspectRatio:false, scales:{y:{beginAtZero:true, ticks:{stepSize:1}}}, plugins:{legend:{display:false}} }\n      });\n    }\n\n    function graficoTempo(){\n      destroyChart(\u0027tempo\u0027);\n      const ctx \u003d document.getElementById(\u0027graficoTempo\u0027).getContext(\u00272d\u0027);\n      const map \u003d {};\n      filtrados.forEach(i\u003d\u003e{ const d\u003dtoBR(i.dataISO); map[d]\u003d(map[d]||0)+1; });\n      const datas \u003d Object.keys(map).sort((a,b)\u003d\u003e{\n        const [da,ma,aa]\u003da.split(\u0027/\u0027).map(Number), [db,mb,ab]\u003db.split(\u0027/\u0027).map(Number);\n        return new Date(aa,ma-1,da) - new Date(ab,mb-1,db);\n      });\n      graficos.tempo \u003d new Chart(ctx, {\n        type:\u0027line\u0027,\n        data:{ labels:datas, datasets:[{label:\u0027Solicita√ß√µes por dia\u0027, data:datas.map(d\u003d\u003emap[d]), borderColor:\u0027#8B5CF6\u0027, backgroundColor:\u0027rgba(139,92,246,.1)\u0027, tension:.35, fill:true }] },\n        options:{ responsive:true, maintainAspectRatio:false, scales:{y:{beginAtZero:true,ticks:{stepSize:1}}} }\n      });\n    }\n\n    function graficoFunil(){\n      destroyChart(\u0027funil\u0027);\n      const ctx \u003d document.getElementById(\u0027graficoFunil\u0027).getContext(\u00272d\u0027);\n      const total \u003d filtrados.length;\n      const aprovadosOuEntregues \u003d filtrados.filter(i\u003d\u003ei.status\u003d\u003d\u003d\u0027APROVADO\u0027 || i.status\u003d\u003d\u003d\u0027ENTREGUE\u0027).length;\n      const entregues \u003d filtrados.filter(i\u003d\u003ei.status\u003d\u003d\u003d\u0027ENTREGUE\u0027).length;\n      graficos.funil \u003d new Chart(ctx, {\n        type:\u0027bar\u0027,\n        data:{ labels:[\u0027Solicitadas\u0027,\u0027Aprovadas\u0027,\u0027Entregues\u0027], datasets:[{ data:[total,aprovadosOuEntregues,entregues], backgroundColor:[\u0027#3B82F6\u0027,\u0027#10B981\u0027,\u0027#8B5CF6\u0027], borderColor:[\u0027#2563EB\u0027,\u0027#059669\u0027,\u0027#7C3AED\u0027], borderWidth:1 }] },\n        options:{ responsive:true, maintainAspectRatio:false, scales:{y:{beginAtZero:true,ticks:{stepSize:1}}}, plugins:{legend:{display:false}} }\n      });\n    }\n\n    function graficoBeneficios(){\n      destroyChart(\u0027beneficios\u0027);\n      const ctx \u003d document.getElementById(\u0027graficoBeneficios\u0027).getContext(\u00272d\u0027);\n      const map \u003d {};\n      filtrados.forEach(i\u003d\u003e{ map[i.beneficio]\u003d(map[i.beneficio]||0)+1; });\n      const top \u003d Object.entries(map).sort((a,b)\u003d\u003eb[1]-a[1]).slice(0,8);\n      const labels \u003d top.map(([k])\u003d\u003e k.length\u003e22? k.slice(0,22)+\u0027‚Ä¶\u0027 : k);\n      const data   \u003d top.map(([,v])\u003d\u003ev);\n      graficos.beneficios \u003d new Chart(ctx,{\n        type:\u0027bar\u0027,\n        data:{ labels, datasets:[{data, label:\u0027Quantidade\u0027, backgroundColor:[\u0027#8B5CF6\u0027,\u0027#10B981\u0027,\u0027#F59E0B\u0027,\u0027#EF4444\u0027,\u0027#3B82F6\u0027,\u0027#F97316\u0027,\u0027#06B6D4\u0027,\u0027#84CC16\u0027], borderWidth:1}] },\n        options:{ responsive:true, maintainAspectRatio:false, indexAxis:\u0027y\u0027, scales:{x:{beginAtZero:true,ticks:{stepSize:1}}}, plugins:{legend:{display:false}} }\n      });\n    }\n\n    function atualizarTabelaResumo(){\n      const tbody \u003d el(\u0027tabelaResumo\u0027);\n      const unidades \u003d [...new Set(filtrados.map(i\u003d\u003ei.unidade))];\n      tbody.innerHTML \u003d unidades.map(u\u003d\u003e{\n        const items \u003d filtrados.filter(i\u003d\u003ei.unidade\u003d\u003d\u003du);\n        const total \u003d items.length;\n        const aprov \u003d items.filter(i\u003d\u003ei.status\u003d\u003d\u003d\u0027APROVADO\u0027).length;\n        const taxa  \u003d total? ((aprov/total)*100).toFixed(1) : 0;\n        return `\n          \u003ctr class\u003d\"hover:bg-gray-50\"\u003e\n            \u003ctd class\u003d\"px-3 py-2 text-sm font-medium text-gray-900\"\u003e${u.replace(\u0027Unidade \u0027,\u0027\u0027)}\u003c/td\u003e\n            \u003ctd class\u003d\"px-3 py-2 text-sm text-gray-900\"\u003e${total}\u003c/td\u003e\n            \u003ctd class\u003d\"px-3 py-2 text-sm font-medium ${taxa\u003e\u003d70?\u0027text-green-600\u0027:(taxa\u003e\u003d50?\u0027text-yellow-600\u0027:\u0027text-red-600\u0027)}\"\u003e${taxa}%\u003c/td\u003e\n            \u003ctd class\u003d\"px-3 py-2 text-sm text-gray-600\"\u003e‚Äî\u003c/td\u003e\n          \u003c/tr\u003e\n        `;\n      }).join(\u0027\u0027);\n    }\n\n    function atualizarTabelaBeneficios(){\n      const tbody \u003d el(\u0027tabelaBeneficios\u0027);\n      const map \u003d {};\n      filtrados.forEach(i\u003d\u003e{ map[i.beneficio]\u003d(map[i.beneficio]||0)+1; });\n      const tot \u003d filtrados.length || 1;\n      const ord \u003d Object.entries(map).sort((a,b)\u003d\u003eb[1]-a[1]);\n      tbody.innerHTML \u003d ord.map(([ben,q])\u003d\u003e{\n        const p \u003d ((q/tot)*100).toFixed(1);\n        const trend \u003d Math.random()\u003e0.5?\u0027‚ÜóÔ∏è\u0027:\u0027‚ÜòÔ∏è\u0027;\n        return `\n          \u003ctr class\u003d\"hover:bg-gray-50\"\u003e\n            \u003ctd class\u003d\"px-3 py-2 text-sm text-gray-900\" title\u003d\"${ben}\"\u003e${ben.length\u003e28? ben.slice(0,28)+\u0027‚Ä¶\u0027 : ben}\u003c/td\u003e\n            \u003ctd class\u003d\"px-3 py-2 text-sm font-medium text-purple-600\"\u003e${q}\u003c/td\u003e\n            \u003ctd class\u003d\"px-3 py-2 text-sm text-gray-600\"\u003e${p}%\u003c/td\u003e\n            \u003ctd class\u003d\"px-3 py-2 text-sm\"\u003e${trend}\u003c/td\u003e\n          \u003c/tr\u003e\n        `;\n      }).join(\u0027\u0027);\n    }\n\n    function atualizarTabelaRecentes(){\n      const tbody \u003d el(\u0027tabelaRecentes\u0027);\n      const recentes \u003d filtrados.slice().sort((a,b)\u003d\u003e (b.dataISO\u003ea.dataISO?1:-1)).slice(0,10);\n      const cls \u003d { PENDENTE:\u0027bg-yellow-100 text-yellow-800\u0027, APROVADO:\u0027bg-green-100 text-green-800\u0027, RECUSADO:\u0027bg-red-100 text-red-800\u0027, ENTREGUE:\u0027bg-purple-100 text-purple-800\u0027 };\n      tbody.innerHTML \u003d recentes.map(i\u003d\u003e{\n        const dias \u003d diasEntre(i.dataISO);\n        return `\n          \u003ctr class\u003d\"hover:bg-gray-50\"\u003e\n            \u003ctd class\u003d\"px-3 py-2 text-sm font-medium text-indigo-600 cursor-pointer hover:underline\"\n                onclick\u003d\"abrirHistorico(\u0027${(i.cpf||\u0027\u0027).replace(/\"/g,\u0027\u0026quot;\u0027)}\u0027)\"\u003e\n              ${i.nome}\n            \u003c/td\u003e\n            \u003ctd class\u003d\"px-3 py-2 text-sm text-gray-600\"\u003e${maskCPF(i.cpf)}\u003c/td\u003e\n            \u003ctd class\u003d\"px-3 py-2 text-sm text-gray-600\" title\u003d\"${i.beneficio}\"\u003e${i.beneficio.length\u003e24? i.beneficio.slice(0,24)+\u0027‚Ä¶\u0027 : i.beneficio}\u003c/td\u003e\n            \u003ctd class\u003d\"px-3 py-2 text-sm text-gray-600\"\u003e${i.unidade.replace(\u0027Unidade \u0027,\u0027\u0027)}\u003c/td\u003e\n            \u003ctd class\u003d\"px-3 py-2 text-sm text-gray-600\"\u003e${i.dataBR}\u003c/td\u003e\n            \u003ctd class\u003d\"px-3 py-2\"\u003e\u003cspan class\u003d\"px-2 py-1 text-xs font-medium rounded-full ${cls[i.status]||\u0027bg-gray-100 text-gray-800\u0027}\"\u003e${i.status.charAt(0)+i.status.slice(1).toLowerCase()}\u003c/span\u003e\u003c/td\u003e\n            \u003ctd class\u003d\"px-3 py-2 text-sm ${dias\u003e7?\u0027text-red-600 font-bold\u0027:\u0027text-gray-600\u0027}\"\u003e${dias}\u003c/td\u003e\n          \u003c/tr\u003e\n        `;\n      }).join(\u0027\u0027);\n    }\n\n    // \u003d\u003d\u003d\u003d\u003d Hist√≥rico do benefici√°rio \u003d\u003d\u003d\u003d\u003d\n    function abrirHistorico(cpf){\n      cpf \u003d String(cpf||\u0027\u0027).replace(/\\D/g,\u0027\u0027);\n      const reg \u003d registros.find(r \u003d\u003e String(r.cpf||\u0027\u0027).replace(/\\D/g,\u0027\u0027) \u003d\u003d\u003d cpf) || {};\n      const nome \u003d reg.nome || \u0027\u0027;\n      const titulo \u003d nome ? `Hist√≥rico de ${nome} (${maskCPF(cpf)})` : `Hist√≥rico (${maskCPF(cpf)})`;\n      el(\u0027tituloHistorico\u0027).textContent \u003d titulo;\n      el(\u0027conteudoHistorico\u0027).innerHTML \u003d \u0027\u003cdiv class\u003d\"text-center text-gray-500 py-4\"\u003eCarregando hist√≥rico...\u003c/div\u003e\u0027;\n      openModal(\u0027modalHistorico\u0027);\n\n      if (!(google \u0026\u0026 google.script \u0026\u0026 google.script.run)) {\n        el(\u0027conteudoHistorico\u0027).innerHTML \u003d \u0027\u003cdiv class\u003d\"text-center text-red-500 py-4\"\u003eGoogle Apps Script indispon√≠vel.\u003c/div\u003e\u0027;\n        return;\n      }\n\n      google.script.run\n        .withSuccessHandler(function(html){\n          el(\u0027conteudoHistorico\u0027).innerHTML \u003d html || \u0027\u003cdiv class\u003d\"text-center text-gray-500 py-4\"\u003eNenhum registro encontrado.\u003c/div\u003e\u0027;\n        })\n        .getHistoricoBeneficiario(cpf);\n    }\n\n    function atualizarGauge(valor){\n      const c \u003d document.getElementById(\u0027gaugeCanvas\u0027);\n      const ctx \u003d c.getContext(\u00272d\u0027);\n      ctx.clearRect(0,0,c.width,c.height);\n      const cx\u003dc.width/2, cy\u003dc.height-10, r\u003d80;\n      ctx.beginPath(); ctx.arc(cx,cy,r,Math.PI,0); ctx.lineWidth\u003d15; ctx.strokeStyle\u003d\u0027#e5e7eb\u0027; ctx.stroke();\n      const ang \u003d Math.PI*(valor/100);\n      ctx.beginPath(); ctx.arc(cx,cy,r,Math.PI,Math.PI+ang); ctx.lineWidth\u003d15;\n      ctx.strokeStyle \u003d valor\u003e\u003d70? \u0027#10b981\u0027 : (valor\u003e\u003d50? \u0027#f59e0b\u0027 : \u0027#ef4444\u0027); ctx.stroke();\n      ctx.fillStyle\u003d\u0027#374151\u0027; ctx.font\u003d\u0027bold 24px Arial\u0027; ctx.textAlign\u003d\u0027center\u0027; ctx.fillText(`${valor}%`, cx, cy-10);\n    }\n\n    function atualizarGraficos(){\n      graficoStatus(); graficoUnidades(); graficoTempo(); graficoFunil(); graficoBeneficios();\n    }\n\n    function atualizarDashboard(){\n      atualizarMetricas();\n      calcularTendencias();\n      gerarAlertas();\n      atualizarGraficos();\n      atualizarTabelaResumo();\n      atualizarTabelaBeneficios();\n      atualizarTabelaRecentes();\n    }\n\n    function exportarPDF(){\n      const { jsPDF } \u003d window.jspdf;\n      const doc \u003d new jsPDF();\n      doc.setFontSize(18); doc.text(\u0027Relat√≥rio do Dashboard\u0027, 14, 18);\n      doc.setFontSize(11); doc.text(`Gerado em: ${new Date().toLocaleString(\u0027pt-BR\u0027)}`, 14, 26);\n\n      const total \u003d filtrados.length;\n      const aprov \u003d filtrados.filter(i\u003d\u003ei.status\u003d\u003d\u003d\u0027APROVADO\u0027).length;\n      const pend  \u003d filtrados.filter(i\u003d\u003ei.status\u003d\u003d\u003d\u0027PENDENTE\u0027).length;\n      const rec   \u003d filtrados.filter(i\u003d\u003ei.status\u003d\u003d\u003d\u0027RECUSADO\u0027).length;\n      const entr  \u003d filtrados.filter(i\u003d\u003ei.status\u003d\u003d\u003d\u0027ENTREGUE\u0027).length;\n      const eficiencia \u003d total? (((aprov+entr)/total)*100).toFixed(1) : 0;\n\n      let y\u003d40;\n      doc.setFontSize(13); doc.text(\u0027Resumo Executivo\u0027, 14, y); y+\u003d8;\n      doc.setFontSize(11);\n      const linhas \u003d [\n        `‚Ä¢ Total de Solicita√ß√µes: ${total}`,\n        `‚Ä¢ Aprovados: ${aprov} (${total?((aprov/total)*100).toFixed(1):\u00270\u0027}%)`,\n        `‚Ä¢ Pendentes: ${pend} (${total?((pend/total)*100).toFixed(1):\u00270\u0027}%)`,\n        `‚Ä¢ Recusados: ${rec} (${total?((rec/total)*100).toFixed(1):\u00270\u0027}%)`,\n        `‚Ä¢ Entregues: ${entr} (${total?((entr/total)*100).toFixed(1):\u00270\u0027}%)`,\n        `‚Ä¢ Efici√™ncia Geral: ${eficiencia}%`\n      ];\n      linhas.forEach(t\u003d\u003e{ doc.text(t, 16, y); y+\u003d8; });\n      doc.save(\u0027dashboard-relatorio.pdf\u0027);\n    }\n\n    // \u003d\u003d\u003d\u003d\u003d Init \u003d\u003d\u003d\u003d\u003d\n    window.onload \u003d function(){\n      popularUnidades();\n      aplicarFiltros();\n    };\n  \u003c/script\u003e\n\n  \u003cscript\u003e\n    // Bot√£o SAIR ‚Üí volta para o login\n    (function () {\n      var btn \u003d document.getElementById(\u0027btnSair\u0027);\n      if (!btn) return;\n      btn.addEventListener(\u0027click\u0027, function (e) {\n        e.preventDefault();\n        if (google \u0026\u0026 google.script \u0026\u0026 google.script.run) {\n          google.script.run\n            .withSuccessHandler(function (html) {\n              document.open(); document.write(html); document.close();\n            })\n            .renderView(\u0027login\u0027, {});\n        } else {\n          var qs \u003d new URLSearchParams(location.search);\n          qs.set(\u0027view\u0027, \u0027login\u0027);\n          location.href \u003d \u0027?\u0027 + qs.toString();\n        }\n      });\n    })();\n  \u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},{"id":"c013b84d-1137-4dfe-bfb4-ce0814feb529","name":"central","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml lang\u003d\"pt-BR\"\u003e\n\u003chead\u003e\n  \u003cbase target\u003d\"_top\"\u003e\n  \u003cmeta charset\u003d\"UTF-8\" /\u003e\n  \u003cmeta name\u003d\"viewport\" content\u003d\"width\u003ddevice-width,initial-scale\u003d1\" /\u003e\n  \u003ctitle\u003eCentral de Aprova√ß√£o de Benef√≠cios\u003c/title\u003e\n\n  \u003cscript src\u003d\"https://cdn.tailwindcss.com\"\u003e\u003c/script\u003e\n\n  \u003cstyle\u003e\n    html, body { height: 100%; }\n    [x-cloak]{ display:none !important; }\n\n    .card{ background:#fff; border:1px solid rgba(2,6,23,.06); border-radius:16px; box-shadow:0 10px 30px rgba(2,6,23,.06); }\n    .btn{ display:inline-flex; align-items:center; gap:.5rem; padding:.5rem .9rem; border-radius:.8rem; border:1px solid rgba(2,6,23,.08); background:#fff; }\n    .btn:hover{ background:#f8fafc; }\n    .btn-primary{ background:#0ea5e9; color:#fff; border-color:#0ea5e9; }\n    .btn-primary:hover{ filter:brightness(.95); }\n    .btn-muted{ background:#111827; color:#fff; border-color:#111827; }\n    .btn-muted:hover{ filter:brightness(.95); }\n\n    .chip{ border:1px solid transparent }\n    .chip.active{ box-shadow:0 0 0 2px rgba(59,130,246,.2) inset; border-color:#3b82f6 }\n\n    .toast-wrap{ position:fixed; top:16px; right:16px; z-index:9999; display:flex; flex-direction:column; gap:10px; }\n    .toast{ min-width:280px; max-width:360px; padding:12px 14px; border-radius:12px; box-shadow:0 10px 25px rgba(0,0,0,.12);\n      display:flex; align-items:flex-start; gap:10px; color:#0f172a; background:#fff; border-left:6px solid; animation:slideIn .25s ease-out; }\n    .toast.success{ border-color:#10b981 } .toast.error{ border-color:#ef4444 }\n    .toast .title{ font-weight:700; font-size:14px } .toast .msg{ font-size:13px; color:#334155 }\n    @keyframes slideIn{ from{ transform:translateY(-10px); opacity:0 } to{ transform:translateY(0); opacity:1 } }\n\n    .table{ width:100%; border-collapse:separate; border-spacing:0 6px; }\n    .table thead th{ font-weight:600; font-size:.8rem; color:#334155; padding:8px 10px; }\n    .table tbody td{ background:#fff; padding:10px 12px; font-size:.9rem; color:#0f172a; }\n    .table tbody tr td:first-child{ border-top-left-radius:10px; border-bottom-left-radius:10px; }\n    .table tbody tr td:last-child{ border-top-right-radius:10px; border-bottom-right-radius:10px; }\n\n    .badge{ display:inline-flex; align-items:center; gap:.35rem; padding:.2rem .55rem; border-radius:.6rem; font-size:.75rem; font-weight:600; }\n    .badge-pendente{ background:#fef3c7; color:#92400e; }\n    .badge-aprovado{ background:#dcfce7; color:#166534; }\n    .badge-recusado{ background:#fee2e2; color:#991b1b; }\n    .badge-entregue{ background:#e0f2fe; color:#075985; }\n    .badge-default{ background:#f1f5f9; color:#334155; }\n\n    .btn-loading{ position:relative; pointer-events:none; opacity:.85 }\n    .btn-loading::after{ content:\"\"; position:absolute; right:10px; top:50%; width:14px; height:14px; margin-top:-7px;\n      border:2px solid rgba(255,255,255,.7); border-top-color:transparent; border-radius:50%; animation:spin .7s linear infinite; }\n    @keyframes spin{ to{ transform:rotate(360deg) } }\n\n    /* Drawer */\n    .scrim{ position:fixed; inset:0; background:rgba(15,23,42,.35); z-index:9998; opacity:0; pointer-events:none; transition:.2s; }\n    .scrim.show{ opacity:1; pointer-events:auto; }\n    .drawer{ position:fixed; top:0; right:-760px; width:760px; max-width:100%; height:100%; background:#fff; z-index:9999;\n      box-shadow:-10px 0 30px rgba(2,6,23,.15); transition:right .25s ease; display:flex; flex-direction:column; }\n    .drawer.show{ right:0; }\n    .kv{ display:grid; grid-template-columns: 220px 1fr; gap:.35rem .75rem; }\n    .kv .k{ color:#475569; font-size:.85rem; }\n    .kv .v{ color:#0f172a; font-weight:600; font-size:.95rem; word-break:break-word; }\n    .pill{ display:inline-flex; align-items:center; gap:.4rem; background:#f1f5f9; border:1px solid #e5e7eb; padding:.25rem .55rem; border-radius:9999px; font-size:.75rem; }\n    .link{ color:#2563eb; text-decoration:underline; }\n\n    /* Imagem da assinatura digital no drawer */\n    .sig-img{\n      max-height:80px;\n      border-radius:0.5rem;\n      border:1px dashed #cbd5e1;\n      padding:4px;\n      background:#f8fafc;\n    }\n  \u003c/style\u003e\n\u003c/head\u003e\n\u003cbody class\u003d\"bg-gradient-to-br from-blue-50 via-indigo-50 to-sky-100 min-h-screen\"\u003e\n\n  \u003c!-- TOP --\u003e\n  \u003cheader class\u003d\"sticky top-0 z-50 bg-white/90 backdrop-blur shadow-sm\"\u003e\n    \u003cdiv class\u003d\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8 py-3 flex items-center justify-end\"\u003e\n      \u003cbutton id\u003d\"btnSair\" class\u003d\"btn-muted text-sm\"\u003eSair\u003c/button\u003e\n    \u003c/div\u003e\n  \u003c/header\u003e\n\n  \u003cdiv id\u003d\"toastWrap\" class\u003d\"toast-wrap\"\u003e\u003c/div\u003e\n\n  \u003cdiv class\u003d\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8 py-6\"\u003e\n\n    \u003cdiv class\u003d\"card p-5 mb-6\"\u003e\n      \u003ch1 class\u003d\"text-2xl md:text-3xl font-bold text-gray-800\"\u003eüìå Central de Aprova√ß√£o de Benef√≠cios\u003c/h1\u003e\n      \u003cp class\u003d\"text-gray-600 text-sm md:text-base mt-1\"\u003eClique em \u003cb\u003eüëÅÔ∏è Ver\u003c/b\u003e para abrir os \u003cb\u003edetalhes completos\u003c/b\u003e do cadastro. A√ß√µes r√°pidas continuam nos bot√µes.\u003c/p\u003e\n    \u003c/div\u003e\n\n    \u003c!-- Filtros --\u003e\n    \u003cdiv class\u003d\"card p-5 mb-6\"\u003e\n      \u003ch2 class\u003d\"text-lg font-semibold text-gray-800 mb-3\"\u003eFiltros\u003c/h2\u003e\n      \u003cdiv class\u003d\"grid grid-cols-1 md:grid-cols-7 gap-3\"\u003e\n        \u003cdiv class\u003d\"md:col-span-2\"\u003e\n          \u003clabel class\u003d\"block text-xs font-medium text-gray-700 mb-1\"\u003eCPF\u003c/label\u003e\n          \u003cinput type\u003d\"text\" id\u003d\"cpfBusca\" placeholder\u003d\"000.000.000-00\" class\u003d\"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\u003e\n        \u003c/div\u003e\n        \u003cdiv\u003e\n          \u003clabel class\u003d\"block text-xs font-medium text-gray-700 mb-1\"\u003eData Inicial\u003c/label\u003e\n          \u003cinput type\u003d\"date\" id\u003d\"dataInicio\" class\u003d\"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\u003e\n        \u003c/div\u003e\n        \u003cdiv\u003e\n          \u003clabel class\u003d\"block text-xs font-medium text-gray-700 mb-1\"\u003eData Final\u003c/label\u003e\n          \u003cinput type\u003d\"date\" id\u003d\"dataFim\" class\u003d\"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\u003e\n        \u003c/div\u003e\n        \u003cdiv class\u003d\"md:col-span-2\"\u003e\n          \u003clabel class\u003d\"block text-xs font-medium text-gray-700 mb-1\"\u003eBenef√≠cio\u003c/label\u003e\n          \u003cselect id\u003d\"beneficioFiltro\" class\u003d\"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\u003e\n            \u003coption value\u003d\"\"\u003eTodos\u003c/option\u003e\n          \u003c/select\u003e\n        \u003c/div\u003e\n        \u003cdiv\u003e\n          \u003clabel class\u003d\"block text-xs font-medium text-gray-700 mb-1\"\u003eUnidade\u003c/label\u003e\n          \u003cselect id\u003d\"unidadeFiltro\" class\u003d\"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\u003e\n            \u003coption value\u003d\"\"\u003eTodas\u003c/option\u003e\n          \u003c/select\u003e\n        \u003c/div\u003e\n        \u003cdiv class\u003d\"flex items-end gap-2\"\u003e\n          \u003cbutton id\u003d\"btnBuscar\" class\u003d\"w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 text-sm rounded-md font-medium\"\u003eüîé Buscar\u003c/button\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003cdiv class\u003d\"mt-4 flex flex-wrap items-center gap-2\"\u003e\n        \u003cspan class\u003d\"text-xs font-medium text-gray-600 mr-2\"\u003eStatus:\u003c/span\u003e\n        \u003cbutton class\u003d\"chip px-3 py-1 rounded-full text-xs bg-gray-100 hover:bg-gray-200\" data-status\u003d\"\"          onclick\u003d\"setStatusFiltro(this,\u0027\u0027)\"\u003eTodos\u003c/button\u003e\n        \u003cbutton class\u003d\"chip px-3 py-1 rounded-full text-xs text-green-800 bg-green-100 hover:bg-green-200\"   data-status\u003d\"APROVADO\" onclick\u003d\"setStatusFiltro(this,\u0027APROVADO\u0027)\"\u003eAprovado\u003c/button\u003e\n        \u003cbutton class\u003d\"chip px-3 py-1 rounded-full text-xs text-yellow-800 bg-yellow-100 hover:bg-yellow-200\" data-status\u003d\"PENDENTE\" onclick\u003d\"setStatusFiltro(this,\u0027PENDENTE\u0027)\"\u003ePendente\u003c/button\u003e\n        \u003cbutton class\u003d\"chip px-3 py-1 rounded-full text-xs text-red-800 bg-red-100 hover:bg-red-200\"          data-status\u003d\"RECUSADO\" onclick\u003d\"setStatusFiltro(this,\u0027RECUSADO\u0027)\"\u003eRecusado\u003c/button\u003e\n        \u003cbutton class\u003d\"chip px-3 py-1 rounded-full text-xs text-blue-800 bg-blue-100 hover:bg-blue-200\"       data-status\u003d\"ENTREGUE\" onclick\u003d\"setStatusFiltro(this,\u0027ENTREGUE\u0027)\"\u003eEntregue\u003c/button\u003e\n\n        \u003cdiv class\u003d\"ml-auto flex items-center gap-2\"\u003e\n          \u003clabel for\u003d\"ordenarPor\" class\u003d\"text-xs text-gray-600\"\u003eOrdenar por:\u003c/label\u003e\n          \u003cselect id\u003d\"ordenarPor\" class\u003d\"px-3 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\u003e\n            \u003coption value\u003d\"data_desc\"\u003eData (novo ‚Üí antigo)\u003c/option\u003e\n            \u003coption value\u003d\"data_asc\"\u003eData (antigo ‚Üí novo)\u003c/option\u003e\n            \u003coption value\u003d\"nome_asc\"\u003eNome (A ‚Üí Z)\u003c/option\u003e\n            \u003coption value\u003d\"nome_desc\"\u003eNome (Z ‚Üí A)\u003c/option\u003e\n          \u003c/select\u003e\n\n          \u003cbutton onclick\u003d\"aplicarFiltrosFront()\" class\u003d\"bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1.5 rounded-md text-xs font-medium\"\u003eAplicar\u003c/button\u003e\n          \u003cbutton onclick\u003d\"limparFiltrosFront()\" class\u003d\"bg-gray-500 hover:bg-gray-600 text-white px-3 py-1.5 rounded-md text-xs font-medium\"\u003eLimpar\u003c/button\u003e\n          \u003cbutton onclick\u003d\"mostrarTodos()\" class\u003d\"bg-gray-700 hover:bg-gray-800 text-white px-3 py-1.5 rounded-md text-xs font-medium\"\u003eüìã Mostrar Todos\u003c/button\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003cdiv id\u003d\"loading\" class\u003d\"hidden mt-3 text-blue-700 font-semibold text-sm\"\u003eüîÑ Carregando registros...\u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003c!-- Totais --\u003e\n    \u003cdiv class\u003d\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-5\"\u003e\n      \u003cdiv class\u003d\"card p-4\"\u003e\u003cdiv class\u003d\"flex items-center\"\u003e\n        \u003cdiv class\u003d\"bg-blue-100 p-2 rounded-full\"\u003e\u003csvg class\u003d\"w-5 h-5 text-blue-600\" fill\u003d\"none\" stroke\u003d\"currentColor\" viewBox\u003d\"0 0 24 24\"\u003e\u003cpath stroke-linecap\u003d\"round\" stroke-linejoin\u003d\"round\" stroke-width\u003d\"2\" d\u003d\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"/\u003e\u003c/svg\u003e\u003c/div\u003e\n        \u003cdiv class\u003d\"ml-3\"\u003e\u003cp class\u003d\"text-xs font-medium text-gray-600\"\u003eTotal\u003c/p\u003e\u003cp id\u003d\"totalCount\" class\u003d\"text-2xl font-bold text-gray-900\"\u003e0\u003c/p\u003e\u003c/div\u003e\n      \u003c/div\u003e\u003c/div\u003e\n      \u003cdiv class\u003d\"card p-4\"\u003e\u003cdiv class\u003d\"flex items-center\"\u003e\n        \u003cdiv class\u003d\"bg-green-100 p-2 rounded-full\"\u003e\u003csvg class\u003d\"w-5 h-5 text-green-600\" fill\u003d\"none\" stroke\u003d\"currentColor\" viewBox\u003d\"0 0 24 24\"\u003e\u003cpath stroke-linecap\u003d\"round\" stroke-linejoin\u003d\"round\" stroke-width\u003d\"2\" d\u003d\"M5 13l4 4L19 7\"/\u003e\u003c/svg\u003e\u003c/div\u003e\n        \u003cdiv class\u003d\"ml-3\"\u003e\u003cp class\u003d\"text-xs font-medium text-gray-600\"\u003eAprovados\u003c/p\u003e\u003cp id\u003d\"aprovadasCount\" class\u003d\"text-2xl font-bold text-green-600\"\u003e0\u003c/p\u003e\u003c/div\u003e\n      \u003c/div\u003e\u003c/div\u003e\n      \u003cdiv class\u003d\"card p-4\"\u003e\u003cdiv class\u003d\"flex items-center\"\u003e\n        \u003cdiv class\u003d\"bg-yellow-100 p-2 rounded-full\"\u003e\u003csvg class\u003d\"w-5 h-5 text-yellow-600\" fill\u003d\"none\" stroke\u003d\"currentColor\" viewBox\u003d\"0 0 24 24\"\u003e\u003cpath stroke-linecap\u003d\"round\" stroke-linejoin\u003d\"round\" stroke-width\u003d\"2\" d\u003d\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"/\u003e\u003c/svg\u003e\u003c/div\u003e\n        \u003cdiv class\u003d\"ml-3\"\u003e\u003cp class\u003d\"text-xs font-medium text-gray-600\"\u003ePendentes\u003c/p\u003e\u003cp id\u003d\"pendentesCount\" class\u003d\"text-2xl font-bold text-yellow-600\"\u003e0\u003c/p\u003e\u003c/div\u003e\n      \u003c/div\u003e\u003c/div\u003e\n      \u003cdiv class\u003d\"card p-4\"\u003e\u003cdiv class\u003d\"flex items-center\"\u003e\n        \u003cdiv class\u003d\"bg-red-100 p-2 rounded-full\"\u003e\u003csvg class\u003d\"w-5 h-5 text-red-600\" fill\u003d\"none\" stroke\u003d\"currentColor\" viewBox\u003d\"0 0 24 24\"\u003e\u003cpath stroke-linecap\u003d\"round\" stroke-linejoin\u003d\"round\" stroke-width\u003d\"2\" d\u003d\"M6 18L18 6M6 6l12 12\"/\u003e\u003c/svg\u003e\u003c/div\u003e\n        \u003cdiv class\u003d\"ml-3\"\u003e\u003cp class\u003d\"text-xs font-medium text-gray-600\"\u003eRecusados\u003c/p\u003e\u003cp id\u003d\"recusadasCount\" class\u003d\"text-2xl font-bold text-red-600\"\u003e0\u003c/p\u003e\u003c/div\u003e\n      \u003c/div\u003e\u003c/div\u003e\n    \u003c/div\u003e\n    \u003cdiv class\u003d\"flex items-center justify-end mb-6\"\u003e\n      \u003cbutton class\u003d\"btn\" onclick\u003d\"copiarTotais()\"\u003eCopiar Totais\u003c/button\u003e\n    \u003c/div\u003e\n\n    \u003c!-- Tabela --\u003e\n    \u003cdiv class\u003d\"card overflow-hidden\"\u003e\n      \u003cdiv class\u003d\"px-4 py-3 border-b border-gray-200 flex items-center justify-between\"\u003e\n        \u003ch2 class\u003d\"text-lg font-semibold text-gray-800\"\u003eSolicita√ß√µes\u003c/h2\u003e\n        \u003cdiv class\u003d\"flex items-center gap-2\"\u003e\n          \u003cspan id\u003d\"lastUpdated\" class\u003d\"text-xs text-gray-500\"\u003e\u003c/span\u003e\n          \u003cbutton class\u003d\"btn\" onclick\u003d\"copiarTabela()\"\u003eCopiar CSV\u003c/button\u003e\n          \u003cbutton class\u003d\"btn\" onclick\u003d\"baixarCSV()\"\u003eBaixar CSV\u003c/button\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n      \u003cdiv class\u003d\"overflow-x-auto\"\u003e\n        \u003ctable class\u003d\"min-w-full divide-y divide-gray-200 table\"\u003e\n          \u003cthead class\u003d\"bg-gray-50\"\u003e\u003ctr\u003e\n            \u003cth class\u003d\"text-left\"\u003eData\u003c/th\u003e\n            \u003cth class\u003d\"text-left\"\u003eUnidade\u003c/th\u003e\n            \u003cth class\u003d\"text-left\"\u003eNome\u003c/th\u003e\n            \u003cth class\u003d\"text-left\"\u003eCPF\u003c/th\u003e\n            \u003cth class\u003d\"text-left\"\u003eDemanda\u003c/th\u003e\n            \u003cth class\u003d\"text-left\"\u003eStatus\u003c/th\u003e\n            \u003cth class\u003d\"text-left\"\u003eA√ß√µes\u003c/th\u003e\n          \u003c/tr\u003e\u003c/thead\u003e\n          \u003ctbody id\u003d\"tbody\" class\u003d\"bg-white divide-y divide-gray-200\"\u003e\u003c/tbody\u003e\n        \u003c/table\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\n  \u003c!-- Drawer de Detalhes --\u003e\n  \u003cdiv id\u003d\"scrim\" class\u003d\"scrim\" onclick\u003d\"fecharDetalhes()\"\u003e\u003c/div\u003e\n  \u003caside id\u003d\"drawer\" class\u003d\"drawer\" aria-modal\u003d\"true\" role\u003d\"dialog\"\u003e\n    \u003cdiv class\u003d\"p-4 border-b border-gray-200 flex items-center justify-between\"\u003e\n      \u003cdiv\u003e\n        \u003ch3 class\u003d\"text-xl font-bold text-gray-900\" id\u003d\"detTitulo\"\u003eDetalhes\u003c/h3\u003e\n        \u003cp class\u003d\"text-xs text-gray-500\" id\u003d\"detSub\"\u003e‚Äî\u003c/p\u003e\n      \u003c/div\u003e\n      \u003cdiv class\u003d\"flex items-center gap-2\"\u003e\n        \u003cbutton id\u003d\"btnDetBaixar\" class\u003d\"btn\"\u003eüìÑ Baixar PDF\u003c/button\u003e\n        \u003cbutton class\u003d\"btn\" onclick\u003d\"copiarDetalhes()\"\u003eCopiar\u003c/button\u003e\n        \u003cbutton class\u003d\"btn-muted\" onclick\u003d\"fecharDetalhes()\"\u003eFechar\u003c/button\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cdiv id\u003d\"detLoading\" class\u003d\"px-4 py-6 hidden\"\u003e\n      \u003cdiv class\u003d\"pill\"\u003eCarregando‚Ä¶\u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cdiv id\u003d\"detWrap\" class\u003d\"p-4 overflow-y-auto\"\u003e\n      \u003cdiv class\u003d\"mb-4 flex flex-wrap items-center gap-2\" id\u003d\"detChips\"\u003e\u003c/div\u003e\n      \u003cdiv id\u003d\"detGrid\" class\u003d\"kv\"\u003e\u003c/div\u003e\n\n      \u003cdiv class\u003d\"border-t border-gray-200 mt-6 pt-4\"\u003e\n        \u003cdiv class\u003d\"flex flex-wrap gap-2\"\u003e\n          \u003cbutton class\u003d\"bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded text-xs font-semibold\"  id\u003d\"detBtnAprovar\"\u003eAprovar\u003c/button\u003e\n          \u003cbutton class\u003d\"bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded text-xs font-semibold\"   id\u003d\"detBtnEntregar\"\u003eEntregue\u003c/button\u003e\n          \u003cbutton class\u003d\"bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded text-xs font-semibold\" id\u003d\"detBtnPendente\"\u003ePendente\u003c/button\u003e\n          \u003cbutton class\u003d\"bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded text-xs font-semibold\"      id\u003d\"detBtnRecusar\"\u003eRecusar\u003c/button\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  \u003c/aside\u003e\n\n  \u003cscript\u003e\n    const SAFE_GOOGLE \u003d (typeof google !\u003d\u003d \u0027undefined\u0027) \u0026\u0026 google.script \u0026\u0026 google.script.run;\n\n    (function(){\n      const btn \u003d document.getElementById(\u0027btnSair\u0027);\n      if (!btn) return;\n      btn.addEventListener(\u0027click\u0027, function(e){\n        e.preventDefault();\n        if (SAFE_GOOGLE){\n          google.script.run\n            .withSuccessHandler(html \u003d\u003e { document.open(); document.write(html); document.close(); })\n            .renderView(\u0027login\u0027);\n        } else {\n          const qs \u003d new URLSearchParams(location.search);\n          qs.set(\u0027view\u0027,\u0027login\u0027); location.href \u003d \u0027?\u0027 + qs.toString();\n        }\n      });\n    })();\n\n    let cacheRegistros \u003d [], viewRegistros \u003d [];\n    const filtros \u003d { unidade:\u0027\u0027, status:\u0027\u0027, ordenar:\u0027data_desc\u0027, beneficio:\u0027\u0027 };\n\n    function showToast(type, title, msg){\n      const wrap \u003d document.getElementById(\u0027toastWrap\u0027);\n      const div \u003d document.createElement(\u0027div\u0027);\n      div.className \u003d `toast ${type}`;\n      div.innerHTML \u003d `\u003cdiv\u003e\u003cdiv class\u003d\"title\"\u003e${title||\u0027\u0027}\u003c/div\u003e\u003cdiv class\u003d\"msg\"\u003e${msg||\u0027\u0027}\u003c/div\u003e\u003c/div\u003e`;\n      wrap.appendChild(div);\n      setTimeout(()\u003d\u003e div.remove(), 4000);\n    }\n    function setLastUpdated(){ document.getElementById(\"lastUpdated\").textContent \u003d \"Atualizado em \" + new Date().toLocaleString(\"pt-BR\"); }\n\n    function badgeStatus(statusRaw) {\n      const s \u003d (statusRaw || \"\").toString().trim().toUpperCase();\n      const map \u003d {APROVADO:\u0027badge-aprovado\u0027,PENDENTE:\u0027badge-pendente\u0027,RECUSADO:\u0027badge-recusado\u0027,ENTREGUE:\u0027badge-entregue\u0027};\n      const cls \u003d map[s] || \u0027badge-default\u0027;\n      const label \u003d s ? (s.charAt(0) + s.slice(1).toLowerCase()) : \u0027‚Äî\u0027;\n      return `\u003cspan class\u003d\"badge ${cls}\"\u003e${label}\u003c/span\u003e`;\n    }\n    function fmtData(d){\n      if(!d) return \"\";\n      if(/^\\d{4}-\\d{2}-\\d{2}$/.test(d)) return new Date(d+\"T00:00:00\").toLocaleDateString(\"pt-BR\");\n      if(/^\\d{2}\\/\\d{2}\\/\\d{4}$/.test(d)) return d;\n      const nd\u003dnew Date(d); return isNaN(nd)? (d||\"\"): nd.toLocaleDateString(\"pt-BR\");\n    }\n    function fmtCPF(c){\n      if(!c) return \"\";\n      const d\u003dc.toString().replace(/\\D/g,\"\");\n      return d.length\u003d\u003d\u003d11 ? d.replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/,\"$1.$2.$3-$4\") : c;\n    }\n\n    function parseDataSort(v){\n      if (!v) return 0;\n      const m \u003d String(v).match(/^(\\d{2})\\/(\\d{2})\\/(\\d{4})$/);\n      if (m) return new Date(+m[3], +m[2]-1, +m[1]).getTime();\n      const d \u003d new Date(v); return isNaN(d)? 0 : d.getTime();\n    }\n\n    function renderTabela(regs){\n      const tbody \u003d document.getElementById(\"tbody\");\n      tbody.innerHTML \u003d \"\";\n      if (regs.length \u003d\u003d\u003d 0) {\n        tbody.innerHTML \u003d `\u003ctr\u003e\u003ctd class\u003d\"px-3 py-3 text-center text-sm text-gray-500\" colspan\u003d\"7\"\u003eNenhum registro encontrado\u003c/td\u003e\u003c/tr\u003e`;\n        atualizarEstatisticas([]); setLastUpdated(); return;\n      }\n      regs.forEach(reg\u003d\u003e{\n        const tr \u003d document.createElement(\u0027tr\u0027);\n        tr.className \u003d \"hover:bg-gray-50\";\n        tr.innerHTML \u003d `\n          \u003ctd class\u003d\"px-3 py-2 whitespace-nowrap text-xs text-gray-900\"\u003e${fmtData(reg.data)}\u003c/td\u003e\n          \u003ctd class\u003d\"px-3 py-2 whitespace-nowrap text-xs text-gray-900\"\u003e${reg.unidade||\"\"}\u003c/td\u003e\n          \u003ctd class\u003d\"px-3 py-2 whitespace-nowrap text-xs text-blue-700 underline cursor-pointer\" onclick\u003d\"abrirDetalhes(${reg.linha})\"\u003e${reg.nome||\"\"}\u003c/td\u003e\n          \u003ctd class\u003d\"px-3 py-2 whitespace-nowrap text-xs text-gray-900\"\u003e${fmtCPF(reg.cpf||\"\")}\u003c/td\u003e\n          \u003ctd class\u003d\"px-3 py-2 whitespace-nowrap text-xs text-gray-900\"\u003e${reg.demanda||\"\"}\u003c/td\u003e\n          \u003ctd class\u003d\"px-3 py-2 whitespace-nowrap\"\u003e${badgeStatus(reg.status)}\u003c/td\u003e\n          \u003ctd class\u003d\"px-3 py-2 whitespace-nowrap text-xs\"\u003e\n            \u003cdiv class\u003d\"flex flex-wrap gap-2\"\u003e\n              \u003cbutton class\u003d\"px-2 py-1 rounded text-xs font-medium bg-slate-100\" onclick\u003d\"abrirDetalhes(${reg.linha})\"\u003eüëÅÔ∏è Ver\u003c/button\u003e\n              \u003cbutton class\u003d\"bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded text-xs font-medium\"  onclick\u003d\"atualizar(this, ${reg.linha}, \u0027APROVADO\u0027)\"\u003eAprovar\u003c/button\u003e\n              \u003cbutton class\u003d\"bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded text-xs font-medium\"   onclick\u003d\"atualizar(this, ${reg.linha}, \u0027ENTREGUE\u0027)\"\u003eEntregue\u003c/button\u003e\n              \u003cbutton class\u003d\"bg-yellow-500 hover:bg-yellow-600 text-white px-2 py-1 rounded text-xs font-medium\"onclick\u003d\"atualizar(this, ${reg.linha}, \u0027PENDENTE\u0027)\"\u003ePendente\u003c/button\u003e\n              \u003cbutton class\u003d\"bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-xs font-medium\"    onclick\u003d\"atualizar(this, ${reg.linha}, \u0027RECUSADO\u0027)\"\u003eRecusar\u003c/button\u003e\n              \u003cbutton class\u003d\"bg-purple-600 hover:bg-purple-700 text-white px-2 py-1 rounded text-xs font-medium\" onclick\u003d\"baixarPDFLinha(this, ${reg.linha})\"\u003eüìÑ Baixar\u003c/button\u003e\n            \u003c/div\u003e\n          \u003c/td\u003e`;\n        tbody.appendChild(tr);\n      });\n      atualizarEstatisticas(regs);\n      setLastUpdated();\n    }\n\n    function atualizarEstatisticas(regs){\n      const arr \u003d regs || [];\n      const total \u003d arr.length;\n      const ap \u003d arr.filter(r \u003d\u003e (r.status||\u0027\u0027).toUpperCase()\u003d\u003d\u003d\u0027APROVADO\u0027).length;\n      const pe \u003d arr.filter(r \u003d\u003e (r.status||\u0027\u0027).toUpperCase()\u003d\u003d\u003d\u0027PENDENTE\u0027).length;\n      const re \u003d arr.filter(r \u003d\u003e (r.status||\u0027\u0027).toUpperCase()\u003d\u003d\u003d\u0027RECUSADO\u0027).length;\n      document.getElementById(\u0027totalCount\u0027).textContent \u003d total;\n      document.getElementById(\u0027aprovadasCount\u0027).textContent \u003d ap;\n      document.getElementById(\u0027pendentesCount\u0027).textContent \u003d pe;\n      document.getElementById(\u0027recusadasCount\u0027).textContent \u003d re;\n    }\n\n    function setStatusFiltro(btn, status){\n      filtros.status \u003d (status||\u0027\u0027).toUpperCase();\n      document.querySelectorAll(\u0027[data-status]\u0027).forEach(el\u003d\u003e{\n        el.classList.toggle(\u0027active\u0027, (el.getAttribute(\u0027data-status\u0027)||\u0027\u0027)\u003d\u003d\u003dfiltros.status);\n      });\n      aplicarFiltrosFront();\n    }\n\n    function ordenarLista(list){\n      const modo \u003d filtros.ordenar || \u0027data_desc\u0027;\n      const byNome \u003d (a,b) \u003d\u003e a.nome.localeCompare(b.nome, \u0027pt-BR\u0027, {sensitivity:\u0027base\u0027});\n      const byData \u003d (a,b) \u003d\u003e parseDataSort(a.data) - parseDataSort(b.data);\n      let arr \u003d list.slice();\n      if (modo \u003d\u003d\u003d \u0027data_desc\u0027) arr.sort((a,b)\u003d\u003e byData(b,a));\n      else if (modo \u003d\u003d\u003d \u0027data_asc\u0027) arr.sort(byData);\n      else if (modo \u003d\u003d\u003d \u0027nome_asc\u0027) arr.sort(byNome);\n      else if (modo \u003d\u003d\u003d \u0027nome_desc\u0027) arr.sort((a,b)\u003d\u003e byNome(b,a));\n      return arr;\n    }\n\n    function aplicarFiltrosFront(){\n      const unidadeSel \u003d document.getElementById(\u0027unidadeFiltro\u0027).value || \u0027\u0027;\n      const benSel \u003d document.getElementById(\u0027beneficioFiltro\u0027).value || \u0027\u0027;\n      filtros.unidade \u003d unidadeSel;\n      filtros.beneficio \u003d benSel;\n      filtros.ordenar \u003d document.getElementById(\u0027ordenarPor\u0027).value || \u0027data_desc\u0027;\n\n      const base \u003d cacheRegistros.filter(r\u003d\u003e{\n        if (filtros.unidade \u0026\u0026 r.unidade !\u003d\u003d filtros.unidade) return false;\n        if (filtros.beneficio \u0026\u0026 r.demanda !\u003d\u003d filtros.beneficio) return false;\n        if (filtros.status \u0026\u0026 (r.status||\u0027\u0027).toUpperCase() !\u003d\u003d filtros.status) return false;\n        return true;\n      });\n      viewRegistros \u003d ordenarLista(base);\n      renderTabela(viewRegistros);\n    }\n\n    function limparFiltrosFront(){\n      document.getElementById(\u0027unidadeFiltro\u0027).value \u003d \u0027\u0027;\n      document.getElementById(\u0027beneficioFiltro\u0027).value \u003d \u0027\u0027;\n      setStatusFiltro(null,\u0027\u0027);\n      document.getElementById(\"cpfBusca\").value \u003d \"\";\n      document.getElementById(\"dataInicio\").value \u003d \"\";\n      document.getElementById(\"dataFim\").value \u003d \"\";\n      document.getElementById(\"ordenarPor\").value \u003d \"data_desc\";\n      aplicarFiltrosFront();\n    }\n\n    function buscar(){\n      const cpf  \u003d document.getElementById(\"cpfBusca\").value.trim();\n      const dIni \u003d document.getElementById(\"dataInicio\").value;\n      const dFim \u003d document.getElementById(\"dataFim\").value;\n      const uni  \u003d document.getElementById(\"unidadeFiltro\").value || \u0027\u0027;\n      const ben  \u003d document.getElementById(\"beneficioFiltro\").value || \u0027\u0027;\n      document.getElementById(\"loading\").classList.remove(\"hidden\");\n\n      if (SAFE_GOOGLE) {\n        google.script.run\n          .withSuccessHandler(dados\u003d\u003e{\n            document.getElementById(\"loading\").classList.add(\"hidden\");\n            cacheRegistros \u003d (dados \u0026\u0026 dados.registros) ? dados.registros : [];\n            popularBeneficios();\n            aplicarFiltrosFront();\n          })\n          .withFailureHandler(err\u003d\u003e{\n            document.getElementById(\"loading\").classList.add(\"hidden\");\n            showToast(\u0027error\u0027,\u0027Erro na busca\u0027, String(err \u0026\u0026 err.message ? err.message : err));\n          })\n          .buscarBeneficios(cpf, dIni, dFim, ben, uni);\n      } else {\n        document.getElementById(\"loading\").classList.add(\"hidden\");\n        cacheRegistros \u003d [];\n        popularBeneficios();\n        aplicarFiltrosFront();\n      }\n    }\n\n    function mostrarTodos(){\n      document.getElementById(\"cpfBusca\").value \u003d \"\";\n      document.getElementById(\"dataInicio\").value \u003d \"\";\n      document.getElementById(\"dataFim\").value \u003d \"\";\n      document.getElementById(\"loading\").classList.remove(\"hidden\");\n      if (SAFE_GOOGLE) {\n        google.script.run\n          .withSuccessHandler(dados\u003d\u003e{\n            document.getElementById(\"loading\").classList.add(\"hidden\");\n            cacheRegistros \u003d (dados \u0026\u0026 dados.registros) ? dados.registros : [];\n            popularBeneficios();\n            aplicarFiltrosFront();\n          })\n          .withFailureHandler(err\u003d\u003e{\n            document.getElementById(\"loading\").classList.add(\"hidden\");\n            showToast(\u0027error\u0027,\u0027Erro ao carregar\u0027, String(err \u0026\u0026 err.message ? err.message : err));\n          })\n          .buscarBeneficios(\"\", \"\", \"\", \"\", \"\");\n      } else {\n        document.getElementById(\"loading\").classList.add(\"hidden\");\n        cacheRegistros \u003d [];\n        popularBeneficios();\n        aplicarFiltrosFront();\n      }\n    }\n\n    function atualizar(btn, linha, status){\n      if (!SAFE_GOOGLE) return;\n      const orig \u003d btn.textContent;\n      btn.classList.add(\u0027btn-loading\u0027); btn.textContent\u003d\u0027Salvando‚Ä¶\u0027; btn.disabled \u003d true;\n      google.script.run\n        .withSuccessHandler(()\u003d\u003e{\n          btn.classList.remove(\u0027btn-loading\u0027); btn.disabled\u003dfalse; btn.textContent\u003dorig;\n          showToast(\u0027success\u0027,\u0027Status atualizado\u0027, `Linha ${linha} ‚Üí ${status}`); buscar();\n        })\n        .withFailureHandler(err\u003d\u003e{\n          btn.classList.remove(\u0027btn-loading\u0027); btn.disabled\u003dfalse; btn.textContent\u003dorig;\n          showToast(\u0027error\u0027,\u0027Erro ao atualizar\u0027, String(err \u0026\u0026 err.message ? err.message : err));\n        })\n        .atualizarStatus(linha, status);\n    }\n\n    function baixarPDFLinha(btn, linha){\n      if (!SAFE_GOOGLE) return;\n      const orig \u003d btn.textContent;\n      btn.classList.add(\u0027btn-loading\u0027); btn.textContent\u003d\u0027Gerando‚Ä¶\u0027; btn.disabled \u003d true;\n      google.script.run\n        .withSuccessHandler(res\u003d\u003e{\n          btn.classList.remove(\u0027btn-loading\u0027); btn.disabled\u003dfalse; btn.textContent\u003dorig;\n          if (res \u0026\u0026 res.link){\n            showToast(\u0027success\u0027,\u0027PDF pronto\u0027,\u0027Abrindo em nova guia‚Ä¶\u0027);\n            window.open(res.link, \u0027_blank\u0027);\n            buscar();\n          } else {\n            showToast(\u0027error\u0027,\u0027Falha ao gerar PDF\u0027,\u0027Tente novamente.\u0027);\n          }\n        })\n        .withFailureHandler(err\u003d\u003e{\n          btn.classList.remove(\u0027btn-loading\u0027); btn.disabled\u003dfalse; btn.textContent\u003dorig;\n          showToast(\u0027error\u0027,\u0027Erro ao gerar PDF\u0027, String(err));\n        })\n        .gerarPdfDeRegistro(linha);\n    }\n\n    function popularUnidades(){\n      if (SAFE_GOOGLE){\n        google.script.run.withSuccessHandler(arr\u003d\u003e{\n          const sel \u003d document.getElementById(\u0027unidadeFiltro\u0027);\n          sel.innerHTML \u003d `\u003coption value\u003d\"\"\u003eTodas\u003c/option\u003e` + (arr||[]).map(u\u003d\u003e`\u003coption value\u003d\"${u}\"\u003e${u}\u003c/option\u003e`).join(\u0027\u0027);\n          aplicarFiltrosFront();\n        }).listarUnidadesDashboard();\n      }\n    }\n\n    function popularBeneficios(){\n      const sel \u003d document.getElementById(\u0027beneficioFiltro\u0027);\n      if (!sel) return;\n      const lista \u003d Array.from(new Set((cacheRegistros||[]).map(r \u003d\u003e r.demanda).filter(Boolean)))\n                      .sort((a,b)\u003d\u003ea.localeCompare(b,\u0027pt-BR\u0027,{sensitivity:\u0027base\u0027}));\n      sel.innerHTML \u003d `\u003coption value\u003d\"\"\u003eTodos\u003c/option\u003e` + lista.map(v\u003d\u003e`\u003coption value\u003d\"${v}\"\u003e${v}\u003c/option\u003e`).join(\u0027\u0027);\n    }\n\n    async function copiarTotais(){\n      const linhas \u003d [\n        `Total: ${document.getElementById(\u0027totalCount\u0027).textContent}`,\n        `Aprovados: ${document.getElementById(\u0027aprovadasCount\u0027).textContent}`,\n        `Pendentes: ${document.getElementById(\u0027pendentesCount\u0027).textContent}`,\n        `Recusados: ${document.getElementById(\u0027recusadasCount\u0027).textContent}`\n      ].join(\u0027\\n\u0027);\n      try{\n        await navigator.clipboard.writeText(linhas);\n        showToast(\u0027success\u0027,\u0027Copiado!\u0027,\u0027Totais enviados para sua √°rea de transfer√™ncia.\u0027);\n      }catch(_){\n        showToast(\u0027error\u0027,\u0027Falha ao copiar\u0027,\u0027Tente novamente.\u0027);\n      }\n    }\n\nfunction gerarCSV(regs){\n  const linhas \u003d [[\u0027Data\u0027,\u0027Unidade\u0027,\u0027Nome\u0027,\u0027CPF\u0027,\u0027Demanda\u0027,\u0027Status\u0027]];\n  (regs||[]).forEach(r \u003d\u003e {\n    linhas.push([r.data||\u0027\u0027, r.unidade||\u0027\u0027, r.nome||\u0027\u0027, r.cpf||\u0027\u0027, r.demanda||\u0027\u0027, r.status||\u0027\u0027]);\n  });\n  const csv \u003d linhas.map(l\u003d\u003el.map(x\u003d\u003e`\"${String(x||\u0027\u0027).replace(/\"/g,\u0027\"\"\u0027)}\"`).join(\u0027,\u0027)).join(\u0027\\n\u0027);\n  return csv;\n}\n\n\n    async function copiarTabela(){\n      try{\n        await navigator.clipboard.writeText(gerarCSV(viewRegistros));\n        showToast(\u0027success\u0027,\u0027Copiado!\u0027,\u0027Tabela copiada como CSV.\u0027);\n      }catch(_){\n        showToast(\u0027error\u0027,\u0027Falha ao copiar\u0027,\u0027Use o bot√£o Baixar CSV.\u0027);\n      }\n    }\n    function baixarCSV(){\n      const csv \u003d gerarCSV(viewRegistros);\n      const blob \u003d new Blob([csv], {type:\u0027text/csv;charset\u003dutf-8;\u0027});\n      const url \u003d URL.createObjectURL(blob);\n      const a \u003d document.createElement(\u0027a\u0027);\n      a.href \u003d url; a.download \u003d \u0027central-solicitacoes.csv\u0027; a.click();\n      URL.revokeObjectURL(url);\n    }\n\n    // \u003d\u003d\u003d\u003d\u003d Drawer de detalhes \u003d\u003d\u003d\u003d\u003d\n    let detLinhaAtual \u003d null;\n    function abrirDetalhes(linha){\n      detLinhaAtual \u003d linha;\n      document.getElementById(\u0027scrim\u0027).classList.add(\u0027show\u0027);\n      document.getElementById(\u0027drawer\u0027).classList.add(\u0027show\u0027);\n      document.getElementById(\u0027detLoading\u0027).classList.remove(\u0027hidden\u0027);\n      document.getElementById(\u0027detGrid\u0027).innerHTML \u003d \u0027\u0027;\n      document.getElementById(\u0027detChips\u0027).innerHTML \u003d \u0027\u0027;\n      document.getElementById(\u0027detTitulo\u0027).textContent \u003d \u0027Detalhes\u0027;\n      document.getElementById(\u0027detSub\u0027).textContent \u003d \u0027‚Äî\u0027;\n\n      if (SAFE_GOOGLE){\n        google.script.run\n          .withSuccessHandler(popularDetalhes)\n          .withFailureHandler(err\u003d\u003e{\n            document.getElementById(\u0027detLoading\u0027).classList.add(\u0027hidden\u0027);\n            showToast(\u0027error\u0027,\u0027Erro ao carregar detalhes\u0027, String(err \u0026\u0026 err.message ? err.message : err));\n          })\n          .getRegistroCompleto(linha);\n      }\n    }\n    function fecharDetalhes(){\n      document.getElementById(\u0027scrim\u0027).classList.remove(\u0027show\u0027);\n      document.getElementById(\u0027drawer\u0027).classList.remove(\u0027show\u0027);\n    }\n    function esc(s){\n      return String(s\u003d\u003dnull?\u0027\u0027:s).replace(/[\u0026\u003c\u003e\"\u0027]/g, m\u003d\u003e({ \u0027\u0026\u0027:\u0027\u0026amp;\u0027,\u0027\u003c\u0027:\u0027\u0026lt;\u0027,\u0027\u003e\u0027:\u0027\u0026gt;\u0027,\u0027\"\u0027:\u0027\u0026quot;\u0027 }[m]));\n    }\n    function linkify(s){\n      const v \u003d String(s||\u0027\u0027).trim();\n      if (/^https?:\\/\\//i.test(v)) return `\u003ca class\u003d\"link\" href\u003d\"${esc(v)}\" target\u003d\"_blank\" rel\u003d\"noopener\"\u003eabrir\u003c/a\u003e`;\n      return esc(v);\n    }\n\n    // Escapar valor para atributo src da imagem\n    function escAttr(s){\n      return String(s\u003d\u003dnull?\u0027\u0027:s).replace(/[\u0026\"\u003c\u003e\u0027\"]/g, m \u003d\u003e ({\n        \u0027\u0026\u0027:\u0027\u0026amp;\u0027,\n        \u0027\"\u0027:\u0027\u0026quot;\u0027,\n        \"\u0027\":\u0027\u0026#39;\u0027,\n        \u0027\u003c\u0027:\u0027\u0026lt;\u0027,\n        \u0027\u003e\u0027:\u0027\u0026gt;\u0027\n      }[m]));\n    }\n\n    // Decide como renderizar cada valor da grade (incluindo assinatura e DOCUMENTOS/ANEXOS)\n    function renderValorDetalhe(kv){\n      const label \u003d String(kv.label || \u0027\u0027);\n      let val \u003d kv.value;\n\n      // Assinatura digital (imagem)\n      if (/ASSINATURA/i.test(label) \u0026\u0026 typeof val \u003d\u003d\u003d \u0027string\u0027){\n        const raw \u003d val.trim();\n        if (!raw) return \u0027‚Äî\u0027;\n\n        // J√° veio como dataURL\n        if (/^data:image\\//i.test(raw)){\n          return `\u003cimg src\u003d\"${escAttr(raw)}\" alt\u003d\"Assinatura digital\" class\u003d\"sig-img\"\u003e`;\n        }\n\n        // Veio como URL (Drive, etc.)\n        if (/^https?:\\/\\//i.test(raw)){\n          return `\u003cimg src\u003d\"${escAttr(raw)}\" alt\u003d\"Assinatura digital\" class\u003d\"sig-img\"\u003e`;\n        }\n\n        // Veio como base64 \"seco\"\n        if (/^[A-Za-z0-9+/\u003d]+$/.test(raw) \u0026\u0026 raw.length \u003e 100){\n          const src \u003d \u0027data:image/png;base64,\u0027 + raw;\n          return `\u003cimg src\u003d\"${escAttr(src)}\" alt\u003d\"Assinatura digital\" class\u003d\"sig-img\"\u003e`;\n        }\n      }\n\n      // DOCUMENTOS / ANEXOS ‚Üí lista bonitinha de links por arquivo\n      if (/(DOCUMENTO|ANEXO)/i.test(label) \u0026\u0026 typeof val \u003d\u003d\u003d \u0027string\u0027){\n        const raw \u003d val.trim();\n        if (!raw) return \u0027‚Äî\u0027;\n\n        const linhas \u003d raw.split(/\\r?\\n/).filter(Boolean);\n        if (!linhas.length) return \u0027‚Äî\u0027;\n\n        let html \u003d \u0027\u003cul class\u003d\"list-disc pl-4 space-y-1\"\u003e\u0027;\n        linhas.forEach((ln, idx) \u003d\u003e {\n          const m \u003d ln.match(/(https?:\\/\\/[^\\s]+)/i);\n          if (m){\n            const url \u003d m[1];\n            let nome \u003d ln.replace(m[1],\u0027\u0027).replace(/[:\\-‚Äì]\\s*$/,\u0027\u0027).trim();\n            if (!nome) nome \u003d \u0027Documento \u0027 + (idx+1);\n            html +\u003d `\u003cli\u003e\u003ca class\u003d\"link\" href\u003d\"${escAttr(url)}\" target\u003d\"_blank\" rel\u003d\"noopener\"\u003e${esc(nome)}\u003c/a\u003e\u003c/li\u003e`;\n          } else {\n            html +\u003d `\u003cli\u003e${esc(ln)}\u003c/li\u003e`;\n          }\n        });\n        html +\u003d \u0027\u003c/ul\u003e\u0027;\n        return html;\n      }\n\n      // Demais campos\n      return linkify(val);\n    }\n\n    function popularDetalhes(payload){\n      document.getElementById(\u0027detLoading\u0027).classList.add(\u0027hidden\u0027);\n      if (!payload){ showToast(\u0027error\u0027,\u0027Sem dados\u0027,\u0027N√£o foi poss√≠vel carregar.\u0027); return; }\n\n      const r \u003d payload.resumo || {};\n      document.getElementById(\u0027detTitulo\u0027).textContent \u003d r.nome ? r.nome : \u0027Detalhes\u0027;\n      document.getElementById(\u0027detSub\u0027).textContent \u003d [r.data, r.unidade, r.protocolo ? (\u0027Protocolo \u0027 + r.protocolo) : \u0027\u0027].filter(Boolean).join(\u0027 ‚Ä¢ \u0027);\n\n      // Chips de topo\n      const chips \u003d [];\n      if (r.status) chips.push(`\u003cspan class\u003d\"pill\"\u003eStatus: \u003cb\u003e${esc(r.status)}\u003c/b\u003e\u003c/span\u003e`);\n      if (r.cpf)    chips.push(`\u003cspan class\u003d\"pill\"\u003eCPF: \u003cb\u003e${esc(r.cpf)}\u003c/b\u003e\u003c/span\u003e`);\n      if (r.demanda)chips.push(`\u003cspan class\u003d\"pill\"\u003eBenef√≠cio: \u003cb\u003e${esc(r.demanda)}\u003c/b\u003e\u003c/span\u003e`);\n      if (r.unidade)chips.push(`\u003cspan class\u003d\"pill\"\u003eUnidade: \u003cb\u003e${esc(r.unidade)}\u003c/b\u003e\u003c/span\u003e`);\n      document.getElementById(\u0027detChips\u0027).innerHTML \u003d chips.join(\u0027\u0027);\n\n      // Grade com TODOS os campos (cabe√ßalho ‚Üí valor)\n      const grid \u003d document.getElementById(\u0027detGrid\u0027);\n      grid.innerHTML \u003d (payload.cols||[]).map(kv \u003d\u003e `\n        \u003cdiv class\u003d\"k\"\u003e${esc(kv.label)}\u003c/div\u003e\n        \u003cdiv class\u003d\"v\"\u003e${renderValorDetalhe(kv)}\u003c/div\u003e\n      `).join(\u0027\u0027);\n\n      // A√ß√µes dentro do drawer\n      document.getElementById(\u0027btnDetBaixar\u0027).onclick \u003d ()\u003d\u003e baixarPDFLinha(document.getElementById(\u0027btnDetBaixar\u0027), payload.linha);\n      document.getElementById(\u0027detBtnAprovar\u0027).onclick \u003d ()\u003d\u003e atualizar(document.getElementById(\u0027detBtnAprovar\u0027), payload.linha, \u0027APROVADO\u0027);\n      document.getElementById(\u0027detBtnEntregar\u0027).onclick\u003d ()\u003d\u003e atualizar(document.getElementById(\u0027detBtnEntregar\u0027), payload.linha, \u0027ENTREGUE\u0027);\n      document.getElementById(\u0027detBtnPendente\u0027).onclick\u003d ()\u003d\u003e atualizar(document.getElementById(\u0027detBtnPendente\u0027), payload.linha, \u0027PENDENTE\u0027);\n      document.getElementById(\u0027detBtnRecusar\u0027).onclick \u003d ()\u003d\u003e atualizar(document.getElementById(\u0027detBtnRecusar\u0027), payload.linha, \u0027RECUSADO\u0027);\n    }\n\n    async function copiarDetalhes(){\n      const txt \u003d document.getElementById(\u0027detGrid\u0027).innerText;\n      try{\n        await navigator.clipboard.writeText(txt);\n        showToast(\u0027success\u0027,\u0027Copiado!\u0027,\u0027Detalhes para a √°rea de transfer√™ncia.\u0027);\n      }\n      catch(_){\n        showToast(\u0027error\u0027,\u0027Falha ao copiar\u0027,\u0027Tente novamente.\u0027);\n      }\n    }\n\n    // Eventos / Init\n    document.getElementById(\u0027btnBuscar\u0027).addEventListener(\u0027click\u0027, ()\u003d\u003ebuscar());\n    document.getElementById(\u0027ordenarPor\u0027).addEventListener(\u0027change\u0027, ()\u003d\u003eaplicarFiltrosFront());\n    document.getElementById(\u0027beneficioFiltro\u0027).addEventListener(\u0027change\u0027, ()\u003d\u003eaplicarFiltrosFront());\n\n    document.addEventListener(\u0027DOMContentLoaded\u0027, function(){\n      const cpfInput \u003d document.getElementById(\"cpfBusca\");\n      cpfInput.addEventListener(\"input\", function(e){\n        let v\u003de.target.value.replace(/\\D/g,\"\");\n        v\u003dv.replace(/(\\d{3})(\\d)/,\"$1.$2\");\n        v\u003dv.replace(/(\\d{3})(\\d)/,\"$1.$2\");\n        v\u003dv.replace(/(\\d{3})(\\d{1,2})$/,\"$1-$2\");\n        e.target.value\u003dv;\n      });\n    });\n\n    (function init(){\n      const chipTodos \u003d document.querySelector(\u0027[data-status\u003d\"\"]\u0027);\n      if (chipTodos) chipTodos.classList.add(\u0027active\u0027);\n      popularUnidades();\n      mostrarTodos();\n    })();\n  \u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},{"id":"b5d54a34-a4b0-440b-b563-8188caeb9f5d","name":"analista","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml lang\u003d\"pt-BR\"\u003e\n\u003chead\u003e\n  \u003cbase target\u003d\"_top\"\u003e\n  \u003cmeta name\u003d\"viewport\" content\u003d\"width\u003ddevice-width, initial-scale\u003d1.0\"\u003e\n  \u003ctitle\u003ePainel do Analista\u003c/title\u003e\n  \u003cstyle\u003e\n    :root{ --ok:#0B6E4F; --ok2:#095b41; --blue:#2563eb; --violet:#9333ea; --red:#dc2626; }\n    html,body{height:100%}\n    body{font-family:Arial, sans-serif; background:#f5f7fb; margin:0; padding:24px}\n    .wrap{max-width:1100px; margin:0 auto}\n    .card{background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:18px; margin-bottom:16px; box-shadow:0 4px 10px rgba(0,0,0,.04)}\n    h2{margin:6px 0 16px; font-size:20px}\n    .row{display:grid; grid-template-columns:1fr 1fr 1fr 1fr 1fr; gap:10px}\n    .row label{font-weight:600; font-size:12px; color:#334155}\n    input, select{width:100%; padding:10px; border:1px solid #cbd5e1; border-radius:8px; box-sizing:border-box}\n    .btn{background:var(--ok); color:#fff; border:none; border-radius:8px; padding:10px 14px; cursor:pointer; font-weight:700}\n    .btn:hover{background:var(--ok2)}\n    table{width:100%; border-collapse:collapse}\n    th, td{padding:10px; border-bottom:1px solid #e5e7eb; text-align:left; font-size:14px}\n    th{background:#f1f5f9; font-weight:700}\n    .actions button{margin-right:6px}\n    .muted{color:#64748b; font-size:12px}\n    .badge{display:inline-block; padding:4px 8px; border-radius:999px; background:#eef2ff; color:#3730a3; font-weight:700; font-size:12px}\n    .toast{position:fixed; top:16px; right:16px; background:#0b6e4f; color:#fff; padding:10px 12px; border-radius:8px; box-shadow:0 10px 30px rgba(0,0,0,.18); display:none; z-index:10}\n    .alert{background:#fee2e2; color:#7f1d1d; border:1px solid #fecaca; padding:8px 10px; border-radius:8px; display:none; margin-bottom:12px}\n    @media (max-width:900px){ .row{grid-template-columns:1fr 1fr} }\n    /* loader */\n    .loader{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(255,255,255,.65); z-index:9}\n    .loader.show{display:flex}\n    .spin{width:36px; height:36px; border:4px solid #c7d2fe; border-top-color:#3b82f6; border-radius:50%; animation:spin .9s linear infinite}\n    @keyframes spin{to{transform:rotate(360deg)}}\n  \u003c/style\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n  \u003cdiv class\u003d\"wrap\"\u003e\n    \u003cdiv class\u003d\"toast\" id\u003d\"toast\"\u003e\u003c/div\u003e\n    \u003cdiv class\u003d\"loader\" id\u003d\"loader\"\u003e\u003cdiv class\u003d\"spin\" aria-label\u003d\"Carregando\"\u003e\u003c/div\u003e\u003c/div\u003e\n\n    \u003c!-- CADASTRAR --\u003e\n    \u003cdiv class\u003d\"card\"\u003e\n      \u003ch2\u003eCadastro r√°pido de usu√°rio\u003c/h2\u003e\n      \u003cdiv class\u003d\"alert\" id\u003d\"alert\"\u003e\u003c/div\u003e\n      \u003cdiv class\u003d\"row\"\u003e\n        \u003cdiv\u003e\n          \u003clabel\u003eSetor\u003c/label\u003e\n          \u003cinput list\u003d\"dl-setores\" id\u003d\"iSetor\" placeholder\u003d\"Ex.: CRAS MARIA JOS√â (JARDIM)\" autocomplete\u003d\"off\"\u003e\n          \u003cdatalist id\u003d\"dl-setores\"\u003e\u003c/datalist\u003e\n        \u003c/div\u003e\n        \u003cdiv\u003e\n          \u003clabel\u003eUsu√°rio\u003c/label\u003e\n          \u003cinput id\u003d\"iUsuario\" placeholder\u003d\"login do usu√°rio\" autocomplete\u003d\"off\"\u003e\n        \u003c/div\u003e\n        \u003cdiv\u003e\n          \u003clabel\u003eSenha inicial\u003c/label\u003e\n          \u003cinput id\u003d\"iSenha\" type\u003d\"text\" placeholder\u003d\"Ex.: 12345\"\u003e\n        \u003c/div\u003e\n        \u003cdiv\u003e\n          \u003clabel\u003eE-mail (opcional)\u003c/label\u003e\n          \u003cinput id\u003d\"iEmail\" type\u003d\"email\" placeholder\u003d\"nome@dominio.com\" autocomplete\u003d\"off\"\u003e\n        \u003c/div\u003e\n        \u003cdiv\u003e\n          \u003clabel\u003ePerfil\u003c/label\u003e\n          \u003cselect id\u003d\"iRole\"\u003e\n            \u003coption value\u003d\"usuario\"\u003eUsu√°rio\u003c/option\u003e\n            \u003coption value\u003d\"central\"\u003eCentral\u003c/option\u003e\n            \u003coption value\u003d\"analista\"\u003eAnalista\u003c/option\u003e\n            \u003coption value\u003d\"admin\"\u003eAdmin\u003c/option\u003e\n          \u003c/select\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n      \u003cdiv style\u003d\"margin-top:10px\"\u003e\n        \u003cbutton class\u003d\"btn\" id\u003d\"btnCriar\"\u003eCadastrar\u003c/button\u003e\n        \u003cspan class\u003d\"muted\"\u003eDica: pode digitar um setor novo mesmo que n√£o esteja na lista.\u003c/span\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003c!-- LISTA --\u003e\n    \u003cdiv class\u003d\"card\"\u003e\n      \u003ch2\u003eUsu√°rios por setor\u003c/h2\u003e\n      \u003cdiv style\u003d\"display:flex; gap:10px; align-items:center; margin-bottom:10px\"\u003e\n        \u003cinput id\u003d\"filtro\" placeholder\u003d\"Buscar por usu√°rio/setor...\" autocomplete\u003d\"off\"\u003e\n        \u003cspan class\u003d\"badge\" id\u003d\"badgeTotal\"\u003e0\u003c/span\u003e\n      \u003c/div\u003e\n      \u003cdiv style\u003d\"overflow:auto\"\u003e\n        \u003ctable id\u003d\"tb\"\u003e\n          \u003cthead\u003e\n            \u003ctr\u003e\n              \u003cth style\u003d\"width:22%\"\u003eSetor\u003c/th\u003e\n              \u003cth style\u003d\"width:18%\"\u003eUsu√°rio\u003c/th\u003e\n              \u003cth style\u003d\"width:22%\"\u003eE-mail\u003c/th\u003e\n              \u003cth style\u003d\"width:12%\"\u003ePerfil\u003c/th\u003e\n              \u003cth style\u003d\"width:26%\"\u003eA√ß√µes\u003c/th\u003e\n            \u003c/tr\u003e\n          \u003c/thead\u003e\n          \u003ctbody id\u003d\"tbody\"\u003e\u003c/tbody\u003e\n        \u003c/table\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\n\u003cscript\u003e\n  let base \u003d []; // {linha,setor,usuario,email,role}\n  let setores \u003d [];\n\n  // helpers UI\n  const $ \u003d id \u003d\u003e document.getElementById(id);\n  function toast(msg){ const t\u003d$(\u0027toast\u0027); t.innerText\u003dmsg; t.style.display\u003d\u0027block\u0027; setTimeout(()\u003d\u003et.style.display\u003d\u0027none\u0027,2200); }\n  function showAlert(msg){ const a\u003d$(\u0027alert\u0027); a.innerText\u003dmsg; a.style.display\u003d\u0027block\u0027; setTimeout(()\u003d\u003ea.style.display\u003d\u0027none\u0027,4200); }\n  function busy(on){ const l\u003d$(\u0027loader\u0027); if(on) l.classList.add(\u0027show\u0027); else l.classList.remove(\u0027show\u0027); }\n\n  // load\n  function carregar(){\n    busy(true);\n    google.script.run\n      .withSuccessHandler(function(resp){\n        busy(false);\n        const r \u003d resp || {};\n        base \u003d Array.isArray(r.usuarios) ? r.usuarios : [];\n        setores \u003d Array.isArray(r.setores) ? r.setores : [];\n        popularSetores();\n        render(base);\n      })\n      .withFailureHandler(function(err){\n        busy(false);\n        showAlert(\u0027Falha ao carregar usu√°rios: \u0027 + (err \u0026\u0026 err.message ? err.message : \u0027erro desconhecido\u0027));\n      })\n      .listarUsuariosLogin();\n  }\n\n  function popularSetores(){\n    const dl \u003d $(\u0027dl-setores\u0027); dl.innerHTML \u003d \u0027\u0027;\n    setores.forEach(s\u003d\u003e{ const o\u003ddocument.createElement(\u0027option\u0027); o.value\u003ds; dl.appendChild(o); });\n  }\n\n  function render(arr){\n    const tb \u003d $(\u0027tbody\u0027); tb.innerHTML \u003d \u0027\u0027;\n    $(\u0027badgeTotal\u0027).innerText \u003d arr.length;\n\n    arr.forEach(u\u003d\u003e{\n      const tr \u003d document.createElement(\u0027tr\u0027);\n\n      // Setor (edit√°vel)\n      const tdSet \u003d document.createElement(\u0027td\u0027);\n      const inSet \u003d document.createElement(\u0027input\u0027);\n      inSet.value \u003d u.setor || \u0027\u0027; inSet.style.width\u003d\u0027100%\u0027;\n      inSet.onchange \u003d ()\u003d\u003e u.setor \u003d inSet.value;\n      tdSet.appendChild(inSet); tr.appendChild(tdSet);\n\n      // Usu√°rio (edit√°vel)\n      const tdUsr \u003d document.createElement(\u0027td\u0027);\n      const inUsr \u003d document.createElement(\u0027input\u0027);\n      inUsr.value \u003d u.usuario || \u0027\u0027; inUsr.style.width\u003d\u0027100%\u0027;\n      inUsr.onchange \u003d ()\u003d\u003e u.usuario \u003d inUsr.value;\n      tdUsr.appendChild(inUsr); tr.appendChild(tdUsr);\n\n      // Email (edit√°vel)\n      const tdMail \u003d document.createElement(\u0027td\u0027);\n      const inMail \u003d document.createElement(\u0027input\u0027);\n      inMail.type\u003d\u0027email\u0027; inMail.value \u003d u.email || \u0027\u0027; inMail.style.width\u003d\u0027100%\u0027;\n      inMail.onchange \u003d ()\u003d\u003e u.email \u003d inMail.value;\n      tdMail.appendChild(inMail); tr.appendChild(tdMail);\n\n      // Role (edit√°vel)\n      const tdRole \u003d document.createElement(\u0027td\u0027);\n      const sel \u003d document.createElement(\u0027select\u0027);\n      [\u0027usuario\u0027,\u0027central\u0027,\u0027analista\u0027,\u0027admin\u0027].forEach(r\u003d\u003e{\n        const opt \u003d document.createElement(\u0027option\u0027);\n        opt.value\u003dr; opt.text\u003dr.charAt(0).toUpperCase()+r.slice(1);\n        if ((u.role||\u0027usuario\u0027)\u003d\u003d\u003dr) opt.selected\u003dtrue;\n        sel.appendChild(opt);\n      });\n      sel.onchange \u003d ()\u003d\u003e u.role \u003d sel.value;\n      tdRole.appendChild(sel); tr.appendChild(tdRole);\n\n      // A√ß√µes\n      const tdAc \u003d document.createElement(\u0027td\u0027); tdAc.className\u003d\u0027actions\u0027;\n\n      const bSalvar \u003d document.createElement(\u0027button\u0027);\n      bSalvar.className\u003d\u0027btn\u0027; bSalvar.textContent\u003d\u0027Salvar\u0027;\n      bSalvar.onclick \u003d ()\u003d\u003e salvar(u);\n\n      const bSenha \u003d document.createElement(\u0027button\u0027);\n      bSenha.className\u003d\u0027btn\u0027; bSenha.style.background\u003d\u0027var(--blue)\u0027;\n      bSenha.textContent\u003d\u0027Definir senha\u0027;\n      bSenha.onclick \u003d ()\u003d\u003e {\n        const nova \u003d prompt(\u0027Nova senha para \u0027+(u.usuario||\u0027\u0027)+\u0027:\u0027);\n        if (!nova) return;\n        busy(true);\n        google.script.run\n          .withSuccessHandler(r\u003d\u003e{ busy(false); r \u0026\u0026 r.ok ? toast(\u0027Senha alterada.\u0027) : showAlert(r.msg||\u0027Erro ao alterar senha.\u0027); })\n          .withFailureHandler(e\u003d\u003e{ busy(false); showAlert(\u0027Erro ao alterar senha: \u0027+(e?.message||\u0027\u0027)); })\n          .alterarSenhaLogin(u.linha, String(nova));\n      };\n\n      const bReset \u003d document.createElement(\u0027button\u0027);\n      bReset.className\u003d\u0027btn\u0027; bReset.style.background\u003d\u0027var(--violet)\u0027;\n      bReset.textContent\u003d\u0027Resetar senha\u0027;\n      bReset.onclick \u003d ()\u003d\u003e {\n        if (!confirm(\u0027Gerar senha tempor√°ria para \u0027+(u.usuario||\u0027\u0027)+\u0027?\u0027)) return;\n        busy(true);\n        google.script.run\n          .withSuccessHandler(r\u003d\u003e{\n            busy(false);\n            if (r \u0026\u0026 r.ok){ toast(\u0027Senha resetada.\u0027); alert(\u0027Senha tempor√°ria: \u0027+(r.senha||\u0027\u0027)); }\n            else showAlert(r.msg||\u0027Erro ao resetar senha.\u0027);\n          })\n          .withFailureHandler(e\u003d\u003e{ busy(false); showAlert(\u0027Erro ao resetar: \u0027+(e?.message||\u0027\u0027)); })\n          .resetarSenhaLogin(u.linha);\n      };\n\n      const bDel \u003d document.createElement(\u0027button\u0027);\n      bDel.className\u003d\u0027btn\u0027; bDel.style.background\u003d\u0027var(--red)\u0027;\n      bDel.textContent\u003d\u0027Remover\u0027;\n      bDel.onclick \u003d ()\u003d\u003e {\n        if (!confirm(\u0027Remover o usu√°rio \"\u0027+(u.usuario||\u0027\u0027)+\u0027\" do setor \"\u0027+(u.setor||\u0027\u0027)+\u0027\"?\u0027)) return;\n        busy(true);\n        google.script.run\n          .withSuccessHandler(r\u003d\u003e{ busy(false); r \u0026\u0026 r.ok ? (toast(\u0027Removido.\u0027), carregar()) : showAlert(r.msg||\u0027Erro ao remover.\u0027); })\n          .withFailureHandler(e\u003d\u003e{ busy(false); showAlert(\u0027Erro ao remover: \u0027+(e?.message||\u0027\u0027)); })\n          .excluirUsuarioLogin(u.linha);\n      };\n\n      tdAc.appendChild(bSalvar);\n      tdAc.appendChild(bSenha);\n      tdAc.appendChild(bReset);\n      tdAc.appendChild(bDel);\n      tr.appendChild(tdAc);\n\n      tb.appendChild(tr);\n    });\n  }\n\n  function salvar(u){\n    busy(true);\n    google.script.run\n      .withSuccessHandler(function(r){\n        busy(false);\n        if (r \u0026\u0026 r.ok){ toast(\u0027Altera√ß√µes salvas.\u0027); carregar(); }\n        else showAlert(r.msg||\u0027Erro ao salvar.\u0027);\n      })\n      .withFailureHandler(function(e){\n        busy(false); showAlert(\u0027Erro ao salvar: \u0027+(e \u0026\u0026 e.message ? e.message : \u0027\u0027));\n      })\n      .atualizarUsuarioLogin({ linha:u.linha, setor:u.setor, usuario:u.usuario, email:u.email, role:u.role });\n  }\n\n  function criar(){\n    const setor \u003d $(\u0027iSetor\u0027).value.trim();\n    const usuario \u003d $(\u0027iUsuario\u0027).value.trim();\n    const senha \u003d $(\u0027iSenha\u0027).value;\n    const email \u003d $(\u0027iEmail\u0027).value.trim();\n    const role \u003d $(\u0027iRole\u0027).value;\n    if(!setor || !usuario || !senha){ showAlert(\u0027Informe Setor, Usu√°rio e Senha.\u0027); return; }\n\n    busy(true);\n    google.script.run\n      .withSuccessHandler(function(r){\n        busy(false);\n        if (r \u0026\u0026 r.ok){\n          toast(\u0027Usu√°rio cadastrado.\u0027);\n          $(\u0027iUsuario\u0027).value\u003d\u0027\u0027; $(\u0027iSenha\u0027).value\u003d\u0027\u0027; $(\u0027iEmail\u0027).value\u003d\u0027\u0027;\n          carregar();\n        } else showAlert(r.msg||\u0027Erro ao cadastrar.\u0027);\n      })\n      .withFailureHandler(function(e){\n        busy(false); showAlert(\u0027Erro ao cadastrar: \u0027+(e \u0026\u0026 e.message ? e.message : \u0027\u0027));\n      })\n      .criarUsuarioLogin({setor, usuario, senha, email, role});\n  }\n\n  function filtrar(){\n    const q \u003d $(\u0027filtro\u0027).value.toLowerCase();\n    if (!q) { render(base); return; }\n    const f \u003d base.filter(u \u003d\u003e\n      (u.setor||\u0027\u0027).toLowerCase().includes(q) ||\n      (u.usuario||\u0027\u0027).toLowerCase().includes(q) ||\n      (u.email||\u0027\u0027).toLowerCase().includes(q) ||\n      (u.role||\u0027\u0027).toLowerCase().includes(q)\n    );\n    render(f);\n  }\n\n  // binds\n  $(\u0027btnCriar\u0027).addEventListener(\u0027click\u0027, criar);\n  $(\u0027filtro\u0027).addEventListener(\u0027input\u0027, filtrar);\n\n  // start\n  carregar();\n\u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},{"id":"e09a277a-4026-4a4a-9807-0f70fbd0e4d1","name":"hub","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml lang\u003d\"pt-BR\"\u003e\n\u003chead\u003e\n  \u003cmeta charset\u003d\"UTF-8\"\u003e\n  \u003cbase target\u003d\"_top\"\u003e\n  \u003cmeta name\u003d\"viewport\" content\u003d\"width\u003ddevice-width, initial-scale\u003d1\"\u003e\n  \u003ctitle\u003eHub ‚Äì Atendimentos\u003c/title\u003e\n  \u003cstyle\u003e\n    :root{\n      --bg-url: url(\u0027https://lh3.googleusercontent.com/d/1198pJcJXG4o7_YZOwLC0QvdrBg53Z0Th\u003dw2400\u0027);\n      --brand-900:#0b2742; --brand-800:#0e3557; --brand-700:#114266; --brand-600:#16527c;\n      --card-bg: rgba(255,255,255,.92); --card-border: rgba(255,255,255,.6);\n      --text:#1f2a37; --muted:#6b7280; --primary:#1677ff; --primary-700:#0e5ed6;\n    }\n    html, body { height:100%; margin:0; }\n    body{\n      font-family: \u0027Segoe UI\u0027, Tahoma, Geneva, Verdana, sans-serif;\n      color:var(--text); display:flex; align-items:center; justify-content:center;\n      background:\n        radial-gradient(1200px 600px at 10% -10%, rgba(255,255,255,.1), transparent 60%),\n        radial-gradient(1000px 500px at 110% 0%, rgba(255,255,255,.1), transparent 60%),\n        linear-gradient(135deg, var(--brand-900) 0%, var(--brand-800) 45%, var(--brand-700) 100%);\n      position:relative; overflow:hidden;\n    }\n    body::after{\n      content:\"\"; position:fixed; inset:0;\n      background-image:\n        linear-gradient(transparent calc(100% - 1px), rgba(255,255,255,.06) 1px),\n        linear-gradient(90deg, transparent calc(100% - 1px), rgba(255,255,255,.06) 1px);\n      background-size:30px 30px, 30px 30px; opacity:.4; pointer-events:none; mix-blend-mode:soft-light;\n    }\n    .bg-mark{\n      position:fixed; left:50%; top:50%; transform:translate(-50%, -50%) rotate(-1deg);\n      width:clamp(240px, 36vw, 560px); aspect-ratio: 1/1;\n      background: var(--bg-url) center / contain no-repeat; opacity:.15;\n      filter: drop-shadow(0 20px 60px rgba(0,0,0,.4)) saturate(.95); pointer-events:none; z-index:0;\n    }\n    .wrap{ position:relative; z-index:1; width:100%; display:flex; justify-content:center; padding:24px; }\n    .card{\n      width:min(92vw, 820px);\n      background: var(--card-bg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);\n      border:1px solid var(--card-border); border-radius:20px; padding:36px 28px;\n      box-shadow: 0 20px 40px rgba(0,0,0,.25), 0 1px 0 rgba(255,255,255,.3) inset, 0 0 0 1px rgba(255,255,255,.1) inset;\n      text-align:center;\n    }\n    h1{ margin:0 0 6px; font-weight:800; font-size:1.9rem; color:#0f172a; letter-spacing:.2px; }\n    .subtitle{ margin:6px 0 22px; color:var(--muted); font-size:.98rem; }\n    .actions{ display:flex; gap:18px; justify-content:center; flex-wrap:wrap; margin-top:8px; }\n    .btn{\n      display:inline-flex; align-items:center; justify-content:center; gap:10px;\n      min-width:280px; padding:16px 22px; border-radius:12px; font-weight:800; font-size:1rem;\n      text-decoration:none; color:#fff;\n      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-700) 100%);\n      box-shadow: 0 6px 18px rgba(22,119,255,.35); transition: transform .2s ease, box-shadow .2s ease, opacity .2s ease;\n    }\n    .btn:hover{ transform: translateY(-2px); box-shadow:0 10px 28px rgba(22,119,255,.45); }\n    .btn[aria-busy\u003d\"true\"]{ opacity:.75; pointer-events:none; position:relative; }\n    .btn[aria-busy\u003d\"true\"]::after{\n      content:\"\"; position:absolute; right:14px; width:16px; height:16px; border-radius:50%;\n      border:2px solid rgba(255,255,255,.85); border-top-color:transparent; animation:spin .9s linear infinite;\n    }\n    @keyframes spin{to{transform:rotate(360deg)}}\n    .alert{\n      display:none; margin:18px auto 0; max-width:640px;\n      padding:12px 14px; background:#fee2e2; color:#991b1b; border:1px solid #fecaca; border-radius:10px; font-weight:600;\n    }\n    footer{ margin-top:22px; color:var(--muted); font-size:.85rem; }\n  \u003c/style\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n  \u003cdiv class\u003d\"bg-mark\" aria-hidden\u003d\"true\"\u003e\u003c/div\u003e\n\n  \u003cmain class\u003d\"wrap\"\u003e\n    \u003csection class\u003d\"card\"\u003e\n      \u003ch1\u003eHub ‚Äì Atendimentos\u003c/h1\u003e\n      \u003cp class\u003d\"subtitle\"\u003eSelecione uma op√ß√£o:\u003c/p\u003e\n\n      \u003cdiv class\u003d\"actions\"\u003e\n        \u003ca href\u003d\"#\" class\u003d\"btn\" data-view\u003d\"formulario\"\u003eFormul√°rio de Requerimento\u003c/a\u003e\n        \u003ca href\u003d\"#\" class\u003d\"btn\" data-view\u003d\"baixa\"\u003eBaixa / Entrega\u003c/a\u003e\n      \u003c/div\u003e\n\n      \u003cdiv id\u003d\"alert\" class\u003d\"alert\"\u003e\u003c/div\u003e\n      \u003cfooter\u003e\u0026copy; 2025 SEMFAS\u003c/footer\u003e\n    \u003c/section\u003e\n  \u003c/main\u003e\n\n  \u003cscript\u003e\n  (function(){\n    const alertBox \u003d document.getElementById(\u0027alert\u0027);\n    let busy \u003d false, navigated \u003d false;\n\n    function showError(msg){\n      if(!alertBox) return;\n      alertBox.textContent \u003d msg || \u0027Erro inesperado.\u0027;\n      alertBox.style.display \u003d \u0027block\u0027;\n    }\n    function setBusy(btn, busyFlag){\n      if(!btn) return;\n      if(busyFlag){\n        btn.setAttribute(\u0027aria-busy\u0027,\u0027true\u0027);\n        btn.dataset.label \u003d btn.textContent;\n        btn.textContent \u003d \u0027Abrindo...\u0027;\n      }else{\n        btn.removeAttribute(\u0027aria-busy\u0027);\n        if(btn.dataset.label) btn.textContent \u003d btn.dataset.label;\n      }\n    }\n    function hardRedirect(view){\n      try {\n        // garante navega√ß√£o mesmo que o Apps Script n√£o injete o HTML\n        const url \u003d new URL(window.top.location.href);\n        url.search \u003d \u0027?view\u003d\u0027 + encodeURIComponent(view);\n        window.top.location.href \u003d url.toString();\n        navigated \u003d true;\n      } catch(_){\n        showError(\u0027Falha ao redirecionar para \"\u0027+view+\u0027\".\u0027);\n      }\n    }\n\n    function abrir(view, btn){\n      if (busy) return;\n      busy \u003d true;\n      alertBox.style.display \u003d \u0027none\u0027;\n      setBusy(btn, true);\n\n      // watchdog: se nada acontecer rapidamente, for√ßa redirect\n      const softTimer \u003d setTimeout(()\u003d\u003e{ if(!navigated) hardRedirect(view); }, 1200);\n      const hardTimer \u003d setTimeout(()\u003d\u003e{\n        if(!navigated){\n          setBusy(btn,false); busy\u003dfalse;\n          showError(\u0027Conex√£o lenta. Tente novamente.\u0027);\n        }\n      }, 8000);\n\n      // tenta injetar HTML do servidor\n      try{\n        if (!google || !google.script || !google.script.run) { hardRedirect(view); return; }\n\n        google.script.run\n          .withSuccessHandler(function(html){\n            if (navigated) return;\n            clearTimeout(softTimer); clearTimeout(hardTimer);\n            setBusy(btn,false); busy\u003dfalse;\n            if (typeof html !\u003d\u003d \u0027string\u0027 || !html.trim()) { hardRedirect(view); return; }\n            navigated \u003d true;\n            document.open(); document.write(html); document.close();\n          })\n          .withFailureHandler(function(_err){\n            if (navigated) return;\n            clearTimeout(softTimer); clearTimeout(hardTimer);\n            setBusy(btn,false); busy\u003dfalse;\n            hardRedirect(view);\n          })\n          .renderView(view);\n      } catch(e){\n        clearTimeout(softTimer); clearTimeout(hardTimer);\n        setBusy(btn,false); busy\u003dfalse;\n        hardRedirect(view);\n      }\n    }\n\n    // Delega√ß√£o de clique\n    document.addEventListener(\u0027click\u0027, function(ev){\n      const el \u003d ev.target.closest(\u0027[data-view]\u0027);\n      if(!el) return;\n      ev.preventDefault();\n      const view \u003d el.getAttribute(\u0027data-view\u0027) || \u0027\u0027;\n      if(!view) return;\n      abrir(view, el);\n    });\n\n    // atalhos: 1 formul√°rio, 2 baixa\n    window.addEventListener(\u0027keydown\u0027, (e)\u003d\u003e{\n      if (e.key \u003d\u003d\u003d \u00271\u0027) abrir(\u0027formulario\u0027, document.querySelector(\u0027[data-view\u003d\"formulario\"]\u0027));\n      if (e.key \u003d\u003d\u003d \u00272\u0027) abrir(\u0027baixa\u0027,       document.querySelector(\u0027[data-view\u003d\"baixa\"]\u0027));\n    });\n  })();\n  \u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},{"id":"cab71b58-35e1-41ab-8515-8f1cd4ca94b0","name":"baixa","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml lang\u003d\"pt-BR\"\u003e\n\u003chead\u003e\n  \u003cbase target\u003d\"_top\"\u003e\n  \u003cmeta charset\u003d\"UTF-8\" /\u003e\n  \u003cmeta name\u003d\"viewport\" content\u003d\"width\u003ddevice-width, initial-scale\u003d1.0\" /\u003e\n  \u003ctitle\u003eBaixa / Entrega de Benef√≠cios ‚Äî SEMFAS\u003c/title\u003e\n\n  \u003cstyle\u003e\n    :root{\n      --bg-body:#f3f4f6;\n      --bg-card:#ffffff;\n      --primary:#2563eb;\n      --primary-soft:#eff4ff;\n      --danger:#dc2626;\n      --text-main:#111827;\n      --text-soft:#6b7280;\n      --border:#e5e7eb;\n      --radius-lg:14px;\n      --radius-md:10px;\n      --shadow-card:0 18px 40px rgba(15,23,42,.12);\n    }\n\n    *{box-sizing:border-box;}\n    html,body{margin:0;padding:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,\"Segoe UI\",sans-serif;background:var(--bg-body);color:var(--text-main);}\n    body{padding:24px;}\n\n    .page{\n      max-width:1200px;\n      margin:0 auto 48px;\n    }\n\n    .page-header{\n      margin-bottom:20px;\n    }\n    .page-title{\n      font-size:22px;\n      font-weight:700;\n      letter-spacing:.02em;\n      display:flex;\n      align-items:center;\n      gap:10px;\n    }\n    .page-title span.badge{\n      font-size:11px;\n      padding:2px 8px;\n      border-radius:999px;\n      background:var(--primary-soft);\n      color:var(--primary);\n      font-weight:600;\n    }\n    .page-subtitle{\n      margin-top:4px;\n      font-size:13px;\n      color:var(--text-soft);\n    }\n\n    .card{\n      background:var(--bg-card);\n      border-radius:var(--radius-lg);\n      box-shadow:var(--shadow-card);\n      padding:18px 20px 16px;\n    }\n\n    .filters{\n      display:grid;\n      grid-template-columns: minmax(0,2.4fr) minmax(0,1.2fr) minmax(0,1.6fr) minmax(0,1.6fr) auto;\n      gap:10px;\n      align-items:flex-end;\n      margin-bottom:12px;\n    }\n\n    label.lbl{\n      font-size:11px;\n      text-transform:uppercase;\n      letter-spacing:.06em;\n      color:var(--text-soft);\n      margin-bottom:3px;\n      display:block;\n      font-weight:600;\n    }\n\n    .input-text,\n    .select{\n      width:100%;\n      border-radius:999px;\n      border:1px solid var(--border);\n      padding:7px 11px;\n      font-size:13px;\n      outline:none;\n      background:#f9fafb;\n    }\n    .input-text:focus,\n    .select:focus{\n      border-color:var(--primary);\n      background:#fff;\n    }\n\n    .inline-filters{\n      display:flex;\n      flex-wrap:wrap;\n      align-items:flex-end;\n      gap:8px;\n      margin-bottom:10px;\n    }\n\n    .inline-filters .block{\n      display:flex;\n      flex-direction:column;\n      min-width:150px;\n    }\n\n    .inline-filters .dates{\n      display:flex;\n      gap:6px;\n    }\n\n    .chk-line{\n      display:flex;\n      align-items:center;\n      gap:4px;\n      font-size:12px;\n      color:var(--text-soft);\n      margin-right:10px;\n    }\n\n    .btn{\n      border:none;\n      border-radius:999px;\n      font-size:13px;\n      padding:7px 14px;\n      cursor:pointer;\n      display:inline-flex;\n      align-items:center;\n      justify-content:center;\n      gap:6px;\n      white-space:nowrap;\n    }\n    .btn-primary{\n      background:var(--primary);\n      color:#fff;\n      font-weight:600;\n    }\n    .btn-secondary{\n      background:#e5e7eb;\n      color:#111827;\n      font-weight:500;\n    }\n    .btn-ghost{\n      background:transparent;\n      color:var(--text-soft);\n    }\n    .btn-sm{\n      padding:5px 10px;\n      font-size:12px;\n    }\n\n    .btn-primary:disabled{\n      opacity:.65;\n      cursor:default;\n    }\n\n    .table-wrapper{\n      margin-top:8px;\n      border-radius:var(--radius-md);\n      border:1px solid var(--border);\n      overflow:hidden;\n      background:#fff;\n    }\n\n    table{\n      width:100%;\n      border-collapse:collapse;\n      font-size:13px;\n    }\n    thead{\n      background:#f9fafb;\n    }\n    thead th{\n      padding:8px 10px;\n      text-align:left;\n      font-weight:600;\n      color:var(--text-soft);\n      border-bottom:1px solid var(--border);\n      font-size:11px;\n      text-transform:uppercase;\n      letter-spacing:.05em;\n      white-space:nowrap;\n    }\n    tbody td{\n      padding:8px 10px;\n      border-bottom:1px solid #f3f4f6;\n      vertical-align:middle;\n    }\n    tbody tr:hover{\n      background:#f9fafb;\n    }\n\n    .chip-status{\n      padding:2px 8px;\n      border-radius:999px;\n      font-size:11px;\n      font-weight:600;\n      display:inline-flex;\n      align-items:center;\n    }\n    .chip-status.pendente{\n      background:#fef3c7;\n      color:#92400e;\n    }\n    .chip-status.aprovado{\n      background:#dcfce7;\n      color:#166534;\n    }\n    .chip-status.entregue{\n      background:#e0ecff;\n      color:#1d4ed8;\n    }\n    .chip-status.recusado{\n      background:#fee2e2;\n      color:#b91c1c;\n    }\n\n    .nome-link{\n      color:var(--primary);\n      text-decoration:none;\n      font-weight:500;\n    }\n    .nome-link:hover{text-decoration:underline;}\n\n    .pdf-link{\n      font-size:12px;\n      color:var(--primary);\n      text-decoration:none;\n      font-weight:500;\n    }\n    .pdf-link:hover{text-decoration:underline;}\n\n    .empty-state{\n      padding:18px 14px;\n      font-size:13px;\n      color:var(--text-soft);\n    }\n\n    .badge-pill{\n      display:inline-flex;\n      align-items:center;\n      gap:5px;\n      padding:2px 9px;\n      border-radius:999px;\n      background:#f3f4f6;\n      font-size:11px;\n      color:var(--text-soft);\n    }\n\n    /* MODAL */\n    .modal-backdrop{\n      position:fixed;\n      inset:0;\n      background:rgba(15,23,42,.40);\n      display:none;\n      align-items:center;\n      justify-content:center;\n      z-index:50;\n    }\n    .modal-backdrop.show{display:flex;}\n\n    .modal{\n      background:#fff;\n      border-radius:20px;\n      padding:20px 22px 18px;\n      width:100%;\n      max-width:620px;\n      box-shadow:0 24px 60px rgba(15,23,42,.28);\n      max-height:90vh;\n      overflow:auto;\n    }\n    .modal-header{\n      display:flex;\n      justify-content:space-between;\n      align-items:flex-start;\n      gap:12px;\n      margin-bottom:10px;\n    }\n    .modal-title{\n      font-size:18px;\n      font-weight:700;\n    }\n    .modal-sub{\n      font-size:12px;\n      color:var(--text-soft);\n      margin-top:3px;\n    }\n    .modal-close{\n      border:none;\n      background:transparent;\n      font-size:18px;\n      cursor:pointer;\n      color:#9ca3af;\n    }\n\n    .modal-grid{\n      display:grid;\n      grid-template-columns: minmax(0,1.1fr) minmax(0,1fr) minmax(0,1.1fr);\n      gap:10px;\n      margin-bottom:10px;\n    }\n    .modal-grid-wide{\n      margin-top:4px;\n    }\n\n    textarea{\n      width:100%;\n      border-radius:10px;\n      border:1px solid var(--border);\n      padding:8px 10px;\n      font-size:13px;\n      resize:vertical;\n      min-height:70px;\n      font-family:inherit;\n      background:#f9fafb;\n    }\n    textarea:focus{\n      outline:none;\n      border-color:var(--primary);\n      background:#fff;\n    }\n\n    .modal-footer{\n      margin-top:14px;\n      display:flex;\n      justify-content:flex-end;\n      gap:6px;\n    }\n\n    /* Hist√≥rico CPF */\n    .hist-header{\n      font-size:13px;\n      color:var(--text-soft);\n      margin-bottom:10px;\n    }\n    .hist-list{\n      border-radius:10px;\n      border:1px solid var(--border);\n      overflow:hidden;\n      background:#f9fafb;\n      max-height:60vh;\n      overflow-y:auto;\n    }\n    .hist-row{\n      padding:8px 10px;\n      border-bottom:1px solid #e5e7eb;\n      font-size:12px;\n    }\n    .hist-row:last-child{border-bottom:none;}\n    .hist-top{\n      display:flex;\n      justify-content:space-between;\n      gap:8px;\n      margin-bottom:2px;\n    }\n    .hist-top span.nome{font-weight:600;}\n    .hist-meta{\n      display:flex;\n      flex-wrap:wrap;\n      gap:6px;\n      color:var(--text-soft);\n    }\n    .hist-meta span{\n      padding:1px 6px;\n      border-radius:999px;\n      background:#e5e7eb;\n      font-size:11px;\n    }\n\n    .toast{\n      position:fixed;\n      bottom:18px;\n      right:18px;\n      background:#111827;\n      color:#f9fafb;\n      padding:9px 14px;\n      border-radius:999px;\n      font-size:12px;\n      display:none;\n      align-items:center;\n      gap:8px;\n      z-index:70;\n    }\n    .toast.show{display:flex;}\n    .dot{\n      width:7px;height:7px;border-radius:999px;background:#22c55e;\n    }\n\n    @media (max-width:900px){\n      body{padding:14px;}\n      .filters{\n        grid-template-columns:1fr;\n      }\n      .inline-filters{\n        flex-direction:column;\n        align-items:flex-start;\n      }\n      .modal-grid{\n        grid-template-columns:1fr;\n      }\n    }\n  \u003c/style\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n  \u003cdiv class\u003d\"page\"\u003e\n    \u003cdiv class\u003d\"page-header\"\u003e\n      \u003cdiv class\u003d\"page-title\"\u003e\n        Baixa / Entrega de Benef√≠cios\n        \u003cspan class\u003d\"badge\"\u003eM√ìDULO BAIXA\u003c/span\u003e\n      \u003c/div\u003e\n      \u003cdiv class\u003d\"page-subtitle\"\u003e\n        Pesquise pelos registros, filtre por status / unidade / per√≠odo e registre a entrega.\n        Clique no nome para ver o hist√≥rico completo por CPF.\n      \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cdiv class\u003d\"card\"\u003e\n      \u003c!-- Linha principal de filtros --\u003e\n      \u003cdiv class\u003d\"filters\"\u003e\n        \u003cdiv\u003e\n          \u003clabel class\u003d\"lbl\"\u003eBusca r√°pida\u003c/label\u003e\n          \u003cinput id\u003d\"filtroBusca\" class\u003d\"input-text\" type\u003d\"text\"\n                 placeholder\u003d\"CPF, nome ou protocolo...\" /\u003e\n        \u003c/div\u003e\n\n        \u003cdiv\u003e\n          \u003clabel class\u003d\"lbl\"\u003eStatus\u003c/label\u003e\n          \u003cselect id\u003d\"filtroStatus\" class\u003d\"select\"\u003e\n            \u003coption value\u003d\"pendentes\"\u003ePendentes\u003c/option\u003e\n            \u003coption value\u003d\"todos\"\u003eTodos\u003c/option\u003e\n            \u003coption value\u003d\"entregues\"\u003eEntregues\u003c/option\u003e\n          \u003c/select\u003e\n        \u003c/div\u003e\n\n        \u003cdiv\u003e\n          \u003clabel class\u003d\"lbl\"\u003eUnidade / via de entrada\u003c/label\u003e\n          \u003cselect id\u003d\"filtroUnidade\" class\u003d\"select\"\u003e\n            \u003coption value\u003d\"\"\u003eTodas\u003c/option\u003e\n          \u003c/select\u003e\n        \u003c/div\u003e\n\n        \u003cdiv\u003e\n          \u003clabel class\u003d\"lbl\"\u003eBenef√≠cio\u003c/label\u003e\n          \u003cselect id\u003d\"filtroBeneficio\" class\u003d\"select\"\u003e\n            \u003coption value\u003d\"\"\u003eTodos\u003c/option\u003e\n          \u003c/select\u003e\n        \u003c/div\u003e\n\n        \u003cdiv style\u003d\"display:flex;flex-direction:column;gap:6px;align-items:flex-end;\"\u003e\n          \u003cbutton id\u003d\"btnBuscarRapido\" class\u003d\"btn btn-secondary btn-sm\" type\u003d\"button\"\u003e\n            Buscar\n          \u003c/button\u003e\n          \u003cbutton id\u003d\"btnLimpar\" class\u003d\"btn btn-ghost btn-sm\" type\u003d\"button\"\u003e\n            Limpar\n          \u003c/button\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003c!-- Filtros secund√°rios --\u003e\n      \u003cdiv class\u003d\"inline-filters\"\u003e\n        \u003cdiv class\u003d\"block\"\u003e\n          \u003clabel class\u003d\"lbl\"\u003ePer√≠odo\u003c/label\u003e\n          \u003cdiv class\u003d\"dates\"\u003e\n            \u003cinput id\u003d\"dataInicio\" class\u003d\"input-text\" type\u003d\"date\" /\u003e\n            \u003cinput id\u003d\"dataFim\" class\u003d\"input-text\" type\u003d\"date\" /\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n\n        \u003cdiv class\u003d\"chk-line\"\u003e\n          \u003cinput id\u003d\"chkPdf\" type\u003d\"checkbox\" /\u003e\n          \u003cspan\u003eApenas com PDF\u003c/span\u003e\n        \u003c/div\u003e\n\n        \u003cdiv class\u003d\"chk-line\"\u003e\n          \u003cinput id\u003d\"chkProto\" type\u003d\"checkbox\" /\u003e\n          \u003cspan\u003eApenas com protocolo\u003c/span\u003e\n        \u003c/div\u003e\n\n        \u003cdiv class\u003d\"block\" style\u003d\"min-width:180px;\"\u003e\n          \u003clabel class\u003d\"lbl\"\u003eOrdenar por\u003c/label\u003e\n          \u003cselect id\u003d\"filtroOrder\" class\u003d\"select\"\u003e\n            \u003coption value\u003d\"data_desc\"\u003eMais recentes primeiro\u003c/option\u003e\n            \u003coption value\u003d\"data_asc\"\u003eMais antigos primeiro\u003c/option\u003e\n            \u003coption value\u003d\"nome_asc\"\u003eNome A ‚Üí Z\u003c/option\u003e\n            \u003coption value\u003d\"nome_desc\"\u003eNome Z ‚Üí A\u003c/option\u003e\n            \u003coption value\u003d\"benef_asc\"\u003eBenef√≠cio A ‚Üí Z\u003c/option\u003e\n            \u003coption value\u003d\"benef_desc\"\u003eBenef√≠cio Z ‚Üí A\u003c/option\u003e\n            \u003coption value\u003d\"uni_asc\"\u003eUnidade A ‚Üí Z\u003c/option\u003e\n            \u003coption value\u003d\"uni_desc\"\u003eUnidade Z ‚Üí A\u003c/option\u003e\n            \u003coption value\u003d\"prot_asc\"\u003eProtocolo ‚Üë\u003c/option\u003e\n            \u003coption value\u003d\"prot_desc\"\u003eProtocolo ‚Üì\u003c/option\u003e\n          \u003c/select\u003e\n        \u003c/div\u003e\n\n        \u003cdiv style\u003d\"margin-left:auto;\"\u003e\n          \u003cbutton id\u003d\"btnAplicarFiltros\" class\u003d\"btn btn-primary btn-sm\" type\u003d\"button\"\u003e\n            Aplicar filtros\n          \u003c/button\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003c!-- Tabela --\u003e\n      \u003cdiv class\u003d\"table-wrapper\"\u003e\n        \u003ctable\u003e\n          \u003cthead\u003e\n            \u003ctr\u003e\n              \u003cth style\u003d\"min-width:180px;\"\u003eNome\u003c/th\u003e\n              \u003cth\u003eCPF\u003c/th\u003e\n              \u003cth style\u003d\"min-width:170px;\"\u003eBenef√≠cio\u003c/th\u003e\n              \u003cth style\u003d\"min-width:170px;\"\u003eUnidade\u003c/th\u003e\n              \u003cth\u003eSolicitado em\u003c/th\u003e\n              \u003cth\u003eStatus\u003c/th\u003e\n              \u003cth\u003ePDF\u003c/th\u003e\n              \u003cth style\u003d\"text-align:right;\"\u003eA√ß√µes\u003c/th\u003e\n            \u003c/tr\u003e\n          \u003c/thead\u003e\n          \u003ctbody id\u003d\"tbodyRegistros\"\u003e\u003c/tbody\u003e\n        \u003c/table\u003e\n        \u003cdiv id\u003d\"estadoVazio\" class\u003d\"empty-state\" style\u003d\"display:none;\"\u003e\n          Nenhum registro encontrado para os filtros selecionados.\n        \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003cdiv style\u003d\"margin-top:8px;font-size:11px;color:var(--text-soft);display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;\"\u003e\n        \u003cspan class\u003d\"badge-pill\"\u003e\n          \u003cstrong id\u003d\"lblTotal\"\u003e0\u003c/strong\u003e registros listados\n        \u003c/span\u003e\n        \u003cspan\u003eSe precisar, a entrega pode ser desfeita pela Central, em ‚ÄúEntregue ‚Üí Desfazer‚Äù.\u003c/span\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\n  \u003c!-- MODAL ENTREGA --\u003e\n  \u003cdiv id\u003d\"modalEntregaBackdrop\" class\u003d\"modal-backdrop\"\u003e\n    \u003cdiv class\u003d\"modal\"\u003e\n      \u003cdiv class\u003d\"modal-header\"\u003e\n        \u003cdiv\u003e\n          \u003cdiv class\u003d\"modal-title\"\u003eRegistrar entrega\u003c/div\u003e\n          \u003cdiv id\u003d\"modalEntregaResumo\" class\u003d\"modal-sub\"\u003e\u003c/div\u003e\n        \u003c/div\u003e\n        \u003cbutton class\u003d\"modal-close\" type\u003d\"button\" onclick\u003d\"fecharModalEntrega()\"\u003e√ó\u003c/button\u003e\n      \u003c/div\u003e\n\n      \u003cdiv class\u003d\"modal-grid\"\u003e\n        \u003cdiv\u003e\n          \u003clabel class\u003d\"lbl\"\u003eData da entrega\u003c/label\u003e\n          \u003cinput id\u003d\"entregaData\" class\u003d\"input-text\" type\u003d\"date\" /\u003e\n        \u003c/div\u003e\n\n        \u003cdiv\u003e\n          \u003clabel class\u003d\"lbl\"\u003eEntregue por\u003c/label\u003e\n          \u003cinput id\u003d\"entregaPor\" class\u003d\"input-text\" type\u003d\"text\"\n                 placeholder\u003d\"Nome de quem realizou a entrega\" /\u003e\n        \u003c/div\u003e\n\n        \u003cdiv\u003e\n          \u003clabel class\u003d\"lbl\"\u003eUnidade de entrega\u003c/label\u003e\n          \u003cselect id\u003d\"entregaUnidade\" class\u003d\"select\"\u003e\n            \u003coption value\u003d\"\"\u003eSelecione...\u003c/option\u003e\n          \u003c/select\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003cdiv class\u003d\"modal-grid-wide\"\u003e\n        \u003clabel class\u003d\"lbl\"\u003eObserva√ß√£o da entrega (opcional)\u003c/label\u003e\n        \u003ctextarea id\u003d\"entregaObs\"\n                  placeholder\u003d\"Ex.: entregue ao pr√≥prio benefici√°rio, acompanhado de...\"\u003e\u003c/textarea\u003e\n      \u003c/div\u003e\n\n      \u003cdiv class\u003d\"modal-footer\"\u003e\n        \u003cbutton class\u003d\"btn btn-secondary btn-sm\" type\u003d\"button\" onclick\u003d\"fecharModalEntrega()\"\u003eCancelar\u003c/button\u003e\n        \u003cbutton id\u003d\"btnConfirmarEntrega\" class\u003d\"btn btn-primary btn-sm\" type\u003d\"button\"\u003e\n          Confirmar entrega\n        \u003c/button\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\n  \u003c!-- MODAL HIST√ìRICO CPF --\u003e\n  \u003cdiv id\u003d\"modalHistBackdrop\" class\u003d\"modal-backdrop\"\u003e\n    \u003cdiv class\u003d\"modal\"\u003e\n      \u003cdiv class\u003d\"modal-header\"\u003e\n        \u003cdiv\u003e\n          \u003cdiv class\u003d\"modal-title\"\u003eHist√≥rico do CPF\u003c/div\u003e\n          \u003cdiv id\u003d\"modalHistSub\" class\u003d\"modal-sub\"\u003e\u003c/div\u003e\n        \u003c/div\u003e\n        \u003cbutton class\u003d\"modal-close\" type\u003d\"button\" onclick\u003d\"fecharModalHistorico()\"\u003e√ó\u003c/button\u003e\n      \u003c/div\u003e\n\n      \u003cdiv class\u003d\"hist-header\"\u003e\n        Todos os registros encontrados para este CPF (solicita√ß√µes e entregas).\n      \u003c/div\u003e\n      \u003cdiv id\u003d\"histLista\" class\u003d\"hist-list\"\u003e\u003c/div\u003e\n\n      \u003cdiv class\u003d\"modal-footer\"\u003e\n        \u003cbutton class\u003d\"btn btn-secondary btn-sm\" type\u003d\"button\" onclick\u003d\"fecharModalHistorico()\"\u003eFechar\u003c/button\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\n  \u003c!-- TOAST --\u003e\n  \u003cdiv id\u003d\"toast\" class\u003d\"toast\"\u003e\n    \u003cspan class\u003d\"dot\"\u003e\u003c/span\u003e\n    \u003cspan id\u003d\"toastText\"\u003eA√ß√£o conclu√≠da.\u003c/span\u003e\n  \u003c/div\u003e\n\n  \u003cscript\u003e\n    let REGISTROS_ATUAIS \u003d [];\n    let REGISTRO_SELECIONADO \u003d null;\n    let UNIDADES_OPCOES \u003d [];\n    const LS_SETOR  \u003d \u0027semfas_setor\u0027;\n    const LS_USUARIO\u003d \u0027semfas_usuario\u0027;\n\n    function hojeISO(){\n      const d \u003d new Date();\n      const m \u003d String(d.getMonth()+1).padStart(2,\u00270\u0027);\n      const da\u003d String(d.getDate()).padStart(2,\u00270\u0027);\n      return d.getFullYear() + \u0027-\u0027 + m + \u0027-\u0027 + da;\n    }\n\n    function mostrarToast(msg){\n      const el \u003d document.getElementById(\u0027toast\u0027);\n      document.getElementById(\u0027toastText\u0027).textContent \u003d msg || \u0027\u0027;\n      el.classList.add(\u0027show\u0027);\n      setTimeout(()\u003d\u003eel.classList.remove(\u0027show\u0027), 2600);\n    }\n\n    function statusChip(statusRaw){\n      const s \u003d String(statusRaw||\u0027\u0027).toUpperCase();\n      let cls \u003d \u0027pendente\u0027;\n      if (s \u003d\u003d\u003d \u0027ENTREGUE\u0027) cls \u003d \u0027entregue\u0027;\n      else if (s \u003d\u003d\u003d \u0027APROVADO\u0027) cls \u003d \u0027aprovado\u0027;\n      else if (s \u003d\u003d\u003d \u0027RECUSADO\u0027) cls \u003d \u0027recusado\u0027;\n      return `\u003cspan class\u003d\"chip-status ${cls}\"\u003e${s || \u0027PENDENTE\u0027}\u003c/span\u003e`;\n    }\n\n    function preencherTabela(registros){\n      REGISTROS_ATUAIS \u003d registros || [];\n      const tbody \u003d document.getElementById(\u0027tbodyRegistros\u0027);\n      const vazio \u003d document.getElementById(\u0027estadoVazio\u0027);\n      tbody.innerHTML \u003d \u0027\u0027;\n\n      if (!REGISTROS_ATUAIS.length){\n        vazio.style.display \u003d \u0027block\u0027;\n        document.getElementById(\u0027lblTotal\u0027).textContent \u003d \u00270\u0027;\n        return;\n      }\n      vazio.style.display \u003d \u0027none\u0027;\n      document.getElementById(\u0027lblTotal\u0027).textContent \u003d REGISTROS_ATUAIS.length;\n\n      REGISTROS_ATUAIS.forEach((reg, idx)\u003d\u003e{\n        const tr \u003d document.createElement(\u0027tr\u0027);\n\n        const tdNome \u003d document.createElement(\u0027td\u0027);\n        const a \u003d document.createElement(\u0027a\u0027);\n        a.href \u003d \u0027javascript:void(0)\u0027;\n        a.className \u003d \u0027nome-link\u0027;\n        a.textContent \u003d reg.nome || \u0027(sem nome)\u0027;\n        a.addEventListener(\u0027click\u0027, ()\u003d\u003eabrirHistorico(reg));\n        tdNome.appendChild(a);\n\n        const tdCpf   \u003d document.createElement(\u0027td\u0027);\n        tdCpf.textContent \u003d reg.cpf || \u0027\u0027;\n\n        const tdBen   \u003d document.createElement(\u0027td\u0027);\n        tdBen.textContent \u003d reg.beneficio || \u0027\u0027;\n\n        const tdUni   \u003d document.createElement(\u0027td\u0027);\n        tdUni.textContent \u003d reg.unidade || \u0027\u0027;\n\n        const tdData  \u003d document.createElement(\u0027td\u0027);\n        tdData.textContent \u003d reg.solicitadoEm || \u0027\u0027;\n\n        const tdStatus\u003d document.createElement(\u0027td\u0027);\n        tdStatus.innerHTML \u003d statusChip(reg.status);\n\n        const tdPdf   \u003d document.createElement(\u0027td\u0027);\n        if (reg.pdf){\n          const link \u003d document.createElement(\u0027a\u0027);\n          link.href \u003d reg.pdf;\n          link.target \u003d \u0027_blank\u0027;\n          link.className \u003d \u0027pdf-link\u0027;\n          link.textContent \u003d \u0027PDF\u0027;\n          tdPdf.appendChild(link);\n        } else {\n          tdPdf.textContent \u003d \u0027‚Äî\u0027;\n          tdPdf.style.color \u003d \u0027#9ca3af\u0027;\n        }\n\n        const tdAcao  \u003d document.createElement(\u0027td\u0027);\n        tdAcao.style.textAlign \u003d \u0027right\u0027;\n        const btn \u003d document.createElement(\u0027button\u0027);\n        btn.type \u003d \u0027button\u0027;\n        btn.className \u003d \u0027btn btn-primary btn-sm\u0027;\n        btn.textContent \u003d \u0027Marcar entregue\u0027;\n        btn.disabled \u003d (String(reg.status || \u0027\u0027).toUpperCase() \u003d\u003d\u003d \u0027ENTREGUE\u0027);\n        btn.addEventListener(\u0027click\u0027, ()\u003d\u003eabrirModalEntrega(reg));\n        tdAcao.appendChild(btn);\n\n        tr.appendChild(tdNome);\n        tr.appendChild(tdCpf);\n        tr.appendChild(tdBen);\n        tr.appendChild(tdUni);\n        tr.appendChild(tdData);\n        tr.appendChild(tdStatus);\n        tr.appendChild(tdPdf);\n        tr.appendChild(tdAcao);\n\n        tbody.appendChild(tr);\n      });\n    }\n\n    function coletarFiltrosBase(){\n      const status    \u003d document.getElementById(\u0027filtroStatus\u0027).value || \u0027pendentes\u0027;\n      const unidade   \u003d document.getElementById(\u0027filtroUnidade\u0027).value || \u0027\u0027;\n      const beneficio \u003d document.getElementById(\u0027filtroBeneficio\u0027).value || \u0027\u0027;\n      const order     \u003d document.getElementById(\u0027filtroOrder\u0027).value || \u0027data_desc\u0027;\n      const pdfOnly   \u003d document.getElementById(\u0027chkPdf\u0027).checked;\n      const hasProto  \u003d document.getElementById(\u0027chkProto\u0027).checked;\n      const dataIni   \u003d document.getElementById(\u0027dataInicio\u0027).value || \u0027\u0027;\n      const dataFim   \u003d document.getElementById(\u0027dataFim\u0027).value || \u0027\u0027;\n      return { status, unidade, beneficio, order, pdfOnly, hasProto, dataIni, dataFim };\n    }\n\n    function carregarLista(){\n      const f \u003d coletarFiltrosBase();\n      const btn \u003d document.getElementById(\u0027btnAplicarFiltros\u0027);\n      btn.disabled \u003d true;\n\n      google.script.run\n        .withSuccessHandler(res\u003d\u003e{\n          btn.disabled \u003d false;\n          preencherTabela(res \u0026\u0026 res.registros ? res.registros : []);\n        })\n        .withFailureHandler(err\u003d\u003e{\n          btn.disabled \u003d false;\n          console.error(err);\n          mostrarToast(\u0027Erro ao carregar registros.\u0027);\n        })\n        .baixa_list(f.status, f.unidade, f.beneficio, f.order, f.pdfOnly, f.hasProto, f.dataIni, f.dataFim);\n    }\n\n    function buscarRapido(){\n      const q \u003d (document.getElementById(\u0027filtroBusca\u0027).value || \u0027\u0027).trim();\n      if (!q){\n        carregarLista();\n        return;\n      }\n      const base \u003d coletarFiltrosBase();\n      const btn \u003d document.getElementById(\u0027btnBuscarRapido\u0027);\n      btn.disabled \u003d true;\n\n      google.script.run\n        .withSuccessHandler(res\u003d\u003e{\n          btn.disabled \u003d false;\n          preencherTabela(res \u0026\u0026 res.registros ? res.registros : []);\n        })\n        .withFailureHandler(err\u003d\u003e{\n          btn.disabled \u003d false;\n          console.error(err);\n          mostrarToast(\u0027Erro na busca r√°pida.\u0027);\n        })\n        .baixa_search(q, base.status, base.unidade, base.beneficio, base.order, base.pdfOnly, base.hasProto, base.dataIni, base.dataFim);\n    }\n\n    function limparFiltros(){\n      document.getElementById(\u0027filtroBusca\u0027).value \u003d \u0027\u0027;\n      document.getElementById(\u0027filtroStatus\u0027).value \u003d \u0027pendentes\u0027;\n      document.getElementById(\u0027filtroUnidade\u0027).value \u003d \u0027\u0027;\n      document.getElementById(\u0027filtroBeneficio\u0027).value \u003d \u0027\u0027;\n      document.getElementById(\u0027dataInicio\u0027).value \u003d \u0027\u0027;\n      document.getElementById(\u0027dataFim\u0027).value \u003d \u0027\u0027;\n      document.getElementById(\u0027chkPdf\u0027).checked \u003d false;\n      document.getElementById(\u0027chkProto\u0027).checked \u003d false;\n      document.getElementById(\u0027filtroOrder\u0027).value \u003d \u0027data_desc\u0027;\n      carregarLista();\n    }\n\n    function preencherOpcoesFiltros(op){\n      op \u003d op || {};\n      const unidades   \u003d op.unidades   || [];\n      const beneficios \u003d op.beneficios || [];\n      UNIDADES_OPCOES \u003d unidades.slice();\n\n      const selUni \u003d document.getElementById(\u0027filtroUnidade\u0027);\n      const selBen \u003d document.getElementById(\u0027filtroBeneficio\u0027);\n      const selEntUni \u003d document.getElementById(\u0027entregaUnidade\u0027);\n\n      // Limpa mantendo a primeira op√ß√£o\n      selUni.options.length \u003d 1;\n      selBen.options.length \u003d 1;\n      selEntUni.options.length \u003d 1;\n\n      unidades.forEach(u\u003d\u003e{\n        const o1 \u003d document.createElement(\u0027option\u0027);\n        o1.value \u003d u;\n        o1.textContent \u003d u;\n        selUni.appendChild(o1);\n\n        const o2 \u003d document.createElement(\u0027option\u0027);\n        o2.value \u003d u;\n        o2.textContent \u003d u;\n        selEntUni.appendChild(o2);\n      });\n\n      beneficios.forEach(b\u003d\u003e{\n        const o \u003d document.createElement(\u0027option\u0027);\n        o.value \u003d b;\n        o.textContent \u003d b;\n        selBen.appendChild(o);\n      });\n\n      // Sugerir unidade logada no combo de entrega\n      const setorLogado \u003d localStorage.getItem(LS_SETOR) || \u0027\u0027;\n      if (setorLogado){\n        const opt \u003d Array.from(selEntUni.options).find(o \u003d\u003e o.value \u003d\u003d\u003d setorLogado);\n        if (opt) selEntUni.value \u003d setorLogado;\n      }\n    }\n\n    function carregarOpcoesFiltros(){\n      google.script.run\n        .withSuccessHandler(preencherOpcoesFiltros)\n        .withFailureHandler(err\u003d\u003econsole.error(err))\n        .baixa_listarOpcoes();\n    }\n\n    /* \u003d\u003d\u003d\u003d\u003d MODAL ENTREGA \u003d\u003d\u003d\u003d\u003d */\n\n    function abrirModalEntrega(reg){\n      REGISTRO_SELECIONADO \u003d reg;\n      const backdrop \u003d document.getElementById(\u0027modalEntregaBackdrop\u0027);\n      const resumo \u003d document.getElementById(\u0027modalEntregaResumo\u0027);\n\n      resumo.textContent \u003d\n        (reg.nome || \u0027\u0027) + \u0027 ‚Ä¢ \u0027 +\n        (reg.cpf || \u0027\u0027) + \u0027 ‚Ä¢ \u0027 +\n        (reg.beneficio || \u0027\u0027) + \u0027 ‚Ä¢ \u0027 +\n        (reg.unidade || \u0027\u0027);\n\n      // Data da entrega \u003d hoje por padr√£o\n      document.getElementById(\u0027entregaData\u0027).value \u003d hojeISO();\n\n      // \u003e\u003e\u003e ENTREGUE POR em branco conforme pedido\n      document.getElementById(\u0027entregaPor\u0027).value \u003d \u0027\u0027;\n\n      // Unidade de entrega: se houver setor logado, sugerir\n      const setorLogado \u003d localStorage.getItem(LS_SETOR) || \u0027\u0027;\n      const selEntUni \u003d document.getElementById(\u0027entregaUnidade\u0027);\n      if (setorLogado){\n        const opt \u003d Array.from(selEntUni.options).find(o\u003d\u003eo.value \u003d\u003d\u003d setorLogado);\n        selEntUni.value \u003d opt ? setorLogado : \u0027\u0027;\n      } else {\n        selEntUni.value \u003d \u0027\u0027;\n      }\n\n      document.getElementById(\u0027entregaObs\u0027).value \u003d \u0027\u0027;\n\n      backdrop.classList.add(\u0027show\u0027);\n    }\n\n    function fecharModalEntrega(){\n      document.getElementById(\u0027modalEntregaBackdrop\u0027).classList.remove(\u0027show\u0027);\n      REGISTRO_SELECIONADO \u003d null;\n    }\n\n    function confirmarEntrega(){\n      if (!REGISTRO_SELECIONADO) return;\n\n      const dataEntrega \u003d document.getElementById(\u0027entregaData\u0027).value;\n      const quem        \u003d (document.getElementById(\u0027entregaPor\u0027).value || \u0027\u0027).trim();\n      const unidadeEnt  \u003d document.getElementById(\u0027entregaUnidade\u0027).value || \u0027\u0027;\n      const obs         \u003d document.getElementById(\u0027entregaObs\u0027).value || \u0027\u0027;\n\n      if (!dataEntrega){\n        alert(\u0027Informe a data da entrega.\u0027);\n        return;\n      }\n      if (!quem){\n        alert(\u0027Informe em \"Entregue por\" o nome de quem realizou a entrega.\u0027);\n        return;\n      }\n      if (!unidadeEnt){\n        alert(\u0027Selecione a unidade de entrega.\u0027);\n        return;\n      }\n\n      const payload \u003d {\n        rowRef: REGISTRO_SELECIONADO.rowRef,\n        dataEntrega: dataEntrega,\n        setor: unidadeEnt,\n        usuario: quem,\n        obs: obs\n      };\n\n      const btn \u003d document.getElementById(\u0027btnConfirmarEntrega\u0027);\n      btn.disabled \u003d true;\n\n      google.script.run\n        .withSuccessHandler(ok\u003d\u003e{\n          btn.disabled \u003d false;\n          fecharModalEntrega();\n          mostrarToast(\u0027Entrega registrada com sucesso.\u0027);\n          carregarLista();\n        })\n        .withFailureHandler(err\u003d\u003e{\n          btn.disabled \u003d false;\n          console.error(err);\n          alert(\u0027Erro ao registrar entrega: \u0027 + (err \u0026\u0026 err.message ? err.message : err));\n        })\n        .baixa_marcarEntrega(payload);\n    }\n\n    /* \u003d\u003d\u003d\u003d\u003d MODAL HIST√ìRICO CPF \u003d\u003d\u003d\u003d\u003d */\n\n    function abrirHistorico(reg){\n      if (!reg || !reg.cpf) return;\n\n      const cpf \u003d reg.cpf;\n      const backdrop \u003d document.getElementById(\u0027modalHistBackdrop\u0027);\n      const sub \u003d document.getElementById(\u0027modalHistSub\u0027);\n      sub.textContent \u003d cpf + \u0027 ‚Ä¢ \u0027 + (reg.nome || \u0027\u0027);\n\n      const lista \u003d document.getElementById(\u0027histLista\u0027);\n      lista.innerHTML \u003d \u0027\u003cdiv class\u003d\"hist-row\"\u003eCarregando hist√≥rico...\u003c/div\u003e\u0027;\n      backdrop.classList.add(\u0027show\u0027);\n\n      google.script.run\n        .withSuccessHandler(res\u003d\u003e{\n          const registros \u003d (res \u0026\u0026 res.registros) ? res.registros : [];\n          if (!registros.length){\n            lista.innerHTML \u003d \u0027\u003cdiv class\u003d\"hist-row\"\u003eNenhum registro encontrado para este CPF.\u003c/div\u003e\u0027;\n            return;\n          }\n          lista.innerHTML \u003d \u0027\u0027;\n          registros.forEach(r\u003d\u003e{\n            const div \u003d document.createElement(\u0027div\u0027);\n            div.className \u003d \u0027hist-row\u0027;\n\n            const top \u003d document.createElement(\u0027div\u0027);\n            top.className \u003d \u0027hist-top\u0027;\n            const spanNome \u003d document.createElement(\u0027span\u0027);\n            spanNome.className \u003d \u0027nome\u0027;\n            spanNome.textContent \u003d r.beneficio || \u0027(benef√≠cio n√£o informado)\u0027;\n            const spanData \u003d document.createElement(\u0027span\u0027);\n            spanData.textContent \u003d r.data || \u0027\u0027;\n            top.appendChild(spanNome);\n            top.appendChild(spanData);\n\n            const meta \u003d document.createElement(\u0027div\u0027);\n            meta.className \u003d \u0027hist-meta\u0027;\n\n            const st \u003d document.createElement(\u0027span\u0027);\n            st.textContent \u003d \u0027Status: \u0027 + (r.status || \u0027\u0027);\n            meta.appendChild(st);\n\n            if (r.unidade){\n              const sp \u003d document.createElement(\u0027span\u0027);\n              sp.textContent \u003d r.unidade;\n              meta.appendChild(sp);\n            }\n            if (r.entregue_em){\n              const sp \u003d document.createElement(\u0027span\u0027);\n              sp.textContent \u003d \u0027Entregue em \u0027 + r.entregue_em;\n              meta.appendChild(sp);\n            }\n            if (r.unidade_entrega){\n              const sp \u003d document.createElement(\u0027span\u0027);\n              sp.textContent \u003d \u0027Unidade de entrega: \u0027 + r.unidade_entrega;\n              meta.appendChild(sp);\n            }\n            if (r.entregue_por){\n              const sp \u003d document.createElement(\u0027span\u0027);\n              sp.textContent \u003d \u0027Entregue por: \u0027 + r.entregue_por;\n              meta.appendChild(sp);\n            }\n            if (r.obs_entrega){\n              const sp \u003d document.createElement(\u0027span\u0027);\n              sp.textContent \u003d \u0027Obs.: \u0027 + r.obs_entrega;\n              meta.appendChild(sp);\n            }\n\n            if (r.protocolo){\n              const sp \u003d document.createElement(\u0027span\u0027);\n              sp.textContent \u003d \u0027Protocolo \u0027 + r.protocolo;\n              meta.appendChild(sp);\n            }\n\n            if (r.pdf){\n              const sp \u003d document.createElement(\u0027span\u0027);\n              const a \u003d document.createElement(\u0027a\u0027);\n              a.href \u003d r.pdf;\n              a.target \u003d \u0027_blank\u0027;\n              a.textContent \u003d \u0027PDF\u0027;\n              a.style.color \u003d \u0027#1d4ed8\u0027;\n              a.style.textDecoration \u003d \u0027none\u0027;\n              sp.appendChild(a);\n              meta.appendChild(sp);\n            }\n\n            div.appendChild(top);\n            div.appendChild(meta);\n            lista.appendChild(div);\n          });\n        })\n        .withFailureHandler(err\u003d\u003e{\n          console.error(err);\n          lista.innerHTML \u003d \u0027\u003cdiv class\u003d\"hist-row\"\u003eErro ao carregar hist√≥rico.\u003c/div\u003e\u0027;\n        })\n        .historicoPorCPF(cpf);\n    }\n\n    function fecharModalHistorico(){\n      document.getElementById(\u0027modalHistBackdrop\u0027).classList.remove(\u0027show\u0027);\n    }\n\n    /* \u003d\u003d\u003d\u003d\u003d INIT \u003d\u003d\u003d\u003d\u003d */\n    document.addEventListener(\u0027DOMContentLoaded\u0027, ()\u003d\u003e{\n      document.getElementById(\u0027btnAplicarFiltros\u0027).addEventListener(\u0027click\u0027, carregarLista);\n      document.getElementById(\u0027btnBuscarRapido\u0027).addEventListener(\u0027click\u0027, buscarRapido);\n      document.getElementById(\u0027btnLimpar\u0027).addEventListener(\u0027click\u0027, limparFiltros);\n      document.getElementById(\u0027btnConfirmarEntrega\u0027).addEventListener(\u0027click\u0027, confirmarEntrega);\n\n      document.getElementById(\u0027filtroBusca\u0027).addEventListener(\u0027keydown\u0027, e\u003d\u003e{\n        if (e.key \u003d\u003d\u003d \u0027Enter\u0027) buscarRapido();\n      });\n\n      carregarOpcoesFiltros();\n      carregarLista();\n    });\n  \u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},{"id":"cc49ef43-e8f1-4a8d-b555-e40d51c9d745","name":"ti","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml lang\u003d\"pt-BR\"\u003e\n\u003chead\u003e\n  \u003cbase target\u003d\"_top\"\u003e\n  \u003cmeta charset\u003d\"UTF-8\" /\u003e\n  \u003cmeta name\u003d\"viewport\" content\u003d\"width\u003ddevice-width,initial-scale\u003d1\" /\u003e\n  \u003ctitle\u003eTI ‚Ä¢ Chamados\u003c/title\u003e\n  \u003cscript src\u003d\"https://cdn.tailwindcss.com\"\u003e\u003c/script\u003e\n\u003c/head\u003e\n\u003cbody class\u003d\"bg-slate-50 text-slate-900\"\u003e\n  \u003cdiv class\u003d\"max-w-6xl mx-auto p-4\"\u003e\n    \u003cdiv class\u003d\"flex flex-col gap-3 md:flex-row md:items-center md:justify-between\"\u003e\n      \u003cdiv\u003e\n        \u003ch1 class\u003d\"text-2xl font-extrabold\"\u003e‚öôÔ∏è TI ‚Ä¢ Chamados\u003c/h1\u003e\n        \u003cp class\u003d\"text-slate-600 text-sm\"\u003eLista e tratamento dos chamados registrados pelo sistema.\u003c/p\u003e\n      \u003c/div\u003e\n      \u003cdiv class\u003d\"flex gap-2\"\u003e\n        \u003cselect id\u003d\"fStatus\" class\u003d\"px-3 py-2 rounded-xl border border-slate-200 bg-white\"\u003e\n          \u003coption value\u003d\"ABERTO\"\u003eABERTO\u003c/option\u003e\n          \u003coption value\u003d\"EM ANDAMENTO\"\u003eEM ANDAMENTO\u003c/option\u003e\n          \u003coption value\u003d\"RESOLVIDO\"\u003eRESOLVIDO\u003c/option\u003e\n          \u003coption value\u003d\"CANCELADO\"\u003eCANCELADO\u003c/option\u003e\n          \u003coption value\u003d\"TODOS\"\u003eTODOS\u003c/option\u003e\n        \u003c/select\u003e\n        \u003cinput id\u003d\"fQ\" placeholder\u003d\"Buscar (protocolo, nome, setor, texto...)\" class\u003d\"w-72 px-3 py-2 rounded-xl border border-slate-200 bg-white\" /\u003e\n        \u003cbutton id\u003d\"btnReload\" class\u003d\"px-4 py-2 rounded-xl bg-slate-900 text-white font-bold\"\u003eAtualizar\u003c/button\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cdiv id\u003d\"msg\" class\u003d\"mt-3 hidden px-4 py-3 rounded-xl border\"\u003e\u003c/div\u003e\n\n    \u003cdiv class\u003d\"mt-4 bg-white border border-slate-200 rounded-2xl overflow-hidden shadow-sm\"\u003e\n      \u003cdiv class\u003d\"p-3 border-b border-slate-100 flex items-center justify-between\"\u003e\n        \u003cdiv class\u003d\"font-extrabold\"\u003eChamados\u003c/div\u003e\n        \u003cdiv id\u003d\"count\" class\u003d\"text-sm text-slate-600\"\u003e\u003c/div\u003e\n      \u003c/div\u003e\n      \u003cdiv class\u003d\"overflow-x-auto\"\u003e\n        \u003ctable class\u003d\"w-full text-sm\"\u003e\n          \u003cthead class\u003d\"bg-slate-50 text-slate-600\"\u003e\n            \u003ctr\u003e\n              \u003cth class\u003d\"text-left p-3\"\u003eProtocolo\u003c/th\u003e\n              \u003cth class\u003d\"text-left p-3\"\u003eData\u003c/th\u003e\n              \u003cth class\u003d\"text-left p-3\"\u003eNome\u003c/th\u003e\n              \u003cth class\u003d\"text-left p-3\"\u003eSetor\u003c/th\u003e\n              \u003cth class\u003d\"text-left p-3\"\u003eCategoria\u003c/th\u003e\n              \u003cth class\u003d\"text-left p-3\"\u003ePrioridade\u003c/th\u003e\n              \u003cth class\u003d\"text-left p-3\"\u003eStatus\u003c/th\u003e\n              \u003cth class\u003d\"text-left p-3\"\u003eAnexo\u003c/th\u003e\n              \u003cth class\u003d\"text-left p-3\"\u003eA√ß√µes\u003c/th\u003e\n            \u003c/tr\u003e\n          \u003c/thead\u003e\n          \u003ctbody id\u003d\"tb\" class\u003d\"divide-y divide-slate-100\"\u003e\u003c/tbody\u003e\n        \u003c/table\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003c!-- Drawer --\u003e\n    \u003cdiv id\u003d\"drawer\" class\u003d\"fixed inset-0 hidden\"\u003e\n      \u003cdiv class\u003d\"absolute inset-0 bg-black/40\" id\u003d\"dwBg\"\u003e\u003c/div\u003e\n      \u003cdiv class\u003d\"absolute right-0 top-0 h-full w-full max-w-xl bg-white shadow-2xl p-5 overflow-y-auto\"\u003e\n        \u003cdiv class\u003d\"flex items-start justify-between gap-3\"\u003e\n          \u003cdiv\u003e\n            \u003cdiv id\u003d\"dwProt\" class\u003d\"text-xl font-extrabold\"\u003e\u003c/div\u003e\n            \u003cdiv id\u003d\"dwSub\" class\u003d\"text-sm text-slate-600\"\u003e\u003c/div\u003e\n          \u003c/div\u003e\n          \u003cbutton id\u003d\"dwClose\" class\u003d\"px-3 py-2 rounded-xl border border-slate-200 font-bold\"\u003eFechar\u003c/button\u003e\n        \u003c/div\u003e\n\n        \u003cdiv class\u003d\"mt-4 grid grid-cols-1 gap-3\"\u003e\n          \u003cdiv class\u003d\"bg-slate-50 border border-slate-200 rounded-2xl p-4\"\u003e\n            \u003cdiv class\u003d\"font-bold mb-2\"\u003eDescri√ß√£o\u003c/div\u003e\n            \u003cdiv id\u003d\"dwDesc\" class\u003d\"text-sm whitespace-pre-wrap\"\u003e\u003c/div\u003e\n          \u003c/div\u003e\n\n          \u003cdiv class\u003d\"grid grid-cols-1 md:grid-cols-2 gap-3\"\u003e\n            \u003cdiv\u003e\n              \u003clabel class\u003d\"text-xs font-bold text-slate-600\"\u003eStatus\u003c/label\u003e\n              \u003cselect id\u003d\"dwStatus\" class\u003d\"w-full px-3 py-2 rounded-xl border border-slate-200 bg-white\"\u003e\n                \u003coption value\u003d\"ABERTO\"\u003eABERTO\u003c/option\u003e\n                \u003coption value\u003d\"EM ANDAMENTO\"\u003eEM ANDAMENTO\u003c/option\u003e\n                \u003coption value\u003d\"RESOLVIDO\"\u003eRESOLVIDO\u003c/option\u003e\n                \u003coption value\u003d\"CANCELADO\"\u003eCANCELADO\u003c/option\u003e\n              \u003c/select\u003e\n            \u003c/div\u003e\n            \u003cdiv\u003e\n              \u003clabel class\u003d\"text-xs font-bold text-slate-600\"\u003eRespons√°vel\u003c/label\u003e\n              \u003cinput id\u003d\"dwResp\" class\u003d\"w-full px-3 py-2 rounded-xl border border-slate-200 bg-white\" placeholder\u003d\"Nome do t√©cnico\" /\u003e\n            \u003c/div\u003e\n          \u003c/div\u003e\n\n          \u003cdiv\u003e\n            \u003clabel class\u003d\"text-xs font-bold text-slate-600\"\u003eObserva√ß√£o\u003c/label\u003e\n            \u003ctextarea id\u003d\"dwObs\" rows\u003d\"4\" class\u003d\"w-full px-3 py-2 rounded-xl border border-slate-200 bg-white\" placeholder\u003d\"Atualiza√ß√£o do atendimento...\"\u003e\u003c/textarea\u003e\n          \u003c/div\u003e\n\n          \u003cdiv class\u003d\"flex gap-2\"\u003e\n            \u003ca id\u003d\"dwAnexo\" target\u003d\"_blank\" class\u003d\"px-4 py-2 rounded-xl border border-slate-200 font-bold hidden\"\u003eAbrir anexo\u003c/a\u003e\n            \u003cbutton id\u003d\"dwSave\" class\u003d\"px-4 py-2 rounded-xl bg-emerald-600 text-white font-extrabold\"\u003eSalvar\u003c/button\u003e\n          \u003c/div\u003e\n\n          \u003cdiv id\u003d\"dwInfo\" class\u003d\"text-xs text-slate-500\"\u003e\u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\n\u003cscript\u003e\n  const tb \u003d document.getElementById(\u0027tb\u0027);\n  const count \u003d document.getElementById(\u0027count\u0027);\n  const msg \u003d document.getElementById(\u0027msg\u0027);\n\n  const fStatus \u003d document.getElementById(\u0027fStatus\u0027);\n  const fQ \u003d document.getElementById(\u0027fQ\u0027);\n  document.getElementById(\u0027btnReload\u0027).addEventListener(\u0027click\u0027, load);\n\n  // Drawer\n  const drawer \u003d document.getElementById(\u0027drawer\u0027);\n  const dwBg \u003d document.getElementById(\u0027dwBg\u0027);\n  const dwClose \u003d document.getElementById(\u0027dwClose\u0027);\n  const dwProt \u003d document.getElementById(\u0027dwProt\u0027);\n  const dwSub \u003d document.getElementById(\u0027dwSub\u0027);\n  const dwDesc \u003d document.getElementById(\u0027dwDesc\u0027);\n  const dwStatus \u003d document.getElementById(\u0027dwStatus\u0027);\n  const dwResp \u003d document.getElementById(\u0027dwResp\u0027);\n  const dwObs \u003d document.getElementById(\u0027dwObs\u0027);\n  const dwAnexo \u003d document.getElementById(\u0027dwAnexo\u0027);\n  const dwSave \u003d document.getElementById(\u0027dwSave\u0027);\n  const dwInfo \u003d document.getElementById(\u0027dwInfo\u0027);\n\n  let currentLinha \u003d null;\n\n  function toast(text, ok\u003dtrue){\n    msg.classList.remove(\u0027hidden\u0027);\n    msg.className \u003d \u0027mt-3 px-4 py-3 rounded-xl border \u0027 + (ok ? \u0027bg-emerald-50 border-emerald-200 text-emerald-900\u0027 : \u0027bg-red-50 border-red-200 text-red-900\u0027);\n    msg.textContent \u003d text;\n    setTimeout(()\u003d\u003emsg.classList.add(\u0027hidden\u0027), 3500);\n  }\n\n  function openDrawer(item){\n    currentLinha \u003d item.linha;\n    dwProt.textContent \u003d item.protocolo || \u0027\u0027;\n    dwSub.textContent \u003d `${item.nome || \u0027\u0027} ‚Ä¢ ${item.setor || \u0027\u0027} ‚Ä¢ ${item.categoria || \u0027\u0027} ‚Ä¢ ${item.prioridade || \u0027\u0027}`;\n    dwDesc.textContent \u003d item.descricao || \u0027\u0027;\n    dwStatus.value \u003d (item.status || \u0027ABERTO\u0027).toUpperCase();\n    dwResp.value \u003d item.responsavel || \u0027\u0027;\n    dwObs.value \u003d item.obs || \u0027\u0027;\n    dwInfo.textContent \u003d `Criado em: ${item.carimbo || \u0027\u0027} | Atualizado: ${item.atualizado_em || \u0027\u0027}`;\n\n    if (item.anexo){\n      dwAnexo.href \u003d item.anexo;\n      dwAnexo.classList.remove(\u0027hidden\u0027);\n    } else {\n      dwAnexo.classList.add(\u0027hidden\u0027);\n      dwAnexo.removeAttribute(\u0027href\u0027);\n    }\n\n    drawer.classList.remove(\u0027hidden\u0027);\n  }\n  function closeDrawer(){\n    drawer.classList.add(\u0027hidden\u0027);\n    currentLinha \u003d null;\n  }\n  dwBg.addEventListener(\u0027click\u0027, closeDrawer);\n  dwClose.addEventListener(\u0027click\u0027, closeDrawer);\n  document.addEventListener(\u0027keydown\u0027, (e)\u003d\u003e{ if(e.key\u003d\u003d\u003d\u0027Escape\u0027 \u0026\u0026 !drawer.classList.contains(\u0027hidden\u0027)) closeDrawer(); });\n\n  dwSave.addEventListener(\u0027click\u0027, ()\u003d\u003e{\n    if(!currentLinha) return;\n    const patch \u003d {\n      status: dwStatus.value,\n      responsavel: dwResp.value,\n      obs: dwObs.value\n    };\n    dwSave.disabled \u003d true;\n    google.script.run\n      .withSuccessHandler(()\u003d\u003e{\n        dwSave.disabled \u003d false;\n        toast(\u0027Atualizado com sucesso!\u0027);\n        closeDrawer();\n        load();\n      })\n      .withFailureHandler((err)\u003d\u003e{\n        dwSave.disabled \u003d false;\n        console.error(err);\n        toast(\u0027Falha ao atualizar.\u0027, false);\n      })\n      .ti_atualizarChamado(currentLinha, patch);\n  });\n\n  function badge(st){\n    st \u003d String(st||\u0027\u0027).toUpperCase();\n    const map \u003d {\n      \u0027ABERTO\u0027:\u0027bg-red-50 text-red-700 border-red-200\u0027,\n      \u0027EM ANDAMENTO\u0027:\u0027bg-amber-50 text-amber-700 border-amber-200\u0027,\n      \u0027RESOLVIDO\u0027:\u0027bg-emerald-50 text-emerald-700 border-emerald-200\u0027,\n      \u0027CANCELADO\u0027:\u0027bg-slate-100 text-slate-700 border-slate-200\u0027\n    };\n    return map[st] || \u0027bg-slate-100 text-slate-700 border-slate-200\u0027;\n  }\n\n  function rowHtml(it){\n    const anexo \u003d it.anexo ? `\u003ca class\u003d\"text-blue-600 font-bold\" target\u003d\"_blank\" href\u003d\"${it.anexo}\"\u003eAbrir\u003c/a\u003e` : \u0027-\u0027;\n    return `\n      \u003ctr class\u003d\"hover:bg-slate-50\"\u003e\n        \u003ctd class\u003d\"p-3 font-extrabold\"\u003e${it.protocolo||\u0027\u0027}\u003c/td\u003e\n        \u003ctd class\u003d\"p-3\"\u003e${it.carimbo||\u0027\u0027}\u003c/td\u003e\n        \u003ctd class\u003d\"p-3\"\u003e${it.nome||\u0027\u0027}\u003c/td\u003e\n        \u003ctd class\u003d\"p-3\"\u003e${it.setor||\u0027\u0027}\u003c/td\u003e\n        \u003ctd class\u003d\"p-3\"\u003e${it.categoria||\u0027\u0027}\u003c/td\u003e\n        \u003ctd class\u003d\"p-3\"\u003e${it.prioridade||\u0027\u0027}\u003c/td\u003e\n        \u003ctd class\u003d\"p-3\"\u003e\u003cspan class\u003d\"inline-flex px-2 py-1 rounded-lg border text-xs font-extrabold ${badge(it.status)}\"\u003e${it.status||\u0027\u0027}\u003c/span\u003e\u003c/td\u003e\n        \u003ctd class\u003d\"p-3\"\u003e${anexo}\u003c/td\u003e\n        \u003ctd class\u003d\"p-3\"\u003e\n          \u003cbutton class\u003d\"px-3 py-2 rounded-xl bg-slate-900 text-white font-bold\" data-open\u003d\"${it.linha}\"\u003eAbrir\u003c/button\u003e\n        \u003c/td\u003e\n      \u003c/tr\u003e\n    `;\n  }\n\n  function load(){\n    tb.innerHTML \u003d `\u003ctr\u003e\u003ctd class\u003d\"p-4 text-slate-500\" colspan\u003d\"9\"\u003eCarregando...\u003c/td\u003e\u003c/tr\u003e`;\n    google.script.run\n      .withSuccessHandler((res)\u003d\u003e{\n        const arr \u003d (res \u0026\u0026 res.chamados) ? res.chamados : [];\n        count.textContent \u003d `${arr.length} registros`;\n        if(!arr.length){\n          tb.innerHTML \u003d `\u003ctr\u003e\u003ctd class\u003d\"p-4 text-slate-500\" colspan\u003d\"9\"\u003eNenhum chamado encontrado.\u003c/td\u003e\u003c/tr\u003e`;\n          return;\n        }\n        tb.innerHTML \u003d arr.map(rowHtml).join(\u0027\u0027);\n        tb.querySelectorAll(\u0027[data-open]\u0027).forEach(btn\u003d\u003e{\n          btn.addEventListener(\u0027click\u0027, ()\u003d\u003e{\n            const linha \u003d parseInt(btn.getAttribute(\u0027data-open\u0027),10);\n            const item \u003d arr.find(x\u003d\u003ex.linha\u003d\u003d\u003dlinha);\n            if(item) openDrawer(item);\n          });\n        });\n      })\n      .withFailureHandler((err)\u003d\u003e{\n        console.error(err);\n        tb.innerHTML \u003d `\u003ctr\u003e\u003ctd class\u003d\"p-4 text-red-600\" colspan\u003d\"9\"\u003eErro ao carregar.\u003c/td\u003e\u003c/tr\u003e`;\n      })\n      .ti_listarChamados({ status: fStatus.value, q: fQ.value });\n  }\n\n  load();\n\u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"}]}